<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- Primary Meta Tags -->
    <title>The Rabbit Test | Interactive Psychological Horror Experience</title>
    <meta name="title" content="The Rabbit Test | Interactive Psychological Horror Experience">
    <meta name="description" content="A mandatory compliance assessment. Answer the questions. Follow the protocol. Do not investigate the anomalies. An interactive psychological horror experience that blurs the line between employee training and something far more sinister.">
    <meta name="keywords" content="interactive fiction, psychological horror, web experience, corporate horror, ARG, alternate reality game, horror game, browser game, interactive story">
    <meta name="author" content="Enju Roger Jung">
    <meta name="creator" content="Enju Roger Jung (@grizz.lemon)">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://rabbittest.io/">
    <meta property="og:title" content="The Rabbit Test | Interactive Psychological Horror">
    <meta property="og:description" content="A mandatory compliance assessment awaits. Answer the questions. Follow the protocol. Do not investigate the anomalies. Are you ready to begin?">
    <meta property="og:image" content="https://rabbittest.io/og-image.png">
    <meta property="og:site_name" content="The Rabbit Test">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://rabbittest.io/">
    <meta property="twitter:title" content="The Rabbit Test | Interactive Psychological Horror">
    <meta property="twitter:description" content="A mandatory compliance assessment awaits. Answer the questions. Follow the protocol. Do not investigate the anomalies.">
    <meta property="twitter:image" content="https://rabbittest.io/og-image.png">
    
    <!-- PWA / Immersion Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Rabbit Test">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#faf8f5">
    <meta name="msapplication-navbutton-color" content="#faf8f5">
    <meta name="msapplication-TileColor" content="#faf8f5">
    <meta name="format-detection" content="telephone=no">
    
    <!-- Prevent caching issues -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7RGD6JEWGQ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-7RGD6JEWGQ');
        
        // Analytics helper function
        function trackEvent(eventName, params = {}) {
            if (typeof gtag !== 'undefined') {
                gtag('event', eventName, params);
            }
        }
    </script>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='40' fill='%23ff8a80'/></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%230d0a07'/><circle cx='50' cy='50' r='30' fill='%23ff8a80'/></svg>">
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json,%7B%22name%22%3A%22The%20Rabbit%20Test%22%2C%22short_name%22%3A%22RabbitTest%22%2C%22start_url%22%3A%22.%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%230d0a07%22%2C%22theme_color%22%3A%22%230d0a07%22%7D">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Londrina+Sketch&family=VT323&family=Space+Mono:wght@400;700&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            /* ════════════════════════════════
               THE RABBIT TEST — COLOR BIBLE
               Aesthetic: Cute Corporate (Doki Doki Style)
               The horror hides beneath the pastel surface
               ════════════════════════════════ */
            
            /* ─── CRT EFFECT COLORS (kept for glitch moments) ─── */
            --crt-red: rgb(218, 49, 49);
            --crt-green: rgb(112, 159, 115);
            --crt-blue: rgb(40, 129, 206);
            
            /* ─── BACKGROUNDS (Soft, Inviting, Safe-looking) ─── */
            --bg-primary: #faf8f5;
            --bg-secondary: #f5f0eb;
            --bg-elevated: #ffffff;
            --bg-card: #fff9f7;
            
            /* ─── TEXT HIERARCHY (Dark, Readable) ─── */
            --text-bright: #1a1a1a;
            --text-primary: #2d2d2d;
            --text-secondary: #555555;
            --text-dim: #888888;
            --text-ghost: #cccccc;
            
            /* ════════════════════════════════
               THE STORY COLORS — Pastel & Friendly (hiding darkness)
               Using complementary color theory for harmony
               ════════════════════════════════ */
            
            /* FACILITY - Soft Lavender (seems calming, actually oppressive) */
            --facility: #7c6c9a;
            --facility-glow: rgba(124, 108, 154, 0.2);
            --facility-soft: rgba(124, 108, 154, 0.08);
            
            /* VINCENT - Soft Blue (melancholy, gentle sadness) */
            --vincent: #6b9ebe;
            --vincent-bright: #89b5d1;
            --vincent-glow: rgba(107, 158, 190, 0.3);
            --vincent-subtle: rgba(107, 158, 190, 0.1);
            
            /* ISLA/RABBIT - Coral Pink [THE BRAND COLOR] (love, warmth) */
            --rabbit: #e8707e;
            --rabbit-glow: rgba(232, 112, 126, 0.3);
            --rabbit-subtle: rgba(232, 112, 126, 0.12);
            --coral: var(--rabbit);
            --coral-glow: var(--rabbit-glow);
            
            /* OWEN - Warm Peach/Apricot (innocent, hopeful) */
            --owen: #f0a868;
            --owen-glow: rgba(240, 168, 104, 0.3);
            --owen-subtle: rgba(240, 168, 104, 0.1);
            
            /* MARCUS - Bright Mint (energetic, playful) */
            --marcus: #5ec69e;
            --marcus-glow: rgba(94, 198, 158, 0.3);
            
            /* FREEDOM GREEN - Soft Teal */
            --freedom: #4a9e8c;
            --freedom-glow: rgba(74, 158, 140, 0.3);
            
            /* DEATH - Muted Rose (death should feel sad, not just scary) */
            --terminated: #a84858;
            
            /* ─── STRUCTURAL (Soft, Friendly Borders) ─── */
            --border: #e8e0d8;
            --border-light: #f0e8e0;
            --redacted: #e0d8d0;
            
            /* ─── SPACING SYSTEM (8px base) ─── */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-2xl: 48px;
            --space-3xl: 64px;
            
            /* ─── TOUCH TARGETS (44px minimum for iOS) ─── */
            --touch-target: 44px;
            --touch-target-lg: 52px;
            
            /* ─── SAFE AREAS ─── */
            --safe-top: env(safe-area-inset-top, 0px);
            --safe-bottom: env(safe-area-inset-bottom, 0px);
            --safe-left: env(safe-area-inset-left, 0px);
            --safe-right: env(safe-area-inset-right, 0px);
            
            /* ─── LEGACY ALIASES (mapped to new system) ─── */
            --amber: var(--vincent);
            --amber-glow: var(--vincent-glow);
            --amber-bright: var(--vincent-bright);
            --isla: var(--rabbit);
            --rabbit-dead: var(--terminated);
            --white: var(--text-primary);
            --ice: var(--facility);
            --green: var(--freedom);
            --green-bright: var(--freedom);
            --teal: var(--freedom);
            --system-green: var(--freedom);
            --text-hero: var(--text-primary);
            --vincent-lie: var(--text-dim);
        }

        /* ════════════════════════════════
           DARK MODE — CSS FILTER INVERSION
           Applied via .dark-mode class on themeable pages only
           (Not Owen's page, not game pages, not special character pages)
           
           STRATEGY: Main page content gets inverted. Fixed-position overlays
           and modals get counter-inverted to maintain their original appearance.
           ════════════════════════════════ */
        
        /* Invert only the active page content */
        .dark-mode .page.active {
            filter: invert(1) hue-rotate(180deg);
            background: #ffffff;
        }
        
        /* ─── FIXED-POSITION OVERLAYS: Counter-invert to maintain original look ─── */
        
        /* Break warning modal (appears on testbreak/testbreak2) */
        .dark-mode .page.active .break-warning-modal {
            filter: invert(1) hue-rotate(180deg);
        }
        
        /* Break complete/skipped screens (appears on testbreak/testbreak2) */
        .dark-mode .page.active .break-over-screen {
            filter: invert(1) hue-rotate(180deg);
        }
        
        /* Final sequence overlay (Vincent's encrypted message) */
        .dark-mode .page.active .final-sequence-overlay {
            filter: invert(1) hue-rotate(180deg);
        }
        
        /* Report modal */
        .dark-mode .page.active .report-modal {
            filter: invert(1) hue-rotate(180deg);
        }
        
        /* ─── ENDING PAGE: Special handling due to position:fixed content ─── */
        
        /* Exclude endingPage from general inversion - handle separately */
        .dark-mode #endingPage.active {
            filter: none;
            background: #0a0a0a;
        }
        
        /* Apply inversion to ending-page content (fixed position element) */
        .dark-mode #endingPage.active .ending-page {
            filter: invert(1) hue-rotate(180deg);
        }
        
        /* Processing text before ending-page loads */
        .dark-mode #endingPage.active #endingContent > div:not(.ending-page) {
            color: #a0a0a0 !important;
        }
        
        .dark-mode #endingPage.active #endingContent > div:not(.ending-page) div {
            color: #a0a0a0 !important;
        }
        
        /* Counter-invert restart buttons so they display correctly */
        .dark-mode #endingPage.active .ending-restart.owen-login-large {
            filter: invert(1) hue-rotate(180deg);
        }
        
        /* Same handling for other ending pages */
        .dark-mode #secretEndingPage.active,
        .dark-mode #hireEndingPage.active,
        .dark-mode #perfectEndingPage.active,
        .dark-mode #finalUploadPage.active {
            filter: none;
            background: #0a0a0a;
        }
        
        .dark-mode #secretEndingPage.active .ending-page,
        .dark-mode #hireEndingPage.active .ending-page,
        .dark-mode #perfectEndingPage.active .ending-page,
        .dark-mode #finalUploadPage.active .ending-page {
            filter: invert(1) hue-rotate(180deg);
        }
        
        .dark-mode #secretEndingPage.active .ending-restart.owen-login-large,
        .dark-mode #hireEndingPage.active .ending-restart.owen-login-large,
        .dark-mode #perfectEndingPage.active .ending-restart.owen-login-large,
        .dark-mode #finalUploadPage.active .ending-restart.owen-login-large {
            filter: invert(1) hue-rotate(180deg);
        }
        
        /* ─── MEDIA: Keep images/videos looking correct ─── */
        
        /* Counter-invert media so they display with original colors */
        .dark-mode .page.active img,
        .dark-mode .page.active video,
        .dark-mode .page.active canvas,
        .dark-mode .page.active svg,
        .dark-mode .page.active [class*="emoji"] {
            filter: invert(1) hue-rotate(180deg);
        }
        
        /* Dance character images are already correct, just add shadow */
        .dark-mode .page.active img.dance-character {
            filter: drop-shadow(0 0 8px rgba(0,0,0,0.3));
        }
        
        /* Media inside counter-inverted overlays need another inversion */
        .dark-mode .page.active .break-warning-modal img,
        .dark-mode .page.active .break-over-screen img,
        .dark-mode .page.active .final-sequence-overlay img {
            filter: invert(1) hue-rotate(180deg);
        }
        
        /* ─── CRT OVERLAY EFFECT ─── */
        .dark-mode body::after {
            filter: invert(1);
        }
        
        /* ─── TIMER/NAV BAR DARK MODE ─── */
        body.dark-mode .timer {
            background: linear-gradient(180deg, rgba(20, 20, 20, 0.98) 0%, rgba(15, 15, 15, 0.95) 100%);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        body.dark-mode .player-name-ticker.scrolling::before {
            background: linear-gradient(to right, rgba(20, 20, 20, 1), transparent);
        }
        
        body.dark-mode .player-name-ticker.scrolling::after {
            background: linear-gradient(to left, rgba(20, 20, 20, 1), transparent);
        }
        
        /* ─── TERMINAL BOOT OVERLAYS (appended to body, outside page system) ─── */
        /* These already have dark backgrounds, just ensure text is visible */
        body.dark-mode > .owen-boot-overlay {
            background: #080808 !important;
        }
        
        body.dark-mode > .owen-boot-overlay .boot-text {
            color: #60c8b0 !important;
        }
        
        /* ─── TERMINATION OVERLAY (outside page system) ─── */
        body.dark-mode > .termination-overlay {
            background: #0a0a0a !important;
        }
        
        body.dark-mode > .termination-text {
            color: #60c8b0 !important;
        }
        
        /* Ending page inside termination overlay */
        body.dark-mode > .termination-overlay .ending-page {
            background: linear-gradient(180deg, #1a1a1a 0%, #0f0f0f 100%) !important;
        }
        
        body.dark-mode > .termination-overlay .ending-logo {
            color: #6a7a7a !important;
        }
        
        body.dark-mode > .termination-overlay .ending-main {
            color: #e0e0e0 !important;
        }
        
        body.dark-mode > .termination-overlay .ending-form {
            color: #6a7a7a !important;
        }
        
        body.dark-mode > .termination-overlay .ending-divider-line {
            background: linear-gradient(90deg, transparent, #4a5a5a, transparent) !important;
        }
        
        body.dark-mode > .termination-overlay .ending-status {
            color: #a0b0b0 !important;
        }
        
        body.dark-mode > .termination-overlay .ending-verdict-text {
            color: #7a8a8a !important;
        }
        
        body.dark-mode > .termination-overlay .ending-instruction-text {
            color: #8a9a9a !important;
        }
        
        body.dark-mode > .termination-overlay .ending-restart.owen-login-large {
            background: linear-gradient(180deg, #2a2a2a 0%, #1a1a1a 100%) !important;
            border-color: #3a4a4a !important;
            box-shadow: 
                0 4px 0 #1a2a2a,
                0 6px 16px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.05) !important;
        }
        
        body.dark-mode > .termination-overlay .ending-restart.owen-login-large:hover {
            background: linear-gradient(180deg, #3a3a3a 0%, #2a2a2a 100%) !important;
            border-color: #4a5a5a !important;
        }
        
        body.dark-mode > .termination-overlay .login-prompt-large {
            color: #7a8a8a !important;
        }
        
        body.dark-mode > .termination-overlay .login-user-large {
            color: #c9a86c !important;
        }
        
        body.dark-mode > .termination-overlay .login-action-large {
            color: #8a9a9a !important;
        }
        
        body.dark-mode > .termination-overlay .login-id-large {
            color: #6a7a7a !important;
        }
        
        body.dark-mode > .termination-overlay .login-divider {
            color: #4a5a5a !important;
        }
        
        body.dark-mode > .termination-overlay .ending-restart.owen-login-large::before,
        body.dark-mode > .termination-overlay .ending-restart.owen-login-large::after {
            color: #3a4a4a !important;
        }

        /* ════════════════════════════════
           CHARACTER COLOR CLASSES
           ════════════════════════════════ */
        
        /* Vincent - Soft Blue, gentle melancholy */
        .c-vincent { 
            color: var(--vincent); 
            text-shadow: 0 1px 2px var(--vincent-glow);
        }
        
        /* Vincent's V signature - Snake green to connect him to the snake game */
        .c-vincent-v,
        .c-vincent.snake-green { 
            color: #00ff88;
            text-shadow: 0 0 8px rgba(0, 255, 136, 0.5);
        }
        
        /* Snake game V button - bright snake green */
        .game-btn.snake-v {
            color: #00ff88;
            text-shadow: 0 0 6px rgba(0, 255, 136, 0.4);
        }
        
        .game-btn.snake-v:hover {
            color: #00ff88;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.6);
        }
        
        /* Isla/Rabbit - Coral Pink, love and warmth */
        .c-rabbit { 
            color: var(--rabbit); 
            text-shadow: 0 1px 2px var(--rabbit-glow);
        }
        .c-rabbit-mid { color: var(--rabbit); }
        .c-rabbit-dead { color: var(--terminated); }
        .c-isla { 
            color: var(--rabbit); 
            text-shadow: 0 1px 2px var(--rabbit-glow);
        }
        
        /* Owen - Warm Peach, hope and innocence */
        .c-owen { 
            color: var(--owen); 
            text-shadow: 0 1px 2px var(--owen-glow);
        }
        
        /* Facility - Soft Lavender, the consuming force */
        .c-facility { 
            color: var(--facility); 
            text-shadow: 0 1px 2px var(--facility-glow);
        }
        .c-ice { 
            color: var(--facility); 
            text-shadow: 0 1px 3px rgba(124, 108, 154, 0.4);
        }
        .c-cold { color: var(--facility); }
        .c-system { color: var(--facility); }
        
        /* THE SILVER HORSE - containment entity styling (now dark on light) */
        .silver-horse {
            color: #4a3a5c;
            text-shadow: 
                0 2px 4px rgba(74, 58, 92, 0.3),
                0 4px 8px rgba(74, 58, 92, 0.2),
                0 0 20px rgba(124, 108, 154, 0.3);
            animation: horseGlitch 3s ease-in-out infinite, horsePulse 1.5s ease-in-out infinite;
            position: relative;
            display: inline;
            letter-spacing: 2px;
        }
        
        @keyframes horsePulse {
            0%, 100% { 
                text-shadow: 
                    0 2px 4px rgba(74, 58, 92, 0.3),
                    0 4px 8px rgba(74, 58, 92, 0.2),
                    0 0 20px rgba(124, 108, 154, 0.3);
                opacity: 1;
            }
            50% { 
                text-shadow: 
                    0 2px 6px rgba(74, 58, 92, 0.5),
                    0 4px 12px rgba(74, 58, 92, 0.3),
                    0 0 30px rgba(124, 108, 154, 0.5);
                opacity: 0.95;
            }
        }
        
        @keyframes horseGlitch {
            0%, 100% { transform: translateX(0); }
            92% { transform: translateX(0); }
            93% { transform: translateX(-2px) skewX(-1deg); }
            94% { transform: translateX(3px) skewX(2deg); }
            95% { transform: translateX(-1px); }
            96% { transform: translateX(2px) skewX(-1deg); }
            97% { transform: translateX(0); }
        }
        
        /* Emphasis and utility */
        .c-emphasis { 
            color: var(--text-bright); 
            font-weight: 400; 
        }
        .c-warm { 
            color: var(--owen); 
            text-shadow: 0 0 10px var(--owen-glow);
        }
        .c-terminated { 
            color: var(--terminated); 
            font-weight: bold; 
        }
        .c-crossed { 
            text-decoration: line-through; 
            opacity: 0.6;
            position: relative;
        }
        .c-marcus, .c-marcus { 
            color: var(--marcus); 
            text-shadow: 0 1px 2px var(--marcus-glow);
        }
        .c-correction {
            color: var(--text-dim);
        }
        
        /* Vincent lie text - muted, uncertain */
        .c-vincent-lie { 
            color: var(--text-dim) !important;
            font-style: italic !important;
        }
        
        .c-crossed::before,
        .c-crossed::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            height: 1px;
            background: currentColor;
        }
        
        .c-crossed::before {
            top: 30%;
            transform: rotate(-2deg);
        }
        
        .c-crossed::after {
            top: 70%;
            transform: rotate(1deg);
        }
        .c-correction {
            color: var(--text-primary);
            font-style: italic;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }

        html {
            font-size: 15px;
            overscroll-behavior: none;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            /* Prevent overscroll/bounce at edges */
            height: 100%;
        }

        @media (min-width: 390px) {
            html {
                font-size: 16px;
            }
        }

        @media (min-width: 768px) {
            html {
                font-size: 17px;
            }
        }

        @media (min-width: 1200px) {
            html {
                font-size: 18px;
            }
        }

        @keyframes flicker {
            0%, 100% { opacity: 1; }
            92% { opacity: 1; }
            93% { opacity: 0.98; }
            94% { opacity: 1; }
        }
        
        /* CRT Blinking Cursor */
        @keyframes blinkTextCursor {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }
        
        .crt-cursor {
            display: inline-block;
            animation: blinkTextCursor 500ms infinite;
            color: var(--text-bright);
            text-shadow: 
                0 0 0.3em currentColor,
                1px 1px rgba(255, 0, 255, 0.4),
                -1px -1px rgba(0, 255, 255, 0.35);
        }
        
        /* CRT typewriter effect */
        @keyframes typewriter {
            from { width: 0; }
            to { width: 100%; }
        }
        
        .crt-typewriter {
            display: inline-block;
            overflow: hidden;
            white-space: nowrap;
            animation: typewriter 1s steps(20) forwards;
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: 'Space Mono', monospace;
            font-size: 1rem;
            line-height: 1.75;
            min-height: 100vh;
            min-height: 100dvh;
            overflow-x: hidden;
            overflow-y: scroll;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: none;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
            animation: flicker 15s infinite;
            word-wrap: break-word;
            overflow-wrap: break-word;
            padding-top: var(--safe-top);
            padding-bottom: var(--safe-bottom);
            padding-left: var(--safe-left);
            padding-right: var(--safe-right);
            /* Subtle shadow for depth on light background */
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.04);
            /* Prevent double-tap zoom */
            touch-action: manipulation;
            -ms-touch-action: manipulation;
            /* Prevent text selection on tap */
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            /* Prevent text selection globally */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* Prevent zoom on all interactive elements */
        input, textarea, select, button {
            font-size: 16px; /* Prevents iOS zoom on focus */
            touch-action: manipulation;
        }
        
        /* Re-enable text selection for input fields */
        input, textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        /* ════════════════════════════════
           PERFORMANCE OPTIMIZATIONS
           - Reduced overlays from 4 to 2 (combined effects)
           - Using contain: strict for better layer isolation
           - Added will-change hints for animated elements
           - Reduced motion support for accessibility
           ════════════════════════════════ */
        
        /* Respect user's motion preferences */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* Combined CRT overlay - single layer instead of multiple */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: 
                /* Vignette */
                radial-gradient(ellipse at center, transparent 0%, transparent 55%, rgba(0,0,0,0.25) 100%),
                /* Scanlines - simplified */
                repeating-linear-gradient(0deg, transparent 0px, transparent 2px, rgba(0,0,0,0.03) 2px, rgba(0,0,0,0.03) 4px);
            z-index: 9998;
            contain: strict;
        }
        
        /* Noise overlay - only on desktop for performance */
        @media (min-width: 768px) {
            body::before {
                content: '';
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                opacity: 0.008;
                background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='2'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
                z-index: 9999;
                contain: strict;
            }
        }
        
        /* Remove separate overlay divs - effects combined above */
        .crt-rgb-overlay,
        .crt-vignette {
            display: none;
        }
        
        /* ============ CRT TEXT EFFECTS - OPTIMIZED ============ */
        /* Chromatic aberration ONLY on headings (not body text) */
        h1, h2, .scenario-headline-main, .game-title, .ending-main,
        .title-main, .section-header, .assessment-header, .break-header h2,
        .training-section-header, .story-title {
            text-shadow: 
                0 0 0.3em currentColor,
                1px 1px rgba(255, 0, 255, 0.3),
                -1px -1px rgba(0, 255, 255, 0.25);
            will-change: transform;
        }
        
        /* Simplified glow for character colors - no chromatic aberration */
        .c-rabbit, .c-rabbit-mid, [style*="--rabbit"] {
            text-shadow: 0 0 8px var(--rabbit-glow);
        }
        
        .c-owen, [style*="--owen"] {
            text-shadow: 0 0 6px var(--owen-glow);
        }
        
        .c-vincent, [style*="--vincent"] {
            text-shadow: 0 0 6px var(--vincent-glow);
        }
        
        /* Body text - no shadow for performance */
        p, li, .rule-desc, .scenario-body, .final-letter-line {
            text-shadow: none;
        }

        /* ============ INTENSE CRT EFFECTS FOR TERMINAL MESSAGES - OPTIMIZED ============ */
        
        /* Simplified scanlines - no animation on mobile */
        .final-block-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            background: repeating-linear-gradient(
                0deg,
                transparent 0px,
                transparent 2px,
                rgba(0, 0, 0, 0.08) 2px,
                rgba(0, 0, 0, 0.08) 4px
            );
            z-index: 10;
            opacity: 0.6;
        }
        
        /* Animation only on desktop */
        @media (min-width: 768px) {
            .final-block-container::before {
                animation: terminalScanlineFlicker 0.15s infinite;
            }
        }
        
        @keyframes terminalScanlineFlicker {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 0.4; }
        }
        
        /* Simplified RGB split - runs less frequently */
        .final-block.revealed .final-block-content {
            animation: terminalRGBSplit 12s ease-in-out infinite;
            will-change: transform;
        }
        
        @keyframes terminalRGBSplit {
            0%, 95%, 100% { 
                text-shadow: 0 0 6px currentColor;
                transform: translateX(0);
            }
            96% {
                text-shadow: -1px 0 rgba(255, 0, 0, 0.3), 1px 0 rgba(0, 255, 255, 0.3), 0 0 8px currentColor;
                transform: translateX(-1px);
            }
            98% {
                text-shadow: 0 0 6px currentColor;
                transform: translateX(1px);
            }
        }
        
        /* Simplified phosphor glow - longer cycle */
        .final-block.revealed .final-letter-line {
            text-shadow: 0 0 4px var(--vincent), 0 0 8px var(--vincent-glow);
            animation: phosphorGlow 5s ease-in-out infinite;
        }
        
        @keyframes phosphorGlow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.92; }
        }
        
        /* Screen jitter - much less frequent */
        .final-block.revealed {
            animation: screenJitter 15s ease-in-out infinite;
            will-change: transform;
        }
        
        @keyframes screenJitter {
            0%, 98%, 100% { transform: translate(0, 0); }
            98.5% { transform: translate(-1px, 0); }
            99% { transform: translate(1px, 0); }
        }
        
        /* Simplified interference line */
        .final-block-container::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent 0%, rgba(0, 0, 0, 0.04) 50%, transparent 100%);
            pointer-events: none;
            z-index: 11;
            animation: interferenceRoll 6s linear infinite;
            will-change: transform;
        }
        
        @keyframes interferenceRoll {
            0% { transform: translateY(-10px); opacity: 0; }
            5% { opacity: 1; }
            95% { opacity: 1; }
            100% { transform: translateY(calc(100vh + 10px)); opacity: 0; }
        }
        
        /* Header glitch - simplified and less frequent */
        .final-block.revealed .final-block-header {
            animation: terminalHeaderGlitch 10s ease-in-out infinite;
        }
        
        @keyframes terminalHeaderGlitch {
            0%, 92%, 100% {
                transform: translateX(0);
            }
            93% {
                transform: translateX(2px);
            }
            94% {
                transform: translateX(-2px);
            }
            95% {
                transform: translateX(0);
            }
        }
        
        /* Intense CRT curvature/barrel effect on the container */
        .final-sequence-letter {
            position: relative;
        }

        /* Text selection color */
        ::selection {
            background: rgba(0, 212, 170, 0.3);
            color: var(--text-bright);
        }

        ::-moz-selection {
            background: rgba(0, 212, 170, 0.3);
            color: var(--text-bright);
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-dim);
        }

        /* Focus states for accessibility */
        button:focus-visible,
        .checkbox-container:focus-visible,
        .break-option:focus-visible,
        li:focus-visible {
            outline: 2px solid var(--text-bright);
            outline-offset: 2px;
        }

        /* Minimal scanlines */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: repeating-linear-gradient(
                0deg,
                transparent 0px,
                transparent 2px,
                rgba(0, 0, 0, 0.03) 2px,
                rgba(0, 0, 0, 0.03) 3px
            );
            z-index: 9998;
        }

        .container {
            width: 100%;
            max-width: 680px;
            margin: 0 auto;
            padding: 0;
        }

        .page-content {
            padding: var(--space-lg) var(--space-md);
            padding-bottom: calc(var(--space-3xl) + var(--safe-bottom));
            max-width: 100%;
            margin: 0 auto;
        }

        @media (min-width: 390px) {
            .page-content {
                padding: var(--space-xl) var(--space-lg);
                padding-bottom: calc(var(--space-3xl) + var(--safe-bottom));
            }
        }

        @media (min-width: 768px) {
            .page-content {
                padding: var(--space-2xl) var(--space-xl);
                max-width: 640px;
            }
        }

        .page {
            display: none;
            opacity: 0;
            transition: opacity 0.25s ease;
        }

        .page.active {
            display: block;
            opacity: 1;
            animation: pageFadeIn 0.3s ease;
        }
        
        /* Pause animations on hidden pages for performance */
        .page:not(.active) * {
            animation-play-state: paused !important;
        }
        
        @keyframes pageFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Ending page - no scrolling allowed */
        #endingPage.active {
            overflow: hidden;
        }
        
        #endingPage .page-content {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        /* ════════════════════════════════════
           SAFARI ADDRESS BAR HACK - Phantom spacer
           Creates invisible space at bottom so Safari never thinks
           we've reached the end of the page
           ════════════════════════════════════ */
        #phantomSpacer {
            width: 100%;
            height: 50px; /* Small fixed height - just enough to prevent address bar */
            pointer-events: none;
            user-select: none;
            -webkit-user-select: none;
            background: var(--bg-primary);
        }
        
        /* ════════════════════════════════
           PAGE TRANSITION EFFECTS
           ════════════════════════════════ */
        
        /* Standalone mode (added to home screen) - extra immersion */
        body.standalone-mode {
            /* Full immersion when running as PWA */
        }
        
        /* Add to home screen hint - only show on mobile Safari */
        .homescreen-hint {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid var(--border);
            padding: 12px 20px;
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            color: var(--text-dim);
            letter-spacing: 1px;
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: none;
            text-align: center;
            max-width: 280px;
        }
        
        .homescreen-hint.visible {
            opacity: 1;
            pointer-events: auto;
        }
        
        .homescreen-hint-close {
            position: absolute;
            top: 5px;
            right: 8px;
            background: none;
            border: none;
            color: var(--text-dim);
            font-size: 1rem;
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }
        
        /* Hide hint in standalone mode or on desktop */
        body.standalone-mode .homescreen-hint,
        @media (min-width: 768px) {
            .homescreen-hint {
                display: none;
            }
        }

        /* ============ TIMER BAR ============ */
        /* Timer CSS moved to login page section */

        .timer-spacer {
            height: 55px;
            display: none;
        }

        .timer-spacer.visible {
            display: block;
        }

        /* ============ TITLE PAGE ============ */
        .title-page {
            height: 100vh;
            height: 100dvh;
            max-height: 100vh;
            max-height: 100dvh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: var(--space-xl) var(--space-lg);
            padding-top: calc(var(--space-xl) + var(--safe-top));
            padding-bottom: calc(var(--space-lg) + var(--safe-bottom));
            position: relative;
            overflow: hidden;
            box-sizing: border-box;
        }
        
        /* Prevent scrolling on title page */
        #titlePage {
            overflow: hidden;
            height: 100vh;
            height: 100dvh;
            max-height: 100vh;
            max-height: 100dvh;
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
        }
        
        #titlePage.active ~ #phantomSpacer {
            display: none;
        }
        
        /* Make everything on title page dark for light background */
        .title-page * {
            color: var(--text-primary) !important;
        }
        
        .title-page .c-owen {
            color: var(--owen) !important;
        }
        
        /* Explicit overrides for title page elements */
        .title-page .title-logo,
        .title-page .title-main,
        .title-page .title-sub,
        .title-page .title-form,
        .title-page .title-department,
        .title-page .title-timestamp,
        .title-page .title-begin,
        .title-page .title-warning,
        .title-page .employee-id {
            color: var(--text-primary) !important;
        }
        
        .title-page .title-i {
            color: var(--rabbit) !important;
        }
        
        .title-page .title-o {
            color: var(--owen) !important;
        }

        /* Corner accents - smaller on mobile */
        .title-page::before,
        .title-page::after {
            content: '';
            position: absolute;
            width: 40px;
            height: 40px;
            border: 1px solid rgba(0, 0, 0, 0.15);
            opacity: 1;
        }
        
        @media (min-width: 390px) {
            .title-page::before,
            .title-page::after {
                width: 56px;
                height: 56px;
            }
        }

        .title-page::before {
            top: calc(var(--space-md) + var(--safe-top));
            left: var(--space-md);
            border-right: none;
            border-bottom: none;
        }

        .title-page::after {
            bottom: calc(var(--space-md) + var(--safe-bottom));
            right: var(--space-md);
            border-left: none;
            border-top: none;
        }

        @keyframes bootIn {
            0% { opacity: 0; transform: translateY(8px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        @keyframes glowPulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        /* Title block wrapper for better centering */
        .title-block {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: var(--space-lg);
        }

        .title-logo {
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            font-weight: 400;
            letter-spacing: 0.4em;
            color: var(--text-dim);
            opacity: 0;
            margin-bottom: var(--space-md);
            text-transform: uppercase;
            animation: bootIn 0.6s ease 0.2s forwards;
        }

        @media (min-width: 390px) {
            .title-logo {
                font-size: 0.6rem;
                letter-spacing: 0.45em;
                margin-bottom: var(--space-lg);
            }
        }

        @keyframes titleColorShift {
            0% { color: var(--rabbit); }
            50% { color: var(--text-bright); }
            100% { color: var(--text-bright); }
        }

        @keyframes rabbitHint {
            0%, 70% { color: inherit; }
            85% { color: var(--rabbit); }
            100% { color: var(--text-bright); }
        }

        .title-rabbit {
            animation: rabbitHint 6s ease 2s forwards;
        }

        .title-main {
            font-family: 'VT323', monospace;
            font-size: 2.75rem;
            font-weight: 400;
            letter-spacing: 0.06em;
            margin-bottom: var(--space-sm);
            color: var(--text-bright);
            line-height: 1.1;
            opacity: 0;
            animation: bootIn 0.6s ease 0.4s forwards, titleColorShift 4s ease 1s forwards;
            text-shadow: 0 0 60px rgba(0, 0, 0, 0.12);
            text-transform: lowercase;
        }
        
        .title-tld {
            text-shadow: none;
        }
        
        .title-i {
            color: var(--rabbit);
            text-shadow: 0 0 20px var(--rabbit-glow);
        }
        
        .title-o {
            color: var(--owen);
            text-shadow: 0 0 20px var(--owen-glow);
        }

        @media (min-width: 390px) {
            .title-main {
                font-size: 3.25rem;
                letter-spacing: 0.1em;
            }
        }

        @media (min-width: 768px) {
            .title-main {
                font-size: 3.75rem;
                letter-spacing: 0.15em;
            }
        }

        .title-sub {
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            letter-spacing: 0.35em;
            color: var(--text-secondary);
            margin-bottom: 0;
            opacity: 0;
            text-transform: uppercase;
            animation: bootIn 0.6s ease 0.55s forwards;
        }

        @media (min-width: 390px) {
            .title-sub {
                font-size: 0.65rem;
                letter-spacing: 0.4em;
            }
        }

        .title-divider {
            width: 1px;
            height: 32px;
            background: linear-gradient(180deg, transparent, rgba(0, 0, 0, 0.15), transparent);
            margin: var(--space-lg) auto;
            opacity: 0;
            animation: bootIn 0.6s ease 0.65s forwards;
        }
        
        @media (min-width: 390px) {
            .title-divider {
                height: 40px;
                margin: var(--space-xl) auto;
            }
        }

        .title-meta {
            margin-bottom: var(--space-lg);
            opacity: 0;
            animation: bootIn 0.6s ease 0.75s forwards;
        }

        @media (min-width: 390px) {
            .title-meta {
                margin-bottom: var(--space-xl);
            }
        }

        .title-form {
            font-size: 0.5rem;
            letter-spacing: 0.2em;
            color: var(--text-dim);
            margin-bottom: 4px;
            text-transform: uppercase;
            opacity: 0.7;
        }

        @media (min-width: 390px) {
            .title-form {
                font-size: 0.55rem;
                letter-spacing: 0.25em;
            }
        }

        .title-department {
            font-size: 0.45rem;
            color: var(--text-dim);
            opacity: 0.55;
            letter-spacing: 0.15em;
            text-transform: uppercase;
        }

        @media (min-width: 390px) {
            .title-department {
                font-size: 0.5rem;
                letter-spacing: 0.2em;
            }
        }

        .title-timestamp {
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            color: var(--text-dim);
            opacity: 0.6;
            margin-top: var(--space-md);
            letter-spacing: 0.1em;
        }

        .employee-id {
            font-family: 'Space Mono', monospace;
            font-size: 0.5rem;
            color: var(--text-dim);
            opacity: 0.55;
            margin-top: var(--space-sm);
            letter-spacing: 0.1em;
        }

        .redacted-name {
            color: var(--text-dim);
            letter-spacing: 1px;
        }

        .revealed-name {
            color: var(--owen);
        }

        /* Display Mode Toggle - glitchy footer effect */
        .title-display-mode {
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            color: var(--text-dim);
            margin-top: var(--space-xl);
            letter-spacing: 0.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0.7;
        }
        
        .title-display-mode:hover {
            opacity: 1;
        }
        
        @media (min-width: 390px) {
            .title-display-mode {
                font-size: 0.65rem;
            }
        }

        /* ════════════════════════════════
           GLITCH TEXT EFFECT - Chromatic aberration / VHS style
           Use: <span class="glitch-text" data-text="YOUR TEXT">YOUR TEXT</span>
           ════════════════════════════════ */
        .glitch-text,
        .display-mode-toggle {
            position: relative;
            display: inline-block;
            color: var(--text-bright);
            font-weight: 500;
        }
        
        /* Glitch layers - red and cyan chromatic split */
        .glitch-text::before,
        .glitch-text::after,
        .display-mode-toggle::before,
        .display-mode-toggle::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.8;
            pointer-events: none;
        }
        
        .glitch-text::before,
        .display-mode-toggle::before {
            color: #ff6b6b;
            animation: glitch-1 2s infinite linear alternate-reverse;
            clip-path: polygon(0 0, 100% 0, 100% 35%, 0 35%);
        }
        
        .glitch-text::after,
        .display-mode-toggle::after {
            color: #4ecdc4;
            animation: glitch-2 3s infinite linear alternate-reverse;
            clip-path: polygon(0 65%, 100% 65%, 100% 100%, 0 100%);
        }
        
        /* Faster glitch on hover */
        .glitch-text:hover::before,
        .glitch-text:hover::after,
        .title-display-mode:hover .display-mode-toggle::before,
        .title-display-mode:hover .display-mode-toggle::after {
            animation-duration: 0.2s;
        }
        
        /* Glitch variant - more intense for buttons */
        .glitch-text-intense::before {
            animation: glitch-intense-1 1.5s infinite linear alternate-reverse;
        }
        
        .glitch-text-intense::after {
            animation: glitch-intense-2 2s infinite linear alternate-reverse;
        }
        
        .glitch-text-intense:hover::before,
        .glitch-text-intense:hover::after {
            animation-duration: 0.15s;
        }
        
        @keyframes glitch-1 {
            0%, 100% { transform: translate(0); }
            20% { transform: translate(-2px, 1px); }
            40% { transform: translate(2px, -1px); }
            60% { transform: translate(-1px, -1px); }
            80% { transform: translate(1px, 1px); }
        }
        
        @keyframes glitch-2 {
            0%, 100% { transform: translate(0); }
            20% { transform: translate(2px, -1px); }
            40% { transform: translate(-2px, 1px); }
            60% { transform: translate(1px, 1px); }
            80% { transform: translate(-1px, -1px); }
        }
        
        @keyframes glitch-intense-1 {
            0%, 100% { transform: translate(0); }
            10% { transform: translate(-3px, 2px); }
            30% { transform: translate(3px, -1px); }
            50% { transform: translate(-2px, -2px); }
            70% { transform: translate(2px, 2px); }
            90% { transform: translate(-1px, 1px); }
        }
        
        @keyframes glitch-intense-2 {
            0%, 100% { transform: translate(0); }
            15% { transform: translate(3px, -2px); }
            35% { transform: translate(-3px, 1px); }
            55% { transform: translate(2px, 2px); }
            75% { transform: translate(-2px, -2px); }
            95% { transform: translate(1px, -1px); }
        }
        
        /* Vincent's green glitch variant for Snake Game */
        #snakeGamePage .glitch-text::before {
            color: #7dff7d;
        }
        
        #snakeGamePage .glitch-text::after {
            color: #00b359;
        }

        /* Login Page */
        .login-page {
            height: 100vh;
            height: 100dvh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 24px;
            text-align: center;
            overflow: hidden;
            box-sizing: border-box;
        }
        
        .login-system-id {
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            letter-spacing: 3px;
            color: var(--text-dim);
            margin-bottom: 16px;
            opacity: 0.85;
        }

        .login-header {
            font-family: 'Space Mono', monospace;
            font-size: 1rem;
            letter-spacing: 3px;
            color: var(--white);
            margin-bottom: 32px;
        }

        .login-form-container {
            width: 100%;
            max-width: 300px;
            margin-bottom: 24px;
        }

        .login-label {
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            letter-spacing: 2px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            text-align: left;
        }

        .login-name-input {
            width: 100%;
            padding: 14px 16px;
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
            letter-spacing: 2px;
            background: rgba(0, 0, 0, 0.03);
            border: 1px solid rgba(0, 0, 0, 0.12);
            color: var(--white);
            text-transform: uppercase;
            outline: none;
            transition: all 0.3s ease;
        }

        .login-name-input::placeholder {
            color: var(--text-dim);
            opacity: 0.5;
        }

        .login-name-input:focus {
            border-color: var(--white);
            background: rgba(0, 212, 170, 0.08);
        }

        .login-hint {
            font-family: 'Space Mono', monospace;
            font-size: 0.5rem;
            letter-spacing: 1px;
            color: var(--text-dim);
            margin-top: 8px;
            text-align: left;
            opacity: 0.75;
        }

        .login-proceed-btn {
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            letter-spacing: 3px;
            color: var(--text-dim);
            padding: 14px 32px;
            border: 1px solid var(--border-light);
            cursor: not-allowed;
            transition: all 0.2s ease;
            opacity: 0.4;
            position: relative;
            overflow: hidden;
        }

        .login-proceed-btn.enabled {
            color: var(--white);
            border-color: var(--teal);
            cursor: pointer;
            opacity: 1;
        }
        
        .login-proceed-btn.enabled::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 212, 170, 0.15), transparent);
            transition: left 0.4s ease;
        }

        .login-proceed-btn.enabled:hover {
            background: rgba(0, 212, 170, 0.1);
            border-color: var(--white);
            box-shadow: 0 0 15px rgba(0, 212, 170, 0.2);
        }
        
        .login-proceed-btn.enabled:hover::before {
            left: 100%;
        }
        
        .login-proceed-btn.enabled:active {
            transform: scale(0.98);
        }

        .login-footer {
            font-family: 'Space Mono', monospace;
            font-size: 0.45rem;
            letter-spacing: 2px;
            color: var(--text-dim);
            margin-top: 48px;
            opacity: 0.55;
        }

        /* Updated Timer UI */
        .timer {
            display: none;
            justify-content: space-between;
            align-items: center;
            padding: 11px 18px;
            background: linear-gradient(180deg, rgba(250, 248, 245, 0.98) 0%, rgba(245, 240, 235, 0.95) 100%);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            font-family: 'VT323', monospace;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .timer.visible {
            display: flex;
        }

        .timer-left {
            flex: 0 1 auto;
            min-width: 80px;
            max-width: 140px;
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.85rem;
            color: #555555;
            letter-spacing: 0.05em;
            white-space: nowrap;
            overflow: hidden;
        }
        
        .timer-emp {
            color: #555555;
            opacity: 0.8;
            flex-shrink: 0;
        }
        
        /* Player name in left section */
        .timer-left .player-name-ticker {
            display: inline-block;
            max-width: 90px;
            overflow: hidden;
            vertical-align: middle;
            position: relative;
        }
        
        .timer-left .player-name-ticker #playerNameDisplay {
            display: inline-block;
            white-space: nowrap;
            color: #b8860b;
            font-weight: bold;
            letter-spacing: 0.05em;
            font-size: 0.85rem;
        }
        
        /* Scale down font for very long names */
        .timer-left .player-name-ticker.long-name #playerNameDisplay {
            font-size: 0.7rem;
        }
        
        /* When name is too long, apply scrolling animation */
        .timer-left .player-name-ticker.scrolling #playerNameDisplay {
            animation: tickerScroll 6s linear infinite;
            padding-right: 30px;
        }
        
        .timer-status-indicator {
            width: 6px;
            height: 6px;
            background: #2d8a6e;
            border-radius: 50%;
            box-shadow: 0 0 6px rgba(45, 138, 110, 0.5);
            animation: statusPulse 2s ease-in-out infinite;
            flex-shrink: 0;
            transition: all 0.5s ease;
        }
        
        @keyframes statusPulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        .timer-status-indicator.warning {
            background: #c94a4a;
            box-shadow: 0 0 8px rgba(201, 74, 74, 0.4);
        }
        
        .timer-status-indicator.disabled {
            background: #8b0000;
            box-shadow: 0 0 4px rgba(139, 0, 0, 0.4);
            animation: disabledPulse 3s ease-in-out infinite;
        }
        
        @keyframes disabledPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 0.8; }
        }

        /* Status text in CENTER - fixed width so it doesn't move */
        .timer-center {
            flex: 0 0 auto;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 5px;
            text-align: center;
            font-size: 0.7rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: #2d8a6e;
            transition: all 0.5s ease;
        }
        
        .timer-center.disabled {
            color: #8b0000;
        }
        
        .timer-center.disabled #timerCycleText {
            opacity: 0.7;
        }
        
        #playerNameDisplay {
            color: #b8860b;
            text-shadow: none;
            letter-spacing: 0.1em;
            font-weight: bold;
        }
        
        /* Ticker container for long names */
        .player-name-ticker {
            display: inline-block;
            max-width: 120px;
            overflow: hidden;
            vertical-align: bottom;
            position: relative;
        }
        
        .player-name-ticker #playerNameDisplay {
            display: inline-block;
            white-space: nowrap;
        }
        
        /* When name is too long, apply scrolling animation */
        .player-name-ticker.scrolling #playerNameDisplay {
            animation: tickerScroll 6s linear infinite;
            padding-right: 30px; /* Gap before repeat */
        }
        
        @keyframes tickerScroll {
            0% {
                transform: translateX(0);
            }
            100% {
                transform: translateX(-50%);
            }
        }
        
        /* Fade edges for smoother ticker appearance */
        .player-name-ticker.scrolling::before,
        .player-name-ticker.scrolling::after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            width: 10px;
            z-index: 1;
            pointer-events: none;
        }
        
        .player-name-ticker.scrolling::before {
            left: 0;
            background: linear-gradient(to right, rgba(250, 248, 245, 1), transparent);
        }
        
        .player-name-ticker.scrolling::after {
            right: 0;
            background: linear-gradient(to left, rgba(250, 248, 245, 1), transparent);
        }
        
        @media (min-width: 480px) {
            .timer-left .player-name-ticker {
                max-width: 110px;
            }
            .timer-left .player-name-ticker #playerNameDisplay {
                font-size: 0.9rem;
            }
        }
        
        @media (min-width: 768px) {
            .timer-left .player-name-ticker {
                max-width: 150px;
            }
        }

        .tracking-disabled-text {
            transition: all 0.3s ease;
            text-transform: uppercase;
            color: #2d8a6e;
        }

        .tracking-disabled-text.warning {
            color: #c94a4a;
            text-shadow: none;
        }

        .timer-right {
            flex: 0 0 100px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 11px;
        }

        .score-display {
            font-family: 'VT323', monospace;
            font-size: 0.93rem;
            letter-spacing: 0.1em;
            color: #555555;
            opacity: 1;
        }

        .report-btn {
            font-family: 'VT323', monospace;
            font-size: 1rem;
            background: transparent;
            border: 1px solid rgba(201, 74, 74, 0.4);
            color: #c94a4a;
            padding: 3px 9px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .report-btn:hover {
            background: rgba(201, 74, 74, 0.1);
            border-color: #c94a4a;
        }

        @media (min-width: 480px) {
            .timer {
                padding: 11px 26px;
            }
            
            .timer-left {
                flex: 0 0 132px;
                font-size: 1.05rem;
                gap: 9px;
            }
            
            .timer-status-indicator {
                width: 7px;
                height: 7px;
            }
            
            .timer-center {
                font-size: 0.75rem;
                gap: 6px;
            }
            
            .timer-right {
                flex: 0 0 120px;
                gap: 14px;
            }
            
            .score-display {
                font-size: 0.95rem;
            }
            
            .report-btn {
                font-size: 1rem;
                padding: 3px 10px;
            }
        }
        
        @media (min-width: 768px) {
            .timer-left {
                flex: 0 0 150px;
                font-size: 1rem;
            }
            
            .timer-center {
                font-size: 0.8rem;
            }
            
            .timer-right {
                flex: 0 0 150px;
            }
            
            .score-display {
                font-size: 1rem;
            }
        }

        /* Section 3 redacted content */
        .redact-s3 {
            color: var(--text-dim);
            letter-spacing: 0;
            user-select: none;
        }

        .redact-s3.revealed {
            color: inherit;
            letter-spacing: inherit;
            user-select: auto;
        }
        
        /* ════════════════════════════════════════════════════════════
           SECTION 3: THE WHITE ROOM — LIVING VOID
           SVG turbulence filter for organic distortion
           Canvas overlay for particles and atmospheric effects
           ════════════════════════════════════════════════════════════ */
        
        .section-3-void {
            position: relative;
            background: #050507;
            margin: 60px -16px;
            padding: 80px 16px;
            overflow: hidden;
            min-height: 80vh;
        }
        
        /* Particle canvas overlay */
        .section-3-void .void-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none;
        }
        
        /* Content with SVG distortion filter */
        .section-3-void .void-content {
            position: relative;
            z-index: 5;
            max-width: 700px;
            margin: 0 auto;
            /* SVG filter removed - can cause content to disappear on some devices */
        }
        
        @keyframes voidBreathe {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.97; }
        }
        
        /* Section styling */
        .section-3-void .owen-section {
            margin: 0;
        }
        
        .section-3-void .owen-section-header {
            color: rgba(255, 255, 255, 0.35) !important;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.1) !important;
            animation: none !important;
            letter-spacing: 4px !important;
        }
        
        .section-3-void .owen-section-subheader {
            color: rgba(255, 255, 255, 0.15) !important;
        }
        
        .section-3-void .owen-letter {
            background: transparent !important;
            border-left: 2px solid rgba(255, 255, 255, 0.08) !important;
            box-shadow: none !important;
            color: rgba(255, 255, 255, 0.9) !important;
            animation: voidTextGlow 6s ease-in-out infinite !important;
        }
        
        @keyframes voidTextGlow {
            0%, 100% { 
                text-shadow: 0 0 20px rgba(255, 255, 255, 0.05);
            }
            50% { 
                text-shadow: 0 0 40px rgba(140, 130, 170, 0.15);
            }
        }
        
        .section-3-void .owen-letter * {
            color: inherit !important;
            animation: none !important;
        }
        
        /* Override Owen page pulse animations for void section */
        #owenPage .section-3-void .owen-section,
        #owenPage .section-3-void .owen-section *,
        #owenPage .section-3-void .owen-letter,
        #owenPage .section-3-void .owen-letter * {
            animation: none !important;
        }
        
        #owenPage .section-3-void .owen-letter {
            background: transparent !important;
            border-left: 2px solid rgba(255, 255, 255, 0.08) !important;
            box-shadow: none !important;
            color: rgba(255, 255, 255, 0.9) !important;
        }
        
        /* Character colors */
        .section-3-void .c-facility {
            color: rgba(170, 185, 210, 0.95) !important;
            text-shadow: 0 0 20px rgba(140, 130, 170, 0.3) !important;
        }
        
        .section-3-void .c-emphasis {
            color: #ffffff !important;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.4) !important;
        }
        
        .section-3-void .c-rabbit {
            color: #e8707e !important;
            text-shadow: 0 0 15px rgba(232, 112, 126, 0.4) !important;
        }
        
        .section-3-void .c-owen {
            color: #f0a868 !important;
            text-shadow: 0 0 15px rgba(240, 168, 104, 0.4) !important;
        }
        
        .section-3-void .c-vincent,
        .section-3-void .snake-green {
            color: #6b9ebe !important;
            text-shadow: 0 0 15px rgba(107, 158, 190, 0.4) !important;
        }
        
        .section-3-void .inverse-pulse {
            color: rgba(160, 150, 190, 0.95) !important;
            text-shadow: 0 0 25px rgba(140, 130, 170, 0.5) !important;
        }
        
        .section-3-void .redact-s3 {
            color: rgba(255, 255, 255, 0.2) !important;
        }
        
        /* Silver horse - ethereal glow */
        .section-3-void .silver-horse {
            color: #c8d0e0 !important;
            text-shadow: 
                0 0 10px rgba(200, 208, 224, 0.8),
                0 0 30px rgba(160, 150, 190, 0.6),
                0 0 60px rgba(120, 110, 160, 0.4) !important;
            animation: voidHorseFlicker 4s ease-in-out infinite !important;
            letter-spacing: 3px !important;
        }
        
        @keyframes voidHorseFlicker {
            0%, 100% { opacity: 1; }
            25% { opacity: 0.92; }
            50% { opacity: 1; }
            75% { opacity: 0.95; }
        }
        
        .section-3-void .cutoff {
            border-top: 1px solid rgba(255, 255, 255, 0.08) !important;
        }
        
        /* Vignette overlay */
        .section-3-void::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at center, 
                transparent 0%, 
                transparent 40%, 
                rgba(0,0,0,0.3) 70%,
                rgba(0,0,0,0.6) 100%);
            pointer-events: none;
            z-index: 15;
        }

        /* Rabbit name redacted - keeps parent color */
        .redact-rabbit {
            letter-spacing: 0;
            user-select: none;
        }

        .redact-rabbit.revealed {
            letter-spacing: inherit;
            user-select: auto;
        }

        /* Rabbit name reveal container - for Section 2 alternating effect */
        .rabbit-container {
            display: inline-grid;
            vertical-align: baseline;
        }

        .rabbit-container .rabbit-name,
        .rabbit-container .rabbit-reveal-redact {
            grid-area: 1 / 1;
            white-space: nowrap;
        }

        .rabbit-container .rabbit-name {
            opacity: 0;
            animation: rabbitRevealName 3s ease-in-out infinite;
        }

        .rabbit-container .rabbit-reveal-redact {
            animation: rabbitRevealRedact 3s ease-in-out infinite;
        }

        @keyframes rabbitRevealName {
            0%, 40% { 
                opacity: 0;
            }
            50%, 90% { 
                opacity: 1;
            }
            100% {
                opacity: 0;
            }
        }

        @keyframes rabbitRevealRedact {
            0%, 40% { 
                opacity: 1;
            }
            50%, 90% { 
                opacity: 0;
            }
            100% {
                opacity: 1;
            }
        }

        /* On Owen's view (2nd playthrough), stop the animation and show revealed */
        body.owen-view .rabbit-container .rabbit-name {
            opacity: 1;
            animation: none;
        }

        body.owen-view .rabbit-container .rabbit-reveal-redact {
            display: none;
            animation: none;
        }
        
        /* Owen name reveal container - for Section 6 alternating effect */
        .owen-container {
            display: inline-grid;
            vertical-align: baseline;
        }

        .owen-container .owen-name,
        .owen-container .owen-reveal-redact {
            grid-area: 1 / 1;
            white-space: nowrap;
        }

        .owen-container .owen-name {
            opacity: 0;
            animation: owenRevealName 3s ease-in-out infinite;
        }

        .owen-container .owen-reveal-redact {
            animation: owenRevealRedact 3s ease-in-out infinite;
        }

        @keyframes owenRevealName {
            0%, 40% { 
                opacity: 0;
            }
            50%, 90% { 
                opacity: 1;
            }
            100% {
                opacity: 0;
            }
        }

        @keyframes owenRevealRedact {
            0%, 40% { 
                opacity: 1;
            }
            50%, 90% { 
                opacity: 0;
            }
            100% {
                opacity: 1;
            }
        }

        /* On Owen's view (2nd playthrough), stop Owen animation and show revealed */
        body.owen-view .owen-container .owen-name {
            opacity: 1;
            animation: none;
        }

        body.owen-view .owen-container .owen-reveal-redact {
            display: none;
            animation: none;
        }

        /* Redacted "waiting" text - cycles through character colors */
        .redacted-waiting {
            animation: colorCycle 4s ease-in-out infinite;
        }

        @keyframes colorCycle {
            0%, 100% { color: var(--text-dim); }
            15% { color: var(--vincent); }
            30% { color: var(--isla); }
            45% { color: var(--rabbit); }
            60% { color: var(--terminated); }
            75% { color: var(--owen); }
            90% { color: var(--ice); }
        }

        /* Owen's view - brighter amber (second playthrough) */
        body.owen-view .amber-text {
            color: var(--owen);
            border-left-color: var(--owen);
        }

        body.owen-view .amber-text .hidden-message {
            color: var(--owen);
        }

        body.owen-view .amber-warning-header,
        body.owen-view .amber-warning-text,
        body.owen-view .amber-warning-directive {
            color: var(--owen);
        }

        body.owen-view .amber-end-text {
            color: var(--owen);
        }

        body.owen-view .admin-header {
            color: var(--owen);
        }

        body.owen-view .filler-text {
            color: var(--owen);
        }

        .title-begin {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-height: var(--touch-target-lg);
            padding: var(--space-sm) var(--space-xl);
            border: 1px solid rgba(0, 0, 0, 0.18);
            background: rgba(0, 0, 0, 0.02);
            cursor: pointer;
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            letter-spacing: 0.3em;
            color: var(--text-bright);
            text-transform: uppercase;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            opacity: 0;
            animation: bootIn 0.6s ease 0.9s forwards;
            -webkit-tap-highlight-color: transparent;
        }
        
        @media (min-width: 390px) {
            .title-begin {
                padding: var(--space-md) var(--space-2xl);
                font-size: 0.6rem;
                letter-spacing: 0.35em;
            }
        }
        
        .title-begin::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 0, 0, 0.08), transparent);
            transition: left 0.5s ease;
        }

        .title-begin:hover {
            border-color: rgba(0, 0, 0, 0.2);
            background: rgba(0, 0, 0, 0.04);
        }
        
        .title-begin:hover::before {
            left: 100%;
        }
        
        .title-begin:active {
            transform: scale(0.98);
            background: rgba(0, 0, 0, 0.06);
            border-color: rgba(0, 0, 0, 0.25);
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .blink-slow {
            animation: blink 2s ease-in-out infinite;
        }

        .title-warning {
            font-family: 'Space Mono', monospace;
            font-size: 0.45rem;
            letter-spacing: 0.2em;
            color: var(--text-dim);
            margin-top: var(--space-lg);
            opacity: 0;
            text-transform: uppercase;
            animation: bootIn 0.6s ease 1s forwards;
        }
        
        .title-warning-dot {
            display: inline-block;
            width: 4px;
            height: 4px;
            background: var(--rabbit);
            border-radius: 50%;
            margin-right: 6px;
            vertical-align: middle;
            animation: blink 1.5s ease-in-out infinite;
        }
        
        @media (min-width: 390px) {
            .title-warning {
                font-size: 0.5rem;
                letter-spacing: 0.25em;
                margin-top: var(--space-xl);
            }
        }

        /* ============ INSTRUCTIONS ============ */
        .instructions-page {
            padding-bottom: var(--space-2xl);
        }
        
        /* Give scenario and rules more horizontal breathing room */
        .instructions-page .scenario-intro,
        .instructions-page .instruction-rules {
            margin-left: calc(-1 * var(--space-sm));
            margin-right: calc(-1 * var(--space-sm));
        }
        
        @media (min-width: 390px) {
            .instructions-page .scenario-intro,
            .instructions-page .instruction-rules {
                margin-left: calc(-1 * var(--space-md));
                margin-right: calc(-1 * var(--space-md));
            }
        }

        .instructions-header {
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            letter-spacing: 0.25em;
            margin-bottom: var(--space-lg);
            color: var(--text-secondary);
            text-align: center;
            text-transform: uppercase;
        }

        .instructions-subheader {
            display: none;
        }
        
        @media (min-width: 390px) {
            .instructions-header {
                font-size: 0.65rem;
                letter-spacing: 0.3em;
                margin-bottom: var(--space-xl);
            }
        }

        /* Icon styles - Premium design */
        .instruction-icon {
            width: 52px;
            height: 52px;
            margin: 0 auto var(--space-md);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        @media (min-width: 390px) {
            .instruction-icon {
                width: 56px;
                height: 56px;
            }
        }
        
        .instruction-icon svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 0 6px rgba(0, 0, 0, 0.08));
        }
        
        .instruction-icon-glow {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(0, 0, 0, 0.04) 0%, transparent 70%);
            animation: iconPulse 6s ease-in-out infinite;
            will-change: transform, opacity;
        }
        
        @keyframes iconPulse {
            0%, 100% { transform: scale(1); opacity: 0.4; }
            50% { transform: scale(1.06); opacity: 0.6; }
        }
        
        /* Icon 1 - Checklist/Answer */
        .icon-answer svg {
            stroke: var(--teal);
        }
        
        /* Icon 2 - Scroll/Arrow with amber accent */
        .icon-scroll-new {
            animation: scrollFloat 3s ease-in-out infinite;
        }
        
        .icon-scroll-new svg {
            stroke: var(--amber);
            filter: drop-shadow(0 0 8px rgba(255, 200, 0, 0.25));
        }
        
        @keyframes scrollFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        /* Icon 3 - Lock/Final */
        .icon-final svg {
            stroke: var(--coral);
            filter: drop-shadow(0 0 6px rgba(255, 138, 128, 0.15));
        }
        
        /* Key rule icon - Eye with warning */
        .key-rule-icon-new {
            width: 56px;
            height: 56px;
            margin: 0 auto var(--space-md);
            position: relative;
        }
        
        @media (min-width: 390px) {
            .key-rule-icon-new {
                width: 64px;
                height: 64px;
            }
        }
        
        .key-rule-icon-new svg {
            width: 100%;
            height: 100%;
            stroke: var(--amber);
            filter: drop-shadow(0 0 12px rgba(255, 200, 0, 0.35));
        }
        
        .key-rule-icon-new .eye-slash {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 75%;
            height: 2px;
            background: var(--coral);
            transform: translate(-50%, -50%) rotate(-45deg);
            box-shadow: 0 0 8px rgba(255, 138, 128, 0.5);
            border-radius: 1px;
        }

        .icon-eye {
            display: none;
        }

        .icon-scroll {
            display: none;
        }

        @keyframes scrollBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-4px); }
        }

        /* Instruction cards */
        .instruction-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: var(--space-lg) var(--space-md);
            margin-bottom: var(--space-md);
            text-align: center;
            border-radius: 2px;
        }
        
        @media (min-width: 390px) {
            .instruction-card {
                padding: var(--space-xl) var(--space-lg);
            }
        }

        .instruction-card-number {
            font-family: 'Space Mono', monospace;
            font-size: 0.5625rem;
            letter-spacing: 0.2em;
            color: var(--text-ghost);
            margin-bottom: var(--space-xs);
            text-transform: uppercase;
        }

        .instruction-card-title {
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
            letter-spacing: 0.1em;
            color: var(--text-bright);
            margin-bottom: var(--space-sm);
        }
        
        @media (min-width: 390px) {
            .instruction-card-title {
                font-size: 0.95rem;
            }
        }

        .instruction-card-text {
            font-size: 0.8125rem;
            color: var(--text-secondary);
            line-height: 1.7;
        }
        
        @media (min-width: 390px) {
            .instruction-card-text {
                font-size: 0.875rem;
                line-height: 1.75;
            }
        }

        /* Scenario introduction box */
        /* ============ DRILL SCENARIO - CINEMATIC HERO ============ */
        .scenario-intro {
            background: rgba(0, 0, 0, 0.02);
            border: 1px solid rgba(0, 0, 0, 0.1);
            padding: 0;
            margin: 0 0 var(--space-2xl);
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(255, 138, 128, 0.05);
        }
        
        .scenario-label {
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            letter-spacing: 0.3em;
            color: var(--text-secondary);
            padding: var(--space-md) var(--space-sm);
            border-bottom: 1px solid var(--border);
            text-align: center;
        }
        
        .scenario-hero {
            padding: var(--space-xl) var(--space-sm) var(--space-xl);
            text-align: center;
            position: relative;
        }
        
        .scenario-hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 1px;
            height: 32px;
            background: linear-gradient(to bottom, var(--border), transparent);
        }
        
        .scenario-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            letter-spacing: 0.15em;
            color: var(--white);
            margin-bottom: var(--space-lg);
            padding: 5px 10px;
            border: 1px solid rgba(0, 0, 0, 0.15);
            background: rgba(0, 0, 0, 0.04);
            animation: statusGlow 2s ease-in-out infinite;
        }
        
        @keyframes statusGlow {
            0%, 100% {
                box-shadow: 0 0 6px rgba(0, 0, 0, 0.06);
            }
            50% {
                box-shadow: 0 0 12px rgba(0, 0, 0, 0.1);
            }
        }
        
        .scenario-status-dot {
            width: 5px;
            height: 5px;
            background: var(--white);
            border-radius: 50%;
            animation: statusBlink 2.5s ease-in-out infinite;
        }
        
        @keyframes statusBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }
        
        .scenario-headline {
            font-family: 'Space Mono', monospace;
            font-size: 1.1rem;
            letter-spacing: 0.08em;
            color: var(--text-bright);
            line-height: 1.4;
            margin-bottom: var(--space-sm);
        }
        
        .scenario-headline-main {
            display: block;
            font-size: 1.2rem;
            letter-spacing: 0.05em;
            margin-bottom: 4px;
            text-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }
        
        .scenario-headline-sub {
            display: block;
            font-size: 0.85rem;
            color: var(--text-primary);
            letter-spacing: 0.12em;
        }
        
        .scenario-divider {
            width: 40px;
            height: 1px;
            background: var(--text-dim);
            margin: var(--space-lg) auto var(--space-xl);
        }
        
        .scenario-body {
            font-size: 0.8rem;
            line-height: 2.1;
            color: var(--text-primary);
            text-align: left;
            padding: 0;
            margin: 0 0 var(--space-xl);
            max-width: 100%;
        }
        
        .scenario-objective {
            text-align: center;
        }
        
        .scenario-objective-action {
            display: inline-block;
            font-family: 'Space Mono', monospace;
            font-size: 0.65rem;
            letter-spacing: 0.12em;
            color: var(--white);
            text-transform: uppercase;
            padding: var(--space-sm) var(--space-md);
            border: 1px solid rgba(0, 0, 0, 0.15);
            background: rgba(0, 0, 0, 0.04);
            animation: objectiveGlow 2s ease-in-out infinite;
        }
        
        @keyframes objectiveGlow {
            0%, 100% {
                box-shadow: 0 0 10px rgba(255, 138, 128, 0.1);
                border-color: rgba(255, 138, 128, 0.4);
            }
            50% {
                box-shadow: 0 0 20px rgba(255, 138, 128, 0.25);
                border-color: rgba(255, 138, 128, 0.7);
            }
        }
        
        .scenario-footer {
            padding: var(--space-sm) 0;
            border-top: 1px solid var(--border);
            overflow: hidden;
            position: relative;
        }
        
        .scenario-footer-scroll {
            display: flex;
            gap: var(--space-xl);
            font-family: 'Space Mono', monospace;
            font-size: 0.5rem;
            letter-spacing: 0.12em;
            color: var(--text-secondary);
            white-space: nowrap;
            animation: footerScroll 30s linear infinite;
            will-change: transform;
        }
        
        @keyframes footerScroll {
            0% { transform: translate3d(0, 0, 0); }
            100% { transform: translate3d(-50%, 0, 0); }
        }
        
        .scenario-footer-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .scenario-footer-dot {
            width: 4px;
            height: 4px;
            background: var(--rabbit);
            border-radius: 50%;
            animation: statusBlink 1.5s ease-in-out infinite;
        }
        
        @media (min-width: 390px) {
            .scenario-intro {
                margin: 0 0 var(--space-2xl);
            }
            .scenario-label {
                font-size: 0.6rem;
                padding: var(--space-md) var(--space-md);
            }
            .scenario-hero {
                padding: var(--space-2xl) var(--space-md) var(--space-2xl);
            }
            .scenario-headline-main {
                font-size: 2.1rem;
            }
            .scenario-headline-sub {
                font-size: 1.05rem;
            }
            .scenario-body {
                font-size: 0.85rem;
                padding: 0 var(--space-xs);
                line-height: 2.2;
            }
            .scenario-divider {
                margin: var(--space-xl) auto var(--space-2xl);
            }
            .scenario-objective-action {
                font-size: 0.7rem;
                padding: var(--space-sm) var(--space-lg);
            }
            .scenario-footer-scroll {
                font-size: 0.55rem;
            }
        }

        /* ============ KEY RULE - MAIN CALLOUT ============ */
        /* ============ KEY RULE - MAIN CALLOUT ============ */
        .key-rule {
            background: transparent;
            border: none;
            border-left: 3px solid var(--vincent);
            padding: var(--space-md) var(--space-lg);
            margin: 0 0 var(--space-lg);
            text-align: left;
        }
        
        @media (min-width: 390px) {
            .key-rule {
                padding: var(--space-lg) var(--space-xl);
                margin: 0 0 var(--space-xl);
            }
        }

        .key-rule-icon {
            display: none;
        }
        
        .key-rule-icon svg {
            display: none;
        }

        .key-rule-text {
            font-family: 'Space Mono', monospace;
            font-size: 1.3rem;
            letter-spacing: 0.05em;
            color: var(--text-bright);
            line-height: 1.4;
        }
        
        .key-rule-text span {
            color: var(--vincent);
            text-shadow: 0 0 15px var(--vincent-glow);
        }
        
        @media (min-width: 390px) {
            .key-rule-text {
                font-size: 1.5rem;
            }
        }

        .key-rule-sub {
            font-size: 0.75rem;
            color: var(--text-primary);
            margin-top: var(--space-sm);
            line-height: 1.8;
        }
        
        @media (min-width: 390px) {
            .key-rule-sub {
                font-size: 0.8rem;
            }
        }

        /* ============ PROTOCOL SECTION ============ */
        .instruction-rules {
            margin: var(--space-lg) 0 var(--space-xl);
        }
        
        .instruction-rules-header {
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-bright);
            letter-spacing: 0.3em;
            margin-bottom: var(--space-lg);
            padding: var(--space-md) 0;
            border-top: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
            text-align: center;
        }
        
        @media (min-width: 390px) {
            .instruction-rules {
                margin: var(--space-xl) 0 var(--space-2xl);
            }
            .instruction-rules-header {
                font-size: 0.85rem;
                letter-spacing: 0.35em;
                margin-bottom: var(--space-xl);
            }
        }
        
        .instruction-rule {
            display: flex;
            align-items: flex-start;
            text-align: left;
            padding: var(--space-md) var(--space-sm);
            margin: var(--space-md) 0;
            border: 1px solid rgba(0, 0, 0, 0.08);
            background: rgba(0, 0, 0, 0.02);
        }
        
        @media (min-width: 390px) {
            .instruction-rule {
                padding: var(--space-lg) var(--space-md);
                margin: var(--space-lg) 0;
            }
        }
        
        .rule-number {
            font-family: 'Space Mono', monospace;
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-right: var(--space-sm);
            min-width: 24px;
            opacity: 0.8;
        }
        
        .rule-content {
            flex: 1;
        }
        
        .rule-title {
            font-family: 'Space Mono', monospace;
            font-size: 0.6875rem;
            color: var(--text-bright);
            letter-spacing: 0.08em;
            margin-bottom: var(--space-sm);
            text-transform: uppercase;
        }
        
        @media (min-width: 390px) {
            .rule-title {
                font-size: 0.75rem;
                letter-spacing: 0.1em;
                margin-bottom: var(--space-md);
            }
        }
        
        .rule-desc {
            font-size: 0.8rem;
            color: var(--text-primary);
            line-height: 1.9;
        }
        
        @media (min-width: 390px) {
            .rule-desc {
                font-size: 0.85rem;
                line-height: 2;
            }
        }

        /* Example amber preview */
        .example-amber {
            background: #faf6f0;
            border: 2px solid #f7dc6f;
            border-top: none;
            padding: var(--space-md);
            padding-top: 44px;
            margin: var(--space-lg) 0;
            color: #1a1a1a;
            font-size: 0.7rem;
            line-height: 1.8;
            position: relative;
            box-shadow: 0 3px 12px rgba(212, 136, 28, 0.12);
            font-family: 'Space Mono', monospace;
        }
        
        /* Top bar matching amber-text style */
        .example-amber::before {
            content: '⚠ DATA BREACH - LEAKED FILE DETECTED';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #fff176 0%, #f7dc6f 100%);
            padding: 6px 12px;
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            letter-spacing: 1.5px;
            color: #1a1a1a;
            font-weight: 500;
            border-bottom: 2px solid #e6c84a;
        }
        
        /* Left glowing bar matching amber-text style */
        .example-amber::after {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(180deg, #fff176 0%, #f7dc6f 100%);
        }
        
        .example-amber .amber-author {
            font-weight: 700;
            color: #8b5a00;
        }
        
        @media (min-width: 390px) {
            .example-amber {
                padding: var(--space-lg);
                padding-top: 48px;
                font-size: 0.75rem;
            }
            
            .example-amber::before {
                font-size: 0.6rem;
                padding: 8px 14px;
            }
        }

        .example-label {
            font-family: 'Space Mono', monospace;
            font-size: 0.65rem;
            letter-spacing: 2px;
            color: var(--text-dim);
            margin-bottom: 12px;
            text-align: center;
        }
        
        @media (min-width: 390px) {
            .example-label {
                font-size: 0.7rem;
            }
        }

        .example-header {
            display: none; /* Hidden since we now use ::before for the header bar */
        }

        /* Final warning - big termination notice */
        .final-note {
            text-align: center;
            padding: var(--space-lg) var(--space-md);
            margin: var(--space-xl) 0 var(--space-lg) 0;
            border: 2px solid var(--rabbit);
            background: rgba(232, 112, 126, 0.05);
        }

        .final-note-big {
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--rabbit);
            letter-spacing: 0.05em;
            margin-bottom: var(--space-sm);
            text-transform: uppercase;
        }
        
        .final-note-small {
            font-size: 0.7rem;
            color: var(--text-secondary);
            line-height: 1.6;
            font-family: 'Space Mono', monospace;
            letter-spacing: 0.02em;
        }
        
        @media (min-width: 390px) {
            .final-note {
                padding: var(--space-xl) var(--space-lg);
            }
            .final-note-big {
                font-size: 1rem;
                letter-spacing: 0.08em;
            }
            .final-note-small {
                font-size: 0.75rem;
            }
        }

        /* Hidden hint from V - first letters spell LOOK RABBIT */
        .legal-notice {
            font-family: 'Space Mono', monospace;
            font-size: clamp(0.6rem, 2.5vw, 0.8rem);
            color: var(--text-secondary);
            opacity: 0.8;
            margin: var(--space-lg) 0;
            line-height: 2.2;
            text-align: left;
            padding: var(--space-md);
            background: rgba(0, 0, 0, 0.02);
            border-left: 2px solid var(--border);
        }
        
        @media (min-width: 390px) {
            .legal-notice {
                line-height: 2.4;
                padding: var(--space-lg);
            }
        }
        
        @media (min-width: 500px) {
            .legal-notice {
                font-size: 0.85rem;
                line-height: 2.5;
            }
        }

        /* MARA style acrostic letters */
        .acrostic-letter {
            color: var(--rabbit);
            font-weight: 700;
            text-shadow: 
                0 0 8px rgba(232, 112, 126, 0.6),
                0 0 16px rgba(232, 112, 126, 0.4),
                0 0 24px rgba(232, 112, 126, 0.2);
            animation: maraGlow 2s ease-in-out infinite;
        }

        @keyframes maraGlow {
            0%, 100% { 
                opacity: 1;
                text-shadow: 
                    0 0 8px rgba(232, 112, 126, 0.6),
                    0 0 16px rgba(232, 112, 126, 0.4),
                    0 0 24px rgba(232, 112, 126, 0.2);
            }
            50% { 
                opacity: 0.9;
                text-shadow: 
                    0 0 12px rgba(232, 112, 126, 0.8),
                    0 0 24px rgba(232, 112, 126, 0.5),
                    0 0 36px rgba(232, 112, 126, 0.3);
            }
        }

        /* ════════════════════════════════
           MARA STYLE — Glitchy infected text effect (chromatic aberration)
           Use class="mara-style" data-text="your text" on any span
           ════════════════════════════════ */
        .mara-style {
            color: var(--rabbit);
            position: relative;
            display: inline-block;
            font-weight: 600;
            animation: maraPulse 3s ease-in-out infinite;
            text-shadow: 
                0 0 2px var(--rabbit),
                0 0 4px rgba(232, 112, 126, 0.4);
        }
        
        .mara-style::before,
        .mara-style::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0.7;
            font-weight: 600;
        }
        
        .mara-style::before {
            color: #ff6b6b;
            animation: maraGlitch1 0.2s infinite;
            clip-path: inset(0 0 50% 0);
        }
        
        .mara-style::after {
            color: #4ecdc4;
            animation: maraGlitch2 0.2s infinite;
            clip-path: inset(50% 0 0 0);
        }
        
        @keyframes maraPulse {
            0%, 100% { opacity: 1; }
            47% { opacity: 1; }
            50% { opacity: 0.6; }
            53% { opacity: 1; }
            80% { opacity: 1; }
            82% { opacity: 0.7; }
            84% { opacity: 1; }
        }
        
        @keyframes maraGlitch1 {
            0%, 100% { transform: translate(0); }
            20% { transform: translate(-2px, 1px); }
            40% { transform: translate(2px, -1px); }
            60% { transform: translate(-1px, 2px); }
        }
        
        @keyframes maraGlitch2 {
            0%, 100% { transform: translate(0); }
            20% { transform: translate(2px, -1px); }
            40% { transform: translate(-2px, 1px); }
            60% { transform: translate(1px, -2px); }
        }

        /* Agreement box */
        .agreement-box {
            margin-top: 40px;
            padding-top: 24px;
            border-top: 1px solid var(--border);
        }

        .checkbox-container {
            display: flex;
            gap: 16px;
            align-items: flex-start;
            cursor: pointer;
            margin-bottom: 24px;
            padding: 16px;
            border: 1px solid var(--border);
            background: var(--bg-secondary);
        }

        .checkbox-container:hover {
            border-color: var(--border-light);
        }

        .custom-checkbox {
            width: 20px;
            height: 20px;
            min-width: 20px;
            border: 2px solid var(--text-dim);
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 2px;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .custom-checkbox.checked {
            border-color: var(--text-bright);
            background: var(--text-bright);
        }

        .custom-checkbox.checked::after {
            content: '✓';
            color: var(--bg-primary);
            font-size: 14px;
            font-weight: bold;
        }

        .checkbox-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.7;
            cursor: pointer;
        }

        .understand-btn {
            width: 100%;
            padding: 18px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            color: var(--text-dim);
            font-family: 'Space Mono', monospace;
            font-size: 1rem;
            letter-spacing: 3px;
            cursor: not-allowed;
            transition: all 0.3s ease;
        }

        .understand-btn.enabled {
            cursor: pointer;
            border-color: var(--text-bright);
            color: var(--white);
            background: transparent;
        }

        .understand-btn.enabled:hover {
            background: rgba(0, 0, 0, 0.06);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }

        .section-header {
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            color: var(--text-bright);
            text-align: center;
            letter-spacing: 0.5px;
            margin-bottom: 24px;
            opacity: 0.7;
            word-break: break-word;
            text-shadow: 0 0 20px rgba(0, 0, 0, 0.08);
            padding: 0 10px;
        }
        
        @media (min-width: 360px) {
            .section-header {
                font-size: 0.6rem;
                letter-spacing: 1px;
            }
        }
        
        /* CRT RGB flicker effect on loading/processing headers */
        .section-header[class*="LOADING"],
        .section-header[class*="PROCESSING"],
        .section-header[class*="INITIALIZED"],
        .section-header[class*="STANDBY"],
        #test2 .section-header,
        #test4 .section-header,
        #test6 .section-header {
            animation: crtHeaderFlicker 2.5s infinite;
        }
        
        @keyframes crtHeaderFlicker {
            0%, 100% { 
                text-shadow: 
                    0.4px 0 1px rgba(0, 150, 255, 0.4), 
                    -0.4px 0 1px rgba(255, 50, 80, 0.3), 
                    0 0 8px rgba(0, 0, 0, 0.1); 
            }
            20% { 
                text-shadow: 
                    1.2px 0 1px rgba(0, 150, 255, 0.4), 
                    -1.2px 0 1px rgba(255, 50, 80, 0.3), 
                    0 0 8px rgba(0, 0, 0, 0.1); 
            }
            40% { 
                text-shadow: 
                    0.2px 0 1px rgba(0, 150, 255, 0.4), 
                    -0.2px 0 1px rgba(255, 50, 80, 0.3), 
                    0 0 8px rgba(0, 0, 0, 0.1); 
            }
            60% { 
                text-shadow: 
                    0.8px 0 1px rgba(0, 150, 255, 0.4), 
                    -0.8px 0 1px rgba(255, 50, 80, 0.3), 
                    0 0 8px rgba(0, 0, 0, 0.1); 
            }
            80% { 
                text-shadow: 
                    0.3px 0 1px rgba(0, 150, 255, 0.4), 
                    -0.3px 0 1px rgba(255, 50, 80, 0.3), 
                    0 0 8px rgba(0, 0, 0, 0.1); 
            }
        }

        @media (min-width: 480px) {
            .section-header {
                font-size: 0.75rem;
                letter-spacing: 2px;
                margin-bottom: 28px;
            }
        }
        
        .containment-advisory {
            font-family: 'Space Mono', monospace;
            font-size: 0.4rem;
            letter-spacing: 1px;
            color: #C0C0C0;
            text-align: center;
            margin-bottom: 16px;
            opacity: 0;
            animation: advisoryFlicker 15s ease-in-out infinite;
            text-shadow: 0 0 8px rgba(192, 192, 192, 0.4);
        }
        
        @keyframes advisoryFlicker {
            0%, 100% { opacity: 0; }
            42% { opacity: 0; }
            43% { opacity: 0.6; }
            44% { opacity: 0.2; }
            46% { opacity: 0.7; }
            48% { opacity: 0.3; }
            50% { opacity: 0; }
        }

        /* ============ WARNING BOX ============ */
        .warning-box {
            border: 2px solid #f7dc6f;
            border-left: 4px solid #fff176;
            padding: var(--space-md);
            background: linear-gradient(135deg, rgba(245, 166, 35, 0.08) 0%, rgba(212, 136, 28, 0.04) 100%);
            margin-bottom: var(--space-xl);
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(212, 136, 28, 0.1);
        }
        
        @media (min-width: 390px) {
            .warning-box {
                padding: var(--space-lg);
            }
        }

        .warning-box h2 {
            font-family: 'Space Mono', monospace;
            font-size: 0.875rem;
            color: #1a1a1a;
            margin-bottom: var(--space-sm);
            letter-spacing: 0.15em;
        }

        .warning-box ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .warning-box li {
            color: #2d2d2d;
            margin-bottom: var(--space-xs);
            padding-left: var(--space-md);
            position: relative;
            font-size: 0.75rem;
            line-height: 1.6;
        }
        
        @media (min-width: 390px) {
            .warning-box li {
                font-size: 0.8125rem;
            }
        }

        .warning-box li::before {
            content: "›";
            position: absolute;
            left: 0;
            color: #f7dc6f;
        }

        /* ============ TEST SECTIONS ============ */
        .test-section {
            display: none;
        }

        .test-section.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }
        
        /* ============ SECTION 3 DREAM EFFECT ============ */
        #test3 {
            position: relative;
            overflow: hidden;
        }
        
        /* ════════════════════════════════
           SECTION 3 - FORCED DARK MODE - MYSTERIOUS THEME
           Owen's dream / white room story - should feel unsettling
           ════════════════════════════════ */
        #test3.active {
            animation: fadeIn 0.4s ease;
            background: #080808 !important;
        }
        
        /* Section header and progress */
        #test3 .section-header,
        #test3 .progress {
            color: #555 !important;
        }
        
        /* Question blocks */
        #test3 .question-block {
            background: rgba(15, 15, 15, 0.9) !important;
            border: 1px solid #1a1a1a !important;
        }
        
        #test3 .question-number {
            color: #444 !important;
        }
        
        #test3 .question-text {
            color: #999 !important;
        }
        
        #test3 .options li {
            background: #0a0a0a !important;
            border: 1px solid #1a1a1a !important;
            color: #777 !important;
        }
        
        #test3 .options li:hover {
            background: #111 !important;
            border-color: #2a2a2a !important;
            color: #aaa !important;
        }
        
        #test3 .options li.selected {
            background: #111 !important;
            border-color: #8b0000 !important;
            color: #ccc !important;
        }
        
        /* ═══ THE LEAKED FILE CONTAINER ═══ */
        #test3 .amber-text,
        #test3.active .amber-text {
            background: #0a0a0a !important;
            border: none !important;
            border-left: 2px solid #2a0000 !important;
            color: #888 !important;
            box-shadow: none !important;
            filter: none !important;
            animation: none !important;
            padding: 20px !important;
            padding-top: 44px !important;
            margin: 24px 0 !important;
        }
        
        /* Header bar - dark red glow */
        #test3 .amber-text::before,
        #test3.active .amber-text::before {
            content: '◈ RESTRICTED' !important;
            background: #080808 !important;
            border: none !important;
            border-bottom: 1px solid #1a0000 !important;
            color: #660000 !important;
            font-size: 0.5rem !important;
            letter-spacing: 4px !important;
            padding: 8px 16px !important;
            box-shadow: none !important;
            text-shadow: 0 0 8px rgba(100, 0, 0, 0.4);
            animation: restrictedGlow 4s ease-in-out infinite;
        }
        
        @keyframes restrictedGlow {
            0%, 100% { 
                color: #8b0000;
                text-shadow: 0 0 10px rgba(139, 0, 0, 0.3);
            }
            50% { 
                color: #aa2222;
                text-shadow: 0 0 20px rgba(139, 0, 0, 0.6);
            }
        }
        
        /* Left accent bar - hide it, using border-left instead */
        #test3 .amber-text::after,
        #test3.active .amber-text::after {
            display: none !important;
        }
        
        /* File header info */
        #test3 .amber-header {
            background: transparent !important;
            border: none !important;
            border-bottom: 1px solid #1a1a1a !important;
            border-left: none !important;
            color: #444 !important;
            padding: 12px 0 !important;
            margin-bottom: 20px !important;
        }
        
        #test3 .amber-header .doc-id {
            color: #555 !important;
        }
        
        /* Story text */
        #test3 .hidden-message {
            color: #999 !important;
            line-height: 2 !important;
        }
        
        #test3 .hidden-message em {
            color: #bbb !important;
            font-style: italic;
        }
        
        /* Character colors - muted but visible */
        #test3 .c-vincent { color: #6a8099 !important; }
        #test3 .c-rabbit, #test3 .c-isla { color: #996a70 !important; }
        #test3 .c-owen { color: #888 !important; }
        #test3 .c-marcus { color: #5a8a5a !important; }
        
        /* Story breaks */
        #test3 .story-break {
            opacity: 0.3 !important;
        }
        
        #test3 .break-line {
            color: #333 !important;
        }
        
        /* Terminal line */
        #test3 .terminal-line {
            color: #333 !important;
        }
        
        /* Submit button */
        #test3 .submit-btn {
            background: #0a0a0a !important;
            border-color: #2a2a2a !important;
            color: #666 !important;
        }
        
        #test3 .submit-btn:hover {
            border-color: #444 !important;
            color: #999 !important;
        }
        
        /* Subtle vignette - darkness at edges */
        #test3::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 100;
            box-shadow: inset 0 0 150px 50px rgba(0, 0, 0, 0.4);
        }
        
        /* ════════════════════════════════ */
        
        /* Section 3 character styling handled above */
        
        /* Key emphasized text pulses through */
        #test3 .c-emphasis {
            animation: emphasisBleed 5s ease-in-out infinite;
        }
        
        @keyframes emphasisBleed {
            0%, 70%, 100% {
                opacity: 0.8;
            }
            75%, 85% {
                opacity: 1;
                text-shadow: 0 0 4px currentColor;
            }
        }
        
        /* Owen wisp canvas - ethereal smoke effect with color inversion */
        #owenWispCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9989;
            opacity: 0;
            transition: opacity 0.8s ease;
            -webkit-transform: translateZ(0); /* Force GPU acceleration on iOS */
            transform: translateZ(0);
            mix-blend-mode: difference; /* Inverts colors behind the wisps */
        }
        
        #owenWispCanvas.active {
            opacity: 1;
        }
        
        /* WebKit canvas rendering optimization */
        #owenWispCanvas {
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            -webkit-perspective: 1000;
            perspective: 1000;
        }
        
        /* Dream text effects for Section 3 - subtle wobble on story content */
        #test3 .amber-text .hidden-message {
            animation: dreamTextWobble 8s ease-in-out infinite;
        }
        
        @keyframes dreamTextWobble {
            0%, 100% { 
                transform: translateX(0) skewX(0deg);
            }
            25% { 
                transform: translateX(0.5px) skewX(0.1deg);
            }
            50% { 
                transform: translateX(-0.5px) skewX(-0.1deg);
            }
            75% { 
                transform: translateX(0.25px) skewX(0.05deg);
            }
        }
        
        /* Subtle glow on Section 3 headers only */
        #test3 .section-header,
        #test3 .progress,
        #test3 .containment-advisory {
            animation: dreamGlow 4s ease-in-out infinite alternate;
        }
        
        @keyframes dreamGlow {
            0% {
                text-shadow: 
                    0 0 15px rgba(0, 0, 0, 0.1),
                    0 0 30px rgba(138, 43, 226, 0.1),
                    0 0 45px rgba(0, 255, 255, 0.05);
            }
            100% {
                text-shadow: 
                    0 0 20px rgba(0, 0, 0, 0.1),
                    0 0 40px rgba(138, 43, 226, 0.15),
                    0 0 60px rgba(0, 255, 255, 0.1);
            }
        }
        
        /* Ripple touch indicator */
        .ripple-touch {
            position: fixed;
            border-radius: 50%;
            pointer-events: none;
            background: radial-gradient(circle, rgba(255,255,255,0.4) 0%, transparent 70%);
            transform: scale(0);
            animation: rippleExpand 1s ease-out forwards;
            z-index: 10002;
        }
        
        @keyframes rippleExpand {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(4);
                opacity: 0;
            }
        }
        
        /* CSS-only dream fallback for Instagram browser / older iOS */
        #test3.dream-css-fallback {
            animation: fadeIn 0.4s ease, cssDreamPulse 5s ease-in-out infinite;
        }
        
        #test3.dream-css-fallback::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(ellipse at 30% 20%, rgba(138, 43, 226, 0.03) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 80%, rgba(0, 255, 255, 0.025) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(0, 0, 0, 0.015) 0%, transparent 70%);
            animation: cssDreamOverlay 10s ease-in-out infinite;
            pointer-events: none;
            z-index: 10001;
        }
        
        @keyframes cssDreamPulse {
            0%, 100% { 
                filter: hue-rotate(0deg) saturate(1) blur(0px);
            }
            25% { 
                filter: hue-rotate(3deg) saturate(1.05) blur(0.1px);
            }
            50% { 
                filter: hue-rotate(-3deg) saturate(0.98) blur(0px);
            }
            75% { 
                filter: hue-rotate(1.5deg) saturate(1.02) blur(0.05px);
            }
        }
        
        @keyframes cssDreamOverlay {
            0%, 100% {
                opacity: 0.2;
                transform: scale(1);
            }
            50% {
                opacity: 0.3;
                transform: scale(1.02);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(6px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .progress {
            font-family: 'Space Mono', monospace;
            font-size: 0.625rem;
            color: var(--text-dim);
            text-align: center;
            margin-bottom: var(--space-xl);
            letter-spacing: 0.25em;
            text-transform: uppercase;
            padding: var(--space-sm) var(--space-md);
            border: 1px solid var(--border);
            display: inline-block;
            margin-left: 50%;
            transform: translateX(-50%);
        }
        
        @media (min-width: 390px) {
            .progress {
                font-size: 0.6875rem;
                margin-bottom: var(--space-2xl);
            }
        }

        .section-header {
            font-family: 'Space Mono', monospace;
            font-size: 0.6875rem;
            color: var(--text-dim);
            text-align: center;
            letter-spacing: 0.2em;
            margin-bottom: var(--space-md);
            padding-bottom: var(--space-sm);
            border-bottom: 1px solid var(--border);
        }
        
        @media (min-width: 390px) {
            .section-header {
                font-size: 0.75rem;
                letter-spacing: 0.25em;
            }
        }

        .terminal-line {
            font-family: 'Space Mono', monospace;
            font-size: 0.625rem;
            color: var(--text-ghost);
            text-align: center;
            letter-spacing: 0.15em;
            margin: var(--space-md) 0 var(--space-sm) 0;
            opacity: 0.8;
        }

        /* ============ QUESTIONS ============ */
        .question-block {
            margin-bottom: var(--space-xl);
            padding-bottom: var(--space-xl);
            border-bottom: 1px solid var(--border);
        }

        @media (min-width: 390px) {
            .question-block {
                margin-bottom: var(--space-2xl);
                padding-bottom: var(--space-2xl);
            }
        }

        .question-block:last-of-type {
            border-bottom: none;
        }

        .question-number {
            font-family: 'Space Mono', monospace;
            font-size: 0.5625rem;
            color: var(--text-dim);
            letter-spacing: 0.2em;
            margin-bottom: var(--space-sm);
            text-transform: uppercase;
        }
        
        @media (min-width: 390px) {
            .question-number {
                font-size: 0.625rem;
                margin-bottom: var(--space-md);
            }
        }

        .question-text {
            font-size: 0.875rem;
            margin-bottom: var(--space-lg);
            line-height: 1.85;
            color: #000000;
            word-wrap: break-word;
            overflow-wrap: break-word;
            padding: var(--space-md);
            background: rgba(0, 0, 0, 0.03);
            border-left: 2px solid rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            border-radius: 2px;
        }
        
        /* eerieQuestionGlow kept for potential other uses */
        @keyframes eerieQuestionGlow {
            0%, 100% { 
                text-shadow: 
                    0 0 30px rgba(0, 0, 0, 0.1),
                    0 0 60px rgba(0, 0, 0, 0.06),
                    0 0 100px rgba(0, 0, 0, 0.03);
                box-shadow: 
                    0 0 40px rgba(0, 0, 0, 0.015),
                    inset 0 0 50px rgba(0, 0, 0, 0.005);
            }
            50% { 
                text-shadow: 
                    0 0 40px rgba(0, 0, 0, 0.12),
                    0 0 80px rgba(0, 0, 0, 0.08),
                    0 0 120px rgba(0, 0, 0, 0.04);
                box-shadow: 
                    0 0 60px rgba(0, 0, 0, 0.02),
                    inset 0 0 70px rgba(0, 0, 0, 0.008);
            }
        }

        .question-text:hover {
            border-left-color: rgba(0, 0, 0, 0.18);
        }

        @media (min-width: 390px) {
            .question-text {
                font-size: 0.9375rem;
                margin-bottom: var(--space-xl);
                line-height: 1.9;
                padding: var(--space-lg);
            }
        }
        
        /* Progressive distortion for terminated employee lines */
        .terminated-line {
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
            font-style: normal;
        }
        
        .terminated-line.distort-1 {
            color: var(--text-dim);
            opacity: 1;
        }
        
        .terminated-line.distort-2 {
            color: var(--text-dim);
            opacity: 0.85;
            text-shadow: 0.5px 0 0 rgba(255, 100, 100, 0.15), -0.5px 0 0 rgba(100, 200, 255, 0.15);
        }
        
        .terminated-line.distort-3 {
            color: var(--text-dim);
            opacity: 0.7;
            text-shadow: 1px 0 0 rgba(255, 100, 100, 0.2), -1px 0 0 rgba(100, 200, 255, 0.2);
            animation: distortFlicker3 4s ease-in-out infinite;
        }
        
        .terminated-line.distort-4 {
            color: var(--text-dim);
            opacity: 0.55;
            text-shadow: 1.5px 0 0 rgba(255, 100, 100, 0.25), -1.5px 0 0 rgba(100, 200, 255, 0.25);
            animation: distortFlicker4 3s ease-in-out infinite;
            filter: blur(0.3px);
        }
        
        .terminated-line.distort-5 {
            color: var(--text-dim);
            opacity: 0.4;
            text-shadow: 2px 0 0 rgba(255, 100, 100, 0.3), -2px 0 0 rgba(100, 200, 255, 0.3);
            animation: distortFlicker5 2s ease-in-out infinite;
            filter: blur(0.5px);
        }
        
        .terminated-line.distort-6 {
            color: var(--text-dim);
            opacity: 0.25;
            text-shadow: 2.5px 0 0 rgba(255, 100, 100, 0.35), -2.5px 0 0 rgba(100, 200, 255, 0.35);
            animation: distortFlicker6 1.5s ease-in-out infinite;
            filter: blur(0.8px);
        }
        
        .terminated-line.distort-7 {
            color: var(--text-dim);
            opacity: 0.12;
            text-shadow: 3px 0 0 rgba(255, 100, 100, 0.4), -3px 0 0 rgba(100, 200, 255, 0.4);
            animation: distortFlicker7 1s ease-in-out infinite;
            filter: blur(1px);
        }
        
        .terminated-line.distort-8 {
            color: var(--text-dim);
            opacity: 0.05;
            text-shadow: 4px 0 0 rgba(255, 100, 100, 0.5), -4px 0 0 rgba(100, 200, 255, 0.5);
            animation: distortFlicker8 0.5s ease-in-out infinite;
            filter: blur(1.5px);
        }
        
        @keyframes distortFlicker3 {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(0.5px); }
        }
        
        @keyframes distortFlicker4 {
            0%, 100% { transform: translateX(0); opacity: 0.55; }
            25% { transform: translateX(-0.5px); }
            50% { transform: translateX(0.5px); opacity: 0.45; }
            75% { transform: translateX(-0.3px); }
        }
        
        @keyframes distortFlicker5 {
            0%, 100% { transform: translateX(0); opacity: 0.4; }
            20% { transform: translateX(1px); opacity: 0.3; }
            40% { transform: translateX(-0.5px); }
            60% { transform: translateX(0.5px); opacity: 0.35; }
            80% { transform: translateX(-1px); }
        }
        
        @keyframes distortFlicker6 {
            0%, 100% { transform: translateX(0); opacity: 0.25; }
            15% { transform: translateX(1.5px); opacity: 0.15; }
            30% { transform: translateX(-1px); opacity: 0.2; }
            50% { transform: translateX(0); opacity: 0.1; }
            70% { transform: translateX(1px); opacity: 0.25; }
            85% { transform: translateX(-1.5px); }
        }
        
        @keyframes distortFlicker7 {
            0%, 100% { transform: translateX(0); opacity: 0.12; }
            10% { transform: translateX(2px); opacity: 0.05; }
            25% { transform: translateX(-1.5px); opacity: 0.15; }
            40% { transform: translateX(1px); opacity: 0.08; }
            55% { transform: translateX(-2px); opacity: 0.1; }
            70% { transform: translateX(1.5px); opacity: 0.05; }
            85% { transform: translateX(-1px); opacity: 0.12; }
        }
        
        @keyframes distortFlicker8 {
            0%, 100% { transform: translateX(0); opacity: 0.05; }
            20% { transform: translateX(3px); opacity: 0.02; }
            40% { transform: translateX(-2px); opacity: 0.08; }
            60% { transform: translateX(2px); opacity: 0.03; }
            80% { transform: translateX(-3px); opacity: 0.05; }
        }

        .options {
            list-style: none;
            padding: 0;
        }

        .options li {
            min-height: var(--touch-target);
            padding: var(--space-md);
            margin-bottom: var(--space-sm);
            border: 1px solid rgba(0, 0, 0, 0.15);
            background: rgba(0, 0, 0, 0.02);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.8125rem;
            line-height: 1.7;
            color: #1a1a1a;
            word-wrap: break-word;
            overflow-wrap: break-word;
            border-radius: 2px;
            -webkit-tap-highlight-color: transparent;
            position: relative;
        }

        .options li::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 0;
            background: rgba(0, 0, 0, 0.18);
            transition: width 0.2s ease;
            opacity: 0.3;
        }

        @media (min-width: 390px) {
            .options li {
                padding: var(--space-md) var(--space-lg);
                font-size: 0.875rem;
                line-height: 1.75;
            }
        }

        .options li:hover {
            border-color: rgba(0, 0, 0, 0.2);
            background: rgba(0, 0, 0, 0.04);
            color: #000000;
        }

        .options li:hover::before {
            width: 3px;
        }
        
        .options li:active {
            transform: scale(0.99);
            background: rgba(0, 0, 0, 0.03);
        }

        .options li.selected {
            border-color: rgba(0, 0, 0, 0.18);
            background: rgba(0, 0, 0, 0.04);
            color: var(--text-bright);
            text-shadow: 
                0 0 30px rgba(0, 0, 0, 0.15),
                0 0 60px rgba(0, 0, 0, 0.1);
            box-shadow: 
                0 0 50px rgba(0, 0, 0, 0.04),
                inset 0 0 50px rgba(0, 0, 0, 0.015);
        }

        .options li.selected::before {
            width: 3px;
            opacity: 0.8;
        }

        .options li.locked {
            opacity: 0.35;
            pointer-events: none;
        }

        .options li.locked.selected {
            opacity: 1;
        }

        .options li.correct-answer {
            border-color: var(--marcus) !important;
            background: rgba(94, 198, 158, 0.15) !important;
            color: var(--text-primary) !important;
            opacity: 1 !important;
            box-shadow: 
                0 2px 8px rgba(94, 198, 158, 0.2),
                inset 0 0 0 1px rgba(94, 198, 158, 0.3) !important;
        }

        .options li.correct-answer::before {
            content: '✓ ';
            opacity: 0.7;
        }

        .options li.wrong-answer {
            border-color: var(--text-ghost) !important;
            background: transparent !important;
            color: var(--text-dim) !important;
            opacity: 0.4 !important;
            text-shadow: none !important;
            box-shadow: none !important;
        }

        .options li.wrong-answer.selected {
            opacity: 0.7 !important;
            border-color: var(--text-dim) !important;
            text-decoration: line-through;
            text-decoration-color: var(--text-ghost);
        }

        /* ============ LEAKED FILE SECTIONS ============ */
        @keyframes leakReveal {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Flickering animation for the breach header */
        @keyframes breachFlicker {
            0%, 100% { 
                opacity: 1;
                text-shadow: 0 0 8px var(--vincent-glow);
            }
            5% { 
                opacity: 0.1;
                text-shadow: none;
            }
            6% { 
                opacity: 1;
                text-shadow: 0 0 15px var(--vincent-glow), 0 0 30px var(--vincent-glow);
            }
            10% {
                opacity: 0.8;
            }
            15% {
                opacity: 1;
            }
            35% { 
                opacity: 0.05;
                text-shadow: none;
            }
            36% { 
                opacity: 1;
                text-shadow: 0 0 20px var(--vincent-glow);
            }
            55% {
                opacity: 1;
            }
            56% {
                opacity: 0.3;
            }
            57% {
                opacity: 1;
            }
            80% {
                opacity: 1;
                text-shadow: 0 0 8px var(--vincent-glow);
            }
            81% {
                opacity: 0.6;
                text-shadow: 0 0 25px var(--vincent-glow);
            }
            82% {
                opacity: 1;
            }
        }
        
        @keyframes breachBarFlicker {
            0%, 100% { 
                background: rgba(143, 164, 184, 0.15);
                border-bottom-color: rgba(143, 164, 184, 0.3);
            }
            5%, 35% { 
                background: rgba(143, 164, 184, 0.02);
                border-bottom-color: rgba(143, 164, 184, 0.1);
            }
            6%, 36% { 
                background: rgba(143, 164, 184, 0.25);
                border-bottom-color: rgba(143, 164, 184, 0.5);
            }
            56% {
                background: rgba(143, 164, 184, 0.08);
            }
            57%, 81% {
                background: rgba(143, 164, 184, 0.2);
            }
            82% {
                background: rgba(143, 164, 184, 0.15);
            }
        }
        
        @keyframes breachGlitch {
            0%, 100% {
                transform: translateX(0);
            }
            5% {
                transform: translateX(-2px);
            }
            6% {
                transform: translateX(3px);
            }
            35% {
                transform: translateX(1px);
            }
            36% {
                transform: translateX(-1px);
            }
            56% {
                transform: translateX(2px);
            }
            57% {
                transform: translateX(0);
            }
        }

        /* ════════════════════════════════
           CLASSIFIED LEAK SECTIONS (Vincent's hidden messages)
           A system glitch is causing classified files to bleed through
           ════════════════════════════════ */
        
        .classified-leak {
            color: #1a1a1a;
            padding: var(--space-xl) var(--space-lg);
            padding-top: 56px;
            margin: var(--space-2xl) calc(var(--space-md) * -1);
            font-size: 0.9375rem;
            line-height: 1.9;
            background: #faf6f0;
            border: 2px solid #f7dc6f;
            border-top: none;
            position: relative;
            animation: leakReveal 0.5s ease;
            word-wrap: break-word;
            overflow-wrap: break-word;
            box-shadow: 0 4px 16px rgba(212, 136, 28, 0.15);
        }
        
        @media (min-width: 390px) {
            .classified-leak {
                padding: var(--space-2xl) var(--space-xl);
                padding-top: 60px;
                margin: var(--space-2xl) calc(var(--space-lg) * -1);
            }
        }

        /* Top warning bar */
        .classified-leak::before {
            content: '⚠ DATA BREACH - LEAKED FILE DETECTED';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #fff176 0%, #f7dc6f 100%);
            padding: 10px 16px;
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            letter-spacing: 2px;
            color: #1a1a1a;
            font-weight: 500;
            border-bottom: 2px solid #e6c84a;
        }
        
        @media (min-width: 390px) {
            .classified-leak::before {
                font-size: 0.65rem;
                letter-spacing: 2.5px;
                padding: 12px 20px;
            }
        }

        /* Left accent bar */
        .classified-leak::after {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(180deg, #fff176 0%, #f7dc6f 100%);
        }

        @media (min-width: 768px) {
            .classified-leak {
                margin: 48px 0;
                padding: 48px 36px 40px 40px;
                padding-top: 56px;
                font-size: 0.92rem;
                line-height: 2.2;
            }
        }

        /* Leak header - the fake "file metadata" */
        .leak-header {
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            letter-spacing: 1px;
            line-height: 2;
            margin-top: 20px;
            margin-bottom: 28px;
            padding: 16px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(143, 164, 184, 0.15);
            color: var(--text-dim);
        }
        
        @media (min-width: 480px) {
            .leak-header {
                font-size: 0.65rem;
            }
        }
        
        .leak-header .doc-id {
            color: var(--vincent);
            opacity: 0.8;
        }
        
        .leak-header .forward-status {
            color: var(--rabbit);
            animation: forwardPulse 2s ease-in-out infinite;
        }
        
        @keyframes forwardPulse {
            0%, 100% { 
                opacity: 0.8;
                text-shadow: 0 0 5px var(--rabbit-glow);
            }
            50% { 
                opacity: 1;
                text-shadow: 0 0 12px var(--rabbit-glow);
            }
        }

        /* Legacy alias for backward compatibility */
        .amber-text {
            color: #1a1a1a;
            padding: var(--space-xl) var(--space-lg);
            padding-top: 56px;
            margin: var(--space-2xl) calc(var(--space-md) * -1);
            font-size: 0.9375rem;
            line-height: 1.9;
            background: #faf6f0;
            border: 2px solid #f7dc6f;
            border-top: none;
            position: relative;
            animation: leakReveal 0.5s ease;
            word-wrap: break-word;
            overflow-wrap: break-word;
            box-shadow: 0 4px 20px rgba(212, 136, 28, 0.15);
        }
        
        @media (min-width: 390px) {
            .amber-text {
                padding: var(--space-2xl) var(--space-xl);
                padding-top: 60px;
                margin: var(--space-2xl) calc(var(--space-lg) * -1);
            }
        }

        .amber-text::before {
            content: '⚠ DATA BREACH - LEAKED FILE DETECTED';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #fff176 0%, #f7dc6f 100%);
            padding: 12px 16px;
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            letter-spacing: 2px;
            color: #1a1a1a;
            font-weight: 500;
            border-bottom: 3px solid #e6c84a;
            box-shadow: 0 2px 8px rgba(212, 136, 28, 0.3);
        }
        
        @media (min-width: 390px) {
            .amber-text::before {
                font-size: 0.65rem;
                letter-spacing: 2.5px;
                padding: 14px 20px;
            }
        }

        .amber-text::after {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(180deg, #fff176 0%, #f7dc6f 100%);
        }

        @media (min-width: 768px) {
            .amber-text {
                margin: 48px 0;
                padding: 64px 36px 40px 40px;
                font-size: 0.92rem;
                line-height: 2.2;
            }
        }

        .admin-header {
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            letter-spacing: 2px;
            margin-bottom: 16px;
            opacity: 0.35;
            color: var(--vincent);
        }

        /* New leak header style */
        .amber-header {
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            letter-spacing: 1px;
            line-height: 2;
            margin-top: 16px;
            margin-bottom: 24px;
            padding: 14px 16px;
            background: #ffffff;
            border: 1px solid #e0e0e0;
            border-left: 3px solid #f7dc6f;
            color: #555555;
            border-radius: 2px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
        }
        
        @media (min-width: 480px) {
            .amber-header {
                font-size: 0.65rem;
                padding: 16px 20px;
            }
        }
        
        .amber-header .doc-id {
            color: #1a1a1a;
            font-weight: 500;
        }
        
        .amber-header .forward-tracking-disabled,
        .forward-tracking-disabled {
            color: #2d8a4e;
            font-weight: 500;
        }

        .filler-text {
            font-size: 0.7rem;
            line-height: 1.7;
            color: #777777;
            margin-bottom: 8px;
        }
        
        /* SCP-style formatting elements */
        .scp-redacted {
            background: var(--bg-primary);
            color: #000;
            padding: 0 4px;
            border-radius: 2px;
            user-select: none;
            cursor: default;
        }
        
        .scp-expunged {
            color: var(--text-dim);
            font-weight: bold;
            letter-spacing: 1px;
        }
        
        .scp-label {
            font-weight: bold;
            color: var(--text-bright);
        }
        
        .scp-addendum {
            border-left: 2px solid var(--text-ghost);
            padding-left: 15px;
            margin: 20px 0;
            font-size: 0.9em;
        }
        
        .scp-note {
            font-style: italic;
            color: var(--text-dim);
            border: 1px dashed var(--text-ghost);
            padding: 10px 15px;
            margin: 15px 0;
            font-size: 0.85em;
        }
        
        .scp-note::before {
            content: "Note: ";
            font-weight: bold;
            font-style: normal;
        }
        
        .scp-warning-box {
            border: 1px solid var(--coral);
            background: rgba(255, 138, 128, 0.05);
            padding: 15px;
            margin: 20px 0;
            text-align: center;
        }
        
        .scp-warning-box .warning-title {
            color: var(--coral);
            font-weight: bold;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }
        
        /* Amber header - clean document metadata style */
        /* (Main definition is above, this ensures consistency) */
        
        @keyframes forwardTrackingPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* Redacted year - shows as blocks */
        .year-redacted {
            background: var(--text-ghost);
            color: var(--text-ghost);
            padding: 0 2px;
            border-radius: 1px;
            user-select: none;
            letter-spacing: -1px;
        }
        
        /* Slightly different style for amber sections */
        .amber-text .year-redacted,
        .example-amber .year-redacted {
            background: rgba(255, 204, 0, 0.3);
            color: rgba(255, 204, 0, 0.3);
        }
        
        /* For the title page timestamp */
        .title-timestamp .year-redacted {
            background: var(--text-dim);
            color: var(--text-dim);
        }
        
        /* ============ TERMINATION ANNOUNCEMENT BROADCAST ============ */
        .termination-broadcast {
            position: relative;
            margin: 60px -20px;
            padding: 0;
            background: var(--bg-primary);
            border-top: 2px solid var(--white);
            border-bottom: 2px solid var(--white);
            overflow: hidden;
        }
        
        @media (min-width: 480px) {
            .termination-broadcast {
                margin: 80px -40px;
            }
        }
        
        .termination-broadcast::before {
            content: '◉ FACILITY-WIDE BROADCAST ◉';
            display: block;
            text-align: center;
            font-family: 'Space Mono', monospace;
            font-size: 0.65rem;
            letter-spacing: 4px;
            color: var(--white);
            background: var(--bg-primary);
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.12);
        }
        
        .termination-content {
            padding: 40px 20px;
            text-align: center;
            animation: broadcastPulse 3s ease-in-out infinite;
        }
        
        @keyframes broadcastPulse {
            0%, 100% { 
                background: rgba(0, 0, 0, 0.02);
            }
            50% { 
                background: rgba(0, 0, 0, 0.04);
            }
        }
        
        .termination-label {
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            letter-spacing: 3px;
            color: var(--text-dim);
            margin-bottom: 16px;
        }
        
        .termination-name {
            font-family: 'Space Mono', monospace;
            font-size: 1.8rem;
            letter-spacing: 6px;
            color: var(--white);
            text-shadow: 0 0 30px rgba(0, 0, 0, 0.18);
            margin-bottom: 12px;
            text-transform: uppercase;
        }
        
        @media (min-width: 480px) {
            .termination-name {
                font-size: 2.2rem;
                letter-spacing: 8px;
            }
        }
        
        .termination-status {
            font-family: 'Space Mono', monospace;
            font-size: 1.4rem;
            letter-spacing: 8px;
            color: var(--terminated);
            text-shadow: 0 0 20px rgba(139, 0, 0, 0.8);
            margin-bottom: 20px;
            animation: terminatedFlash 2s ease-in-out infinite;
        }
        
        @keyframes terminatedFlash {
            0%, 100% { 
                opacity: 1;
            }
            50% { 
                opacity: 0.7;
            }
        }
        
        .termination-details {
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            letter-spacing: 2px;
            color: var(--text-secondary);
            line-height: 2;
        }
        
        .termination-details span {
            display: inline-block;
            padding: 0 12px;
            border-left: 1px solid var(--text-ghost);
        }
        
        .termination-details span:first-child {
            border-left: none;
        }
        
        .termination-broadcast::after {
            content: 'THIS MESSAGE WILL REPEAT';
            display: block;
            text-align: center;
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            letter-spacing: 3px;
            color: var(--text-ghost);
            background: var(--bg-primary);
            padding: 8px 0;
            border-top: 1px solid rgba(0, 0, 0, 0.12);
        }
        
        /* Second and third broadcasts - progressively more intense */
        .termination-broadcast.broadcast-2 {
            border-color: var(--coral);
        }
        
        .termination-broadcast.broadcast-2::before {
            content: '◉ FACILITY-WIDE BROADCAST — REPEAT ◉';
            color: var(--coral);
        }
        
        .termination-broadcast.broadcast-2 .termination-name {
            color: var(--coral);
            text-shadow: 0 0 30px rgba(255, 138, 128, 0.5);
        }
        
        .termination-broadcast.broadcast-3 {
            border-color: var(--terminated);
        }
        
        .termination-broadcast.broadcast-3::before {
            content: '◉◉◉ FACILITY-WIDE BROADCAST — FINAL ◉◉◉';
            color: var(--terminated);
        }
        
        .termination-broadcast.broadcast-3 .termination-name {
            color: var(--terminated);
            text-shadow: 0 0 30px rgba(139, 0, 0, 0.8);
            animation: finalBroadcast 1s ease-in-out infinite;
        }
        
        @keyframes finalBroadcast {
            0%, 100% { 
                transform: scale(1);
            }
            50% { 
                transform: scale(1.02);
            }
        }
        
        .termination-broadcast.broadcast-3::after {
            content: '';
            display: none;
        }

        .hidden-message {
            margin-top: 24px;
            line-height: 2.1;
            color: #2d2d2d;
            font-family: 'Space Mono', monospace;
            font-weight: 400;
            font-size: 0.9rem;
            letter-spacing: 0.3px;
        }

        .story-break {
            text-align: center;
            margin: 50px 0;
            color: #888888;
        }

        .break-line {
            letter-spacing: 2px;
            opacity: 0.7;
        }

        @media (min-width: 768px) {
            .hidden-message {
                line-height: 2.2;
            }
        }

        .hidden-message em {
            color: #1a1a1a;
            font-style: italic;
        }

        .hidden-message strong {
            color: #000000;
            font-weight: 500;
        }

        .cutoff {
            display: block;
            margin-top: 28px;
            opacity: 0.8;
            color: #555555;
            font-style: italic;
        }

        /* White fade effect for white room story - oscillates between original colors and white */
        #whiteRoomStory.fading-to-white,
        #whiteRoomStory.fading-to-white *,
        #whiteRoomStory.fading-to-white .c-rabbit,
        #whiteRoomStory.fading-to-white .c-rabbit-mid,
        #whiteRoomStory.fading-to-white .c-owen,
        #whiteRoomStory.fading-to-white .c-vincent,
        #whiteRoomStory.fading-to-white .c-isla,
        #whiteRoomStory.fading-to-white .c-ice,
        #whiteRoomStory.fading-to-white .c-cold,
        #whiteRoomStory.fading-to-white .c-emphasis {
            animation: oscillateToWhite 16s ease-in-out infinite;
        }
        
        @keyframes oscillateToWhite {
            0% {
                color: inherit;
            }
            50% {
                color: var(--text-bright);
            }
            100% {
                color: inherit;
            }
        }

        .lyrics {
            display: block;
            font-family: 'Space Mono', monospace;
            font-size: 1.1rem;
            font-style: italic;
            color: var(--coral);
            margin: 32px 0;
            padding: 20px 0;
            letter-spacing: 1px;
            text-align: center;
            border-top: 1px solid rgba(255, 138, 128, 0.2);
            border-bottom: 1px solid rgba(255, 138, 128, 0.2);
            animation: lyricGlow 4s ease-in-out infinite;
            text-shadow: 0 0 20px rgba(255, 138, 128, 0.3);
        }

        @keyframes lyricGlow {
            0%, 100% { 
                text-shadow: 0 0 20px rgba(255, 180, 162, 0.3);
                opacity: 0.9;
            }
            50% { 
                text-shadow: 0 0 30px rgba(255, 180, 162, 0.5), 0 0 50px rgba(255, 180, 162, 0.2);
                opacity: 1;
            }
        }

        /* ============ GREEN TEXT ============ */
        @keyframes greenPulse {
            0%, 100% { border-left-color: rgba(0, 0, 0, 0.15); }
            50% { border-left-color: rgba(0, 0, 0, 0.25); }
        }

        .green-text {
            color: #2d2d2d;
            padding: 32px 16px 28px 20px;
            margin: 32px 0;
            font-size: 0.85rem;
            line-height: 2;
            background: #f5f5f5;
            border: 2px solid #2d2d2d;
            border-left: 4px solid #1a1a1a;
            position: relative;
            animation: amberReveal 0.6s ease;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        @keyframes whitePulse {
            0%, 100% { border-left-color: #1a1a1a; }
            50% { border-left-color: #555555; }
        }

        .green-text::after {
            content: 'SYSTEM';
            position: absolute;
            top: -10px;
            left: 16px;
            background: var(--bg-primary);
            padding: 2px 8px;
            font-family: 'Space Mono', monospace;
            font-size: 0.45rem;
            letter-spacing: 2px;
            color: #555555;
        }

        @media (min-width: 480px) {
            .green-text {
                padding: 40px 24px 36px 28px;
                margin: 40px 0;
                font-size: 0.9rem;
            }
            
            .green-text::after {
                left: 20px;
                font-size: 0.5rem;
                letter-spacing: 3px;
            }
        }

        @media (min-width: 768px) {
            .green-text {
                padding: 48px 36px 40px 40px;
                margin: 48px 0;
                font-size: 0.92rem;
                line-height: 2.2;
            }
            
            .green-text::after {
                left: 24px;
                letter-spacing: 4px;
            }
        }

        .green-text strong {
            color: var(--text-bright);
            font-weight: 400;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.18);
        }

        .green-text em {
            color: var(--text-bright);
            font-style: normal;
            text-shadow: 0 0 12px rgba(0, 0, 0, 0.2);
        }

        /* ============ GLITCH EFFECTS FOR GREEN TEXT ============ */
        @keyframes glitchFlicker {
            0%, 100% { opacity: 1; }
            92% { opacity: 1; }
            93% { opacity: 0.1; }
            94% { opacity: 1; }
            95% { opacity: 0.3; }
            96% { opacity: 1; }
        }

        @keyframes scoreGlitch {
            0%, 100% { transform: translateY(0); }
            10% { transform: translateY(-2px); }
            20% { transform: translateY(3px); }
            30% { transform: translateY(-1px); }
            40% { transform: translateY(2px); }
            50% { transform: translateY(0); }
        }

        @keyframes textCorrupt {
            0%, 100% { opacity: 1; color: rgba(0, 0, 0, 0.3); }
            50% { opacity: 0.7; color: var(--coral); }
        }

        @keyframes letterHighlight {
            0%, 100% { color: inherit; text-shadow: none; }
            50% { color: var(--coral); text-shadow: 0 0 10px var(--coral); }
        }

        @keyframes bgFlash {
            0%, 100% { background-color: var(--bg-primary); }
            50% { background-color: #fff0f0; }
        }

        /* Creepy red flicker for "read" text in final section - very slow, barely noticeable */
        @keyframes deathFlicker {
            0%, 94%, 100% { color: inherit; opacity: 1; }
            95% { color: var(--rabbit-dead); opacity: 0.95; }
            96% { color: inherit; opacity: 1; }
        }

        @keyframes subtleDeathFlicker {
            0%, 92%, 100% { color: inherit; opacity: 1; }
            93% { color: var(--rabbit-dead); opacity: 0.9; }
            94% { color: inherit; opacity: 1; }
        }

        .death-flicker {
            animation: subtleDeathFlicker 25s ease-in-out infinite;
            animation-delay: var(--flicker-delay, 0s);
        }

        .death-flicker-fast {
            animation: deathFlicker 0.3s ease-in-out;
        }

        /* Final section - minimal effects, just slow "you" turning red */
        #test6 .progress {
            /* No animation */
        }

        #test6 .section-header {
            /* No animation */
        }

        #test6 .green-text {
            /* No distortion effects */
        }
        
        /* Green text section - minimal spacing when shown */
        #greenTextSection {
            margin-top: 0;
            padding-top: var(--space-lg);
        }

        /* No static overlay */
        #test6::after {
            display: none;
        }

        /* No hue shift */
        #test6.active {
            /* No animation */
        }

        /* Slow "you" color flicker - cycles to red and Owen's gold */
        @keyframes youColorFlicker {
            0%, 85%, 100% { color: inherit; }
            87% { color: var(--rabbit-dead); }
            89% { color: inherit; }
            91% { color: inherit; }
            93% { color: var(--owen); }
            95% { color: inherit; }
        }

        @keyframes youSlowRed {
            0%, 90%, 100% { color: var(--green); }
            92% { color: var(--coral); }
            98% { color: var(--coral); }
        }

        .you-flicker {
            animation: youColorFlicker 35s ease-in-out infinite;
        }

        .you-dread {
            animation: youSlowRed 45s ease-in-out infinite;
        }

        .you-dread-delayed {
            animation: youSlowRed 45s ease-in-out infinite;
            animation-delay: 22s;
        }

        .you-fade-white {
            animation: youFadeWhite 8s ease-in-out forwards;
        }

        @keyframes youFadeWhite {
            0%, 30% { color: inherit; }
            100% { color: var(--text-bright); }
        }

        .you-glow-strong {
            color: var(--text-bright);
            text-shadow: 
                0 0 10px #ffffff,
                0 0 20px #ffffff,
                0 0 40px #ffffff,
                0 0 60px rgba(0, 0, 0, 0.25),
                0 0 80px rgba(0, 0, 0, 0.2);
            animation: youGlowPulse 2s ease-in-out infinite;
        }

        @keyframes youGlowPulse {
            0%, 100% { 
                text-shadow: 
                    0 0 10px #ffffff,
                    0 0 20px #ffffff,
                    0 0 40px #ffffff,
                    0 0 60px rgba(0, 0, 0, 0.25),
                    0 0 80px rgba(0, 0, 0, 0.2);
            }
            50% { 
                text-shadow: 
                    0 0 15px #ffffff,
                    0 0 30px #ffffff,
                    0 0 60px #ffffff,
                    0 0 90px rgba(0, 0, 0, 0.3),
                    0 0 120px rgba(0, 0, 0, 0.25);
            }
        }

        .glitch-active {
            /* Disabled */
        }

        /* ============ RESULT ANNOUNCEMENTS ============ */
        .result-announcement {
            text-align: center;
            padding: 28px 20px;
            margin: 24px 0;
            border: 1px solid rgba(0, 0, 0, 0.1);
            position: relative;
            background: rgba(0, 0, 0, 0.02);
        }

        @media (min-width: 390px) {
            .result-announcement {
                padding: 36px 24px;
            }
        }

        .result-label {
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            letter-spacing: 4px;
            margin-bottom: 14px;
            opacity: 0.5;
            color: var(--text-dim);
        }

        @media (min-width: 390px) {
            .result-label {
                font-size: 0.65rem;
                letter-spacing: 5px;
                margin-bottom: 18px;
            }
        }

        .result-text {
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
            line-height: 1.7;
            color: var(--text-bright);
        }

        @media (min-width: 390px) {
            .result-text {
                font-size: 1rem;
                letter-spacing: 1px;
            }
        }

        /* Responsive separator line */
        .result-separator {
            text-align: center;
            color: rgba(0, 0, 0, 0.1);
            font-size: 0.7rem;
            letter-spacing: -1px;
            margin: 16px 0;
            overflow: hidden;
            white-space: nowrap;
        }
        
        .result-separator::before {
            content: '══════════════════════════';
        }

        /* Inline result format - fits within letter/memo style */
        .result-inline {
            margin: 20px 0;
            padding: 16px 0;
            border-top: 1px solid rgba(0, 0, 0, 0.08);
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            line-height: 2.2;
        }
        
        .result-inline-label {
            font-family: 'Space Mono', monospace;
            font-size: 0.65rem;
            letter-spacing: 2px;
            color: var(--text-dim);
            margin-right: 8px;
        }
        
        .result-inline-value {
            font-family: 'Space Mono', monospace;
            font-size: 1.1rem;
            letter-spacing: 3px;
        }
        
        .result-inline-passed {
            color: var(--freedom);
            text-shadow: 0 0 10px var(--freedom-glow);
        }
        
        .result-inline-failed {
            color: var(--freedom);
            text-shadow: 0 0 10px var(--freedom-glow);
        }
        
        .result-inline-detail {
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            letter-spacing: 1px;
            color: var(--text-secondary);
        }
        
        @media (min-width: 390px) {
            .result-inline {
                padding: 18px 0;
            }
            
            .result-inline-label {
                font-size: 0.7rem;
            }
            
            .result-inline-value {
                font-size: 1.2rem;
            }
            
            .result-inline-detail {
                font-size: 0.75rem;
            }
        }

        /* FAILED result - teal glow */
        .result-failed {
            border-color: rgba(10, 74, 62, 0.5);
            background: rgba(10, 74, 62, 0.1);
            animation: resultTealPulse 2.5s ease-in-out infinite;
        }

        .result-failed .result-label {
            color: rgba(10, 74, 62, 0.9);
        }

        .result-failed .result-text {
            color: var(--text-bright);
        }

        .result-word-failed {
            color: var(--freedom);
            font-size: 1rem;
            font-weight: normal;
            text-shadow: 
                0 0 10px rgba(10, 74, 62, 1),
                0 0 20px rgba(10, 74, 62, 0.8),
                0 0 40px rgba(10, 74, 62, 0.6);
        }

        @media (min-width: 390px) {
            .result-word-failed {
                font-size: 1.15rem;
            }
        }

        /* PASSED result - teal glow */
        .result-passed {
            border-color: rgba(10, 74, 62, 0.5);
            background: rgba(10, 74, 62, 0.1);
            animation: resultTealPulse 2.5s ease-in-out infinite;
        }

        .result-passed .result-label {
            color: rgba(10, 74, 62, 0.9);
        }

        .result-passed .result-text {
            color: var(--text-bright);
        }

        .result-word-passed {
            color: var(--freedom);
            font-size: 1rem;
            font-weight: normal;
            text-shadow: 
                0 0 10px rgba(10, 74, 62, 1),
                0 0 20px rgba(10, 74, 62, 0.8),
                0 0 40px rgba(10, 74, 62, 0.6);
        }

        @media (min-width: 390px) {
            .result-word-passed {
                font-size: 1.15rem;
            }
        }

        @keyframes resultTealPulse {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(10, 74, 62, 0.2), inset 0 0 30px rgba(10, 74, 62, 0.08);
                border-color: rgba(10, 74, 62, 0.4);
            }
            50% { 
                box-shadow: 0 0 40px rgba(10, 74, 62, 0.35), inset 0 0 50px rgba(10, 74, 62, 0.12);
                border-color: rgba(10, 74, 62, 0.6);
            }
        }

        .score-glitching {
            /* Disabled */
        }

        .text-corrupting {
            /* Disabled */
        }

        .glitch-letter {
            display: inline;
            animation: letterHighlight 0.4s ease;
        }

        .screen-flash {
            animation: bgFlash 0.15s ease;
        }

        .compliance-dropping .score-display {
            color: var(--coral) !important;
            animation: scoreGlitch 0.6s ease infinite;
        }

        /* ============ AMBER WARNING BANNERS ============ */
        .amber-warning {
            text-align: left;
            padding: 20px 24px;
            margin: 32px 0 20px 0;
            border: 1px solid var(--amber);
            border-left: 3px solid var(--amber);
            background: linear-gradient(135deg, rgba(255, 204, 0, 0.04) 0%, rgba(255, 204, 0, 0.01) 100%);
            font-family: 'Space Mono', monospace;
        }

        @media (min-width: 480px) {
            .amber-warning {
                padding: 24px 28px;
                margin: 40px 0 24px 0;
            }
        }
        
        .amber-warning-top-border {
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            letter-spacing: 0;
            color: var(--amber);
            opacity: 0.5;
            margin-bottom: 12px;
        }
        
        .amber-warning-classification {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .amber-warning-classification-item {
            font-family: 'Space Mono', monospace;
            font-size: 0.65rem;
            letter-spacing: 1px;
            color: var(--amber);
        }
        
        .amber-warning-status {
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            letter-spacing: 1px;
            color: var(--amber);
            opacity: 0.7;
            margin: 12px 0;
            line-height: 1.8;
        }
        
        .amber-warning-bottom-border {
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            letter-spacing: 0;
            color: var(--amber);
            opacity: 0.5;
            margin: 12px 0 8px 0;
        }
        
        .amber-warning-footer {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 8px;
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            letter-spacing: 1px;
            color: var(--amber);
            opacity: 0.6;
        }
        
        .amber-warning-sub-message {
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            color: var(--amber);
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 204, 0, 0.2);
            text-align: center;
            letter-spacing: 1px;
        }

        /* Large amber warning - more prominent for skippers */
        .amber-warning-large {
            text-align: center;
            padding: 32px 24px;
            margin: 48px 0 28px 0;
            border: 2px solid var(--amber);
            background: var(--amber-glow);
            animation: warningPulse 2s ease infinite;
            box-shadow: 0 0 40px var(--amber-glow);
        }

        @media (min-width: 480px) {
            .amber-warning-large {
                padding: 40px 32px;
                margin: 56px 0 32px 0;
            }
        }

        .amber-warning-large .amber-warning-header {
            font-size: 0.7rem;
            letter-spacing: 4px;
            margin-bottom: 20px;
        }

        @media (min-width: 480px) {
            .amber-warning-large .amber-warning-header {
                font-size: 0.75rem;
                letter-spacing: 5px;
            }
        }

        .amber-warning-large .amber-warning-directive {
            font-size: 0.65rem;
            letter-spacing: 3px;
            margin-bottom: 16px;
        }

        @media (min-width: 480px) {
            .amber-warning-large .amber-warning-directive {
                font-size: 0.7rem;
                letter-spacing: 4px;
            }
        }

        .amber-warning-large .amber-warning-text {
            font-size: 0.6rem;
            letter-spacing: 4px;
            line-height: 2;
        }

        @media (min-width: 480px) {
            .amber-warning-large .amber-warning-text {
                font-size: 0.65rem;
                letter-spacing: 5px;
            }
        }

        .amber-warning-large .amber-warning-sub {
            font-size: 0.8rem;
            margin-top: 16px;
        }

        /* Amber content end marker */
        .amber-end {
            text-align: center;
            padding: 0;
            margin: 24px 0;
            border: none;
            background: transparent;
        }

        .amber-end-text {
            font-family: 'Space Mono', monospace;
            font-size: 0.5rem;
            letter-spacing: 3px;
            color: #1a1a1a;
            text-transform: uppercase;
            line-height: 1.8;
            background: linear-gradient(135deg, #fff176 0%, #f7dc6f 50%, #fff176 100%);
            padding: 20px 24px;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 4px 16px rgba(245, 166, 35, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }
        
        /* Flowing white lines effect */
        .amber-end-text::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 200%;
            height: 100%;
            background: repeating-linear-gradient(
                90deg,
                transparent 0px,
                transparent 40px,
                rgba(255, 255, 255, 0.1) 40px,
                rgba(255, 255, 255, 0.1) 42px
            );
            animation: flowingLines 8s linear infinite;
            pointer-events: none;
        }
        
        @keyframes flowingLines {
            0% { transform: translateX(0); }
            100% { transform: translateX(50%); }
        }
        
        /* Subtle scan line overlay */
        .amber-end-text::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent 0px,
                transparent 2px,
                rgba(0, 0, 0, 0.03) 2px,
                rgba(0, 0, 0, 0.03) 4px
            );
            pointer-events: none;
        }

        @media (min-width: 480px) {
            .amber-end-text {
                font-size: 0.55rem;
                letter-spacing: 4px;
                padding: 24px 32px;
            }
        }

        @keyframes warningPulse {
            0%, 100% { opacity: 0.85; }
            50% { opacity: 1; }
        }

        .amber-warning-header {
            font-family: 'Space Mono', monospace;
            font-size: 0.65rem;
            letter-spacing: 3px;
            color: var(--amber);
            margin-bottom: 16px;
            opacity: 0.85;
        }

        @media (min-width: 480px) {
            .amber-warning-header {
                font-size: 0.7rem;
                letter-spacing: 4px;
            }
        }

        .amber-warning-directive {
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            letter-spacing: 2px;
            color: var(--amber);
            text-transform: uppercase;
            line-height: 2.2;
            margin-bottom: 12px;
        }

        @media (min-width: 480px) {
            .amber-warning-directive {
                font-size: 0.65rem;
                letter-spacing: 3px;
            }
        }

        .amber-warning-text {
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            letter-spacing: 3px;
            color: var(--amber);
            text-transform: uppercase;
            line-height: 2;
        }

        @media (min-width: 480px) {
            .amber-warning-text {
                font-size: 0.6rem;
                letter-spacing: 4px;
            }
        }

        .amber-warning-sub {
            font-family: 'Space Mono', monospace;
            font-style: italic;
            font-size: 0.75rem;
            color: var(--amber);
            margin-top: 12px;
            opacity: 0.8;
        }

        /* ============ TERMINATED / KILLED STYLING ============ */
        .c-terminated {
            color: #8b0000;
            font-weight: bold;
        }

        .termination-announcement {
            animation: terminationPulse 2s ease-in-out infinite;
        }

        @keyframes terminationPulse {
            0%, 100% { 
                opacity: 1; 
                text-shadow: none;
            }
            50% { 
                opacity: 0.6; 
                text-shadow: 0 0 10px rgba(139, 0, 0, 0.5);
            }
        }

        /* System broadcast - a break in the wall */
        .system-broadcast {
            display: block;
            margin: 24px 0;
            padding: 16px 20px;
            background: linear-gradient(90deg, rgba(0, 212, 170, 0.05) 0%, rgba(0, 212, 170, 0.1) 50%, rgba(0, 212, 170, 0.05) 100%);
            border-left: 3px solid var(--system-green);
            border-right: 3px solid var(--system-green);
            font-family: 'Space Mono', monospace;
            font-size: 0.95rem;
            letter-spacing: 2px;
            color: var(--system-green);
            text-align: center;
            position: relative;
        }

        .system-broadcast::before {
            content: '> FACILITY BROADCAST';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-elevated);
            padding: 2px 12px;
            font-size: 0.5rem;
            letter-spacing: 3px;
            color: var(--text-dim);
        }

        .system-broadcast .employee-name {
            color: var(--isla);
        }

        .system-broadcast .status-terminated {
            color: #8b0000;
            font-weight: bold;
        }

        @media (min-width: 480px) {
            .amber-warning-text {
                font-size: 0.6rem;
                letter-spacing: 4px;
            }
        }

        .amber-warning-sub {
            font-size: 0.65rem;
            color: var(--text-secondary);
            margin-top: 10px;
            font-style: italic;
        }

        @media (min-width: 480px) {
            .amber-warning-sub {
                font-size: 0.7rem;
                margin-top: 12px;
            }
        }

        /* ============ SUBMIT BUTTON ============ */
        .submit-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            min-height: var(--touch-target-lg);
            padding: var(--space-md) var(--space-lg);
            margin-top: var(--space-xl);
            background: rgba(0, 0, 0, 0.03);
            border: 1px solid var(--text-secondary);
            color: var(--text-bright);
            font-family: 'Space Mono', monospace;
            font-size: 0.6875rem;
            letter-spacing: 0.25em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.15s ease;
            position: relative;
            overflow: hidden;
            border-radius: 2px;
            -webkit-tap-highlight-color: transparent;
            animation: btnBreathe 3s ease-in-out infinite;
        }

        @keyframes btnBreathe {
            0%, 100% { 
                box-shadow: 0 0 8px rgba(0, 0, 0, 0.08), inset 0 0 8px rgba(0, 0, 0, 0.03);
            }
            50% { 
                box-shadow: 0 0 16px rgba(0, 0, 0, 0.12), inset 0 0 12px rgba(0, 0, 0, 0.04);
            }
        }
        
        @media (min-width: 390px) {
            .submit-btn {
                font-size: 0.75rem;
                margin-top: var(--space-2xl);
            }
        }
        
        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 0, 0, 0.06), transparent);
            transition: left 0.5s ease;
        }

        .submit-btn:hover, .submit-btn:active {
            border-color: var(--text-bright);
            background: rgba(0, 0, 0, 0.06);
            color: var(--text-bright);
            animation: none;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }
        
        .submit-btn:hover::before {
            left: 100%;
        }
        
        .submit-btn:active {
            transform: scale(0.98);
            background: rgba(0, 0, 0, 0.08);
        }
        /* ============ FORWARD CHOICE ============ */
        .forward-choice-container {
            margin: var(--space-xl) 0;
            padding: var(--space-xl) var(--space-lg);
            background: linear-gradient(180deg, #0f0f0f 0%, #0a0a0a 100%);
            border: 1px solid #2a2a2a;
            border-radius: 8px;
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.02);
            position: relative;
            overflow: hidden;
        }
        
        /* Decorative corner brackets */
        .forward-choice-container::before,
        .forward-choice-container::after {
            content: '◇';
            position: absolute;
            font-size: 0.8rem;
            color: #333;
            opacity: 0.5;
        }
        
        .forward-choice-container::before {
            top: 12px;
            left: 16px;
        }
        
        .forward-choice-container::after {
            bottom: 12px;
            right: 16px;
        }
        
        @media (min-width: 390px) {
            .forward-choice-container {
                padding: var(--space-xl) var(--space-xl);
            }
        }

        .forward-choice-header {
            font-family: 'Space Mono', monospace;
            font-size: 0.65rem;
            letter-spacing: 0.3em;
            color: #666;
            text-align: center;
            margin-bottom: var(--space-lg);
            text-transform: uppercase;
            position: relative;
        }
        
        .forward-choice-header::before,
        .forward-choice-header::after {
            content: '───';
            margin: 0 12px;
            letter-spacing: 0;
            color: #333;
        }
        
        @media (min-width: 390px) {
            .forward-choice-header {
                font-size: 0.7rem;
                margin-bottom: var(--space-xl);
            }
        }

        .forward-choice-buttons {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }

        @media (min-width: 480px) {
            .forward-choice-buttons {
                flex-direction: row;
                gap: var(--space-lg);
            }
        }

        .forward-btn {
            width: 100%;
            max-width: 320px;
            min-height: var(--touch-target-lg);
            padding: var(--space-lg) var(--space-xl);
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            cursor: pointer;
            text-align: center;
            border-radius: 4px;
            -webkit-tap-highlight-color: transparent;
            line-height: 1.6;
            position: relative;
            overflow: hidden;
            transition: all 0.2s ease;
        }
        
        /* Satisfying click animation */
        .forward-btn:active {
            transform: scale(0.98);
        }

        .forward-yes {
            background: linear-gradient(180deg, #1a1a1a 0%, #0f0f0f 100%);
            border: 1px solid #3a3a3a;
            color: #e8e8e8;
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }
        
        .forward-yes::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(232, 112, 126, 0.1), transparent);
            transition: left 0.5s ease;
            pointer-events: none;
        }

        .forward-yes:hover {
            border-color: #e8707e;
            box-shadow: 
                0 4px 16px rgba(232, 112, 126, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }
        
        .forward-yes:hover::before {
            left: 100%;
        }
        
        .forward-yes:active {
            background: linear-gradient(180deg, #0f0f0f 0%, #1a1a1a 100%);
            box-shadow: 
                0 1px 4px rgba(0, 0, 0, 0.4),
                inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .forward-owen {
            background: linear-gradient(180deg, #fef3e8 0%, #fce8d8 100%);
            border: 2px solid #e8d4c4;
            color: #8a7060;
            box-shadow: 
                0 4px 0 #d4c0b0,
                0 6px 12px rgba(232, 180, 126, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
        }
        
        .forward-owen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.4) 0%, transparent 100%);
            border-radius: 10px 10px 0 0;
            pointer-events: none;
        }

        .forward-owen:hover {
            background: linear-gradient(180deg, #fff8f0 0%, #fcece0 100%);
            box-shadow: 
                0 6px 0 #d4c0b0,
                0 8px 16px rgba(232, 180, 126, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
            transform: translateY(-2px);
        }
        
        .forward-owen:active {
            box-shadow: 
                0 2px 0 #d4c0b0,
                0 3px 8px rgba(232, 180, 126, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
            transform: translateY(2px);
        }

        .forward-no {
            background: linear-gradient(180deg, #f8f6f4 0%, #f0eeec 100%);
            border: 2px solid #e0dcd8;
            color: #888480;
            box-shadow: 
                0 4px 0 #d0ccc8,
                0 6px 12px rgba(0, 0, 0, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
        }
        
        .forward-no::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.4) 0%, transparent 100%);
            border-radius: 10px 10px 0 0;
            pointer-events: none;
        }

        .forward-no:hover {
            background: linear-gradient(180deg, #fcfaf8 0%, #f4f2f0 100%);
            border-color: #d8d4d0;
            color: #686460;
            box-shadow: 
                0 6px 0 #d0ccc8,
                0 8px 16px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
            transform: translateY(-2px);
        }
        
        .forward-no:active {
            box-shadow: 
                0 2px 0 #d0ccc8,
                0 3px 8px rgba(0, 0, 0, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
            transform: translateY(2px);
        }

        /* ============ EASTER EGG GAMES ============ */
        .game-page {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--space-md);
            text-align: center;
            touch-action: manipulation;
            overflow: hidden;
            z-index: 100;
        }

        .game-page-compact {
            max-height: 100%;
            height: 100%;
            overflow: hidden;
            justify-content: space-evenly;
            padding: var(--space-sm) var(--space-md);
        }

        .game-header {
            font-family: 'Space Mono', monospace;
            font-size: 0.65rem;
            color: var(--text-ghost);
            letter-spacing: 0.15em;
        }

        .game-title {
            font-family: 'Space Mono', monospace;
            font-size: 2rem;
            color: var(--white);
            letter-spacing: 0.1em;
            text-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
        }

        #sudokuGamePage .game-title {
            color: var(--white);
            text-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
        }

        .game-subtitle {
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            color: var(--text-dim);
            letter-spacing: 0.2em;
        }

        .snake-container {
            background: var(--bg-secondary);
            border: 1px solid rgba(0, 0, 0, 0.12);
            padding: 2px;
            touch-action: manipulation;
        }

        #snakeCanvas {
            display: block;
            background: var(--bg-primary);
            touch-action: manipulation;
        }

        /* ════════════════════════════════
           CRT RGB EFFECTS - Reusable classes for retro screen look
           ════════════════════════════════ */
        
        /* RGB scanlines + pixel grid overlay */
        .crt-rgb::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                /* Horizontal scanlines */
                linear-gradient(
                    rgba(18, 16, 16, 0) 50%, 
                    rgba(0, 0, 0, 0.15) 50%
                ),
                /* RGB vertical stripes */
                linear-gradient(
                    90deg, 
                    rgba(255, 0, 0, 0.03), 
                    rgba(0, 255, 0, 0.02), 
                    rgba(0, 0, 255, 0.03)
                );
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
            z-index: 2;
        }
        
        /* Subtle screen flicker */
        .crt-flicker::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(18, 16, 16, 0.1);
            opacity: 0;
            z-index: 3;
            pointer-events: none;
            animation: crtFlicker 0.15s infinite;
        }
        
        @keyframes crtFlicker {
            0% { opacity: 0.02; }
            10% { opacity: 0.03; }
            20% { opacity: 0.01; }
            30% { opacity: 0.04; }
            40% { opacity: 0.01; }
            50% { opacity: 0.03; }
            60% { opacity: 0.02; }
            70% { opacity: 0.04; }
            80% { opacity: 0.01; }
            90% { opacity: 0.03; }
            100% { opacity: 0.02; }
        }
        
        /* Rolling scan line effect */
        .crt-scanline::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(
                to bottom,
                transparent,
                rgba(255, 255, 255, 0.03),
                transparent
            );
            animation: crtScanline 8s linear infinite;
            pointer-events: none;
            z-index: 4;
        }
        
        @keyframes crtScanline {
            0% { top: 0; }
            100% { top: 100%; }
        }
        
        /* RGB color separation text effect */
        .crt-text {
            animation: crtTextShadow 2s infinite;
        }
        
        @keyframes crtTextShadow {
            0% { text-shadow: 0.5px 0 1px rgba(0,255,128,0.4), -0.5px 0 1px rgba(255,0,80,0.3), 0 0 3px; }
            25% { text-shadow: 1px 0 1px rgba(0,255,128,0.4), -1px 0 1px rgba(255,0,80,0.3), 0 0 3px; }
            50% { text-shadow: 0.3px 0 1px rgba(0,255,128,0.4), -0.3px 0 1px rgba(255,0,80,0.3), 0 0 3px; }
            75% { text-shadow: 1.2px 0 1px rgba(0,255,128,0.4), -1.2px 0 1px rgba(255,0,80,0.3), 0 0 3px; }
            100% { text-shadow: 0.5px 0 1px rgba(0,255,128,0.4), -0.5px 0 1px rgba(255,0,80,0.3), 0 0 3px; }
        }

        /* ════════════════════════════════
           VINCENT'S SNAKE GAME - Enhanced with CRT effects
           ════════════════════════════════ */
        
        #snakeGamePage .game-page {
            background: var(--bg-primary);
        }
        
        /* Glitchy header */
        #snakeGamePage .game-header {
            color: var(--green);
            opacity: 0.7;
        }
        
        /* Snake title with glow */
        #snakeGamePage .game-title {
            text-shadow: 
                0 0 10px rgba(74, 158, 97, 0.5),
                0 0 20px rgba(74, 158, 97, 0.3),
                0 0 40px rgba(74, 158, 97, 0.2);
        }
        
        /* Game container - CRT monitor frame */
        #snakeGamePage .snake-container {
            background: #0a0a0a;
            border: 2px solid var(--green);
            box-shadow: 
                0 0 15px rgba(74, 158, 97, 0.3),
                0 0 30px rgba(74, 158, 97, 0.15),
                inset 0 0 60px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }
        
        /* RGB scanlines + pixel grid on game area */
        #snakeGamePage .snake-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                /* Horizontal scanlines */
                linear-gradient(
                    rgba(18, 16, 16, 0) 50%, 
                    rgba(0, 0, 0, 0.12) 50%
                ),
                /* RGB vertical stripes - green tinted for Vincent */
                linear-gradient(
                    90deg, 
                    rgba(255, 50, 50, 0.02), 
                    rgba(50, 255, 100, 0.03), 
                    rgba(50, 50, 255, 0.02)
                );
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
            z-index: 2;
            animation: rgbShift 10s linear infinite;
        }
        
        @keyframes rgbShift {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 0.8; }
        }
        
        /* Rolling scan line */
        #snakeGamePage .snake-container::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(
                to bottom,
                transparent,
                rgba(74, 158, 97, 0.08),
                transparent
            );
            animation: snakeScanline 4s linear infinite;
            pointer-events: none;
            z-index: 3;
        }
        
        @keyframes snakeScanline {
            0% { top: -6px; }
            100% { top: 100%; }
        }
        
        #snakeGamePage #snakeCanvas {
            background: #050505;
        }
        
        /* Score row with CRT text effect */
        #snakeGamePage .game-score-row {
            color: var(--green);
            font-size: 0.8rem;
            animation: crtTextShadow 2s infinite;
        }
        
        #snakeGamePage .game-score-row span span {
            color: #fff;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
        }
        
        /* Control buttons with green theme */
        #snakeGamePage .game-btn {
            background: rgba(74, 158, 97, 0.1);
            border: 1px solid rgba(74, 158, 97, 0.4);
            color: var(--green);
            font-weight: 600;
            transition: all 0.15s ease;
        }
        
        #snakeGamePage .game-btn:hover {
            background: rgba(74, 158, 97, 0.2);
            border-color: var(--green);
            box-shadow: 0 0 10px rgba(74, 158, 97, 0.3);
        }
        
        #snakeGamePage .game-btn:active {
            background: rgba(74, 158, 97, 0.35);
            border-color: var(--green);
            box-shadow: 
                0 0 15px rgba(74, 158, 97, 0.5),
                inset 0 0 10px rgba(74, 158, 97, 0.2);
            transform: scale(0.95);
        }
        
        /* Menu button with subtle green */
        #snakeGamePage .game-menu-btn {
            border-color: rgba(74, 158, 97, 0.3);
            color: rgba(74, 158, 97, 0.7);
        }
        
        #snakeGamePage .game-menu-btn:hover {
            border-color: var(--green);
            color: var(--green);
            box-shadow: 0 0 10px rgba(74, 158, 97, 0.2);
        }

        /* ============ HORSE BASKETBALL GAME (Marcus) ============ */
        .horse-game-container {
            background: var(--bg-secondary);
            border: 1px solid rgba(168, 232, 74, 0.3);
            padding: 2px;
            touch-action: manipulation;
            position: relative;
        }

        #horseCanvas {
            display: block;
            background: var(--bg-primary);
            touch-action: manipulation;
        }

        /* Title doubles as scoreboard */
        .horse-title-score {
            letter-spacing: 0.3em;
        }

        .horse-title-score span {
            transition: all 0.3s ease;
            color: var(--text-dim);
        }

        .horse-title-score span.lit {
            color: var(--marcus);
            text-shadow: 0 0 20px rgba(168, 232, 74, 0.8);
        }

        .horse-shoot-btn {
            width: 100%;
            max-width: 260px;
            height: 60px;
            background: rgba(168, 232, 74, 0.1);
            border: 2px solid var(--marcus);
            color: var(--marcus);
            font-family: 'Space Mono', monospace;
            font-size: 1.2rem;
            letter-spacing: 0.2em;
            cursor: pointer;
            transition: all 0.1s ease;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            text-shadow: 0 0 10px rgba(168, 232, 74, 0.5);
        }

        .horse-shoot-btn:active {
            background: rgba(168, 232, 74, 0.3);
            transform: scale(0.98);
        }

        .horse-shoot-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .horse-game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 20px 30px;
            border: 1px solid var(--marcus);
            text-align: center;
            display: none;
        }

        .horse-game-over.visible {
            display: block;
        }

        .horse-game-over-text {
            font-family: 'Space Mono', monospace;
            font-size: 1.2rem;
            color: var(--marcus);
            margin-bottom: 10px;
        }

        .horse-play-again {
            background: transparent;
            border: 1px solid var(--marcus);
            color: var(--marcus);
            padding: 8px 16px;
            font-family: 'Space Mono', monospace;
            font-size: 0.8rem;
            cursor: pointer;
            margin-top: 10px;
        }

        .horse-play-again:hover {
            background: rgba(168, 232, 74, 0.2);
        }

        #horseGamePage .game-title {
            color: var(--marcus);
            text-shadow: 0 0 20px rgba(168, 232, 74, 0.4);
        }

        #horseGamePage .game-subtitle {
            color: var(--marcus);
        }

        .game-score-row {
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
            color: var(--text-secondary);
            letter-spacing: 0.1em;
            display: flex;
            justify-content: center;
            gap: var(--space-lg);
        }

        .game-controls {
            margin: var(--space-xs) 0;
            touch-action: manipulation;
        }

        .game-controls-row {
            display: flex;
            justify-content: center;
            gap: var(--space-xs);
            margin: 2px 0;
        }

        .game-btn {
            width: 52px;
            height: 52px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            color: var(--text-primary);
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.1s ease;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .game-btn:active {
            background: var(--bg-elevated);
            border-color: var(--green);
            color: var(--green);
        }

        .game-instruction {
            font-size: 0.65rem;
            color: var(--text-ghost);
        }

        .game-buttons {
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
            align-items: center;
        }

        .game-restart-btn {
            font-family: 'Space Mono', monospace;
            font-size: 0.65rem;
            letter-spacing: 0.1em;
            padding: var(--space-sm) var(--space-lg);
            background: transparent;
            border: 1px solid var(--border-light);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            animation: btnBreathe 3s ease-in-out infinite;
        }

        .game-restart-btn:hover, .game-restart-btn:active {
            border-color: var(--text-bright);
            color: var(--text-bright);
            animation: none;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.12);
        }

        .game-menu-btn {
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            letter-spacing: 0.1em;
            padding: var(--space-xs) var(--space-md);
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-dim);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .game-menu-btn:hover, .game-menu-btn:active {
            border-color: var(--text-secondary);
            color: var(--text-secondary);
        }

        /* Sudoku styles */
        .sudoku-container {
            margin: var(--space-sm) 0;
        }

        .sudoku-grid {
            display: grid;
            grid-template-columns: repeat(9, 30px);
            grid-template-rows: repeat(9, 30px);
            gap: 1px;
            background: var(--border);
            border: 2px solid var(--owen);
            padding: 1px;
        }
        
        /* Hidden horse chess piece - glowing easter egg */
        /* Giant horse piece for DJ Rabbit music player (after drop) */
        .dj-rabbit-horse {
            font-family: 'VT323', monospace;
            font-size: 10rem;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
            color: rgba(192, 192, 192, 0.7);
            text-shadow: 
                0 0 30px rgba(192, 192, 192, 0.8),
                0 0 60px rgba(150, 150, 200, 0.5),
                0 0 100px rgba(100, 100, 150, 0.3);
            animation: giantHorseGlitch 2s ease-in-out infinite;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
        }
        
        @keyframes giantHorseGlitch {
            0%, 100% {
                opacity: 0.7;
                transform: translate(-50%, -50%);
                text-shadow: 
                    0 0 30px rgba(192, 192, 192, 0.8),
                    0 0 60px rgba(150, 150, 200, 0.5);
            }
            10% {
                opacity: 0.5;
                transform: translate(-52%, -50%);
                text-shadow: 
                    -3px 0 rgba(255, 0, 0, 0.3),
                    3px 0 rgba(0, 255, 255, 0.3),
                    0 0 30px rgba(192, 192, 192, 0.8);
            }
            20% {
                opacity: 0.8;
                transform: translate(-50%, -48%);
            }
            30% {
                opacity: 0.3;
            }
            32% {
                opacity: 0.9;
                transform: translate(-48%, -50%);
                text-shadow: 
                    2px 0 rgba(255, 0, 0, 0.4),
                    -2px 0 rgba(0, 255, 255, 0.4),
                    0 0 40px rgba(192, 192, 192, 1);
            }
            50% {
                opacity: 0.6;
                transform: translate(-50%, -50%);
            }
            73% {
                opacity: 0.4;
            }
            75% {
                opacity: 0.85;
                transform: translate(-51%, -49%);
                text-shadow: 
                    -2px 0 rgba(255, 0, 0, 0.3),
                    2px 0 rgba(0, 255, 255, 0.3),
                    0 0 50px rgba(192, 192, 192, 0.9);
            }
            90% {
                opacity: 0.2;
            }
            92% {
                opacity: 0.75;
            }
        }
        
        /* Horse piece found notification */
        .horse-found-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            border: 1px solid rgba(192, 192, 192, 0.5);
            padding: 30px 50px;
            z-index: 10000;
            text-align: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .horse-found-notification.visible {
            opacity: 1;
            pointer-events: auto;
        }
        
        .horse-found-text {
            font-family: 'Space Mono', monospace;
            font-size: 1.5rem;
            color: #C0C0C0;
            letter-spacing: 0.1em;
            text-shadow: 0 0 15px rgba(192, 192, 192, 0.5);
        }
        
        .horse-found-text.trojan {
            font-size: 2rem;
            color: #C0C0C0;
            text-shadow: 
                0 0 20px rgba(192, 192, 192, 0.8),
                0 0 40px rgba(150, 150, 200, 0.5);
        }
        
        .sudoku-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Space Mono', monospace;
            font-size: 1.1rem;
            background: var(--bg-secondary);
            cursor: pointer;
            transition: all 0.1s ease;
            -webkit-tap-highlight-color: transparent;
        }

        .sudoku-cell.given {
            color: var(--text-primary);
            cursor: default;
        }

        .sudoku-cell.editable {
            color: var(--owen);
        }

        .sudoku-cell.editable:active {
            background: rgba(244, 209, 155, 0.2);
        }

        .sudoku-cell.error {
            color: #ff4444;
            background: rgba(255, 68, 68, 0.1);
        }

        .sudoku-cell.correct {
            color: var(--green);
        }

        /* 3x3 box borders */
        .sudoku-cell:nth-child(3n) { border-right: 2px solid var(--owen); }
        .sudoku-cell:nth-child(9n) { border-right: none; }
        .sudoku-cell:nth-child(n+19):nth-child(-n+27),
        .sudoku-cell:nth-child(n+46):nth-child(-n+54) { border-bottom: 2px solid var(--owen); }

        /* Sudoku popup */
        .sudoku-popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .sudoku-popup.active {
            display: flex;
        }

        .sudoku-popup-content {
            background: var(--bg-primary);
            border: 1px solid var(--owen);
            padding: var(--space-lg);
            text-align: center;
        }

        .sudoku-popup-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: var(--space-md);
        }

        .sudoku-popup-btn {
            width: 60px;
            height: 60px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            color: var(--text-primary);
            font-family: 'Space Mono', monospace;
            font-size: 1.8rem;
            cursor: pointer;
            transition: all 0.1s ease;
            -webkit-tap-highlight-color: transparent;
        }

        .sudoku-popup-btn:active {
            background: var(--owen);
            border-color: var(--owen);
            color: #000;
        }

        .sudoku-popup-clear, .sudoku-popup-cancel {
            display: block;
            width: 100%;
            padding: var(--space-sm);
            margin-top: var(--space-xs);
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: all 0.1s ease;
            -webkit-tap-highlight-color: transparent;
        }

        .sudoku-popup-clear {
            background: transparent;
            border: 1px solid var(--owen);
            color: var(--owen);
        }

        .sudoku-popup-cancel {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-dim);
        }

        /* ============ VINCENT'S DESKTOP ============ */
        .vincent-desktop {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background: var(--bg-primary);
            padding: 20px;
        }
        
        .vincent-desktop-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: rgba(143, 164, 184, 0.1);
            border: 1px solid var(--vincent);
            margin-bottom: 30px;
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            letter-spacing: 2px;
        }
        
        .vincent-terminal-id {
            color: var(--vincent);
        }
        
        .vincent-user {
            color: var(--text-secondary);
        }
        
        .vincent-desktop-content {
            flex: 1;
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
            align-items: flex-start;
            padding: 40px 20px;
        }
        
        .vincent-folder {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            padding: 20px;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }
        
        .vincent-folder:hover {
            background: rgba(143, 164, 184, 0.08);
            border-color: var(--vincent);
        }
        
        .vincent-folder:active {
            transform: scale(0.95);
        }
        
        .vincent-folder-icon {
            font-size: 3rem;
            filter: grayscale(0.5);
        }
        
        .vincent-folder:hover .vincent-folder-icon {
            filter: grayscale(0);
        }
        
        .vincent-folder-name {
            font-family: 'Space Mono', monospace;
            font-size: 0.65rem;
            letter-spacing: 1px;
            color: var(--text-secondary);
        }
        
        .vincent-folder:hover .vincent-folder-name {
            color: var(--vincent);
        }
        
        .vincent-desktop-footer {
            padding: 12px 16px;
            border-top: 1px solid var(--border);
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            letter-spacing: 2px;
            color: var(--text-dim);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .vincent-status-dot {
            width: 6px;
            height: 6px;
            background: var(--vincent);
            border-radius: 50%;
            animation: statusBlink 2s ease-in-out infinite;
        }
        
        /* Vincent's Files Page */
        .vincent-files {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background: var(--bg-primary);
            padding: 20px;
        }
        
        .vincent-files-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: rgba(143, 164, 184, 0.05);
            border: 1px solid var(--border);
            margin-bottom: 20px;
            font-family: 'Space Mono', monospace;
            font-size: 0.65rem;
        }
        
        .vincent-path {
            color: var(--vincent);
            letter-spacing: 1px;
        }
        
        .vincent-back {
            color: var(--text-dim);
            cursor: pointer;
            letter-spacing: 1px;
        }
        
        .vincent-back:hover {
            color: var(--text-secondary);
        }
        
        .vincent-file-list {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .vincent-file {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            background: rgba(0, 0, 0, 0.02);
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.15s ease;
            font-family: 'Space Mono', monospace;
        }
        
        .vincent-file:hover {
            background: rgba(143, 164, 184, 0.08);
            border-color: var(--vincent);
        }
        
        .vincent-file-icon {
            font-size: 1rem;
            opacity: 0.7;
        }
        
        .vincent-file:hover .vincent-file-icon {
            opacity: 1;
        }
        
        .vincent-file-name {
            flex: 1;
            font-size: 0.75rem;
            color: var(--text-primary);
            letter-spacing: 0.5px;
        }
        
        .vincent-file:hover .vincent-file-name {
            color: var(--vincent-bright);
        }
        
        .vincent-file-date {
            font-size: 0.6rem;
            color: var(--text-dim);
            letter-spacing: 1px;
        }
        
        .vincent-files-footer {
            padding-top: 20px;
            border-top: 1px solid var(--border);
            margin-top: 20px;
        }
        
        .vincent-back-btn {
            width: 100%;
            padding: 14px;
            font-family: 'Space Mono', monospace;
            font-size: 0.65rem;
            letter-spacing: 2px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.15s ease;
        }
        
        .vincent-back-btn:hover {
            border-color: var(--vincent);
            color: var(--vincent);
            background: rgba(143, 164, 184, 0.08);
        }
        
        /* Vincent's Log Viewer */
        .vincent-log-viewer {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background: var(--bg-primary);
            padding: 20px;
        }
        
        .vincent-log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: rgba(143, 164, 184, 0.1);
            border: 1px solid var(--vincent);
            margin-bottom: 20px;
            font-family: 'Space Mono', monospace;
            font-size: 0.65rem;
        }
        
        .vincent-log-title {
            color: var(--vincent);
            letter-spacing: 2px;
        }
        
        .vincent-log-close {
            color: var(--text-dim);
            cursor: pointer;
            letter-spacing: 1px;
        }
        
        .vincent-log-close:hover {
            color: var(--text-secondary);
        }
        
        .vincent-log-content {
            flex: 1;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            line-height: 2;
            color: var(--text-primary);
            overflow-y: auto;
        }
        
        .vincent-log-content .log-date {
            color: var(--text-dim);
            font-size: 0.6rem;
            letter-spacing: 2px;
            margin-bottom: 16px;
            display: block;
        }
        
        .vincent-log-content .log-body {
            white-space: pre-wrap;
        }
        
        .vincent-log-content .log-emphasis {
            color: var(--vincent);
        }
        
        .vincent-log-content .log-warning {
            color: var(--rabbit);
        }
        
        .vincent-log-content .log-owen {
            color: var(--owen);
        }
        
        .vincent-log-content .log-glitch {
            color: var(--text-dim);
            background: rgba(0, 0, 0, 0.04);
            padding: 2px 4px;
            font-family: monospace;
        }
        
        .vincent-log-content .log-corrupted {
            color: var(--rabbit);
            text-shadow: 
                1px 0 var(--vincent),
                -1px 0 var(--owen);
            animation: glitchText 0.8s infinite;
        }
        
        @keyframes glitchText {
            0%, 100% { transform: translate3d(0, 0, 0); }
            25% { transform: translate3d(-1px, 0, 0); }
            75% { transform: translate3d(1px, 0, 0); }
        }
        
        .vincent-log-footer {
            padding-top: 20px;
            border-top: 1px solid var(--border);
            margin-top: 20px;
        }

        /* ============ MUSIC PLAYER STYLES (Isla/Rabbit) - DJ MODE ============ */
        .music-player-page {
            background: radial-gradient(ellipse at 50% 0%, rgba(255, 138, 128, 0.15) 0%, transparent 50%),
                        radial-gradient(ellipse at 80% 80%, rgba(244, 209, 155, 0.1) 0%, transparent 40%),
                        radial-gradient(ellipse at 20% 90%, rgba(255, 138, 128, 0.08) 0%, transparent 35%),
                        var(--bg-primary);
            overflow: hidden;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 12px !important;
            z-index: 100;
        }
        
        .music-player-page::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(255, 138, 128, 0.02) 2px,
                    rgba(255, 138, 128, 0.02) 4px
                );
            pointer-events: none;
            animation: scanlines 8s linear infinite;
        }
        
        @keyframes scanlines {
            0% { transform: translateY(0); }
            100% { transform: translateY(4px); }
        }
        
        .music-player-page .game-header {
            font-size: 0.5rem !important;
            letter-spacing: 3px;
            color: var(--rabbit) !important;
            animation: headerPulse 2s ease-in-out infinite;
            margin-bottom: 4px !important;
        }
        
        @keyframes headerPulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        
        .music-player-page .game-title {
            font-size: 1rem !important;
            margin-bottom: 2px !important;
        }
        
        .music-player-page .game-subtitle {
            color: var(--rabbit);
            font-family: 'Space Mono', monospace;
            font-size: 1.8rem !important;
            letter-spacing: 4px;
            text-shadow: 
                0 0 10px rgba(255, 138, 128, 0.8),
                0 0 20px rgba(255, 138, 128, 0.5),
                0 0 40px rgba(255, 138, 128, 0.3),
                2px 2px 0 rgba(244, 209, 155, 0.5);
            animation: djTitle 1.5s ease-in-out infinite;
            margin-bottom: 8px !important;
        }
        
        @keyframes djTitle {
            0%, 100% { 
                transform: scale(1);
                text-shadow: 
                    0 0 10px rgba(255, 138, 128, 0.8),
                    0 0 20px rgba(255, 138, 128, 0.5),
                    0 0 40px rgba(255, 138, 128, 0.3),
                    2px 2px 0 rgba(244, 209, 155, 0.5);
            }
            50% { 
                transform: scale(1.02);
                text-shadow: 
                    0 0 15px rgba(255, 138, 128, 1),
                    0 0 30px rgba(255, 138, 128, 0.7),
                    0 0 50px rgba(255, 138, 128, 0.4),
                    3px 3px 0 rgba(244, 209, 155, 0.7);
            }
        }
        
        /* Floating rabbits decoration */
        .dj-rabbits {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            overflow: hidden;
            z-index: -1;
        }
        
        .dj-rabbit {
            position: absolute;
            background: rgba(255, 138, 128, 0.4);
            border-radius: 50%;
            opacity: 0.2;
            animation: floatRabbit 8s ease-in-out infinite;
        }
        
        /* Polka dot grid - honeycomb staggered pattern for even distribution */
        /* Row 1 - top (5 dots at ~3%, evenly spaced) */
        .dj-rabbit:nth-child(1) { top: 3%; left: 5%; width: 12px; height: 12px; }
        .dj-rabbit:nth-child(2) { top: 4%; left: 25%; width: 14px; height: 14px; animation-delay: 0.5s; }
        .dj-rabbit:nth-child(3) { top: 3%; left: 50%; width: 10px; height: 10px; animation-delay: 1s; }
        .dj-rabbit:nth-child(4) { top: 5%; left: 75%; width: 16px; height: 16px; animation-delay: 1.5s; }
        .dj-rabbit:nth-child(5) { top: 4%; left: 94%; width: 12px; height: 12px; animation-delay: 2s; }
        /* Row 2 - offset right (~15%) */
        .dj-rabbit:nth-child(6) { top: 15%; left: 15%; width: 16px; height: 16px; animation-delay: 0.3s; }
        .dj-rabbit:nth-child(7) { top: 16%; left: 38%; width: 10px; height: 10px; animation-delay: 0.8s; }
        .dj-rabbit:nth-child(8) { top: 14%; left: 62%; width: 14px; height: 14px; animation-delay: 1.3s; }
        .dj-rabbit:nth-child(9) { top: 16%; left: 85%; width: 12px; height: 12px; animation-delay: 1.8s; }
        /* Row 3 (~28%) */
        .dj-rabbit:nth-child(10) { top: 28%; left: 3%; width: 10px; height: 10px; animation-delay: 2.3s; }
        .dj-rabbit:nth-child(11) { top: 27%; left: 28%; width: 14px; height: 14px; animation-delay: 0.4s; }
        .dj-rabbit:nth-child(12) { top: 29%; left: 52%; width: 16px; height: 16px; animation-delay: 0.9s; }
        .dj-rabbit:nth-child(13) { top: 27%; left: 76%; width: 12px; height: 12px; animation-delay: 1.4s; }
        .dj-rabbit:nth-child(14) { top: 28%; left: 96%; width: 10px; height: 10px; animation-delay: 1.9s; }
        /* Row 4 - offset (~42%) */
        .dj-rabbit:nth-child(15) { top: 42%; left: 12%; width: 14px; height: 14px; animation-delay: 2.4s; }
        .dj-rabbit:nth-child(16) { top: 41%; left: 35%; width: 12px; height: 12px; animation-delay: 0.6s; }
        .dj-rabbit:nth-child(17) { top: 43%; left: 58%; width: 10px; height: 10px; animation-delay: 1.1s; }
        .dj-rabbit:nth-child(18) { top: 41%; left: 82%; width: 16px; height: 16px; animation-delay: 1.6s; }
        /* Row 5 (~55%) */
        .dj-rabbit:nth-child(19) { top: 55%; left: 6%; width: 12px; height: 12px; animation-delay: 2.1s; }
        .dj-rabbit:nth-child(20) { top: 56%; left: 22%; width: 16px; height: 16px; animation-delay: 0.2s; }
        .dj-rabbit:nth-child(21) { top: 54%; left: 45%; width: 14px; height: 14px; animation-delay: 0.7s; }
        .dj-rabbit:nth-child(22) { top: 56%; left: 68%; width: 10px; height: 10px; animation-delay: 1.2s; }
        .dj-rabbit:nth-child(23) { top: 55%; left: 92%; width: 14px; height: 14px; animation-delay: 1.7s; }
        /* Row 6 - offset (~68%) */
        .dj-rabbit:nth-child(24) { top: 68%; left: 8%; width: 10px; height: 10px; animation-delay: 2.2s; }
        .dj-rabbit:nth-child(25) { top: 69%; left: 32%; width: 14px; height: 14px; animation-delay: 0.1s; }
        .dj-rabbit:nth-child(26) { top: 67%; left: 55%; width: 16px; height: 16px; animation-delay: 0.55s; }
        .dj-rabbit:nth-child(27) { top: 69%; left: 78%; width: 12px; height: 12px; animation-delay: 1.05s; }
        /* Row 7 (~82%) */
        .dj-rabbit:nth-child(28) { top: 82%; left: 4%; width: 14px; height: 14px; animation-delay: 1.55s; }
        .dj-rabbit:nth-child(29) { top: 81%; left: 20%; width: 10px; height: 10px; animation-delay: 2.05s; }
        .dj-rabbit:nth-child(30) { top: 83%; left: 42%; width: 12px; height: 12px; animation-delay: 0.25s; }
        .dj-rabbit:nth-child(31) { top: 81%; left: 65%; width: 16px; height: 16px; animation-delay: 0.75s; }
        .dj-rabbit:nth-child(32) { top: 82%; left: 88%; width: 14px; height: 14px; animation-delay: 1.25s; }
        /* Row 8 - bottom (~94%) */
        .dj-rabbit:nth-child(33) { top: 94%; left: 15%; width: 12px; height: 12px; animation-delay: 1.75s; }
        .dj-rabbit:nth-child(34) { top: 95%; left: 38%; width: 16px; height: 16px; animation-delay: 2.25s; }
        .dj-rabbit:nth-child(35) { top: 93%; left: 60%; width: 10px; height: 10px; animation-delay: 0.35s; }
        .dj-rabbit:nth-child(36) { top: 95%; left: 82%; width: 14px; height: 14px; animation-delay: 0.85s; }
        
        @keyframes floatRabbit {
            0%, 100% { 
                transform: translateY(0); 
                opacity: 0.15;
            }
            50% { 
                transform: translateY(-6px); 
                opacity: 0.25;
            }
        }
        
        /* Sparkle effects */
        .dj-sparkles {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 1;
        }
        
        .dj-sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--rabbit);
            border-radius: 50%;
            animation: sparkle 2s ease-in-out infinite;
        }
        
        .dj-sparkle:nth-child(1) { top: 12%; left: 15%; animation-delay: 0s; }
        .dj-sparkle:nth-child(2) { top: 25%; right: 20%; animation-delay: 0.3s; background: #f4d19b; }
        .dj-sparkle:nth-child(3) { bottom: 30%; left: 12%; animation-delay: 0.6s; }
        .dj-sparkle:nth-child(4) { bottom: 18%; right: 15%; animation-delay: 0.9s; background: #f4d19b; }
        .dj-sparkle:nth-child(5) { top: 45%; left: 8%; animation-delay: 1.2s; }
        .dj-sparkle:nth-child(6) { top: 60%; right: 10%; animation-delay: 1.5s; background: #f4d19b; }
        
        @keyframes sparkle {
            0%, 100% { 
                transform: scale(0);
                opacity: 0;
            }
            50% { 
                transform: scale(1);
                opacity: 1;
                box-shadow: 0 0 8px currentColor;
            }
        }
        
        .music-player-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 8px;
            margin: 0;
            width: 100%;
            max-width: 300px;
            position: relative;
            z-index: 2;
        }
        
        /* Now Playing Display - Pastel Style */
        .music-now-playing {
            width: 100%;
            background: linear-gradient(135deg, rgba(232, 112, 126, 0.08) 0%, rgba(201, 168, 108, 0.06) 100%);
            border: 2px solid #e8c4c8;
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(232, 112, 126, 0.1);
        }
        
        .music-now-playing::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(
                from 0deg,
                transparent,
                rgba(232, 112, 126, 0.05),
                transparent,
                rgba(201, 168, 108, 0.05),
                transparent
            );
            animation: rotateBg 8s linear infinite;
            z-index: 0;
        }
        
        @keyframes rotateBg {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .music-now-playing > * {
            position: relative;
            z-index: 1;
        }
        
        .music-now-label {
            font-family: 'Space Mono', monospace;
            font-size: 0.45rem;
            letter-spacing: 0.2em;
            color: #c9a86c;
            margin-bottom: 4px;
        }
        
        .music-visualizer {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 3px;
            height: 28px;
            padding: 4px 0;
        }
        
        .viz-bar {
            width: 5px;
            height: 3px;
            background: linear-gradient(to top, #e8707e, #c9a86c);
            border-radius: 2px;
            opacity: 0.4;
            transition: height 0.1s ease;
        }
        
        .music-visualizer.playing .viz-bar {
            animation: vizPulse 0.4s ease-in-out infinite;
            opacity: 1;
            box-shadow: 0 0 8px rgba(232, 112, 126, 0.4);
        }
        
        .viz-bar:nth-child(1) { animation-delay: 0s; }
        .viz-bar:nth-child(2) { animation-delay: 0.1s; }
        .viz-bar:nth-child(3) { animation-delay: 0.05s; }
        .viz-bar:nth-child(4) { animation-delay: 0.15s; }
        .viz-bar:nth-child(5) { animation-delay: 0.08s; }
        .viz-bar:nth-child(6) { animation-delay: 0.12s; }
        .viz-bar:nth-child(7) { animation-delay: 0.03s; }
        .viz-bar:nth-child(8) { animation-delay: 0.18s; }
        
        @keyframes vizPulse {
            0%, 100% { height: 3px; }
            50% { height: 24px; }
        }
        
        .music-current-track {
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            color: #e8707e;
            letter-spacing: 0.05em;
            margin-top: 4px;
        }
        
        /* Playlist - Pastel Stationery Style */
        .music-playlist {
            width: 100%;
            border: 2px solid #e8c4c8;
            border-radius: 12px;
            overflow: hidden;
            background: linear-gradient(180deg, #fefcfa 0%, #faf6f2 100%);
            box-shadow: 0 4px 12px rgba(232, 112, 126, 0.1);
        }
        
        .playlist-header {
            font-family: 'Space Mono', monospace;
            font-size: 0.45rem;
            letter-spacing: 0.2em;
            color: #c9a86c;
            padding: 8px 12px;
            border-bottom: 1px solid #f0e4e0;
            background: linear-gradient(180deg, rgba(255,255,255,0.5) 0%, transparent 100%);
        }
        
        .playlist-track {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            border-bottom: 1px solid #f0e8e4;
            cursor: pointer;
            transition: all 0.2s ease;
            -webkit-tap-highlight-color: transparent;
        }
        
        .playlist-track:last-child {
            border-bottom: none;
        }
        
        .playlist-track:hover, .playlist-track:active {
            background: rgba(232, 112, 126, 0.08);
        }
        
        .playlist-track.active {
            background: linear-gradient(90deg, rgba(232, 112, 126, 0.12) 0%, rgba(201, 168, 108, 0.08) 100%);
            border-left: 3px solid #e8707e;
        }
        
        .playlist-track.playing {
            background: linear-gradient(90deg, rgba(232, 112, 126, 0.15) 0%, rgba(201, 168, 108, 0.1) 100%);
            animation: trackPulse 1s ease-in-out infinite;
        }
        
        @keyframes trackPulse {
            0%, 100% { box-shadow: inset 0 0 0 rgba(232, 112, 126, 0); }
            50% { box-shadow: inset 0 0 20px rgba(232, 112, 126, 0.08); }
        }
        
        .track-number {
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            color: #c9a86c;
            min-width: 18px;
        }
        
        .playlist-track.active .track-number {
            color: #e8707e;
        }
        
        .track-info {
            flex: 1;
            min-width: 0;
        }
        
        .track-title {
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            color: #4a4a4a;
            letter-spacing: 0.05em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .playlist-track.active .track-title {
            color: #e8707e;
        }
        
        .track-artist {
            font-family: 'Space Mono', monospace;
            font-size: 0.45rem;
            color: #7a6a6e;
            letter-spacing: 0.05em;
            margin-top: 2px;
        }
        
        .track-status {
            font-size: 0.65rem;
            color: #c9a86c;
            min-width: 14px;
            text-align: center;
        }
        
        .playlist-track.active .track-status {
            color: var(--rabbit);
        }
        
        .playlist-track.playing .track-status {
            animation: blink 0.8s ease-in-out infinite;
            text-shadow: 0 0 8px rgba(255, 138, 128, 0.8);
        }
        
        /* Controls - Party Mode */
        .music-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            margin-top: 6px;
        }
        
        .music-control-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(244, 209, 155, 0.1);
            border: 1px solid rgba(244, 209, 155, 0.3);
            border-radius: 50%;
            color: #f4d19b;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.2s ease;
            -webkit-tap-highlight-color: transparent;
        }
        
        .music-control-btn:hover, .music-control-btn:active {
            border-color: #f4d19b;
            background: rgba(244, 209, 155, 0.2);
            box-shadow: 0 0 15px rgba(244, 209, 155, 0.3);
            transform: scale(1.05);
        }
        
        .music-play-btn {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(255, 138, 128, 0.2) 0%, rgba(244, 209, 155, 0.15) 100%);
            border: 2px solid var(--rabbit);
            border-radius: 50%;
            color: var(--rabbit);
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            -webkit-tap-highlight-color: transparent;
            box-shadow: 0 0 20px rgba(255, 138, 128, 0.2);
        }
        
        .music-play-btn:hover, .music-play-btn:active {
            background: linear-gradient(135deg, rgba(255, 138, 128, 0.35) 0%, rgba(244, 209, 155, 0.25) 100%);
            box-shadow: 0 0 30px rgba(255, 138, 128, 0.5);
            transform: scale(1.08);
        }
        
        .music-play-btn.playing {
            background: linear-gradient(135deg, var(--rabbit) 0%, #f4d19b 100%);
            color: var(--bg-primary);
            animation: playBtnPulse 1s ease-in-out infinite;
        }
        
        @keyframes playBtnPulse {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(255, 138, 128, 0.5);
            }
            50% { 
                box-shadow: 0 0 35px rgba(255, 138, 128, 0.8), 0 0 50px rgba(244, 209, 155, 0.4);
            }
        }
        
        .music-status {
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            letter-spacing: 0.1em;
            color: #f4d19b;
            text-align: center;
            margin-top: 4px;
            text-shadow: 0 0 8px rgba(244, 209, 155, 0.4);
            animation: statusBounce 2s ease-in-out infinite;
        }
        
        @keyframes statusBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-2px); }
        }
        
        .music-player-page .game-buttons {
            margin-top: 8px !important;
            padding: 0 !important;
        }
        
        .music-player-page .game-menu-btn {
            font-size: 0.5rem !important;
            padding: 8px 16px !important;
            background: rgba(255, 138, 128, 0.1) !important;
            border-color: rgba(255, 138, 128, 0.3) !important;
            color: var(--rabbit) !important;
        }
        
        .music-player-page .game-menu-btn:hover {
            background: rgba(255, 138, 128, 0.2) !important;
            border-color: var(--rabbit) !important;
            box-shadow: 0 0 15px rgba(255, 138, 128, 0.3) !important;
        }

        /* Restored sudoku cell styles */
        .sudoku-cell {
            font-family: 'Space Mono', monospace;
            font-size: 1.1rem;
            background: var(--bg-secondary);
            cursor: pointer;
            transition: all 0.1s ease;
            -webkit-tap-highlight-color: transparent;
        }

        .sudoku-cell.given {
            color: var(--text-primary);
            cursor: default;
        }

        .sudoku-cell.editable {
            color: var(--coral);
        }

        .sudoku-cell.selected {
            background: rgba(255, 107, 107, 0.2);
            box-shadow: inset 0 0 0 2px var(--coral);
        }

        .sudoku-cell.error {
            color: #ff4444;
            background: rgba(255, 68, 68, 0.1);
        }

        /* ============ PARTY MODE - TRACK 3 BEAT SYNC (120 BPM = 500ms per beat) ============ */
        .music-player-page.party-mode {
            animation: partyBackground 2000ms linear infinite;
        }
        
        @keyframes partyBackground {
            0% { 
                background: radial-gradient(ellipse at 50% 50%, rgba(255, 138, 128, 0.3) 0%, transparent 50%),
                            var(--bg-primary);
            }
            25% { 
                background: radial-gradient(ellipse at 30% 70%, rgba(244, 209, 155, 0.35) 0%, transparent 50%),
                            var(--bg-primary);
            }
            50% { 
                background: radial-gradient(ellipse at 70% 30%, rgba(255, 138, 128, 0.35) 0%, transparent 50%),
                            var(--bg-primary);
            }
            75% { 
                background: radial-gradient(ellipse at 50% 50%, rgba(200, 100, 255, 0.3) 0%, transparent 50%),
                            var(--bg-primary);
            }
            100% { 
                background: radial-gradient(ellipse at 50% 50%, rgba(255, 138, 128, 0.3) 0%, transparent 50%),
                            var(--bg-primary);
            }
        }
        
        /* Beat-synced rabbits - 120 BPM */
        .music-player-page.party-mode .dj-rabbit {
            animation: partyRabbitBounce 500ms ease-in-out infinite !important;
            opacity: 0.4 !important;
            background: rgba(255, 138, 128, 0.6) !important;
        }
        
        .music-player-page.party-mode .dj-rabbit:nth-child(odd) {
            animation-delay: 0ms !important;
        }
        
        .music-player-page.party-mode .dj-rabbit:nth-child(even) {
            animation-delay: 250ms !important;
        }
        
        @keyframes partyRabbitBounce {
            0%, 100% { 
                transform: translateY(0) scale(1);
            }
            50% { 
                transform: translateY(-8px) scale(1.2);
            }
        }
        
        /* Extra party rabbits container */
        .party-rabbits {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            overflow: hidden;
            z-index: 3;
            display: none;
        }
        
        .music-player-page.party-mode .party-rabbits {
            display: block;
        }
        
        .party-rabbit {
            position: absolute;
            width: 18px;
            height: 18px;
            background: rgba(255, 138, 128, 0.7);
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(255, 138, 128, 0.5);
            opacity: 0;
            animation: partyRabbitDrop 500ms ease-out forwards;
        }
        
        @keyframes partyRabbitDrop {
            0% { 
                transform: translateY(-50px) scale(0.5);
                opacity: 0;
            }
            30% {
                opacity: 0.6;
            }
            100% { 
                transform: translateY(0) scale(1);
                opacity: 0.5;
            }
        }
        
        /* Beat pulse for the whole container */
        .music-player-page.party-mode .music-player-container {
            animation: containerPulse 500ms ease-in-out infinite;
        }
        
        @keyframes containerPulse {
            0%, 100% { 
                transform: scale(1);
            }
            50% { 
                transform: scale(1.02);
            }
        }
        
        /* Now playing box party mode */
        .music-player-page.party-mode .music-now-playing {
            animation: nowPlayingParty 500ms ease-in-out infinite;
            border-color: rgba(255, 138, 128, 0.8) !important;
        }
        
        @keyframes nowPlayingParty {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(255, 138, 128, 0.3), inset 0 0 30px rgba(255, 138, 128, 0.1);
            }
            50% { 
                box-shadow: 0 0 40px rgba(255, 138, 128, 0.6), inset 0 0 50px rgba(244, 209, 155, 0.2);
            }
        }
        
        /* Visualizer bars go crazy */
        .music-player-page.party-mode .viz-bar {
            animation: vizParty 250ms ease-in-out infinite !important;
            box-shadow: 0 0 15px rgba(255, 138, 128, 0.8) !important;
        }
        
        .music-player-page.party-mode .viz-bar:nth-child(1) { animation-delay: 0ms !important; }
        .music-player-page.party-mode .viz-bar:nth-child(2) { animation-delay: 31ms !important; }
        .music-player-page.party-mode .viz-bar:nth-child(3) { animation-delay: 62ms !important; }
        .music-player-page.party-mode .viz-bar:nth-child(4) { animation-delay: 93ms !important; }
        .music-player-page.party-mode .viz-bar:nth-child(5) { animation-delay: 125ms !important; }
        .music-player-page.party-mode .viz-bar:nth-child(6) { animation-delay: 156ms !important; }
        .music-player-page.party-mode .viz-bar:nth-child(7) { animation-delay: 187ms !important; }
        .music-player-page.party-mode .viz-bar:nth-child(8) { animation-delay: 218ms !important; }
        
        @keyframes vizParty {
            0%, 100% { height: 4px; background: var(--rabbit); }
            25% { height: 30px; background: #f4d19b; }
            50% { height: 8px; background: #ff69b4; }
            75% { height: 24px; background: var(--rabbit); }
        }
        
        /* Sparkles go wild */
        .music-player-page.party-mode .dj-sparkle {
            animation: sparkleParty 250ms ease-in-out infinite !important;
            width: 8px !important;
            height: 8px !important;
        }
        
        @keyframes sparkleParty {
            0%, 100% { 
                transform: scale(0.5);
                opacity: 0.3;
                box-shadow: 0 0 10px currentColor;
            }
            50% { 
                transform: scale(1.5);
                opacity: 1;
                box-shadow: 0 0 25px currentColor, 0 0 50px currentColor;
            }
        }
        
        /* DJ title goes nuts */
        .music-player-page.party-mode .game-subtitle {
            animation: djTitleParty 500ms ease-in-out infinite !important;
        }
        
        @keyframes djTitleParty {
            0%, 100% { 
                transform: scale(1) rotate(-1deg);
                text-shadow: 
                    0 0 20px rgba(255, 138, 128, 1),
                    0 0 40px rgba(255, 138, 128, 0.8),
                    0 0 60px rgba(244, 209, 155, 0.6),
                    4px 4px 0 rgba(244, 209, 155, 0.8);
                color: var(--rabbit);
            }
            25% {
                color: #f4d19b;
            }
            50% { 
                transform: scale(1.08) rotate(1deg);
                text-shadow: 
                    0 0 30px rgba(244, 209, 155, 1),
                    0 0 60px rgba(255, 138, 128, 0.8),
                    0 0 80px rgba(200, 100, 255, 0.5),
                    -4px -4px 0 rgba(255, 138, 128, 0.8);
                color: #ff69b4;
            }
            75% {
                color: #f4d19b;
            }
        }
        
        /* Play button pulses hard */
        .music-player-page.party-mode .music-play-btn {
            animation: playBtnParty 500ms ease-in-out infinite !important;
        }
        
        @keyframes playBtnParty {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 30px rgba(255, 138, 128, 0.6);
                background: linear-gradient(135deg, var(--rabbit) 0%, #f4d19b 100%);
            }
            50% { 
                transform: scale(1.15);
                box-shadow: 0 0 50px rgba(255, 138, 128, 1), 0 0 80px rgba(244, 209, 155, 0.6);
                background: linear-gradient(135deg, #f4d19b 0%, #ff69b4 100%);
            }
        }
        
        /* Status text bounces harder */
        .music-player-page.party-mode .music-status {
            animation: statusParty 500ms ease-in-out infinite !important;
            font-size: 0.85rem !important;
        }
        
        @keyframes statusParty {
            0%, 100% { 
                transform: translateY(0) scale(1);
                color: #f4d19b;
            }
            50% { 
                transform: translateY(-5px) scale(1.1);
                color: var(--rabbit);
                text-shadow: 0 0 15px rgba(255, 138, 128, 0.8);
            }
        }
        
        /* Strobe flash overlay */
        .party-strobe {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 10;
            opacity: 0;
            background: white;
            display: none;
        }
        
        .music-player-page.party-mode .party-strobe {
            display: block;
            animation: strobeFlash 2000ms ease-in-out infinite;
        }
        
        @keyframes strobeFlash {
            0%, 100% { opacity: 0; }
            48% { opacity: 0; }
            50% { opacity: 0.15; }
            52% { opacity: 0; }
            98% { opacity: 0; }
        }
        
        /* Header text color cycle */
        .music-player-page.party-mode .game-header {
            animation: headerColorCycle 2000ms linear infinite !important;
        }
        
        @keyframes headerColorCycle {
            0%, 100% { color: var(--rabbit); }
            33% { color: #f4d19b; }
            66% { color: #ff69b4; }
        }
        
        /* ============ DROP MODE - 1:06 INTENSIFIER ============ */
        .music-player-page.party-drop {
            animation: dropBackground 500ms linear infinite !important;
        }
        
        @keyframes dropBackground {
            0% { 
                background: radial-gradient(ellipse at 50% 50%, rgba(255, 138, 128, 0.5) 0%, rgba(244, 209, 155, 0.2) 30%, transparent 60%),
                            var(--bg-primary);
            }
            25% { 
                background: radial-gradient(ellipse at 30% 30%, rgba(100, 200, 255, 0.4) 0%, rgba(255, 138, 128, 0.2) 30%, transparent 60%),
                            var(--bg-primary);
            }
            50% { 
                background: radial-gradient(ellipse at 70% 70%, rgba(200, 100, 255, 0.5) 0%, rgba(100, 255, 200, 0.2) 30%, transparent 60%),
                            var(--bg-primary);
            }
            75% { 
                background: radial-gradient(ellipse at 50% 50%, rgba(244, 209, 155, 0.5) 0%, rgba(255, 100, 150, 0.2) 30%, transparent 60%),
                            var(--bg-primary);
            }
        }
        
        .music-player-page.drop-mode .party-strobe {
            animation: strobeFlashIntense 500ms ease-in-out infinite !important;
        }
        
        @keyframes strobeFlashIntense {
            0%, 100% { opacity: 0; }
            45% { opacity: 0; }
            50% { opacity: 0.25; }
            55% { opacity: 0; }
        }
        
        /* Confetti container */
        .confetti-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            overflow: hidden;
            z-index: 15;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0;
        }
        
        .confetti.square {
            border-radius: 2px;
        }
        
        .confetti.circle {
            border-radius: 50%;
        }
        
        .confetti.ribbon {
            width: 4px;
            height: 16px;
            border-radius: 2px;
        }
        
        /* Confetti from left */
        .confetti.from-left {
            left: -20px;
            animation: confettiFromLeft 2s ease-out forwards;
            -webkit-animation: confettiFromLeft 2s ease-out forwards;
        }
        
        @-webkit-keyframes confettiFromLeft {
            0% {
                -webkit-transform: translateX(0) translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                -webkit-transform: translateX(120vw) translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        @keyframes confettiFromLeft {
            0% {
                transform: translateX(0) translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateX(120vw) translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        /* Confetti from right */
        .confetti.from-right {
            right: -20px;
            animation: confettiFromRight 2s ease-out forwards;
            -webkit-animation: confettiFromRight 2s ease-out forwards;
        }
        
        @-webkit-keyframes confettiFromRight {
            0% {
                -webkit-transform: translateX(0) translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                -webkit-transform: translateX(-120vw) translateY(100vh) rotate(-720deg);
                opacity: 0;
            }
        }
        
        @keyframes confettiFromRight {
            0% {
                transform: translateX(0) translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateX(-120vw) translateY(100vh) rotate(-720deg);
                opacity: 0;
            }
        }
        
        /* Confetti from top */
        .confetti.from-top {
            top: -20px;
            animation: confettiFromTop 2.5s ease-out forwards;
            -webkit-animation: confettiFromTop 2.5s ease-out forwards;
        }
        
        @-webkit-keyframes confettiFromTop {
            0% {
                -webkit-transform: translateX(0) translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                -webkit-transform: translateX(20px) translateY(120vh) rotate(540deg);
                opacity: 0;
            }
        }
        
        @keyframes confettiFromTop {
            0% {
                transform: translateX(0) translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateX(20px) translateY(120vh) rotate(540deg);
                opacity: 0;
            }
        }
        
        /* Drop burst rabbits */
        .drop-rabbit {
            position: absolute;
            font-size: 2rem;
            opacity: 0;
            z-index: 12;
            filter: drop-shadow(0 0 10px currentColor);
        }
        
        .drop-rabbit.from-left {
            left: -50px;
            animation: dropRabbitFromLeft 1.5s ease-out forwards;
        }
        
        @keyframes dropRabbitFromLeft {
            0% {
                transform: translateX(0) scale(0.5) rotate(-30deg);
                opacity: 0;
            }
            20% {
                opacity: 1;
            }
            100% {
                transform: translateX(60vw) scale(1.5) rotate(360deg);
                opacity: 0;
            }
        }
        
        .drop-rabbit.from-right {
            right: -50px;
            animation: dropRabbitFromRight 1.5s ease-out forwards;
        }
        
        @keyframes dropRabbitFromRight {
            0% {
                transform: translateX(0) scale(0.5) rotate(30deg);
                opacity: 0;
            }
            20% {
                opacity: 1;
            }
            100% {
                transform: translateX(-60vw) scale(1.5) rotate(-360deg);
                opacity: 0;
            }
        }
        
        /* Thank You Message */
        .thank-you-message {
            position: absolute;
            top: 50%;
            left: 50%;
            -webkit-transform: translate(-50%, -50%) scale(0.5);
            transform: translate(-50%, -50%) scale(0.5);
            z-index: 50;
            text-align: center;
            opacity: 0;
            -webkit-transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            pointer-events: none;
            /* Soft pastel backdrop for readability */
            background: radial-gradient(ellipse at center, rgba(255, 250, 245, 0.98) 0%, rgba(250, 245, 240, 0.95) 50%, transparent 80%);
            padding: 40px 50px;
            border-radius: 20px;
            width: 90vw;
            max-width: 400px;
            box-sizing: border-box;
            border: 2px solid rgba(232, 112, 126, 0.3);
            box-shadow: 0 8px 32px rgba(232, 112, 126, 0.2);
        }
        
        .thank-you-message.visible {
            opacity: 1;
            -webkit-transform: translate(-50%, -50%) scale(1);
            transform: translate(-50%, -50%) scale(1);
        }
        
        .thank-you-text {
            font-family: 'Londrina Sketch', cursive;
            font-size: 3rem;
            letter-spacing: 2px;
            color: #e8707e;
            line-height: 1.1;
            text-shadow: 
                0 2px 4px rgba(0, 0, 0, 0.1),
                0 0 20px rgba(232, 112, 126, 0.4);
            -webkit-animation: thankYouPulse 500ms ease-in-out infinite;
            animation: thankYouPulse 500ms ease-in-out infinite;
        }
        
        .thank-you-text-2 {
            font-family: 'Londrina Sketch', cursive;
            font-size: 3.5rem;
            letter-spacing: 2px;
            color: #c9a86c;
            line-height: 1.1;
            margin-top: 0;
            text-shadow: 
                0 2px 4px rgba(0, 0, 0, 0.1),
                0 0 20px rgba(201, 168, 108, 0.4);
            -webkit-animation: thankYouPulse 500ms ease-in-out infinite;
            animation: thankYouPulse 500ms ease-in-out infinite;
            -webkit-animation-delay: 250ms;
            animation-delay: 250ms;
        }
        
        /* Ponyboy clue - golden highlight to hint it's special */
        .ponyboy-clue {
            color: #c9a86c;
            text-shadow: 
                0 2px 4px rgba(0, 0, 0, 0.1),
                0 0 15px rgba(201, 168, 108, 0.5);
            -webkit-animation: ponyboyShinePulse 1.5s ease-in-out infinite;
            animation: ponyboyShinePulse 1.5s ease-in-out infinite;
        }
        
        @-webkit-keyframes ponyboyShinePulse {
            0%, 100% { 
                color: #c9a86c;
                text-shadow: 
                    0 2px 4px rgba(0, 0, 0, 0.1),
                    0 0 15px rgba(201, 168, 108, 0.5);
            }
            50% { 
                color: #d4b87c;
                text-shadow: 
                    0 2px 4px rgba(0, 0, 0, 0.1),
                    0 0 25px rgba(212, 184, 124, 0.6);
            }
        }
        
        @keyframes ponyboyShinePulse {
            0%, 100% { 
                color: #c9a86c;
                text-shadow: 
                    0 2px 4px rgba(0, 0, 0, 0.1),
                    0 0 15px rgba(201, 168, 108, 0.5);
            }
            50% { 
                color: #d4b87c;
                text-shadow: 
                    0 2px 4px rgba(0, 0, 0, 0.1),
                    0 0 25px rgba(212, 184, 124, 0.6);
            }
        }
        
        /* Mobile adjustments for thank you message */
        @media (max-width: 480px) {
            .thank-you-message {
                padding: 30px 25px;
                width: 85vw;
            }
            .thank-you-text {
                font-size: 2.2rem;
            }
            .thank-you-text-2 {
                font-size: 2.6rem;
            }
        }
        
        .thank-you-heart {
            font-size: 2rem;
            margin-top: 12px;
            -webkit-animation: heartBeat 500ms ease-in-out infinite, heartColorCycle 1500ms linear infinite;
            animation: heartBeat 500ms ease-in-out infinite, heartColorCycle 1500ms linear infinite;
        }
        
        @-webkit-keyframes thankYouPulse {
            0%, 100% { 
                -webkit-transform: scale(1);
            }
            50% { 
                -webkit-transform: scale(1.05);
            }
        }
        
        @keyframes thankYouPulse {
            0%, 100% { 
                transform: scale(1);
            }
            50% { 
                transform: scale(1.05);
            }
        }
        
        @-webkit-keyframes heartBeat {
            0%, 100% { 
                -webkit-transform: scale(1);
            }
            50% { 
                -webkit-transform: scale(1.3);
            }
        }
        
        @keyframes heartColorCycle {
            0%, 100% { 
                color: #ff8a80;
                text-shadow: 0 0 20px rgba(255, 138, 128, 0.8);
            }
            33% { 
                color: #f4d19b;
                text-shadow: 0 0 20px rgba(244, 209, 155, 0.8);
            }
            66% { 
                color: #ff69b4;
                text-shadow: 0 0 20px rgba(255, 105, 180, 0.8);
            }
        }
        
        /* ============ CHASE SEQUENCE - Snake vs Rabbits ============ */
        .chase-rabbit {
            position: absolute;
            width: 24px;
            height: 24px;
            z-index: 30;
            pointer-events: none;
            -webkit-transition: left 0.48s linear, top 0.48s linear;
            transition: left 0.48s linear, top 0.48s linear;
            /* Pixel art rabbit - monochrome nose/mouth */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Crect x='3' y='0' width='2' height='6' fill='white'/%3E%3Crect x='11' y='0' width='2' height='6' fill='white'/%3E%3Crect x='2' y='5' width='12' height='10' rx='2' fill='white'/%3E%3Crect x='5' y='8' width='2' height='2' fill='%23333'/%3E%3Crect x='9' y='8' width='2' height='2' fill='%23333'/%3E%3Crect x='7' y='11' width='2' height='2' fill='%23999'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        
        .chase-rabbit.together {
            opacity: 1;
            -webkit-animation: rabbitBeatPulse 500ms ease-in-out infinite;
            animation: rabbitBeatPulse 500ms ease-in-out infinite;
        }
        
        @-webkit-keyframes rabbitBeatPulse {
            0%, 100% { -webkit-transform: scale(1); }
            50% { -webkit-transform: scale(1.1); }
        }
        
        @keyframes rabbitBeatPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* Owen's rabbit - gold/amber - FRONT of the line */
        .owen-rabbit {
            filter: brightness(1.1) sepia(1) hue-rotate(10deg) saturate(3) drop-shadow(0 0 8px rgba(232, 184, 74, 0.9));
        }
        
        /* Isla's rabbit - coral - MIDDLE */
        .isla-rabbit {
            filter: brightness(1) sepia(1) hue-rotate(-30deg) saturate(2.5) drop-shadow(0 0 8px rgba(255, 138, 128, 0.9));
        }
        
        /* Vincent's rabbit - blue-gray #8fa4b8 - BACK (closest to snake) */
        .vincent-rabbit {
            /* Use Vincent's actual color in the SVG - pixel art style */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Crect x='3' y='0' width='2' height='6' fill='%238fa4b8'/%3E%3Crect x='11' y='0' width='2' height='6' fill='%238fa4b8'/%3E%3Crect x='2' y='5' width='12' height='10' rx='2' fill='%238fa4b8'/%3E%3Crect x='5' y='8' width='2' height='2' fill='%23333'/%3E%3Crect x='9' y='8' width='2' height='2' fill='%23333'/%3E%3Crect x='7' y='11' width='2' height='2' fill='%23667'/%3E%3C/svg%3E");
            filter: drop-shadow(0 0 8px rgba(143, 164, 184, 0.9));
        }
        
        /* ============ GIANT SNAKE GAME ============ */
        .giant-snake-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 35;
            pointer-events: none;
            overflow: hidden;
        }
        
        .giant-snake-segment {
            position: absolute;
            width: 24px;
            height: 24px;
            background: var(--rabbit);
            border-radius: 4px;
            box-shadow: 
                0 2px 8px rgba(232, 112, 126, 0.3),
                0 4px 16px rgba(232, 112, 126, 0.2);
            -webkit-transform: translate(-50%, -50%);
            transform: translate(-50%, -50%);
            -webkit-animation: snakeSegmentBeat 500ms ease-in-out infinite;
            animation: snakeSegmentBeat 500ms ease-in-out infinite;
        }
        
        /* Beat-synced pulse for all segments (120 BPM = 500ms) */
        @-webkit-keyframes snakeSegmentBeat {
            0%, 100% { 
                -webkit-transform: translate(-50%, -50%) scale(1);
            }
            50% { 
                -webkit-transform: translate(-50%, -50%) scale(1.08);
            }
        }
        
        @keyframes snakeSegmentBeat {
            0%, 100% { 
                transform: translate(-50%, -50%) scale(1);
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.08);
            }
        }
        
        .giant-snake-segment.snake-head {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, var(--rabbit) 0%, #d45a68 50%, var(--rabbit) 100%);
            border-radius: 6px;
            box-shadow: 
                0 2px 12px rgba(232, 112, 126, 0.4),
                0 4px 24px rgba(232, 112, 126, 0.3);
            -webkit-animation: snakeHeadPulse 500ms ease-in-out infinite;
            animation: snakeHeadPulse 500ms ease-in-out infinite;
        }
        
        @-webkit-keyframes snakeHeadPulse {
            0%, 100% { 
                box-shadow: 
                    0 2px 12px rgba(232, 112, 126, 0.4),
                    0 4px 24px rgba(232, 112, 126, 0.3);
                -webkit-transform: translate(-50%, -50%) scale(1);
            }
            50% { 
                box-shadow: 
                    0 4px 20px rgba(232, 112, 126, 0.5),
                    0 8px 32px rgba(232, 112, 126, 0.4);
                -webkit-transform: translate(-50%, -50%) scale(1.15);
            }
        }
        
        @keyframes snakeHeadPulse {
            0%, 100% { 
                box-shadow: 
                    0 2px 12px rgba(232, 112, 126, 0.4),
                    0 4px 24px rgba(232, 112, 126, 0.3);
                transform: translate(-50%, -50%) scale(1);
            }
            50% { 
                box-shadow: 
                    0 4px 20px rgba(232, 112, 126, 0.5),
                    0 8px 32px rgba(232, 112, 126, 0.4);
                transform: translate(-50%, -50%) scale(1.15);
            }
        }
        
        /* Elements that get eaten */
        .snake-eaten {
            opacity: 0 !important;
            transform: scale(0) !important;
            transition: all 0.2s ease-in !important;
            pointer-events: none !important;
        }
        
        /* Black out overlay (was white for dark theme) */
        .snake-whiteout {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #1a1a1a;
            z-index: 40;
            opacity: 0;
            transition: opacity 1.5s ease-in;
        }
        
        .snake-whiteout.active {
            opacity: 1;
        }
        
        .snake-whiteout.fading {
            opacity: 0;
            transition: opacity 2s ease-out;
        }
        
        /* ============ THE DROP - EXTRA INTENSITY ============ */
        .music-player-page.party-drop {
            animation: dropBackground 500ms ease-in-out infinite !important;
        }
        
        @keyframes dropBackground {
            0%, 100% { 
                background: radial-gradient(ellipse at 50% 50%, rgba(255, 138, 128, 0.5) 0%, rgba(244, 209, 155, 0.3) 30%, transparent 60%),
                            var(--bg-primary);
            }
            25% { 
                background: radial-gradient(ellipse at 30% 30%, rgba(100, 181, 246, 0.5) 0%, rgba(167, 139, 250, 0.3) 30%, transparent 60%),
                            var(--bg-primary);
            }
            50% { 
                background: radial-gradient(ellipse at 70% 70%, rgba(255, 105, 180, 0.5) 0%, rgba(255, 138, 128, 0.3) 30%, transparent 60%),
                            var(--bg-primary);
            }
            75% { 
                background: radial-gradient(ellipse at 50% 50%, rgba(0, 212, 170, 0.5) 0%, rgba(244, 209, 155, 0.3) 30%, transparent 60%),
                            var(--bg-primary);
            }
        }
        
        .music-player-page.party-drop .party-strobe {
            animation: strobeDropFlash 250ms ease-in-out infinite !important;
        }
        
        @keyframes strobeDropFlash {
            0%, 100% { opacity: 0; }
            50% { opacity: 0.2; }
        }
        
        .music-player-page.party-drop .game-subtitle {
            animation: djTitleDrop 250ms ease-in-out infinite !important;
        }
        
        @keyframes djTitleDrop {
            0%, 100% { 
                transform: scale(1.1) rotate(-2deg);
                text-shadow: 
                    0 0 30px rgba(255, 138, 128, 1),
                    0 0 60px rgba(244, 209, 155, 1),
                    0 0 90px rgba(255, 105, 180, 0.8);
            }
            50% { 
                transform: scale(1.2) rotate(2deg);
                text-shadow: 
                    0 0 40px rgba(100, 181, 246, 1),
                    0 0 80px rgba(167, 139, 250, 1),
                    0 0 120px rgba(0, 212, 170, 0.8);
            }
        }
        
        /* Drop rabbits from sides */
        .drop-rabbit {
            z-index: 5;
        }
        
        @keyframes dropRabbitFromLeft {
            0% { 
                transform: translateX(0) rotate(0deg) scale(0.5);
                opacity: 0;
            }
            100% { 
                transform: translateX(60vw) rotate(360deg) scale(1);
                opacity: 0.7;
            }
        }
        
        @keyframes dropRabbitFromRight {
            0% { 
                transform: translateX(0) rotate(0deg) scale(0.5);
                opacity: 0;
            }
            100% { 
                transform: translateX(-60vw) rotate(-360deg) scale(1);
                opacity: 0.7;
            }
        }
        
        @keyframes dropRabbitFromTop {
            0% { 
                transform: translateY(0) rotate(0deg) scale(0.5);
                opacity: 0;
            }
            100% { 
                transform: translateY(50vh) rotate(360deg) scale(1);
                opacity: 0.7;
            }
        }
        
        @keyframes dropRabbitFromBottom {
            0% { 
                transform: translateY(0) rotate(0deg) scale(0.5);
                opacity: 0;
            }
            100% { 
                transform: translateY(-50vh) rotate(-360deg) scale(1);
                opacity: 0.7;
            }
        }
        
        /* Confetti explosion */
        .confetti {
            position: absolute;
            pointer-events: none;
            z-index: 20;
        }
        
        @keyframes confettiExplode {
            0% { 
                transform: translate(0, 0) rotate(0deg) scale(1);
                opacity: 1;
            }
            100% { 
                transform: translate(var(--tx), var(--ty)) rotate(var(--rot)) scale(0.3);
                opacity: 0;
            }
        }

        /* ============ DANCING CHARACTERS - PRE-DROP HYPE ============ */
        .dance-character {
            position: fixed;
            z-index: 9999;
            pointer-events: none;
            image-rendering: auto;
            filter: drop-shadow(0 0 8px rgba(0,0,0,0.3));
        }
        
        /* Sizes - 20% larger */
        .dance-character.size-sm { width: 60px; height: auto; }
        .dance-character.size-md { width: 96px; height: auto; }
        .dance-character.size-lg { width: 132px; height: auto; }
        
        /* Mobile: smaller characters to prevent overlap */
        @media (max-width: 600px) {
            .dance-character.size-sm { width: 42px; }
            .dance-character.size-md { width: 66px; }
            .dance-character.size-lg { width: 90px; }
            
            /* Reduce the bounce movement on mobile */
            .dance-character.party-crazy-bpm {
                animation: dancePartyBPMMobile 0.5s ease-in-out infinite;
            }
            .dance-character.party-crazy-bpm:nth-child(even) {
                animation: dancePartyBPMMobileAlt 0.5s ease-in-out infinite;
            }
        }
        
        @keyframes dancePartyBPMMobile {
            0%, 100% { transform: translateY(0) translateX(0) scale(1); }
            50% { transform: translateY(-40px) translateX(20px) scale(1.1); }
        }
        @keyframes dancePartyBPMMobileAlt {
            0%, 100% { transform: translateY(0) translateX(0) scale(1); }
            50% { transform: translateY(-40px) translateX(-20px) scale(1.1); }
        }
        
        /* ─── ENTRANCE ANIMATIONS ─── */
        
        /* Pop in with elastic overshoot */
        .dance-character.enter-pop {
            animation: dancePopIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        @keyframes dancePopIn {
            0% { transform: scale(0) rotate(-45deg); opacity: 0; }
            50% { transform: scale(1.3) rotate(15deg); opacity: 1; }
            75% { transform: scale(0.9) rotate(-5deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        
        /* Slide in from left with bounce */
        .dance-character.enter-slide-left {
            animation: danceSlideLeft 0.7s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }
        @keyframes danceSlideLeft {
            0% { transform: translateX(-200px) rotate(-30deg); opacity: 0; }
            60% { transform: translateX(20px) rotate(10deg); opacity: 1; }
            100% { transform: translateX(0) rotate(0deg); opacity: 1; }
        }
        
        /* Slide in from right with bounce */
        .dance-character.enter-slide-right {
            animation: danceSlideRight 0.7s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }
        @keyframes danceSlideRight {
            0% { transform: translateX(200px) rotate(30deg); opacity: 0; }
            60% { transform: translateX(-20px) rotate(-10deg); opacity: 1; }
            100% { transform: translateX(0) rotate(0deg); opacity: 1; }
        }
        
        /* Drop from top with squash */
        .dance-character.enter-drop {
            animation: danceDrop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }
        @keyframes danceDrop {
            0% { transform: translateY(-300px) scaleY(1.5) scaleX(0.7); opacity: 0; }
            60% { transform: translateY(30px) scaleY(0.7) scaleX(1.3); opacity: 1; }
            80% { transform: translateY(-10px) scaleY(1.1) scaleX(0.95); }
            100% { transform: translateY(0) scaleY(1) scaleX(1); opacity: 1; }
        }
        
        /* Rise from bottom */
        .dance-character.enter-rise {
            animation: danceRise 0.6s ease-out forwards;
        }
        @keyframes danceRise {
            0% { transform: translateY(300px) scale(0.3); opacity: 0; }
            70% { transform: translateY(-20px) scale(1.1); opacity: 1; }
            100% { transform: translateY(0) scale(1); opacity: 1; }
        }
        
        /* Spin in like a tornado */
        .dance-character.enter-spin {
            animation: danceSpin 0.8s ease-out forwards;
        }
        @keyframes danceSpin {
            0% { transform: rotate(1080deg) scale(0); opacity: 0; }
            70% { transform: rotate(-30deg) scale(1.1); opacity: 1; }
            100% { transform: rotate(0deg) scale(1); opacity: 1; }
        }
        
        /* Rubber band stretch */
        .dance-character.enter-rubber {
            animation: danceRubber 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        }
        @keyframes danceRubber {
            0% { transform: scale(0, 0); opacity: 0; }
            30% { transform: scale(1.5, 0.5); opacity: 1; }
            50% { transform: scale(0.7, 1.3); }
            70% { transform: scale(1.2, 0.8); }
            100% { transform: scale(1, 1); opacity: 1; }
        }
        
        /* Flip in 3D */
        .dance-character.enter-flip {
            animation: danceFlip 0.7s ease-out forwards;
        }
        @keyframes danceFlip {
            0% { transform: perspective(400px) rotateY(-90deg) scale(0.5); opacity: 0; }
            60% { transform: perspective(400px) rotateY(20deg) scale(1.1); opacity: 1; }
            100% { transform: perspective(400px) rotateY(0deg) scale(1); opacity: 1; }
        }
        
        /* ─── IDLE / DANCING ANIMATIONS ─── */
        
        /* Bouncy dance */
        .dance-character.idle-bounce {
            animation: danceIdleBounce 0.4s ease-in-out infinite;
        }
        @keyframes danceIdleBounce {
            0%, 100% { transform: translateY(0) scaleY(1); }
            50% { transform: translateY(-15px) scaleY(1.05); }
        }
        
        /* Side to side groove */
        .dance-character.idle-groove {
            animation: danceIdleGroove 0.5s ease-in-out infinite;
        }
        @keyframes danceIdleGroove {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            25% { transform: translateX(-8px) rotate(-5deg); }
            75% { transform: translateX(8px) rotate(5deg); }
        }
        
        /* Wiggle wobble */
        .dance-character.idle-wiggle {
            animation: danceIdleWiggle 0.3s ease-in-out infinite;
        }
        @keyframes danceIdleWiggle {
            0%, 100% { transform: rotate(-8deg); }
            50% { transform: rotate(8deg); }
        }
        
        /* Pulse throb */
        .dance-character.idle-pulse {
            animation: danceIdlePulse 0.5s ease-in-out infinite;
        }
        @keyframes danceIdlePulse {
            0%, 100% { transform: scale(1); filter: invert(1) drop-shadow(0 0 8px rgba(255,255,255,0.6)); }
            50% { transform: scale(1.15); filter: invert(1) drop-shadow(0 0 15px rgba(255,255,255,0.9)); }
        }
        
        /* Jello shake */
        .dance-character.idle-jello {
            animation: danceIdleJello 0.6s ease-in-out infinite;
        }
        @keyframes danceIdleJello {
            0%, 100% { transform: skewX(0deg) skewY(0deg); }
            25% { transform: skewX(-8deg) skewY(-3deg); }
            50% { transform: skewX(6deg) skewY(2deg); }
            75% { transform: skewX(-3deg) skewY(-1deg); }
        }
        
        /* Headbang */
        .dance-character.idle-headbang {
            animation: danceIdleHeadbang 0.25s ease-in-out infinite;
        }
        @keyframes danceIdleHeadbang {
            0%, 100% { transform: rotate(0deg) translateY(0); }
            50% { transform: rotate(15deg) translateY(5px); }
        }
        
        /* ─── EXIT ANIMATIONS ─── */
        
        .dance-character.exit-pop {
            animation: danceExitPop 0.4s ease-in forwards;
        }
        @keyframes danceExitPop {
            0% { transform: scale(1) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.4) rotate(20deg); opacity: 0.5; }
            100% { transform: scale(0) rotate(-45deg); opacity: 0; }
        }
        
        .dance-character.exit-fly-up {
            animation: danceExitFlyUp 0.5s ease-in forwards;
        }
        @keyframes danceExitFlyUp {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-400px) rotate(360deg); opacity: 0; }
        }
        
        .dance-character.exit-spin-out {
            animation: danceExitSpinOut 0.5s ease-in forwards;
        }
        @keyframes danceExitSpinOut {
            0% { transform: rotate(0deg) scale(1); opacity: 1; }
            100% { transform: rotate(-720deg) scale(0); opacity: 0; }
        }
        
        .dance-character.exit-fall {
            animation: danceExitFall 0.6s ease-in forwards;
        }
        @keyframes danceExitFall {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(500px) rotate(-90deg); opacity: 0; }
        }
        
        /* ─── SPECIAL: WALK ACROSS SCREEN ─── */
        .dance-character.walk-left-to-right {
            animation: danceWalkLR 5s linear forwards;
        }
        @keyframes danceWalkLR {
            0% { left: -120px; }
            100% { left: calc(100% + 120px); }
        }
        
        .dance-character.walk-right-to-left {
            animation: danceWalkRL 5s linear forwards;
        }
        @keyframes danceWalkRL {
            0% { right: -120px; }
            100% { right: calc(100% + 120px); }
        }
        
        /* Bounce while walking */
        .dance-character.walk-bounce {
            animation: danceWalkBounce 0.3s ease-in-out infinite;
        }
        @keyframes danceWalkBounce {
            0%, 100% { transform: translateY(0) rotate(-3deg); }
            50% { transform: translateY(-8px) rotate(3deg); }
        }
        
        /* ─── SPECIAL: ZOOM ACROSS ─── */
        .dance-character.zoom-left-to-right {
            animation: danceZoomLR 2s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        @keyframes danceZoomLR {
            0% { left: -150px; transform: scale(0.3) rotate(-30deg); opacity: 0; }
            20% { opacity: 1; transform: scale(1.2) rotate(10deg); }
            80% { transform: scale(1) rotate(-5deg); }
            100% { left: calc(100% + 150px); transform: scale(0.3) rotate(30deg); opacity: 0; }
        }
        
        .dance-character.zoom-right-to-left {
            animation: danceZoomRL 2s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        @keyframes danceZoomRL {
            0% { right: -150px; transform: scale(0.3) rotate(30deg); opacity: 0; }
            20% { opacity: 1; transform: scale(1.2) rotate(-10deg); }
            80% { transform: scale(1) rotate(5deg); }
            100% { right: calc(100% + 150px); transform: scale(0.3) rotate(-30deg); opacity: 0; }
        }
        
        /* ─── SPECIAL: DIAGONAL BOUNCE ACROSS ─── */
        .dance-character.diagonal-bounce {
            animation: danceDiagonalBounce 4s ease-in-out forwards;
        }
        @keyframes danceDiagonalBounce {
            0% { left: -100px; top: 80%; transform: scale(0.5); opacity: 0; }
            10% { opacity: 1; transform: scale(1); }
            25% { top: 30%; transform: scale(1.1) rotate(15deg); }
            50% { left: 50%; top: 60%; transform: scale(0.9) rotate(-10deg); }
            75% { top: 20%; transform: scale(1.1) rotate(20deg); }
            90% { opacity: 1; }
            100% { left: calc(100% + 100px); top: 70%; transform: scale(0.5) rotate(-15deg); opacity: 0; }
        }
        
        /* ─── SPECIAL: CRAZY PARTY BOUNCE ─── */
        .dance-character.party-crazy {
            animation: dancePartyCrazy 0.5s ease-in-out infinite;
        }
        @keyframes dancePartyCrazy {
            0%, 100% { transform: translateY(0) rotate(-10deg) scale(1); }
            25% { transform: translateY(-20px) rotate(10deg) scale(1.1); }
            50% { transform: translateY(0) rotate(-5deg) scale(0.95); }
            75% { transform: translateY(-15px) rotate(15deg) scale(1.05); }
        }
        
        /* ─── CRAZY DOUBLE - POST CHASE INSANITY ─── */
        .dance-character.party-crazy-double {
            animation: dancePartyCrazyDouble 0.5s ease-in-out infinite; /* 500ms = 120 BPM */
        }
        @keyframes dancePartyCrazyDouble {
            0%, 100% { transform: translateY(0) translateX(0) rotate(-15deg) scale(1); }
            50% { transform: translateY(-60px) translateX(30px) rotate(15deg) scale(1.1); }
        }
        
        /* ─── BPM SYNCED CRAZY - ONE TWO ONE TWO ─── */
        .dance-character.party-crazy-bpm {
            animation: dancePartyBPM 0.5s ease-in-out infinite; /* 500ms = 120 BPM */
        }
        @keyframes dancePartyBPM {
            0%, 100% { transform: translateY(0) translateX(0) scale(1); }
            50% { transform: translateY(-80px) translateX(40px) scale(1.15); }
        }
        
        /* Alternate direction for variety */
        .dance-character.party-crazy-bpm:nth-child(even) {
            animation: dancePartyBPMAlt 0.5s ease-in-out infinite;
        }
        @keyframes dancePartyBPMAlt {
            0%, 100% { transform: translateY(0) translateX(0) scale(1); }
            50% { transform: translateY(-80px) translateX(-40px) scale(1.15); }
        }
        
        /* ─── SNOOPY SPECIAL DROP ENTRANCE ─── */
        .snoopy-drop-special {
            position: fixed !important;
            left: 50% !important;
            transform: translateX(-50%) !important;
            z-index: 10000;
            object-fit: contain;
            pointer-events: none;
        }
        
        .snoopy-drop-special.size-xxl {
            width: auto !important;
            height: 634px !important;
        }
        
        /* Mobile: smaller SNOOPY, ensure centering */
        @media (max-width: 600px) {
            .snoopy-drop-special.size-xxl {
                height: 350px !important;
                max-width: 90vw;
            }
        }
        
        .snoopy-drop-special.from-bottom {
            animation: snoopyFromBottom 10s ease-in-out forwards;
        }
        
        .snoopy-drop-special.from-top {
            animation: snoopyFromTop 10s ease-in-out forwards;
        }
        
        @keyframes snoopyFromBottom {
            0% { bottom: -634px; opacity: 0; }
            15% { bottom: -15%; opacity: 1; }
            85% { bottom: -15%; opacity: 1; }
            100% { bottom: -15%; opacity: 0; }
        }
        
        @keyframes snoopyFromTop {
            0% { top: -634px; opacity: 0; }
            15% { top: -15%; opacity: 1; }
            85% { top: -15%; opacity: 1; }
            100% { top: -15%; opacity: 0; }
        }
        
        /* ─── CRAZY POLKADOTS AT THE DROP - BPM SYNCED ─── */
        .dj-rabbit.drop-crazy {
            animation: polkadotDropCrazy 0.5s ease-in-out infinite !important; /* 120 BPM */
            opacity: 0.8 !important;
        }
        
        @keyframes polkadotDropCrazy {
            0%, 100% { 
                transform: translate(0, 0) scale(1); 
            }
            50% { 
                transform: translate(20px, -25px) scale(2.5); 
            }
        }
        
        /* Stagger the polkadots for variety */
        .dj-rabbit.drop-crazy:nth-child(odd) {
            animation-delay: 0.15s !important;
        }
        .dj-rabbit.drop-crazy:nth-child(3n) {
            animation-delay: 0.1s !important;
        }
        .dj-rabbit.drop-crazy:nth-child(5n) {
            animation-delay: 0.05s !important;
        }

        /* ============ HORSE CONTAINMENT PAGE ============ */
        .horse-page {
            min-height: 100vh;
            height: auto;
            background: var(--bg-primary);
            padding: 28px 16px;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            position: relative;
        }
        
        @media (min-width: 390px) {
            .horse-page {
                padding: 32px 20px;
            }
        }
        
        /* Ensure horse page container allows scroll */
        #horseContainmentPage {
            overflow-y: auto;
            overflow-x: hidden;
            height: 100vh;
            height: 100dvh;
            -webkit-overflow-scrolling: touch;
        }
        
        #horseContainmentPage .page-content {
            overflow-y: auto;
            height: 100%;
            padding-bottom: 100px;
        }
        
        .horse-page-container {
            max-width: 520px;
            margin: 0 auto;
        }
        
        .horse-header {
            text-align: center;
            margin-bottom: 20px;
            padding: 0 4px;
        }
        
        .horse-header-warning {
            font-family: 'Space Mono', monospace;
            font-size: 0.4rem;
            letter-spacing: 0.5px;
            color: #777;
            margin-bottom: 8px;
            white-space: nowrap;
        }
        
        .horse-header-title {
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            letter-spacing: 1px;
            color: #C0C0C0;
            text-shadow: 0 0 20px rgba(192, 192, 192, 0.5);
            margin-bottom: 6px;
            white-space: nowrap;
        }
        
        .horse-header-sub {
            font-family: 'Space Mono', monospace;
            font-size: 0.35rem;
            letter-spacing: 0;
            color: #666;
            white-space: nowrap;
        }
        
        .horse-status-bar {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 24px;
            flex-wrap: nowrap;
            padding: 0 4px;
        }
        
        .horse-status-item {
            font-family: 'Space Mono', monospace;
            font-size: 0.35rem;
            letter-spacing: 0;
            color: #666;
            white-space: nowrap;
        }
        
        @media (min-width: 360px) {
            .horse-header-warning {
                font-size: 0.45rem;
                letter-spacing: 1px;
            }
            
            .horse-header-title {
                font-size: 0.95rem;
                letter-spacing: 1.5px;
            }
            
            .horse-header-sub {
                font-size: 0.4rem;
                letter-spacing: 0.5px;
            }
            
            .horse-status-bar {
                gap: 10px;
            }
            
            .horse-status-item {
                font-size: 0.4rem;
                letter-spacing: 0.25px;
            }
        }
        
        @media (min-width: 390px) {
            .horse-header-warning {
                font-size: 0.5rem;
                letter-spacing: 1.5px;
            }
            
            .horse-header-title {
                font-size: 1.1rem;
                letter-spacing: 2px;
            }
            
            .horse-header-sub {
                font-size: 0.45rem;
                letter-spacing: 0.5px;
            }
            
            .horse-status-bar {
                gap: 14px;
            }
            
            .horse-status-item {
                font-size: 0.5rem;
                letter-spacing: 0.5px;
            }
        }
        
        @media (min-width: 480px) {
            .horse-header {
                margin-bottom: 28px;
            }
            
            .horse-header-warning {
                font-size: 0.625rem;
                letter-spacing: 2px;
                margin-bottom: 14px;
            }
            
            .horse-header-title {
                font-size: 1.4rem;
                letter-spacing: 4px;
                margin-bottom: 10px;
            }
            
            .horse-header-sub {
                font-size: 0.625rem;
                letter-spacing: 1px;
            }
            
            .horse-status-bar {
                gap: 20px;
                margin-bottom: 28px;
            }
            
            .horse-status-item {
                font-size: 0.6875rem;
                letter-spacing: 1px;
            }
        }
        
        .horse-status-value {
            color: #999;
        }
        
        .horse-status-unstable {
            color: #C0C0C0;
            animation: horseStatusPulse 1.5s ease-in-out infinite;
        }
        
        .horse-status-warning {
            color: #ff6b6b;
            animation: horseWarningPulse 1s ease-in-out infinite;
        }
        
        @keyframes horseStatusPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        @keyframes horseWarningPulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; text-shadow: 0 0 8px rgba(255, 107, 107, 0.5); }
        }
        
        .horse-logs-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .horse-log {
            background: rgba(192, 192, 192, 0.03);
            border: 1px solid rgba(192, 192, 192, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .horse-log:hover {
            border-color: rgba(192, 192, 192, 0.4);
            background: rgba(192, 192, 192, 0.06);
        }
        
        .horse-log::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(180deg, transparent, #C0C0C0, transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .horse-log.revealed::before {
            opacity: 1;
        }
        
        .horse-log-locked {
            padding: 28px 20px;
            text-align: center;
            transition: opacity 0.3s ease;
        }
        
        .horse-log.revealed .horse-log-locked {
            display: none;
        }
        
        .horse-log-icon {
            font-size: 1.75rem;
            color: #C0C0C0;
            margin-bottom: 10px;
            animation: horseIconPulse 2s ease-in-out infinite;
        }
        
        @keyframes horseIconPulse {
            0%, 100% { 
                text-shadow: 0 0 10px rgba(192, 192, 192, 0.3);
                opacity: 0.6;
            }
            50% { 
                text-shadow: 0 0 20px rgba(192, 192, 192, 0.6);
                opacity: 1;
            }
        }
        
        .horse-log-label {
            font-family: 'Space Mono', monospace;
            font-size: 0.6875rem;
            letter-spacing: 2px;
            color: #777;
        }
        
        .horse-log-content {
            display: none;
        }
        
        .horse-log.revealed .horse-log-content {
            display: block;
        }
        
        .horse-log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 18px;
            background: rgba(192, 192, 192, 0.08);
            border-bottom: 1px solid rgba(192, 192, 192, 0.1);
        }
        
        .horse-log-status {
            font-family: 'Space Mono', monospace;
            font-size: 0.6875rem;
            letter-spacing: 1px;
            color: #C0C0C0;
            text-shadow: 0 0 8px rgba(192, 192, 192, 0.5);
        }
        
        .horse-log-id {
            font-family: 'Space Mono', monospace;
            font-size: 0.625rem;
            letter-spacing: 1px;
            color: #777;
        }
        
        .horse-log-body {
            padding: 20px 18px;
        }
        
        .horse-log-title {
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            letter-spacing: 2px;
            color: #C0C0C0;
            margin-bottom: 6px;
        }
        
        .horse-log-date {
            font-family: 'Space Mono', monospace;
            font-size: 0.5625rem;
            letter-spacing: 1px;
            color: #666;
            margin-bottom: 18px;
        }
        
        .horse-log-text {
            font-family: 'Space Mono', monospace;
            font-size: 0.8125rem;
            line-height: 1.9;
            color: #aaa;
        }
        
        .horse-log-text em {
            color: #C0C0C0;
            font-style: normal;
        }
        
        .horse-log-signature {
            display: block;
            margin-top: 18px;
            color: var(--marcus);
            font-style: italic;
            text-shadow: 0 0 6px var(--marcus-glow);
        }
        
        .horse-signature-glitch {
            color: #ff6b6b !important;
            animation: horseSignatureGlitch 2s ease-in-out infinite;
        }
        
        /* Marcus-themed signature in anomaly logs */
        .horse-log-anomaly .horse-signature-glitch {
            color: var(--marcus) !important;
            text-shadow: 0 0 8px var(--marcus-glow);
        }
        
        @keyframes horseSignatureGlitch {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 0.4; }
            52% { opacity: 1; }
            54% { opacity: 0.3; }
        }
        
        .horse-log-footer {
            display: flex;
            justify-content: space-between;
            padding: 12px 18px;
            background: rgba(192, 192, 192, 0.05);
            border-top: 1px solid rgba(192, 192, 192, 0.1);
            font-family: 'Space Mono', monospace;
            font-size: 0.5625rem;
            letter-spacing: 1px;
            color: #666;
        }
        
        /* Responsive adjustments for larger screens */
        @media (min-width: 390px) {
            .horse-log-label {
                font-size: 0.75rem;
            }
            .horse-log-status {
                font-size: 0.75rem;
            }
            .horse-log-id {
                font-size: 0.6875rem;
            }
            .horse-log-title {
                font-size: 0.8125rem;
            }
            .horse-log-date {
                font-size: 0.625rem;
            }
            .horse-log-text {
                font-size: 0.875rem;
            }
            .horse-log-footer {
                font-size: 0.625rem;
            }
        }
        
        /* Corrupted LOG-003 styling */
        .horse-log-corrupted {
            border-color: rgba(255, 107, 107, 0.3);
        }
        
        .horse-log-corrupted:hover {
            border-color: rgba(255, 107, 107, 0.5);
        }
        
        .horse-log-corrupted::before {
            background: linear-gradient(180deg, transparent, #ff6b6b, transparent);
        }
        
        .horse-log-status-error {
            color: #ff6b6b !important;
            text-shadow: 0 0 8px rgba(255, 107, 107, 0.5) !important;
            animation: horseErrorGlitch 3s ease-in-out infinite;
        }
        
        .horse-status-glitch {
            color: var(--marcus) !important;
            text-shadow: 0 0 8px var(--marcus-glow) !important;
            animation: horseStatusGlitch 2.5s ease-in-out infinite;
        }
        
        @keyframes horseStatusGlitch {
            0%, 100% { opacity: 1; transform: translateX(0); }
            88% { opacity: 1; }
            89% { opacity: 0.3; transform: translateX(-1px); }
            90% { opacity: 0.8; transform: translateX(1px); }
            91% { opacity: 0.2; }
            92% { opacity: 1; transform: translateX(0); }
        }
        
        .horse-log-id-error {
            color: #ff6b6b !important;
        }
        
        @keyframes horseErrorGlitch {
            0%, 100% { transform: translateX(0); }
            92% { transform: translateX(0); }
            93% { transform: translateX(-2px); }
            94% { transform: translateX(2px); }
            95% { transform: translateX(-1px); }
            96% { transform: translateX(0); }
        }
        
        .horse-title-glitch {
            animation: horseTitleGlitch 4s ease-in-out infinite;
        }
        
        @keyframes horseTitleGlitch {
            0%, 100% { opacity: 1; }
            90% { opacity: 1; }
            91% { opacity: 0.5; }
            92% { opacity: 1; }
            93% { opacity: 0.3; }
            94% { opacity: 1; }
        }
        
        .horse-text-glitch {
            animation: horseTextGlitch 8s ease-in-out infinite;
        }
        
        @keyframes horseTextGlitch {
            0%, 100% { transform: translateX(0); }
            96% { transform: translateX(0); }
            97% { transform: translateX(-1px) skewX(-0.5deg); }
            98% { transform: translateX(1px) skewX(0.5deg); }
            99% { transform: translateX(0); }
        }
        
        .horse-footer-glitch {
            color: #ff6b6b !important;
            animation: horseFooterPulse 1.5s ease-in-out infinite;
        }
        
        /* Marcus-themed temporal anomaly log */
        .horse-log-anomaly {
            border-color: rgba(168, 232, 74, 0.3) !important;
        }
        
        .horse-log-anomaly:hover {
            border-color: rgba(168, 232, 74, 0.5) !important;
        }
        
        .horse-log-anomaly .horse-log-text {
            color: var(--marcus);
            text-shadow: 0 0 4px var(--marcus-glow);
        }
        
        .horse-log-anomaly .horse-log-footer {
            color: var(--marcus) !important;
            border-top-color: rgba(168, 232, 74, 0.2) !important;
            animation: horseAnomalyPulse 2s ease-in-out infinite;
        }
        
        @keyframes horseAnomalyPulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        @keyframes horseFooterPulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        
        .horse-page-footer {
            margin-top: 40px;
            text-align: center;
            padding-bottom: 40px;
        }
        
        .horse-back-btn {
            font-family: 'Space Mono', monospace;
            font-size: 0.8125rem;
            letter-spacing: 2px;
            color: #C0C0C0;
            background: transparent;
            border: 1px solid rgba(192, 192, 192, 0.3);
            padding: 14px 36px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .horse-back-btn:hover {
            background: rgba(192, 192, 192, 0.1);
            border-color: rgba(192, 192, 192, 0.6);
            text-shadow: 0 0 10px rgba(192, 192, 192, 0.5);
        }

        /* ============ DRAMATIC FINAL CHOICE SEQUENCE ============ */
        .final-sequence-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-primary);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-lg);
            padding-top: calc(var(--space-lg) + var(--safe-top));
            padding-bottom: calc(var(--space-lg) + var(--safe-bottom));
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.8s ease;
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        .final-sequence-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }
        
        /* Corner accents like title page */
        .final-sequence-overlay::before,
        .final-sequence-overlay::after {
            content: '';
            position: fixed;
            width: 40px;
            height: 40px;
            border: 1px solid var(--border);
            opacity: 0.3;
            pointer-events: none;
        }
        
        @media (min-width: 390px) {
            .final-sequence-overlay::before,
            .final-sequence-overlay::after {
                width: 56px;
                height: 56px;
            }
        }
        
        .final-sequence-overlay::before {
            top: calc(var(--space-md) + var(--safe-top));
            left: var(--space-md);
            border-right: none;
            border-bottom: none;
        }
        
        .final-sequence-overlay::after {
            bottom: calc(var(--space-md) + var(--safe-bottom));
            right: var(--space-md);
            border-left: none;
            border-top: none;
        }
        
        .final-sequence-header {
            text-align: center;
            flex-shrink: 0;
            padding-top: var(--space-md);
        }
        
        .final-sequence-sector {
            font-family: 'Space Mono', monospace;
            font-size: 0.625rem;
            letter-spacing: 0.3em;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-bottom: var(--space-xs);
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.15);
        }
        
        .final-sequence-protocol {
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            letter-spacing: 0.15em;
            color: var(--text-primary);
            text-shadow: 0 0 8px rgba(0, 0, 0, 0.12);
        }
        
        .final-sequence-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            max-width: 340px;
            padding: var(--space-lg) 0;
            position: relative;
        }
        
        .final-sequence-status {
            font-family: 'Space Mono', monospace;
            font-size: 0.5625rem;
            letter-spacing: 0.15em;
            color: var(--teal);
            text-transform: uppercase;
            margin-bottom: var(--space-lg);
            text-align: center;
            min-height: 1.2em;
            text-shadow: 0 0 12px var(--teal);
        }
        
        .final-sequence-typing {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-md);
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .final-sequence-typing.visible {
            opacity: 1;
        }
        
        .typing-name {
            font-family: 'Space Mono', monospace;
            font-size: 0.625rem;
            color: var(--amber);
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }
        
        .typing-dots {
            display: flex;
            gap: 3px;
        }
        
        .typing-dot {
            width: 4px;
            height: 4px;
            background: var(--amber);
            border-radius: 50%;
            animation: typingPulse 1.2s ease-in-out infinite;
        }
        
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typingPulse {
            0%, 60%, 100% { opacity: 0.3; transform: scale(0.8); }
            30% { opacity: 1; transform: scale(1); }
        }
        
        /* Letter content */
        .final-sequence-letter {
            text-align: center;
            margin-bottom: var(--space-md);
            opacity: 0;
            transition: opacity 0.5s ease;
            width: 100%;
        }
        
        .final-sequence-letter.visible {
            opacity: 1;
        }
        
        .final-block-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: var(--space-lg);
            position: relative;
        }
        
        .final-block {
            position: relative;
            border: none;
            background: transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }
        
        .final-block:hover:not(.revealed) {
            background: rgba(143, 164, 184, 0.03);
        }
        
        .final-block:active:not(.revealed) {
            transform: scale(0.99);
        }
        
        .final-block.revealed {
            cursor: default;
        }
        
        /* Glowing left accent bar - floating indicator */
        .final-block.revealed::after {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--vincent);
            box-shadow: 0 0 8px var(--vincent-glow), 0 0 16px var(--vincent-glow);
        }
        
        .final-block-locked {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: opacity 0.3s ease;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 3px,
                rgba(143, 164, 184, 0.03) 3px,
                rgba(143, 164, 184, 0.03) 6px
            );
        }
        
        .final-block.revealed .final-block-locked {
            opacity: 0;
            pointer-events: none;
        }
        
        .final-block-icon {
            font-size: 1.2rem;
            color: var(--vincent);
            opacity: 0.5;
            animation: iconPulse 2s ease-in-out infinite;
            text-shadow: 0 0 10px var(--vincent-glow);
        }
        
        .final-block-label {
            font-family: 'Space Mono', monospace;
            font-size: 0.5rem;
            letter-spacing: 0.2em;
            color: var(--text-ghost);
            text-transform: uppercase;
        }
        
        .final-block-content {
            opacity: 0;
            transition: all 0.4s ease;
            display: flex;
            flex-direction: column;
            text-align: left;
        }
        
        .final-block.revealed .final-block-content {
            opacity: 1;
        }
        
        /* Header bar - floating terminal style */
        .final-block-header {
            background: rgba(143, 164, 184, 0.08);
            border-bottom: none;
            padding: 12px 16px;
            font-family: 'Space Mono', monospace;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: blockHeaderFlicker 4s ease-in-out infinite;
        }
        
        @keyframes blockHeaderFlicker {
            0%, 100% { 
                background: rgba(143, 164, 184, 0.12);
            }
            35% { 
                background: rgba(143, 164, 184, 0.06);
            }
            36% { 
                background: rgba(143, 164, 184, 0.18);
            }
            80% {
                background: rgba(143, 164, 184, 0.12);
            }
        }
        
        .block-status {
            font-size: 0.6rem;
            letter-spacing: 1.5px;
            color: var(--vincent);
            text-shadow: 0 0 8px var(--vincent-glow);
            animation: breachFlicker 4s ease-in-out infinite;
        }
        
        .block-divider {
            color: var(--text-ghost);
            opacity: 0.4;
            font-size: 0.6rem;
            margin: 0 2px;
        }
        
        .block-id {
            font-size: 0.55rem;
            letter-spacing: 1.5px;
            color: var(--text-dim);
        }
        
        /* Message body */
        .final-block-body {
            padding: 18px 16px;
            text-align: left;
        }
        
        /* ============ TERMINAL MESSAGE CONTENT - INSTITUTIONAL STYLE ============ */
        .terminal-msg-content {
            font-family: 'Space Mono', monospace;
        }
        
        .msg-system-line {
            font-size: 0.55rem;
            letter-spacing: 0.2em;
            color: var(--text-dim);
            text-transform: uppercase;
            opacity: 0.8;
            margin-bottom: 2px;
        }
        
        .msg-system-sub {
            font-size: 0.45rem;
            letter-spacing: 0.15em;
            color: var(--text-dim);
            text-transform: uppercase;
            opacity: 0.4;
            margin-bottom: 8px;
        }
        
        .msg-timestamp {
            font-size: 0.5rem;
            color: var(--text-dim);
            opacity: 0.5;
            letter-spacing: 0.1em;
            margin-bottom: 12px;
        }
        
        .msg-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(143, 164, 184, 0.15), transparent);
            margin: 12px 0;
        }
        
        .msg-field {
            font-size: 0.6rem;
            letter-spacing: 0.1em;
            color: var(--text-secondary);
            margin-bottom: 6px;
            line-height: 1.5;
        }
        
        .msg-label {
            color: var(--text-dim);
            opacity: 0.6;
            margin-right: 8px;
        }
        
        .msg-field-sub {
            font-size: 0.5rem;
            letter-spacing: 0.1em;
            color: var(--text-dim);
            opacity: 0.5;
            margin-bottom: 8px;
            padding-left: 12px;
        }
        
        .msg-highlight-amber {
            color: var(--vincent);
            text-shadow: 0 0 6px var(--vincent-glow);
        }
        
        .msg-highlight-coral {
            color: var(--rabbit);
            text-shadow: 0 0 6px var(--rabbit-glow);
        }
        
        .msg-warning {
            font-size: 0.55rem;
            letter-spacing: 0.15em;
            color: var(--rabbit);
            text-shadow: 0 0 8px var(--rabbit-glow);
            margin-bottom: 4px;
        }
        
        .msg-note {
            font-size: 0.5rem;
            letter-spacing: 0.1em;
            color: var(--text-dim);
            opacity: 0.6;
        }
        
        /* MSG-003 Monster institutional styling */
        .monster-msg-content {
            margin-bottom: 12px;
        }
        
        .monster-system {
            color: var(--rabbit) !important;
            opacity: 1 !important;
            animation: monsterTextPulse 0.5s ease-in-out infinite;
        }
        
        .monster-sub {
            color: var(--rabbit) !important;
            opacity: 0.7 !important;
        }
        
        .monster-time {
            color: var(--rabbit) !important;
            opacity: 0.5 !important;
        }
        
        @keyframes monsterTextPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        /* Update header to show status and ID on opposite ends */
        .final-block-header {
            justify-content: space-between;
        }

        .final-letter-line {
            font-size: 0.85rem;
            line-height: 1.8;
            color: var(--vincent);
            text-shadow: 0 0 10px var(--vincent-glow);
            margin-bottom: 0;
            text-align: left;
        }
        
        /* Footer metadata - floating */
        .final-block-footer {
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            letter-spacing: 1.5px;
            color: var(--vincent);
            padding: 12px 16px;
            border-top: none;
            background: rgba(143, 164, 184, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-shadow: 0 0 6px var(--vincent-glow);
            animation: footerFlicker 3s ease-in-out infinite;
        }
        
        @keyframes footerFlicker {
            0%, 100% { 
                opacity: 0.8;
                background: rgba(143, 164, 184, 0.08);
            }
            25% { 
                opacity: 1;
                background: rgba(143, 164, 184, 0.12);
            }
            50% { 
                opacity: 0.6;
                background: rgba(143, 164, 184, 0.05);
            }
            75% { 
                opacity: 0.9;
                background: rgba(143, 164, 184, 0.1);
            }
        }
        
        .footer-left {
            opacity: 1;
        }
        
        .footer-right {
            opacity: 0.8;
        }
        
        /* Emphasis block (MSG-003) */
        .final-block-emphasis .final-letter-line {
            color: var(--amber);
            text-shadow: 0 0 12px var(--amber-glow);
            font-style: italic;
        }
        
        .final-block-emphasis .final-block-footer {
            justify-content: flex-end;
        }
        
        .final-block-emphasis .footer-right {
            color: var(--vincent);
            opacity: 0.7;
            font-style: italic;
            font-size: 0.55rem;
            letter-spacing: 1px;
        }
        
        /* ============ UPLOAD SEQUENCE MODAL ============ */
        .upload-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            animation: uploadModalFadeIn 0.5s ease forwards;
            padding: 16px;
            box-sizing: border-box;
        }
        
        @keyframes uploadModalFadeIn {
            to { opacity: 1; }
        }
        
        .upload-sequence {
            width: 100%;
            max-width: 400px;
            background: #0a0a0a;
            border: 1px solid #1a1a1a;
            border-radius: 8px;
            padding: 0;
            box-shadow: 
                0 0 60px rgba(0, 0, 0, 0.8),
                0 0 120px rgba(247, 220, 111, 0.1);
            transform: translateY(20px) scale(0.95);
            animation: uploadModalSlideIn 0.4s ease 0.2s forwards;
            overflow: hidden;
        }
        
        @keyframes uploadModalSlideIn {
            to { 
                transform: translateY(0) scale(1);
            }
        }
        
        .upload-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: linear-gradient(135deg, #d4a800 0%, #b8940a 100%);
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .upload-header-text {
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            letter-spacing: 1.5px;
            color: #0a0a0a;
            font-weight: 700;
        }
        
        .upload-header-blink {
            color: #0a0a0a;
            font-size: 0.8rem;
            animation: uploadBlink 0.5s ease-in-out infinite;
        }
        
        @keyframes uploadBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .upload-terminal {
            background: #050505;
            border: none;
            border-left: 2px solid #d4a800;
            margin: 12px;
            padding: 12px;
            height: 180px;
            overflow-y: auto;
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            line-height: 1.5;
            position: relative;
            border-radius: 4px;
        }
        
        /* Subtle scanlines */
        .upload-terminal::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent 0px,
                transparent 2px,
                rgba(255, 255, 255, 0.01) 2px,
                rgba(255, 255, 255, 0.01) 4px
            );
            pointer-events: none;
        }
        
        /* Remove old after pseudo-element */
        .upload-terminal::after {
            display: none;
        }
        
        .upload-line {
            margin-bottom: 3px;
            opacity: 0;
            animation: lineAppear 0.2s ease forwards;
        }
        
        @keyframes lineAppear {
            to { opacity: 1; }
        }
        
        .upload-line-normal { color: #888; }
        .upload-line-success { color: #00cc6a; font-weight: 500; }
        .upload-line-warning { color: #d4a800; font-weight: 500; }
        .upload-line-dim { color: #555; font-size: 0.55rem; }
        .upload-line-divider { color: #333; }
        .upload-line-progress { 
            color: #fff; 
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            font-weight: 500;
        }
        .upload-line-mega {
            color: #d4a800;
            font-size: 0.8rem;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(212, 168, 0, 0.5);
        }
        
        @keyframes megaPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .upload-line-final {
            color: #fff;
            font-weight: 500;
        }
        
        .upload-line-glitch {
            color: #e8707e;
            font-weight: 500;
        }
        
        .upload-progress-container {
            padding: 0 12px 12px;
        }
        
        .upload-progress-label {
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            letter-spacing: 2px;
            color: #666;
            margin-bottom: 8px;
        }
        
        .upload-progress-bar-bg {
            height: 24px;
            background: #111;
            border: 1px solid #2a2a2a;
            border-radius: 4px;
            padding: 3px;
        }
        
        .upload-progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(135deg, #d4a800 0%, #b8940a 50%, #d4a800 100%);
            border-radius: 2px;
            position: relative;
            overflow: hidden;
            transition: width 0.3s ease;
        }
        
        /* Flowing white lines on progress bar */
        .upload-progress-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 200%;
            height: 100%;
            background: repeating-linear-gradient(
                90deg,
                transparent 0px,
                transparent 15px,
                rgba(255, 255, 255, 0.15) 15px,
                rgba(255, 255, 255, 0.15) 17px
            );
            animation: progressFlow 1.5s linear infinite;
        }
        
        @keyframes progressFlow {
            0% { transform: translateX(0); }
            100% { transform: translateX(50%); }
        }
        
        .upload-progress-percent {
            font-family: 'Space Mono', monospace;
            font-size: 1.4rem;
            font-weight: bold;
            color: #fff;
            text-align: center;
            margin-top: 12px;
            letter-spacing: 3px;
            text-shadow: 0 0 20px rgba(212, 168, 0, 0.3);
        }
        
        .upload-status {
            font-family: 'Space Mono', monospace;
            font-size: 0.65rem;
            letter-spacing: 2px;
            color: #d4a800;
            text-align: center;
            padding: 12px;
            border-top: 1px solid #1a1a1a;
            font-weight: 500;
            animation: statusBlink 1.5s ease-in-out infinite;
            text-shadow: 0 0 10px rgba(212, 168, 0, 0.3);
        }
        
        @keyframes statusBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* ============ MSG BOX SUBTLE GLITCHES ============ */
        /* MSG-001 - Very subtle occasional glitch */
        .final-block:nth-child(1).revealed .final-block-content {
            animation: subtleGlitch1 8s ease-in-out infinite;
        }
        
        .final-block:nth-child(1).revealed .block-status,
        .final-block:nth-child(1).revealed .block-id {
            animation: subtleTextGlitch1 10s ease-in-out infinite;
        }
        
        @keyframes subtleGlitch1 {
            0%, 95%, 100% { transform: translateX(0); }
            96% { transform: translateX(-1px); }
            97% { transform: translateX(1px); }
            98% { transform: translateX(0); }
        }
        
        @keyframes subtleTextGlitch1 {
            0%, 93%, 100% { 
                text-shadow: none;
                transform: translateX(0);
            }
            94% { 
                text-shadow: 1px 0 var(--rabbit), -1px 0 var(--vincent);
                transform: translateX(1px);
            }
            95% { 
                text-shadow: -1px 0 var(--rabbit), 1px 0 var(--owen);
                transform: translateX(-1px);
            }
            96% {
                text-shadow: none;
                transform: translateX(0);
            }
        }
        
        /* MSG-002 - Slightly more frequent glitches */
        .final-block:nth-child(2).revealed .final-block-content {
            animation: subtleGlitch2 5s ease-in-out infinite;
        }
        
        .final-block:nth-child(2).revealed .block-status,
        .final-block:nth-child(2).revealed .block-id {
            animation: subtleTextGlitch2 6s ease-in-out infinite;
        }
        
        @keyframes subtleGlitch2 {
            0%, 90%, 100% { transform: translateX(0); opacity: 1; }
            91% { transform: translateX(-2px); opacity: 0.9; }
            93% { transform: translateX(2px); opacity: 0.95; }
            95% { transform: translateX(-1px); opacity: 1; }
        }
        
        @keyframes subtleTextGlitch2 {
            0%, 85%, 100% { 
                text-shadow: none;
                transform: translateX(0);
            }
            86% { 
                text-shadow: 2px 0 var(--rabbit), -2px 0 var(--vincent);
                transform: translateX(2px);
            }
            88% { 
                text-shadow: -2px 0 var(--rabbit), 2px 0 var(--owen);
                transform: translateX(-2px);
            }
            90% {
                text-shadow: 1px 0 var(--rabbit);
                transform: translateX(0);
            }
        }
        
        /* ============ MSG-003 PROGRESSIVE HORROR ============ */
        /* Starts calm, gets progressively more intense */
        .final-block-monster.revealed .monster-text-container {
            animation: monsterTextBuild 10s ease-in forwards;
        }
        
        @keyframes monsterTextBuild {
            0% { 
                filter: none;
                transform: scale(1);
            }
            30% {
                filter: none;
                transform: scale(1);
            }
            50% {
                filter: blur(0.3px);
                transform: scale(1.01);
            }
            70% {
                filter: blur(0.5px);
                transform: scale(1.02);
            }
            100% {
                filter: blur(0.3px);
                transform: scale(1);
            }
        }
        
        .final-block-monster.revealed .monster-word {
            opacity: 0;
            animation: monsterWordReveal 0.5s ease-out forwards;
        }
        
        .final-block-monster.revealed .monster-let {
            animation-delay: 2s;
        }
        
        .final-block-monster.revealed .monster-me {
            animation-delay: 3s;
        }
        
        .final-block-monster.revealed .monster-out {
            animation-delay: 4s;
        }
        
        @keyframes monsterWordReveal {
            0% { 
                opacity: 0;
                transform: scale(2);
                filter: blur(10px);
            }
            50% {
                opacity: 1;
                transform: scale(1.3);
                filter: blur(2px);
            }
            100% { 
                opacity: 1;
                transform: scale(1);
                filter: blur(0);
                animation: wordPulse 0.5s ease-in-out infinite, wordGlitch 0.08s ease-in-out infinite;
            }
        }
        
        /* Overflow text appears progressively */
        .final-block-monster.revealed .monster-overflow {
            opacity: 0;
        }
        
        .final-block-monster.revealed .monster-overflow-top {
            animation: overflowAppear 1s ease-out 5s forwards, overflowFade 3s ease-in-out 6s infinite;
        }
        
        .final-block-monster.revealed .monster-overflow-left {
            animation: overflowAppear 1s ease-out 6s forwards, overflowFade 3s ease-in-out 7s infinite;
        }
        
        .final-block-monster.revealed .monster-overflow-right {
            animation: overflowAppear 1s ease-out 6.5s forwards, overflowFade 3s ease-in-out 7.5s infinite;
        }
        
        .final-block-monster.revealed .monster-overflow-bottom {
            animation: overflowAppear 1s ease-out 7s forwards, overflowFade 3s ease-in-out 8s infinite;
        }
        
        @keyframes overflowAppear {
            0% {
                opacity: 0;
                filter: blur(5px);
            }
            100% {
                opacity: 0.7;
                filter: blur(0);
            }
        }
        
        /* Shake intensifies over time */
        .final-block-monster.revealed .final-block-content {
            animation: monsterShakeProgressive 10s ease-in forwards;
        }
        
        @keyframes monsterShakeProgressive {
            0%, 30% { transform: translateX(0); }
            32% { transform: translateX(-1px); }
            34% { transform: translateX(1px); }
            36%, 50% { transform: translateX(0); }
            52% { transform: translateX(-1px); }
            53% { transform: translateX(1px); }
            54% { transform: translateX(-2px); }
            55% { transform: translateX(2px); }
            56%, 70% { transform: translateX(0); }
            71% { transform: translateX(-2px); }
            72% { transform: translateX(2px); }
            73% { transform: translateX(-2px); }
            74% { transform: translateX(2px); }
            75% { transform: translateX(-1px); }
            76%, 100% { 
                transform: translateX(0);
                animation: monsterShake 0.15s ease-in-out infinite;
            }
        }
        
        /* Pulse intensifies */
        .final-block-monster.revealed .monster-pulse {
            animation: monsterPulseProgressive 10s ease-in forwards;
        }
        
        /* MSG-003 Flicker out effect */
        @keyframes flickerOut {
            0% { opacity: 1; transform: scaleY(1); }
            10% { opacity: 0.8; transform: scaleY(0.98); }
            20% { opacity: 1; transform: scaleY(1); }
            30% { opacity: 0.6; transform: scaleY(0.95); }
            40% { opacity: 0.9; transform: scaleY(1); }
            50% { opacity: 0.4; transform: scaleY(0.9); }
            60% { opacity: 0.7; transform: scaleY(0.95); }
            70% { opacity: 0.2; transform: scaleY(0.8); }
            80% { opacity: 0.5; transform: scaleY(0.85); }
            90% { opacity: 0.1; transform: scaleY(0.5); }
            100% { opacity: 0; transform: scaleY(0); height: 0; margin: 0; padding: 0; }
        }
        
        .final-block-monster.flicker-out {
            animation: flickerOut 1.5s ease-out forwards;
            overflow: hidden;
        }
        
        .final-block-monster.hidden-complete {
            display: none !important;
        }
        
        @keyframes monsterPulseProgressive {
            0%, 40% { opacity: 0; }
            50% { opacity: 0.05; }
            70% { opacity: 0.1; }
            100% { 
                opacity: 0;
                animation: monsterPulse 1.5s ease-in-out infinite;
            }
        }
        
        /* Header corruption intensifies */
        .final-block-monster.revealed .monster-header {
            animation: headerCorruptProgressive 8s ease-in forwards;
        }
        
        @keyframes headerCorruptProgressive {
            0%, 50% { 
                transform: translateX(0);
                filter: none;
            }
            60% {
                transform: translateX(-1px);
                filter: blur(0.5px);
            }
            70% {
                transform: translateX(1px);
                filter: none;
            }
            80%, 100% {
                animation: headerGlitch 0.3s ease-in-out infinite;
            }
        }
        
        /* ============ MONSTER MSG-003 STYLES ============ */
        .final-block-monster {
            position: relative;
            overflow: visible !important;
        }
        
        .final-block-monster.revealed .final-block-content {
            overflow: visible !important;
            animation: monsterReveal 0.5s ease forwards, monsterShake 0.15s ease-in-out infinite;
        }
        
        .final-block-monster.revealed {
            z-index: 100;
        }
        
        @keyframes monsterReveal {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        
        @keyframes monsterShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }
        
        .monster-header {
            animation: headerGlitch 0.3s ease-in-out infinite;
        }
        
        @keyframes headerGlitch {
            0%, 90%, 100% { transform: translateX(0); opacity: 1; }
            92% { transform: translateX(-3px); opacity: 0.8; }
            94% { transform: translateX(3px); opacity: 0.9; }
            96% { transform: translateX(-1px); opacity: 1; }
        }
        
        .monster-status, .monster-id {
            color: var(--rabbit) !important;
            text-shadow: 
                0 0 10px var(--rabbit-glow),
                2px 0 var(--vincent),
                -2px 0 var(--owen);
            animation: textGlitch 0.1s ease-in-out infinite;
        }
        
        @keyframes textGlitch {
            0%, 100% { 
                text-shadow: 0 0 10px var(--rabbit-glow), 2px 0 var(--vincent), -2px 0 var(--owen);
                transform: translateX(0);
            }
            25% { 
                text-shadow: 0 0 15px var(--rabbit-glow), -2px 0 var(--owen), 2px 0 var(--vincent);
                transform: translateX(1px);
            }
            50% { 
                text-shadow: 0 0 8px var(--rabbit-glow), 3px 0 var(--vincent), -1px 0 var(--owen);
                transform: translateX(-1px);
            }
            75% { 
                text-shadow: 0 0 20px var(--rabbit-glow), -1px 0 var(--vincent), 3px 0 var(--owen);
                transform: translateX(0);
            }
        }
        
        .monster-body {
            position: relative;
            padding: 30px 20px !important;
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: visible !important;
        }
        
        .monster-text-container {
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
            letter-spacing: 2px;
            line-height: 1.4;
            color: var(--text-dim);
            text-align: center;
            position: relative;
            z-index: 2;
        }
        
        .monster-line {
            animation: lineFlicker 2s ease-in-out infinite;
            opacity: 0.6;
        }
        
        .monster-line-1 { animation-delay: 0s; }
        .monster-line-2 { animation-delay: 0.2s; }
        .monster-line-3 { animation-delay: 0.4s; }
        .monster-line-4 { animation-delay: 0.6s; }
        .monster-line-5 { animation-delay: 0.8s; }
        
        @keyframes lineFlicker {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.7; }
            52% { opacity: 0.3; }
            54% { opacity: 0.6; }
        }
        
        .monster-word {
            color: var(--rabbit);
            font-size: 1.1rem;
            font-weight: bold;
            text-shadow: 
                0 0 20px var(--rabbit-glow),
                0 0 40px var(--rabbit-glow),
                3px 0 var(--vincent),
                -3px 0 var(--owen);
            animation: wordPulse 0.5s ease-in-out infinite, wordGlitch 0.08s ease-in-out infinite;
            display: inline-block;
        }
        
        .monster-let { animation-delay: 0s; }
        .monster-me { animation-delay: 0.15s; }
        .monster-out { animation-delay: 0.3s; }
        
        @keyframes wordPulse {
            0%, 100% { 
                transform: scale(1);
                text-shadow: 0 0 20px var(--rabbit-glow), 0 0 40px var(--rabbit-glow), 3px 0 var(--vincent), -3px 0 var(--owen);
            }
            50% { 
                transform: scale(1.1);
                text-shadow: 0 0 30px var(--rabbit-glow), 0 0 60px var(--rabbit-glow), 4px 0 var(--vincent), -4px 0 var(--owen);
            }
        }
        
        @keyframes wordGlitch {
            0%, 100% { transform: translate(0, 0) scale(1); }
            20% { transform: translate(-2px, 1px) scale(1.02); }
            40% { transform: translate(2px, -1px) scale(0.98); }
            60% { transform: translate(1px, 2px) scale(1.01); }
            80% { transform: translate(-1px, -2px) scale(0.99); }
        }
        
        /* Overflow text that spills outside the box */
        .monster-overflow {
            position: absolute;
            font-family: 'Space Mono', monospace;
            font-size: 0.8rem;
            color: var(--rabbit);
            opacity: 0;
            white-space: nowrap;
            text-shadow: 
                0 0 15px var(--rabbit-glow),
                2px 0 var(--vincent),
                -2px 0 var(--owen);
            pointer-events: none;
            z-index: 1;
        }
        
        .final-block-monster.revealed .monster-overflow {
            animation: overflowFade 3s ease-in-out infinite;
        }
        
        .monster-overflow-left {
            left: -80px;
            top: 50%;
            transform: translateY(-50%) rotate(-90deg);
            animation-delay: 0.5s !important;
        }
        
        .monster-overflow-right {
            right: -80px;
            top: 50%;
            transform: translateY(-50%) rotate(90deg);
            animation-delay: 1s !important;
        }
        
        .monster-overflow-top {
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1rem;
            letter-spacing: 8px;
            animation-delay: 0s !important;
        }
        
        .monster-overflow-bottom {
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.6rem;
            letter-spacing: 3px;
            animation-delay: 1.5s !important;
        }
        
        @keyframes overflowFade {
            0%, 100% { opacity: 0; }
            20%, 80% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        /* Pulsing background effect */
        .monster-pulse {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 200%;
            height: 200%;
            transform: translate(-50%, -50%);
            background: radial-gradient(circle, var(--rabbit-glow) 0%, transparent 70%);
            opacity: 0;
            pointer-events: none;
            z-index: 0;
        }
        
        .final-block-monster.revealed .monster-pulse {
            animation: monsterPulse 1.5s ease-in-out infinite;
        }
        
        @keyframes monsterPulse {
            0%, 100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            50% { opacity: 0.15; transform: translate(-50%, -50%) scale(1.2); }
        }
        
        .monster-footer {
            background: rgba(255, 138, 128, 0.1) !important;
            border-top: 1px solid var(--rabbit) !important;
            justify-content: center !important;
        }
        
        .monster-footer-text {
            color: var(--rabbit) !important;
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            letter-spacing: 3px;
            text-shadow: 0 0 10px var(--rabbit-glow);
            animation: footerPulse 0.8s ease-in-out infinite;
        }
        
        @keyframes footerPulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        /* Screen shake when monster revealed */
        @keyframes screenShake {
            0%, 100% { transform: translate(0, 0); }
            10% { transform: translate(-3px, -2px); }
            20% { transform: translate(3px, 2px); }
            30% { transform: translate(-2px, 3px); }
            40% { transform: translate(2px, -3px); }
            50% { transform: translate(-3px, 2px); }
            60% { transform: translate(3px, -2px); }
            70% { transform: translate(-2px, -3px); }
            80% { transform: translate(2px, 3px); }
            90% { transform: translate(-3px, -2px); }
        }
        
        .screen-shake {
            animation: screenShake 0.5s ease-in-out;
        }
        
        /* Scanline intensify on monster */
        .final-block-monster.revealed::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.1) 0px,
                rgba(0, 0, 0, 0.1) 1px,
                transparent 1px,
                transparent 2px
            );
            pointer-events: none;
            z-index: 10;
            animation: scanlineFlicker 0.1s infinite;
        }
        
        @keyframes scanlineFlicker {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 0.8; }
        }
        
        @media (min-width: 390px) {
            .final-block-container {
                gap: 24px;
            }
            
            .final-block-header {
                padding: 14px 20px;
            }
            
            .block-status {
                font-size: 0.65rem;
                letter-spacing: 2px;
            }
            
            .block-id {
                font-size: 0.6rem;
                letter-spacing: 2px;
            }
            
            .final-block-body {
                padding: 22px 20px;
            }
            
            .final-letter-line {
                font-size: 0.9rem;
                line-height: 1.85;
            }
            
            .final-block-footer {
                padding: 14px 20px;
                font-size: 0.55rem;
            }
        }
        
        /* Decrypt Animation */
        .final-block.decrypting {
            pointer-events: none;
            border-color: var(--vincent);
            box-shadow: 0 0 15px rgba(77, 148, 255, 0.3);
        }
        
        .decrypt-terminal {
            padding: 8px;
            text-align: left;
        }
        
        .decrypt-line {
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            color: var(--vincent);
            letter-spacing: 0.5px;
            margin-bottom: 4px;
            opacity: 0.8;
        }
        
        .decrypt-progress-container {
            width: 100%;
            height: 6px;
            background: rgba(77, 148, 255, 0.15);
            border: 1px solid rgba(77, 148, 255, 0.3);
            margin: 8px 0 4px 0;
            overflow: hidden;
        }
        
        .decrypt-progress-bar {
            height: 100%;
            width: 0%;
            background: var(--vincent);
            box-shadow: 0 0 8px var(--vincent);
            transition: width 0.08s linear;
        }
        
        .decrypt-status {
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            color: var(--vincent);
            letter-spacing: 1px;
            text-align: center;
        }
        
        .final-sequence-instruction {
            margin-bottom: var(--space-md);
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .final-sequence-instruction.visible {
            opacity: 1;
        }
        
        .final-sequence-instruction.hidden {
            opacity: 0;
        }
        
        .instruction-text {
            font-family: 'Space Mono', monospace;
            font-size: 0.5625rem;
            letter-spacing: 0.15em;
            color: var(--text-dim);
            text-transform: uppercase;
        }
        
        .final-letter-typing-container {
            display: flex;
            justify-content: center;
            align-items: baseline;
            margin: var(--space-lg) 0 var(--space-sm);
            min-height: 2.5rem;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .final-letter-typing-container.visible {
            opacity: 1;
        }
        
        .final-letter-plea {
            font-family: 'Space Mono', monospace;
            font-size: 2rem;
            color: var(--text-bright);
            font-style: italic;
            text-shadow: 
                0 0 10px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(0, 0, 0, 0.25),
                0 0 40px rgba(0, 0, 0, 0.18),
                0 0 60px rgba(0, 0, 0, 0.15);
            animation: pleaGlow 2s ease-in-out infinite;
        }
        
        @keyframes pleaGlow {
            0%, 100% {
                text-shadow: 
                    0 0 10px rgba(0, 0, 0, 0.3),
                    0 0 20px rgba(0, 0, 0, 0.25),
                    0 0 40px rgba(0, 0, 0, 0.18),
                    0 0 60px rgba(0, 0, 0, 0.15);
            }
            50% {
                text-shadow: 
                    0 0 15px rgba(0, 0, 0, 0.35),
                    0 0 30px rgba(0, 0, 0, 0.25),
                    0 0 50px rgba(0, 0, 0, 0.2),
                    0 0 80px rgba(0, 0, 0, 0.15);
            }
        }
        
        @media (min-width: 390px) {
            .final-letter-plea {
                font-size: 2.25rem;
            }
        }
        
        .typing-cursor {
            font-family: 'Space Mono', monospace;
            font-size: 2rem;
            color: var(--text-bright);
            animation: cursorBlink 0.6s ease-in-out infinite;
            margin-left: 2px;
            opacity: 0;
        }
        
        .typing-cursor.visible {
            opacity: 1;
        }
        
        .typing-cursor.hidden {
            opacity: 0;
            animation: none;
        }
        
        @keyframes cursorBlink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .final-letter-signature {
            font-family: 'Space Mono', monospace;
            font-size: 0.625rem;
            color: var(--text-dim);
            font-style: italic;
            letter-spacing: 0.1em;
            opacity: 0;
            transition: opacity 0.4s ease;
            margin-top: var(--space-sm);
        }
        
        .final-letter-signature.visible {
            opacity: 0.6;
        }
        
        .final-sequence-timer-container {
            text-align: center;
            margin-bottom: var(--space-sm);
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .final-sequence-timer-container.visible {
            opacity: 1;
        }
        
        .final-sequence-timer-label {
            font-family: 'Space Mono', monospace;
            font-size: 0.5625rem;
            letter-spacing: 0.2em;
            color: var(--text-dim);
            text-transform: uppercase;
            margin-bottom: var(--space-xs);
        }
        
        .final-sequence-timer {
            font-family: 'Space Mono', monospace;
            font-size: 1.75rem;
            color: var(--text-secondary);
            letter-spacing: 0.1em;
            text-shadow: 0 0 15px rgba(0, 0, 0, 0.15);
        }
        
        .final-sequence-timer.urgent {
            color: var(--coral);
            animation: timerPulse 0.5s ease-in-out infinite;
            text-shadow: 0 0 20px var(--coral);
        }
        
        @keyframes timerPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .final-sequence-buttons {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            width: 100%;
            opacity: 0;
            transform: translateY(15px);
            transition: all 0.5s ease;
        }
        
        .final-sequence-buttons.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .final-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 72px;
            padding: var(--space-lg) var(--space-xl);
            font-family: 'Space Mono', monospace;
            cursor: pointer;
            text-align: center;
            -webkit-tap-highlight-color: transparent;
            position: relative;
            overflow: hidden;
            border-radius: 14px;
            transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .final-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.4) 0%, transparent 100%);
            border-radius: 12px 12px 0 0;
            pointer-events: none;
        }
        
        .final-btn:active {
            transform: scale(0.96) translateY(2px);
        }
        
        .final-btn-label {
            font-size: 0.5rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            margin-bottom: 4px;
            opacity: 0.7;
        }
        
        .final-btn-main {
            font-size: 0.875rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            margin-bottom: 4px;
            font-weight: 600;
        }
        
        .final-btn-sub {
            font-size: 0.5rem;
            letter-spacing: 0.08em;
            opacity: 0.6;
        }
        
        .final-btn-forward {
            background: linear-gradient(180deg, #fef3e8 0%, #fce8d8 100%);
            border: 2px solid #e8d4c4;
            color: #7a6050;
            box-shadow: 
                0 4px 0 #d4c0b0,
                0 6px 16px rgba(232, 180, 126, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
        }
        
        .final-btn-forward:hover {
            background: linear-gradient(180deg, #fff8f0 0%, #fcece0 100%);
            box-shadow: 
                0 6px 0 #d4c0b0,
                0 8px 20px rgba(232, 180, 126, 0.25),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
            transform: translateY(-2px);
        }
        
        .final-btn-forward:active {
            box-shadow: 
                0 2px 0 #d4c0b0,
                0 3px 8px rgba(232, 180, 126, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
        }
        
        .final-btn-forward .final-btn-label {
            color: #9a8a7a;
        }
        
        .final-btn-forward .final-btn-main {
            color: #6a5a4a;
        }
        
        .final-btn-submit {
            background: linear-gradient(180deg, #f8f6f4 0%, #f0eeec 100%);
            border: 2px solid #e0dcd8;
            color: #888480;
            box-shadow: 
                0 4px 0 #d0ccc8,
                0 6px 12px rgba(0, 0, 0, 0.06),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
        }
        
        .final-btn-submit:hover {
            background: linear-gradient(180deg, #fcfaf8 0%, #f4f2f0 100%);
            border-color: #d8d4d0;
            color: #686460;
            box-shadow: 
                0 6px 0 #d0ccc8,
                0 8px 16px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
            transform: translateY(-2px);
        }
        
        .final-btn-submit:active {
            box-shadow: 
                0 2px 0 #d0ccc8,
                0 3px 8px rgba(0, 0, 0, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
        }
        
        .final-btn-submit .final-btn-label {
            color: #a8a4a0;
        }
        
        .final-sequence-footer {
            text-align: center;
            flex-shrink: 0;
            padding-bottom: var(--space-sm);
        }
        
        .final-sequence-trace {
            font-family: 'Space Mono', monospace;
            font-size: 0.4375rem;
            letter-spacing: 0.1em;
            color: #b8b4b0;
            text-transform: uppercase;
        }
        
        .final-sequence-trace-status {
            color: #7ab89a;
        }
        
        .final-sequence-expired {
            text-align: center;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .final-sequence-expired.visible {
            opacity: 1;
        }
        
        .expired-message {
            font-family: 'Space Mono', monospace;
            font-size: 1.125rem;
            color: var(--coral);
            letter-spacing: 0.15em;
            margin-bottom: var(--space-xs);
        }
        
        .expired-sub {
            font-family: 'Space Mono', monospace;
            font-size: 0.5rem;
            color: var(--text-dim);
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        /* ============ BREAK PAGE ============ */
        .break-page {
            text-align: center;
        }

        .break-header {
            margin-bottom: 36px;
        }

        .break-icon {
            font-size: 1.5rem;
            color: var(--text-dim);
            margin-bottom: 20px;
            animation: glowPulse 2.5s infinite;
        }

        .break-header h2 {
            font-family: 'Space Mono', monospace;
            font-size: 0.8rem;
            color: var(--text-bright);
            letter-spacing: 4px;
            margin-bottom: 8px;
            text-transform: uppercase;
            font-weight: 400;
            text-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }

        .break-subtitle {
            font-size: 0.65rem;
            color: var(--text-dim);
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .break-notice {
            padding: 24px;
            margin: 28px 0;
            border: 1px solid var(--border);
            background: var(--bg-secondary);
        }

        .break-notice p {
            margin: 8px 0;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .break-notice strong {
            color: var(--text-bright);
            font-weight: 400;
        }

        .break-rules {
            text-align: left;
            padding: 16px 20px;
            margin: 24px 0;
            border-left: 2px solid var(--text-secondary);
            background: rgba(0, 0, 0, 0.03);
        }

        .rule-header {
            font-family: 'Space Mono', monospace;
            font-size: 0.8rem;
            color: var(--text-bright);
            letter-spacing: 3px;
            margin-bottom: 10px;
        }

        .break-rules p {
            margin: 0;
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-primary);
            line-height: 1.9;
        }

        .break-rules strong {
            color: var(--text-bright);
            font-weight: 400;
        }

        .break-options {
            margin: 36px 0;
        }

        .break-options-header {
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-bright);
            letter-spacing: 3px;
            margin-bottom: 20px;
            text-transform: uppercase;
            text-align: center;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .break-option {
            display: flex;
            align-items: flex-start;
            text-align: left;
            padding: 20px;
            margin: 12px 0;
            border: 2px solid var(--text-dim);
            background: rgba(0, 0, 0, 0.03);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            animation: btnBreathe 3s ease-in-out infinite;
        }

        .break-option::before {
            content: '>';
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1rem;
            color: var(--text-dim);
            transition: all 0.2s ease;
        }

        .break-option:hover {
            border-color: var(--text-bright);
            background: rgba(0, 0, 0, 0.06);
            animation: none;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }

        .break-option:hover::before {
            color: var(--text-bright);
            transform: translateY(-50%) translateX(3px);
        }

        .break-option.selected {
            border-color: var(--text-bright);
            background: rgba(0, 0, 0, 0.08);
            animation: none;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.12);
        }

        .break-option.selected::before {
            content: '✓';
            color: var(--text-bright);
            font-size: 1.2rem;
        }

        .break-option.selected .option-letter {
            color: var(--text-bright);
        }

        .option-letter {
            font-family: 'Space Mono', monospace;
            font-size: 1.5rem;
            color: var(--text-bright);
            margin-right: 16px;
            min-width: 24px;
            text-shadow: 0 0 10px rgba(248, 244, 236, 0.3);
        }

        .option-title {
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-bright);
            letter-spacing: 1px;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .option-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.8;
        }

        .break-activity {
            margin: 36px 0;
            animation: fadeIn 0.5s ease;
        }
        
        /* Snake Game Modal for Break 2 */
        .snake-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        
        .snake-modal-container {
            background: #0a0a0a;
            border: 1px solid #1a1a1a;
            border-radius: 12px;
            padding: 16px;
            position: relative;
            max-width: 360px;
            width: 94%;
            box-shadow: 0 0 60px rgba(0, 0, 0, 0.8), 
                        0 0 100px rgba(0, 255, 136, 0.05);
        }
        
        .snake-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            gap: 8px;
        }
        
        .snake-modal-title {
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            color: #555;
            letter-spacing: 1.5px;
            white-space: nowrap;
            flex-shrink: 1;
            overflow: hidden;
        }
        
        .snake-modal-buttons {
            display: flex;
            gap: 6px;
            flex-shrink: 0;
        }
        
        .snake-modal-btn {
            background: #111;
            border: 1px solid #2a2a2a;
            color: #666;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            letter-spacing: 0.5px;
            transition: all 0.2s ease;
        }
        
        .snake-modal-btn:hover {
            border-color: #00ff88;
            color: #00ff88;
            background: rgba(0, 255, 136, 0.08);
        }
        
        .snake-modal-btn.close-btn:hover {
            border-color: #ff6b6b;
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.08);
        }
        
        /* Snake game board - dark theme, no white border */
        .snake-modal-container .snake-container {
            background: #0a0a0a;
            border: 1px solid #1a1a1a;
            border-radius: 8px;
            padding: 0;
            margin: 0 auto 12px;
            position: relative;
            overflow: hidden;
        }
        
        .snake-modal-container #breakSnakeCanvas {
            display: block;
            background: #050505;
            border-radius: 6px;
            width: 100%;
            height: auto;
            aspect-ratio: 1;
        }
        
        /* Score row styling */
        .snake-modal-container .game-score-row {
            display: flex;
            justify-content: center;
            gap: 24px;
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            color: #555;
            letter-spacing: 2px;
            margin-bottom: 16px;
        }
        
        .snake-modal-container .game-score-row span span {
            color: #00ff88;
            text-shadow: 0 0 8px rgba(0, 255, 136, 0.4);
        }
        
        /* D-pad controls - bigger, colored, better spacing */
        .snake-modal-container .game-controls {
            margin: 0;
            touch-action: manipulation;
        }
        
        .snake-modal-container .game-controls-row {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin: 4px 0;
        }
        
        .snake-modal-container .game-btn {
            width: 64px;
            height: 56px;
            background: linear-gradient(145deg, #151515, #0d0d0d);
            border: 1px solid #2a2a2a;
            border-radius: 8px;
            color: #00cc6a;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.1s ease;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            text-shadow: 0 0 8px rgba(0, 204, 106, 0.3);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3),
                        inset 0 1px 0 rgba(255, 255, 255, 0.03);
        }
        
        .snake-modal-container .game-btn:hover {
            border-color: #00ff88;
            color: #00ff88;
            background: linear-gradient(145deg, #1a1a1a, #111);
            text-shadow: 0 0 12px rgba(0, 255, 136, 0.5);
        }
        
        .snake-modal-container .game-btn:active {
            background: linear-gradient(145deg, #0d0d0d, #151515);
            border-color: #00ff88;
            color: #00ff88;
            transform: scale(0.95);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.4),
                        inset 0 2px 4px rgba(0, 0, 0, 0.2),
                        0 0 20px rgba(0, 255, 136, 0.2);
        }
        
        /* Make horizontal buttons wider for easier access */
        .snake-modal-container .game-controls-row:last-child .game-btn {
            width: 72px;
        }
        
        .snake-modal-close {
            display: none; /* Hidden - using button instead */
        }

        .quiet-instructions {
            padding: 28px;
            margin-bottom: 28px;
            border: 1px solid var(--border);
            background: var(--bg-secondary);
        }

        .quiet-instructions p {
            margin: 8px 0;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .break-timer-display {
            margin: 36px 0;
            position: relative;
        }

        .timer-label {
            font-size: 0.65rem;
            color: var(--text-dim);
            letter-spacing: 3px;
            margin-bottom: 12px;
            text-transform: uppercase;
        }

        .timer-large {
            font-family: 'Space Mono', monospace;
            font-size: 3.5rem;
            color: var(--text-bright);
            letter-spacing: 8px;
            animation: crtTimerFlicker 3s infinite;
        }
        
        @keyframes crtTimerFlicker {
            0%, 100% { 
                text-shadow: 
                    1px 0 2px rgba(0, 200, 255, 0.5), 
                    -1px 0 2px rgba(255, 50, 100, 0.4), 
                    0 0 20px rgba(248, 244, 236, 0.2); 
            }
            25% { 
                text-shadow: 
                    2px 0 2px rgba(0, 200, 255, 0.5), 
                    -2px 0 2px rgba(255, 50, 100, 0.4), 
                    0 0 20px rgba(248, 244, 236, 0.2); 
            }
            50% { 
                text-shadow: 
                    0.5px 0 2px rgba(0, 200, 255, 0.5), 
                    -0.5px 0 2px rgba(255, 50, 100, 0.4), 
                    0 0 20px rgba(248, 244, 236, 0.2); 
            }
            75% { 
                text-shadow: 
                    1.5px 0 2px rgba(0, 200, 255, 0.5), 
                    -1.5px 0 2px rgba(255, 50, 100, 0.4), 
                    0 0 20px rgba(248, 244, 236, 0.2); 
            }
        }

        .break-tip {
            margin-top: 36px;
            font-size: 0.8rem;
            color: var(--text-dim);
            font-style: italic;
            line-height: 1.9;
        }

        .story-container {
            text-align: left;
            padding: 32px 28px;
            border: 1px solid var(--border);
            background: var(--bg-secondary);
        }

        .story-header {
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            color: var(--text-dim);
            letter-spacing: 2px;
            margin-bottom: 12px;
            text-align: center;
        }

        .story-title {
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-bright);
            letter-spacing: 2px;
            margin-bottom: 28px;
            text-align: center;
            text-transform: uppercase;
        }

        .story-content {
            line-height: 2.1;
            color: var(--text-primary);
        }

        .story-content p {
            margin: 20px 0;
            font-size: 0.85rem;
        }

        @media (min-width: 480px) {
            .story-content p {
                font-size: 0.9rem;
            }
        }

        @media (min-width: 768px) {
            .story-content p {
                font-size: 0.92rem;
            }
        }

        .story-moral {
            margin-top: 32px;
            padding: 20px;
            background: var(--amber-subtle);
            border-left: 2px solid var(--amber);
            color: var(--amber);
            font-size: 0.85rem;
            line-height: 2;
        }

        @media (min-width: 480px) {
            .story-moral {
                font-size: 0.9rem;
            }
        }

        @media (min-width: 768px) {
            .story-moral {
                font-size: 0.92rem;
                line-height: 2.2;
            }
        }

        .story-moral strong {
            color: var(--amber-bright);
            font-weight: 400;
        }

        .story-footer {
            margin-top: 28px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
            font-size: 0.7rem;
            color: var(--text-dim);
            text-align: center;
            line-height: 1.8;
        }

        /* Blackjack Game Styles */
        /* ============ BLACKJACK GAME - POKER CHIP REDESIGN ============ */
        .blackjack-container {
            max-width: 500px;
            margin: 0 auto;
            font-family: 'Space Mono', monospace;
        }
        
        /* Header with balance */
        .bj-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-light);
            margin-bottom: 16px;
        }
        
        .bj-header-title {
            font-size: 0.8rem;
            letter-spacing: 2px;
            color: var(--text-secondary);
        }
        
        .bj-header-balance {
            font-size: 1.1rem;
            font-weight: bold;
            color: #2d8a6e;
            letter-spacing: 1px;
        }
        
        .bj-header-balance.negative {
            color: #c94a4a;
        }
        
        /* Game table */
        .bj-table {
            background: var(--bg-elevated);
            border: 1px solid var(--border-light);
            padding: 20px;
            margin-bottom: 16px;
        }
        
        .bj-hand {
            margin-bottom: 20px;
        }
        
        .bj-hand:last-child {
            margin-bottom: 0;
        }
        
        .bj-hand-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .bj-hand-label {
            font-size: 0.65rem;
            color: var(--text-secondary);
            letter-spacing: 2px;
        }
        
        .bj-hand-value {
            font-size: 0.75rem;
            color: var(--text-bright);
            font-weight: bold;
        }
        
        .bj-cards {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            min-height: 70px;
        }
        
        .bj-divider {
            height: 1px;
            background: var(--border-light);
            margin: 16px 0;
        }

        .cards {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            min-height: 60px;
            margin-bottom: 8px;
        }

        .card {
            background: var(--bg-primary);
            border: 1px solid var(--text-secondary);
            padding: 8px 10px;
            font-family: 'Space Mono', monospace;
            font-size: 1.2rem;
            color: var(--text-bright);
            min-width: 48px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }
        
        .card-value {
            font-size: 1.1rem;
            font-weight: bold;
        }
        
        .card-suit {
            font-size: 1.3rem;
            line-height: 1;
        }

        .card.hidden {
            background: var(--bg-secondary);
            color: var(--text-dim);
        }

        .hand-value {
            font-size: 0.75rem;
            color: var(--text-bright);
            letter-spacing: 1px;
        }
        
        /* Fixed control area - no shifting */
        .bj-controls {
            background: var(--bg-elevated);
            border: 1px solid var(--border-light);
            padding: 16px;
        }
        
        .bj-status {
            text-align: center;
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 16px;
            min-height: 20px;
            letter-spacing: 1px;
        }
        
        .bj-status.win {
            color: #2d8a6e;
        }
        
        .bj-status.lose {
            color: #c94a4a;
        }
        
        /* Button rows - chips + actions */
        .bj-btnrow {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            min-height: 44px;
        }
        
        .bj-btnrow.hidden {
            display: none;
        }
        
        /* Poker chip buttons */
        .bj-chip {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: 3px dashed rgba(255,255,255,0.3);
            font-family: 'Space Mono', monospace;
            font-size: 0.8rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.15s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.1);
        }
        
        /* $25 chip - green */
        .bj-chip[data-bet="25"] {
            background: linear-gradient(145deg, #3d9970 0%, #2d7a5a 100%);
            border-color: rgba(255,255,255,0.3);
            color: #fff;
        }
        
        /* $50 chip - blue */
        .bj-chip[data-bet="50"] {
            background: linear-gradient(145deg, #5588bb 0%, #446699 100%);
            border-color: rgba(255,255,255,0.3);
            color: #fff;
        }
        
        /* $100 chip - black with gold */
        .bj-chip[data-bet="100"] {
            background: linear-gradient(145deg, #3a3a3a 0%, #1a1a1a 100%);
            border-color: #b8860b;
            color: #b8860b;
        }
        
        .bj-chip:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.25), inset 0 1px 0 rgba(255,255,255,0.15);
        }
        
        .bj-chip.selected {
            transform: translateY(-4px) scale(1.1);
            box-shadow: 0 6px 14px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.2);
        }
        
        .bj-chip[data-bet="25"].selected {
            box-shadow: 0 6px 16px rgba(61, 153, 112, 0.5), inset 0 1px 0 rgba(255,255,255,0.2);
        }
        
        .bj-chip[data-bet="50"].selected {
            box-shadow: 0 6px 16px rgba(85, 136, 187, 0.5), inset 0 1px 0 rgba(255,255,255,0.2);
        }
        
        .bj-chip[data-bet="100"].selected {
            box-shadow: 0 6px 16px rgba(184, 134, 11, 0.5), inset 0 1px 0 rgba(255,255,255,0.2);
        }
        
        /* DEAL button */
        .bj-deal {
            padding: 10px 24px;
            background: transparent;
            border: 1px solid var(--text-secondary);
            color: var(--text-bright);
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.2s;
            margin-left: 8px;
        }
        
        .bj-deal:hover {
            border-color: var(--text-bright);
            background: rgba(0,0,0,0.08);
        }
        
        .bj-deal.active {
            border-color: #2d8a6e;
            color: #2d8a6e;
        }
        
        /* Action buttons (HIT/STAND) */
        .bj-action {
            padding: 12px 28px;
            background: transparent;
            border: 1px solid var(--text-secondary);
            color: var(--text-bright);
            font-family: 'Space Mono', monospace;
            font-size: 0.8rem;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .bj-action:hover {
            border-color: var(--text-bright);
            background: rgba(0,0,0,0.08);
        }
        
        .bj-hit {
            border-color: #5588bb;
            color: #5588bb;
        }
        
        .bj-hit:hover {
            background: rgba(85, 136, 187, 0.1);
        }
        
        .bj-stand {
            border-color: #b8860b;
            color: #b8860b;
        }
        
        .bj-stand:hover {
            background: rgba(184, 134, 11, 0.1);
        }

        /* Training Module */
        .training-container {
            text-align: left;
            padding: 24px;
            border: 1px solid var(--border);
            background: var(--bg-secondary);
        }

        .training-header {
            font-family: 'Space Mono', monospace;
            font-size: 0.8rem;
            color: var(--system-green);
            letter-spacing: 2px;
            margin-bottom: 8px;
        }

        .training-title {
            font-family: 'Space Mono', monospace;
            font-size: 1.2rem;
            color: var(--text-bright);
            letter-spacing: 3px;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }

        .training-content {
            font-size: 0.85rem;
            line-height: 2;
            color: var(--text-primary);
        }

        @media (min-width: 480px) {
            .training-content {
                font-size: 0.9rem;
            }
        }

        @media (min-width: 768px) {
            .training-content {
                font-size: 0.92rem;
                line-height: 2.2;
            }
        }

        .training-intro {
            color: var(--text-secondary);
            font-style: italic;
            margin-bottom: 20px;
        }

        .training-section {
            margin-bottom: 24px;
        }

        .training-section-header {
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
            color: var(--text-bright);
            letter-spacing: 2px;
            margin-bottom: 10px;
        }

        .training-list {
            margin: 12px 0 12px 20px;
            padding: 0;
        }

        .training-list li {
            margin-bottom: 6px;
            color: var(--text-secondary);
        }

        .training-content em {
            color: var(--text-bright);
            font-style: italic;
        }

        .training-footer {
            margin-top: 24px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
            text-align: center;
            color: var(--text-dim);
            font-size: 0.8rem;
        }

        .training-completion {
            margin-top: 20px;
            padding: 16px;
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.4);
            text-align: center;
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            color: #22c55e;
            letter-spacing: 1.5px;
            box-shadow: 
                0 0 10px rgba(34, 197, 94, 0.2),
                inset 0 0 20px rgba(34, 197, 94, 0.05);
            animation: completionPulse 2s ease-in-out infinite;
        }
        
        @keyframes completionPulse {
            0%, 100% {
                box-shadow: 
                    0 0 10px rgba(34, 197, 94, 0.2),
                    inset 0 0 20px rgba(34, 197, 94, 0.05);
                border-color: rgba(34, 197, 94, 0.4);
            }
            50% {
                box-shadow: 
                    0 0 20px rgba(34, 197, 94, 0.4),
                    inset 0 0 30px rgba(34, 197, 94, 0.1);
                border-color: rgba(34, 197, 94, 0.6);
            }
        }

        .break-timer-section {
            margin: 36px 0;
            padding: 24px;
            border: 1px solid var(--border);
            background: var(--bg-secondary);
        }

        .break-timer-small {
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
            color: var(--text-bright);
            letter-spacing: 2px;
            margin-bottom: 16px;
        }

        .end-break-btn {
            padding: 12px 20px;
            background: transparent;
            border: 1px solid var(--text-bright);
            color: var(--text-bright);
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: btnBreathe 3s ease-in-out infinite;
        }

        .end-break-btn:hover, .end-break-btn:active {
            border-color: var(--coral);
            color: var(--coral);
            background: rgba(255, 107, 107, 0.1);
            animation: none;
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.3);
        }

        /* Break Over Screen */
        .break-over-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 20px;
        }

        .break-over-content {
            text-align: center;
            max-width: 500px;
        }

        .break-over-icon {
            font-size: 2rem;
            color: var(--text-bright);
            margin-bottom: 24px;
            animation: glowPulse 2s infinite;
        }

        .break-over-content h2 {
            font-family: 'Space Mono', monospace;
            font-size: 1.2rem;
            letter-spacing: 4px;
            color: var(--text-bright);
            margin-bottom: 24px;
            text-transform: uppercase;
        }

        .break-over-message {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 2;
            margin-bottom: 32px;
        }

        @media (min-width: 480px) {
            .break-over-message {
                font-size: 0.9rem;
            }
        }

        @media (min-width: 768px) {
            .break-over-message {
                font-size: 0.92rem;
                line-height: 2.2;
            }
        }

        .break-over-message strong {
            color: var(--text-bright);
            display: block;
            margin-top: 16px;
            letter-spacing: 2px;
        }

        /* Warning modal */
        .break-warning-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 20px;
        }

        .warning-modal-content {
            background: var(--bg-secondary);
            border: 1px solid var(--text-secondary);
            padding: 32px;
            max-width: 420px;
            width: 100%;
            text-align: left;
        }

        .warning-modal-content.monitoring-failure {
            border-color: var(--amber);
            text-align: center;
        }

        .warning-modal-header {
            font-family: 'Space Mono', monospace;
            font-size: 1.1rem;
            color: var(--text-bright);
            letter-spacing: 4px;
            margin-bottom: 24px;
            text-align: center;
        }

        .monitoring-failure .warning-modal-header {
            color: var(--amber);
            text-shadow: 0 0 15px rgba(255, 200, 0, 0.5);
            animation: pulse 2s ease-in-out infinite;
        }

        .monitoring-notice-main {
            font-size: 1rem !important;
            color: var(--rabbit) !important;
            margin-bottom: 24px !important;
            text-shadow: 0 0 10px var(--rabbit-glow);
            animation: warningTextPulse 1.5s ease-in-out infinite;
        }

        @keyframes warningTextPulse {
            0%, 100% { opacity: 1; text-shadow: 0 0 10px var(--rabbit-glow); }
            50% { opacity: 0.85; text-shadow: 0 0 20px var(--rabbit-glow); }
        }

        .monitoring-status-list {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid var(--border-light);
            padding: 16px;
            margin: 20px 0;
            text-align: left;
        }

        .monitoring-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
        }

        .monitoring-item:last-child {
            border-bottom: none;
        }

        .monitoring-label {
            color: var(--text-secondary);
        }

        .monitoring-value {
            letter-spacing: 1px;
        }

        .monitoring-value.offline {
            color: var(--vincent);
            text-shadow: 0 0 8px var(--vincent-glow);
            animation: disabledCycle 0.8s ease-in-out infinite;
        }

        @keyframes disabledCycle {
            0%, 100% { 
                color: var(--vincent);
                text-shadow: 0 0 8px var(--vincent-glow);
            }
            50% { 
                color: var(--text-bright);
                text-shadow: 0 0 12px rgba(0, 0, 0, 0.2);
            }
        }

        .monitoring-notice-sub {
            font-size: 0.8rem !important;
            color: var(--text-dim) !important;
            margin: 20px 0 !important;
        }

        .redacted-inline {
            background: var(--text-dim);
            color: var(--text-dim);
            padding: 0 4px;
            letter-spacing: -1px;
            animation: censorCreep 3s ease-in-out infinite;
            position: relative;
        }

        @keyframes censorCreep {
            0%, 100% { 
                background: var(--text-dim);
                opacity: 1;
            }
            25% {
                background: #f0e8e0;
                opacity: 0.9;
            }
            50% { 
                background: var(--terminated);
                opacity: 0.7;
            }
            75% {
                background: #fff0f0;
                opacity: 0.85;
            }
        }

        .monitoring-notice-warning {
            font-size: 0.85rem !important;
            color: var(--text-bright) !important;
            margin-top: 20px !important;
            line-height: 1.6 !important;
        }

        .warning-modal-content p {
            margin: 14px 0;
            color: var(--text-primary);
            font-size: 0.85rem;
            line-height: 1.8;
        }

        .warning-modal-content ul {
            margin: 14px 0 14px 20px;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .warning-modal-content li {
            margin: 6px 0;
            opacity: 0.85;
        }

        .warning-modal-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 28px;
        }

        @media (min-width: 400px) {
            .warning-modal-buttons {
                flex-direction: row;
            }
        }

        .modal-btn {
            flex: 1;
            padding: 14px 16px;
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn-cancel {
            background: var(--bg-elevated);
            border: 1px solid var(--border-light);
            color: var(--text-secondary);
        }

        .modal-btn-cancel:hover {
            border-color: var(--text-secondary);
            color: var(--text-primary);
        }

        .modal-btn-confirm {
            background: transparent;
            border: 1px solid var(--text-bright);
            color: var(--text-bright);
        }

        .modal-btn-confirm:hover {
            background: rgba(0, 0, 0, 0.08);
        }

        /* ============ TERMINATION OVERLAY ============ */
        .termination-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            z-index: 10000;
            opacity: 0;
            transition: opacity 2s ease;
        }

        .termination-text {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 10001;
            font-family: 'Space Mono', monospace;
            font-size: 1.1rem;
            color: var(--green);
            text-align: center;
            letter-spacing: 3px;
            line-height: 1.8;
            opacity: 0;
            transition: opacity 1s ease;
        }

        /* Subject File Page - matches title page aesthetic */
        .subject-file-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            min-height: 100vh;
            padding: var(--space-xl);
            padding-top: calc(var(--space-xl) + var(--safe-top));
            padding-bottom: calc(var(--space-xl) + var(--safe-bottom));
            position: relative;
            animation: fadeInSlow 0.8s ease;
        }
        
        .subject-file-corner {
            position: absolute;
            width: 48px;
            height: 48px;
            border: 1px solid var(--border);
            opacity: 0.3;
        }
        
        @media (min-width: 390px) {
            .subject-file-corner {
                width: 64px;
                height: 64px;
            }
        }
        
        .subject-file-corner-tl {
            top: calc(var(--space-lg) + var(--safe-top));
            left: var(--space-lg);
            border-right: none;
            border-bottom: none;
        }
        
        .subject-file-corner-br {
            bottom: calc(var(--space-lg) + var(--safe-bottom));
            right: var(--space-lg);
            border-left: none;
            border-top: none;
        }
        
        .subject-file-header {
            text-align: center;
        }
        
        .subject-file-sector {
            font-family: 'Space Mono', monospace;
            font-size: 0.5rem;
            letter-spacing: 0.3em;
            color: var(--text-ghost);
            text-transform: uppercase;
            margin-bottom: var(--space-xs);
        }
        
        .subject-file-protocol {
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            letter-spacing: 0.15em;
            color: var(--text-dim);
        }
        
        .subject-file-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 320px;
        }
        
        .subject-file-status {
            font-family: 'Space Mono', monospace;
            font-size: 0.5rem;
            letter-spacing: 0.15em;
            color: var(--teal);
            text-transform: uppercase;
            margin-bottom: var(--space-xl);
            transition: color 0.3s ease;
        }
        
        .subject-file-card {
            width: 100%;
            border: 1px solid var(--border);
            background: rgba(139, 0, 0, 0.03);
            padding: var(--space-lg);
        }
        
        .subject-file-label {
            font-family: 'Space Mono', monospace;
            font-size: 0.4375rem;
            letter-spacing: 0.2em;
            color: var(--text-ghost);
            text-transform: uppercase;
            margin-bottom: var(--space-xs);
        }
        
        .subject-file-name {
            font-family: 'Space Mono', monospace;
            font-size: 1.75rem;
            color: var(--coral);
            letter-spacing: 0.1em;
            margin-bottom: var(--space-md);
        }
        
        .subject-file-divider {
            height: 1px;
            background: var(--border);
            margin: var(--space-md) 0;
            opacity: 0.5;
        }
        
        .subject-file-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-sm);
        }
        
        .subject-file-key {
            font-family: 'Space Mono', monospace;
            font-size: 0.5rem;
            letter-spacing: 0.1em;
            color: var(--text-dim);
            text-transform: uppercase;
        }
        
        .subject-file-value {
            font-family: 'Space Mono', monospace;
            font-size: 0.5625rem;
            letter-spacing: 0.1em;
            color: var(--text-secondary);
            text-transform: uppercase;
        }
        
        .subject-file-danger {
            color: #8b0000;
        }
        
        .subject-file-dim {
            color: var(--text-ghost);
        }
        
        .subject-file-verdict {
            text-align: center;
            margin-top: var(--space-sm);
        }
        
        .subject-file-verdict-label {
            font-family: 'Space Mono', monospace;
            font-size: 0.4375rem;
            letter-spacing: 0.2em;
            color: var(--text-ghost);
            text-transform: uppercase;
            margin-bottom: var(--space-xs);
        }
        
        .subject-file-verdict-value {
            font-family: 'Space Mono', monospace;
            font-size: 1.25rem;
            color: #8b0000;
            letter-spacing: 0.15em;
        }
        
        .subject-file-footer {
            text-align: center;
        }
        
        .subject-file-trace {
            font-family: 'Space Mono', monospace;
            font-size: 0.4375rem;
            letter-spacing: 0.1em;
            color: var(--text-ghost);
            text-transform: uppercase;
        }

        @media (min-width: 480px) {
            .subject-file-name {
                font-size: 2rem;
            }
            
            .subject-file-verdict-value {
                font-size: 1.5rem;
            }
        }

        .ending-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 48px 24px;
            text-align: center;
        }

        /* New ending page - pastel stationery aesthetic */
        .ending-page {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            text-align: center;
            animation: fadeInSlow 1s ease;
            overflow: hidden;
            z-index: 100;
            box-sizing: border-box;
            background: linear-gradient(180deg, #fefcfa 0%, #faf6f2 100%);
        }

        @keyframes fadeInSlow {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .ending-logo {
            font-family: 'Space Mono', monospace;
            font-size: 0.5rem;
            letter-spacing: 4px;
            color: #b8a8a0;
            margin-bottom: 16px;
            text-transform: uppercase;
            flex-shrink: 0;
        }

        @media (min-width: 480px) {
            .ending-logo {
                font-size: 0.6rem;
                letter-spacing: 6px;
                margin-bottom: 24px;
            }
        }

        .ending-main {
            font-family: 'Space Mono', monospace;
            font-size: 1.3rem;
            letter-spacing: 3px;
            color: #4a4a4a;
            line-height: 1.4;
            margin-bottom: 12px;
            flex-shrink: 0;
            animation: crtEndingFlicker 4s infinite;
        }
        
        @keyframes crtEndingFlicker {
            0%, 100% { 
                text-shadow: 
                    0.5px 0 1px rgba(0, 150, 255, 0.3), 
                    -0.5px 0 1px rgba(255, 50, 100, 0.2), 
                    0 0 15px rgba(74, 74, 74, 0.1); 
            }
            33% { 
                text-shadow: 
                    1px 0 1px rgba(0, 150, 255, 0.3), 
                    -1px 0 1px rgba(255, 50, 100, 0.2), 
                    0 0 15px rgba(74, 74, 74, 0.1); 
            }
            66% { 
                text-shadow: 
                    0.3px 0 1px rgba(0, 150, 255, 0.3), 
                    -0.3px 0 1px rgba(255, 50, 100, 0.2), 
                    0 0 15px rgba(74, 74, 74, 0.1); 
            }
        }

        @media (min-width: 480px) {
            .ending-main {
                font-size: 1.8rem;
                letter-spacing: 5px;
                margin-bottom: 16px;
            }
        }

        @media (min-width: 768px) {
            .ending-main {
                font-size: 2.2rem;
                letter-spacing: 6px;
            }
        }

        .ending-form {
            font-family: 'Space Mono', monospace;
            font-size: 0.5rem;
            letter-spacing: 2px;
            color: #a8a0a0;
            margin-bottom: 16px;
            flex-shrink: 0;
        }

        @media (min-width: 480px) {
            .ending-form {
                font-size: 0.6rem;
                letter-spacing: 3px;
                margin-bottom: 24px;
            }
        }

        .ending-divider-line {
            width: 40px;
            height: 2px;
            background: linear-gradient(90deg, transparent, #d8c8c0, transparent);
            margin: 12px 0;
            flex-shrink: 0;
            border-radius: 1px;
        }

        @media (min-width: 480px) {
            .ending-divider-line {
                width: 60px;
                margin: 18px 0;
            }
        }

        .ending-meta {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 12px;
            flex-shrink: 0;
        }

        .ending-status {
            font-family: 'Space Mono', monospace;
            font-size: 0.65rem;
            letter-spacing: 2px;
            color: #6a5a5e;
        }

        @media (min-width: 480px) {
            .ending-status {
                font-size: 0.8rem;
                letter-spacing: 3px;
            }
        }

        .ending-verdict-text {
            font-family: 'Space Mono', monospace;
            font-size: 0.5rem;
            letter-spacing: 1.5px;
            color: #8a7a7e;
        }

        @media (min-width: 480px) {
            .ending-verdict-text {
                font-size: 0.55rem;
                letter-spacing: 4px;
            }
        }

        .ending-instruction-text {
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            color: #7a6a6e;
            line-height: 1.7;
            margin: 14px 0;
            flex-shrink: 0;
        }

        @media (min-width: 480px) {
            .ending-instruction-text {
                font-size: 0.7rem;
                line-height: 1.9;
                margin: 20px 0;
            }
        }

        /* Share button for endings */
        .ending-share-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin: 16px 0;
            padding: 10px 20px;
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            letter-spacing: 2px;
            color: #7a6a6e;
            background: transparent;
            border: 1px solid #d8ccc8;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .ending-share-btn:hover {
            color: #4a4a4a;
            border-color: #b8a8a4;
            background: rgba(0, 0, 0, 0.02);
        }
        
        .ending-share-btn:active {
            transform: scale(0.98);
        }
        
        .ending-share-btn.copied {
            color: #4a9a6a;
            border-color: #4a9a6a;
        }
        
        @media (min-width: 480px) {
            .ending-share-btn {
                font-size: 0.6rem;
                padding: 12px 24px;
            }
        }

        .ending-attribution-block {
            margin-top: 20px;
        }

        .ending-title-credit {
            font-family: 'VT323', monospace;
            font-size: 1.6rem;
            letter-spacing: 5px;
            color: #4a4a4a;
            margin-bottom: 10px;
        }

        .ending-title-credit .rabbit-word {
            color: #e8707e;
        }

        @media (min-width: 480px) {
            .ending-title-credit {
                font-size: 2.1rem;
                letter-spacing: 7px;
            }
        }

        .ending-author {
            font-family: 'Space Mono', monospace;
            font-size: 0.65rem;
            letter-spacing: 3px;
            color: #9a8a8e;
        }

        @media (min-width: 480px) {
            .ending-author {
                font-size: 0.7rem;
                letter-spacing: 4px;
            }
        }

        .ending-restart {
            margin-top: 48px;
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            letter-spacing: 3px;
            color: #9a8a8e;
            cursor: pointer;
            padding: 12px 24px;
            border: 1px solid #d8ccc8;
            transition: all 0.3s ease;
        }

        .ending-restart:hover {
            color: #6a5a5e;
            border-color: #c8b8b4;
        }

        /* Owen login button - pastel stationery card */
        .ending-restart.owen-login {
            margin-top: 48px;
            padding: 20px 28px;
            border: 2px solid #e8dcd8;
            background: linear-gradient(180deg, #fefcfa 0%, #faf6f2 100%);
            text-align: center;
            border-radius: 16px;
            box-shadow: 
                0 4px 0 #d8ccc8,
                0 6px 16px rgba(0, 0, 0, 0.06);
        }

        .ending-restart.owen-login:hover {
            background: linear-gradient(180deg, #ffffff 0%, #fcf8f4 100%);
            border-color: #d8c8c4;
            transform: translateY(-2px);
            box-shadow: 
                0 6px 0 #d8ccc8,
                0 8px 20px rgba(0, 0, 0, 0.08);
        }

        .ending-restart.owen-login .login-prompt {
            font-family: 'Space Mono', monospace;
            font-size: 0.5rem;
            letter-spacing: 2px;
            color: #a89898;
            margin-bottom: 10px;
        }

        .ending-restart.owen-login .login-user {
            font-family: 'Space Mono', monospace;
            font-size: 1.2rem;
            letter-spacing: 2px;
            color: #c9a86c;
            margin-bottom: 2px;
        }

        .ending-restart.owen-login .login-id {
            font-family: 'Space Mono', monospace;
            font-size: 0.5rem;
            letter-spacing: 1px;
            color: #8a7a7e;
            margin-bottom: 14px;
        }

        .ending-restart.owen-login .login-action {
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            letter-spacing: 3px;
            color: #9a8a8e;
            transition: color 0.3s ease;
        }

        .ending-restart.owen-login:hover .login-action {
            color: #c9a86c;
        }

        /* Larger Owen login box - soft pastel card with satisfying click */
        .ending-restart.owen-login-large {
            margin-top: 20px;
            margin-bottom: 0;
            padding: 0;
            border: 2px solid #e8dcd8;
            background: linear-gradient(180deg, #fefcfa 0%, #f8f4f0 100%);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 
                0 4px 0 #d8ccc8,
                0 6px 16px rgba(0, 0, 0, 0.06),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            position: relative;
            width: 100%;
            max-width: 280px;
            overflow: hidden;
            flex-shrink: 0;
            border-radius: 16px;
        }

        @media (min-width: 480px) {
            .ending-restart.owen-login-large {
                margin-top: 28px;
                max-width: 320px;
            }
        }

        /* Decorative corner flourishes */
        .ending-restart.owen-login-large::before {
            content: '✿';
            position: absolute;
            top: 8px;
            left: 12px;
            font-size: 0.8rem;
            color: #e8c8c8;
            opacity: 0.5;
        }
        
        .ending-restart.owen-login-large::after {
            content: '✿';
            position: absolute;
            bottom: 8px;
            right: 12px;
            font-size: 0.8rem;
            color: #e8c8c8;
            opacity: 0.5;
        }

        .ending-restart.owen-login-large:hover {
            background: linear-gradient(180deg, #ffffff 0%, #faf6f2 100%);
            border-color: #d8c8c4;
            box-shadow: 
                0 6px 0 #d8ccc8,
                0 8px 20px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            transform: translateY(-2px);
        }
        
        .ending-restart.owen-login-large:active {
            box-shadow: 
                0 2px 0 #d8ccc8,
                0 3px 8px rgba(0, 0, 0, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            transform: translateY(2px);
        }

        .login-prompt-large {
            font-family: 'Space Mono', monospace;
            font-size: 0.42rem;
            letter-spacing: 1.5px;
            color: #a89898;
            padding: 12px 12px 10px;
            border-bottom: 1px solid #ece4e0;
            text-transform: uppercase;
            background: linear-gradient(180deg, rgba(255,255,255,0.5) 0%, transparent 100%);
            border-radius: 14px 14px 0 0;
        }

        .login-divider {
            display: none;
        }

        .login-user-large {
            font-family: 'Space Mono', monospace;
            font-size: 1rem;
            letter-spacing: 1.5px;
            color: #c9a86c;
            padding: 14px 12px 6px;
        }

        .login-id-large {
            font-family: 'Space Mono', monospace;
            font-size: 0.45rem;
            letter-spacing: 1px;
            color: #9a8a8e;
            padding: 0 12px 14px;
            white-space: nowrap;
        }

        .login-action-large {
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            letter-spacing: 2px;
            color: #6a5a5e;
            background: linear-gradient(180deg, #f8f0ec 0%, #f4ece8 100%);
            padding: 14px 12px;
            border-top: 1px solid #ece4e0;
            transition: all 0.2s ease;
            margin: 0;
            border-radius: 0 0 14px 14px;
        }

        .ending-restart.owen-login-large:hover .login-action-large {
            color: #4a3a3e;
            background: linear-gradient(180deg, #fcf4f0 0%, #f8f0ec 100%);
        }

        @media (min-width: 480px) {
            .login-prompt-large {
                font-size: 0.5rem;
                letter-spacing: 2px;
                padding: 14px 18px 12px;
            }
            
            .login-user-large {
                font-size: 1.4rem;
                letter-spacing: 2px;
                padding: 18px 18px 8px;
            }
            
            .login-id-large {
                font-size: 0.55rem;
                letter-spacing: 1.5px;
                padding: 0 18px 18px;
            }
            
            .login-action-large {
                font-size: 0.95rem;
                letter-spacing: 3px;
                padding: 16px 18px;
            }
        }

        @media (min-width: 480px) {
            .ending-restart {
                font-size: 0.75rem;
                letter-spacing: 5px;
            }
            
            .ending-restart.owen-login .login-prompt {
                font-size: 0.55rem;
                letter-spacing: 3px;
            }
            
            .ending-restart.owen-login .login-user {
                font-size: 1.3rem;
            }
            
            .ending-restart.owen-login .login-id {
                font-size: 0.55rem;
                letter-spacing: 2px;
            }
            
            .ending-restart.owen-login .login-action {
                font-size: 0.9rem;
            }
        }

        /* Restart button specific styles - cleaner look without ID line */
        .ending-restart.owen-login-large.restart-btn {
            max-width: 280px;
        }
        
        .ending-restart.owen-login-large.restart-btn .login-prompt-large {
            font-size: 0.45rem;
            letter-spacing: 2px;
            padding: 12px 16px 10px;
            color: var(--text-dim);
        }
        
        .ending-restart.owen-login-large.restart-btn .login-user-large {
            font-size: 1rem;
            letter-spacing: 2px;
            padding: 16px 16px 16px;
            color: var(--text-bright);
            text-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
        }
        
        .ending-restart.owen-login-large.restart-btn .login-action-large {
            font-size: 0.85rem;
            letter-spacing: 3px;
            padding: 12px 16px;
            color: var(--text-secondary);
            animation: none;
            background: rgba(0, 0, 0, 0.03);
        }
        
        .ending-restart.owen-login-large.restart-btn:hover .login-user-large {
            color: var(--text-bright);
            text-shadow: 0 0 30px rgba(0, 0, 0, 0.18);
        }
        
        .ending-restart.owen-login-large.restart-btn:hover .login-action-large {
            color: var(--text-bright);
            background: rgba(0, 0, 0, 0.06);
        }
        
        /* Override the Owen gold colors for restart buttons */
        .ending-restart.owen-login-large.restart-btn {
            border: 1px solid rgba(0, 0, 0, 0.12);
            border-bottom: 1px solid rgba(0, 0, 0, 0.12);
            margin-bottom: 0;
            animation: restartBoxGlow 2.5s ease-in-out infinite;
            box-shadow: 
                0 0 20px rgba(0, 0, 0, 0.08),
                0 0 40px rgba(0, 0, 0, 0.04),
                inset 0 0 40px rgba(0, 0, 0, 0.02);
        }
        
        /* Add bottom glow line to match top */
        .ending-restart.owen-login-large.restart-btn::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(0, 0, 0, 0.18), transparent);
            opacity: 0.6;
        }
        
        .ending-restart.owen-login-large.restart-btn::before {
            background: linear-gradient(90deg, transparent, rgba(0, 0, 0, 0.18), transparent);
        }
        
        .ending-restart.owen-login-large.restart-btn .login-prompt-large {
            border-bottom-color: rgba(0, 0, 0, 0.08);
        }
        
        .ending-restart.owen-login-large.restart-btn .login-action-large {
            border-top-color: rgba(0, 0, 0, 0.08);
        }
        
        @keyframes restartBoxGlow {
            0%, 100% {
                box-shadow: 
                    0 0 20px rgba(0, 0, 0, 0.08),
                    0 0 40px rgba(0, 0, 0, 0.04),
                    inset 0 0 40px rgba(0, 0, 0, 0.02);
                border-color: rgba(0, 0, 0, 0.12);
            }
            50% {
                box-shadow: 
                    0 0 30px rgba(0, 0, 0, 0.12),
                    0 0 60px rgba(0, 0, 0, 0.08),
                    inset 0 0 60px rgba(0, 0, 0, 0.03);
                border-color: rgba(0, 0, 0, 0.18);
            }
        }
        
        .ending-restart.owen-login-large.restart-btn:hover {
            background: rgba(0, 0, 0, 0.03);
            border-color: rgba(0, 0, 0, 0.15);
            box-shadow: 
                0 0 40px rgba(0, 0, 0, 0.1),
                0 0 80px rgba(0, 0, 0, 0.1);
            animation: none;
        }
        
        @media (min-width: 480px) {
            .ending-restart.owen-login-large.restart-btn {
                max-width: 300px;
            }
            
            .ending-restart.owen-login-large.restart-btn .login-prompt-large {
                font-size: 0.5rem;
                padding: 14px 20px 12px;
            }
            
            .ending-restart.owen-login-large.restart-btn .login-user-large {
                font-size: 1.1rem;
                padding: 18px 20px 18px;
            }
            
            .ending-restart.owen-login-large.restart-btn .login-action-large {
                font-size: 0.9rem;
                padding: 14px 20px;
            }
        }

        .ending-verdict {
            font-family: 'Space Mono', monospace;
            font-size: 2rem;
            letter-spacing: 8px;
            color: var(--green);
            margin-bottom: 16px;
            line-height: 1.3;
        }

        /* ============ OWEN'S DEDICATED READING PAGE ============ */
        
        /* Lock Owen page to vertical scroll only - prevent all gesture issues */
        #owenPage {
            touch-action: pan-y;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
            scroll-behavior: auto; /* Disable smooth scroll to prevent jumps */
        }
        
        /* ════════════════════════════════════
           OWEN'S PAGE - DARK THEME OVERRIDE
           This page stays dark like the original - an island in the light
           ════════════════════════════════════ */
        #owenPage,
        #owenPage * {
            --bg-primary: #080808;
            --bg-secondary: #101010;
            --bg-elevated: #181818;
            --bg-card: #121212;
            --text-bright: #ffffff;
            --text-primary: #d0d0d0;
            --text-secondary: #A8A8A8;
            --text-dim: #787878;
            --text-ghost: #404040;
            --border: #282828;
            --border-light: #383838;
            --owen: #e8b84a;
            --owen-glow: rgba(232, 184, 74, 0.25);
            --rabbit: #ff8a80;
            --rabbit-glow: rgba(255, 138, 128, 0.2);
            --vincent: #8fa4b8;
            --vincent-glow: rgba(143, 164, 184, 0.25);
            --facility: #ffffff;
            --facility-glow: rgba(255, 255, 255, 0.15);
        }
        
        #owenPage {
            background: #080808 !important;
            color: #d0d0d0 !important;
        }
        
        #owenPage .owen-reading-page {
            background: linear-gradient(180deg, #080808 0%, #101010 100%) !important;
        }
        
        #owenPage .owen-boot-overlay {
            background: #080808 !important;
        }
        
        #owenPage .boot-terminal {
            color: #b0b0b0 !important;
        }
        
        #owenPage .owen-header {
            background: linear-gradient(180deg, #080808 0%, transparent 100%) !important;
            border-bottom-color: rgba(255, 255, 255, 0.1) !important;
        }
        
        #owenPage .owen-header-name {
            color: #e8b84a !important;
            text-shadow: 0 0 20px rgba(232, 184, 74, 0.3) !important;
        }
        
        #owenPage .owen-header-id {
            color: #787878 !important;
        }
        
        /* Owen page character colors - original dark theme glows */
        #owenPage .c-owen {
            color: #e8b84a !important;
            text-shadow: 0 0 12px rgba(232, 184, 74, 0.25) !important;
        }
        
        #owenPage .c-rabbit,
        #owenPage .c-isla {
            color: #ff8a80 !important;
            text-shadow: 0 0 10px rgba(255, 138, 128, 0.2) !important;
        }
        
        #owenPage .c-vincent {
            color: #8fa4b8 !important;
            text-shadow: 0 0 12px rgba(143, 164, 184, 0.25) !important;
        }
        
        #owenPage .c-facility,
        #owenPage .c-ice,
        #owenPage .c-cold {
            color: #ffffff !important;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.15) !important;
        }
        
        /* Owen blackjack game colors */
        #owenPage .owen-blackjack-container {
            background: rgba(232, 184, 74, 0.03) !important;
            border-color: rgba(232, 184, 74, 0.2) !important;
        }
        
        #owenPage .owen-blackjack-title {
            color: #e8b84a !important;
        }
        
        #owenPage .owen-card {
            background: linear-gradient(145deg, #1a1a1a, #0d0d0d) !important;
            border-color: rgba(232, 184, 74, 0.3) !important;
            color: #e8b84a !important;
        }
        
        #owenPage .owen-game-btn {
            background: transparent !important;
            border-color: rgba(232, 184, 74, 0.4) !important;
            color: #e8b84a !important;
        }
        
        #owenPage .owen-game-btn:hover {
            background: rgba(232, 184, 74, 0.1) !important;
        }
        
        /* Owen page letters and sections */
        #owenPage .owen-letter {
            background: rgba(143, 164, 184, 0.02) !important;
            border-left-color: #8fa4b8 !important;
        }
        
        #owenPage .isla-letter {
            background: rgba(255, 138, 128, 0.02) !important;
            border-left-color: #ff8a80 !important;
        }
        
        #owenPage .owen-divider {
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent) !important;
        }
        
        /* End credits on Owen page */
        #owenPage .ending-restart,
        #owenPage .credits-restart-btn {
            border-color: rgba(232, 184, 74, 0.3) !important;
            color: #e8b84a !important;
        }
        
        #owenPage .rizz-lore-btn {
            border-color: rgba(232, 184, 74, 0.3) !important;
            color: #e8b84a !important;
        }
        
        /* ════════════════════════════════════
           OWEN'S REDACTION REVEAL - CLICK TO SEE WHAT'S HIDDEN
           Blocks are visible underneath, revealed text is on top but invisible
           (colored same as background). Wisps invert the top layer, revealing text.
           ════════════════════════════════════ */
        
        /* ════════════════════════════════════
           TAP-TO-REVEAL REDACTION SYSTEM
           Click/tap multiple times to declassify
           ════════════════════════════════════ */
        
        /* Container - inline-grid stacks children perfectly */
        #owenPage .owen-redact {
            display: inline-grid;
            vertical-align: baseline;
            cursor: pointer;
            pointer-events: auto !important;
        }
        
        /* Both children occupy same grid cell */
        #owenPage .owen-redact-blocks,
        #owenPage .owen-redact-reveal,
        #owenPage .owen-redact-reveal-light {
            grid-area: 1 / 1;
            transition: opacity 0.4s ease, filter 0.3s ease;
        }
        
        /* Blocks visible by default */
        #owenPage .owen-redact-blocks {
            opacity: 1;
            word-break: break-all;
            overflow-wrap: break-word;
        }
        
        /* Reveal text hidden by default */
        #owenPage .owen-redact-reveal,
        #owenPage .owen-redact-reveal-light {
            opacity: 0;
            pointer-events: none;
        }
        
        /* Visual feedback on tap - glitch shake */
        #owenPage .owen-redact.tapped {
            animation: redactGlitch 0.15s ease;
        }
        
        @keyframes redactGlitch {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); filter: hue-rotate(20deg); }
            75% { transform: translateX(2px); filter: hue-rotate(-20deg); }
        }
        
        /* Cracking state - blocks starting to break */
        #owenPage .owen-redact.cracking .owen-redact-blocks {
            opacity: 0.6;
            filter: blur(0.5px);
        }
        
        /* Revealed state - blocks gone, text visible */
        #owenPage .owen-redact.revealed .owen-redact-blocks {
            opacity: 0;
            filter: blur(4px);
        }
        
        #owenPage .owen-redact.revealed .owen-redact-reveal,
        #owenPage .owen-redact.revealed .owen-redact-reveal-light {
            opacity: 1;
        }
        
        /* Revealed text inherits parent color for proper theming */
        #owenPage .owen-redact-reveal {
            color: inherit;
        }
        
        #owenPage .owen-redact-reveal-light {
            color: inherit;
        }
        
        /* Already revealed - no cursor change */
        #owenPage .owen-redact.revealed {
            cursor: default;
        }
        
        /* When Owen page is active, set body scroll behavior */
        #owenPage.active ~ * {
            scroll-behavior: auto;
        }
        
        /* Disable pointer events on all content except restart buttons */
        #owenPage .owen-reading-page,
        #owenPage .owen-reading-page * {
            pointer-events: none;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        
        /* Re-enable pointer events ONLY for restart/login buttons at the bottom and blackjack */
        #owenPage .ending-restart,
        #owenPage .credits-restart-btn,
        #owenPage .rizz-lore-btn,
        #owenPage .owen-blackjack-container,
        #owenPage .owen-blackjack-container * {
            pointer-events: auto !important;
            cursor: pointer;
        }
        
        .owen-reading-page {
            min-height: 100vh;
            padding: 16px;
            max-width: 700px;
            margin: 0 auto;
            background: linear-gradient(180deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            touch-action: pan-y;
            -webkit-tap-highlight-color: transparent;
        }

        /* ============ OWEN BOOT SEQUENCE ============ */
        .owen-boot-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            z-index: 100000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
            transition: opacity 0.8s ease;
        }

        .owen-boot-overlay.fading {
            opacity: 0;
        }
        
        /* ════════════════════════════════════
           TERMINAL BOOT - MONOCHROME SYSTEM
           Uses only white/grey shades - no character colors
           ════════════════════════════════════ */
        .boot-terminal {
            width: 92%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 20px 16px;
            font-family: 'Space Mono', 'Courier New', monospace;
            font-size: 0.85rem;
            line-height: 1.5;
            color: #2d2d2d;
            background: transparent;
            position: relative;
            box-sizing: border-box;
            border: none;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .boot-terminal::-webkit-scrollbar {
            display: none;
        }
        
        /* Clean look - no scanlines */

        .boot-line {
            opacity: 0;
            animation: bootLineAppear 0.03s ease forwards;
            margin-bottom: 2px;
            position: relative;
            z-index: 5;
            word-break: break-word;
        }

        @keyframes bootLineAppear {
            to { opacity: 1; }
        }
        
        /* Blinking cursor - dark for light theme */
        .boot-cursor {
            display: inline-block;
            width: 0.5em;
            height: 1em;
            background: #1a1a1a;
            animation: cursorBlink 0.6s step-end infinite;
            vertical-align: text-bottom;
            margin-left: 2px;
        }
        
        @keyframes cursorBlink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        /* Progress bar - monochrome */
        .boot-progress-bar {
            width: 100%;
            height: 14px;
            background: var(--bg-primary);
            border: 1px solid #333;
            margin: 6px 0;
            position: relative;
            overflow: hidden;
        }
        
        .boot-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #404040, #ffffff);
            width: 0%;
            transition: width 0.05s linear;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.15);
        }

        /* ─── MONOCHROME TEXT HIERARCHY ─── */
        
        /* Brightest - STATUS OK, READY states */
        .boot-ready {
            color: var(--text-bright);
            font-size: 0.9rem;
            letter-spacing: 2px;
            margin-top: 12px;
            text-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        }
        
        .boot-status-ok {
            color: var(--text-bright);
            text-shadow: 0 0 8px rgba(0, 0, 0, 0.18);
        }
        
        /* Bright - Important info, user names */
        .boot-name-generic {
            color: #e0e0e0;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.15);
        }
        
        .boot-vincent-name {
            color: #d0d0d0;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.15);
        }
        
        .boot-owen-name {
            color: #d0d0d0;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.15);
        }
        
        /* Medium - Normal text */
        .boot-normal {
            color: #b0b0b0;
        }
        
        /* Dim - Secondary info, headers */
        .boot-dim {
            color: #606060;
        }
        
        .boot-section-header {
            color: #505050;
            font-size: 0.75rem;
            letter-spacing: 2px;
            margin-top: 10px;
            margin-bottom: 6px;
        }
        
        .boot-system-id {
            color: #404040;
            font-size: 0.7rem;
            letter-spacing: 2px;
            margin-bottom: 4px;
        }
        
        .boot-terminal-id {
            color: #707070;
            font-size: 0.8rem;
            letter-spacing: 2px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #222;
        }
        
        /* Ghost - Barely visible */
        .boot-ghost {
            color: #303030;
        }
        
        /* ─── SPECIAL STATES ─── */
        
        /* Warning - Bright white pulsing */
        .boot-warning {
            color: var(--text-bright);
            text-shadow: 0 0 15px rgba(0, 0, 0, 0.25);
            animation: warningPulse 1s ease-in-out infinite;
        }
        
        @keyframes warningPulse {
            0%, 100% { opacity: 0.7; text-shadow: 0 0 10px rgba(0, 0, 0, 0.18); }
            50% { opacity: 1; text-shadow: 0 0 20px rgba(0, 0, 0, 0.3); }
        }
        
        /* Glitch - Flickering grey */
        .boot-glitch {
            color: #808080;
            font-size: 0.8rem;
            letter-spacing: 3px;
            font-style: italic;
            animation: bootGlitch 0.15s ease infinite;
        }

        @keyframes bootGlitch {
            0%, 100% { transform: translateX(0); opacity: 0.5; }
            25% { transform: translateX(-2px); opacity: 0.8; }
            75% { transform: translateX(2px); opacity: 0.3; }
        }
        
        /* Success/Online - Bright */
        .boot-success,
        .boot-system-online,
        .boot-online-text {
            color: var(--text-bright);
            text-shadow: 0 0 8px rgba(0, 0, 0, 0.18);
        }
        
        /* Offline/Error - Dimmed, not colored */
        .boot-system-offline,
        .boot-offline-text,
        .boot-error {
            color: #909090;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.12);
            animation: bootErrorFlash 0.3s ease;
        }
        
        @keyframes bootErrorFlash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }
        
        .boot-status-line {
            display: flex;
            justify-content: space-between;
            padding: 2px 0;
        }
        
        .boot-status-label {
            color: #606060;
        }
        
        .boot-status-value {
            color: var(--text-bright);
            text-shadow: 0 0 6px rgba(0, 0, 0, 0.15);
        }
        
        .boot-status-value.offline {
            color: #707070;
        }
        
        .boot-progress {
            color: #505050;
            letter-spacing: 1px;
        }
        
        .boot-name {
            color: #e0e0e0;
            font-size: 1rem;
            text-shadow: 0 0 12px rgba(0, 0, 0, 0.15);
        }
        
        .boot-highlight {
            color: var(--text-bright);
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }
        
        /* Typing animation */
        .boot-typing {
            overflow: hidden;
            white-space: nowrap;
            animation: typing 0.5s steps(30, end);
        }
        
        @keyframes typing {
            from { width: 0; }
            to { width: 100%; }
        }

        .owen-header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 1px solid rgba(232, 184, 74, 0.15);
            margin-bottom: 40px;
        }

        .owen-header-name {
            font-family: 'Space Mono', monospace;
            font-size: 1.2rem;
            letter-spacing: 2px;
            color: var(--owen);
            text-shadow: 0 0 20px var(--owen-glow);
        }

        .owen-header-id {
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            letter-spacing: 2px;
            color: var(--text-dim);
            margin-top: 4px;
        }

        .owen-title-section {
            text-align: center;
            padding: 40px 15px;
            max-width: 100%;
            overflow-x: hidden;
        }

        .owen-logo {
            font-family: 'Space Mono', monospace;
            font-size: 0.5rem;
            letter-spacing: 4px;
            color: var(--text-dim);
            margin-bottom: 24px;
            opacity: 0.6;
        }
        
        @media (min-width: 400px) {
            .owen-logo {
                font-size: 0.55rem;
                letter-spacing: 6px;
            }
        }

        .owen-main-title {
            font-family: 'Space Mono', monospace;
            font-size: 1.8rem;
            letter-spacing: 2px;
            color: var(--text-bright);
            line-height: 1.2;
            margin-bottom: 12px;
            text-shadow: 0 0 40px rgba(0, 0, 0, 0.08);
            text-transform: lowercase;
            word-break: break-word;
        }
        
        @media (min-width: 400px) {
            .owen-main-title {
                font-size: 2.2rem;
                letter-spacing: 3px;
            }
        }
        
        @media (min-width: 480px) {
            .owen-main-title {
                font-size: 2.5rem;
                letter-spacing: 4px;
            }
        }
        
        .owen-tld {
            text-shadow: none;
        }
        
        .owen-title-i {
            color: var(--rabbit);
            text-shadow: 0 0 20px var(--rabbit-glow);
        }
        
        .owen-title-o {
            color: var(--owen);
            text-shadow: 0 0 20px var(--owen-glow);
        }

        .owen-subtitle {
            font-family: 'Space Mono', monospace;
            font-size: 0.5rem;
            letter-spacing: 2px;
            color: var(--text-secondary);
            margin-bottom: 20px;
            padding: 0 10px;
        }
        
        @media (min-width: 400px) {
            .owen-subtitle {
                font-size: 0.55rem;
                letter-spacing: 3px;
            }
        }
        
        @media (min-width: 480px) {
            .owen-subtitle {
                font-size: 0.6rem;
                letter-spacing: 4px;
            }
        }

        .owen-access {
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
            letter-spacing: 2px;
            color: var(--owen);
            text-shadow: 0 0 15px rgba(244, 209, 155, 0.4);
        }

        .owen-access-sub {
            font-family: 'Space Mono', monospace;
            font-size: 0.5rem;
            letter-spacing: 3px;
            color: var(--green);
            margin-top: 8px;
            opacity: 0.8;
        }

        .owen-access-header {
            text-align: center;
            padding: 0 10px;
        }

        .owen-access-bright {
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            letter-spacing: 1px;
            color: var(--text-bright);
            text-shadow: 0 0 20px rgba(0, 0, 0, 0.2), 0 0 40px rgba(244, 209, 155, 0.4);
            word-break: break-word;
        }

        .owen-access-sub-bright {
            font-family: 'Space Mono', monospace;
            font-size: 0.5rem;
            letter-spacing: 1px;
            color: var(--green);
            margin-top: 12px;
            text-shadow: 0 0 15px rgba(0, 212, 170, 0.5);
            word-break: break-word;
        }

        @media (min-width: 400px) {
            .owen-access-bright {
                font-size: 0.9rem;
                letter-spacing: 2px;
            }
            
            .owen-access-sub-bright {
                font-size: 0.55rem;
                letter-spacing: 2px;
            }
        }

        @media (min-width: 480px) {
            .owen-access-bright {
                font-size: 1.1rem;
                letter-spacing: 3px;
            }
            
            .owen-access-sub-bright {
                font-size: 0.6rem;
                letter-spacing: 3px;
            }
        }
        
        @media (min-width: 600px) {
            .owen-access-bright {
                font-size: 1.3rem;
                letter-spacing: 4px;
            }
            
            .owen-access-sub-bright {
                font-size: 0.7rem;
            }
        }

        .owen-scroll-prompt {
            text-align: center;
            animation: scrollPulse 2s ease-in-out infinite;
        }

        .scroll-text {
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            letter-spacing: 4px;
            color: var(--text-bright);
            margin-bottom: 12px;
            text-shadow: 0 0 15px rgba(0, 0, 0, 0.18);
        }

        .scroll-arrow {
            font-size: 1.5rem;
            color: var(--text-bright);
            animation: arrowBounce 1.5s ease-in-out infinite;
            text-shadow: 0 0 15px rgba(0, 0, 0, 0.18);
        }

        @keyframes scrollPulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        @keyframes arrowBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(8px); }
        }

        .owen-divider {
            text-align: center;
            color: var(--text-ghost);
            margin: 60px 0;
            font-family: monospace;
            letter-spacing: 2px;
            opacity: 0.3;
        }

        .owen-section {
            margin: 60px 0;
        }

        .owen-section-header {
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            letter-spacing: 3px;
            color: var(--amber);
            margin-bottom: 24px;
            text-align: center;
            opacity: 0.7;
        }

        .owen-letter {
            font-family: 'Space Mono', monospace;
            font-weight: 400;
            font-size: 0.9rem;
            line-height: 2.2;
            letter-spacing: 0.5px;
            color: var(--vincent);
            padding: 24px 16px;
            background: linear-gradient(135deg, var(--vincent-subtle) 0%, rgba(143, 164, 184, 0.02) 100%);
            border-left: 2px solid var(--vincent);
            border-radius: 0 4px 4px 0;
            box-shadow: inset 0 0 60px var(--vincent-subtle);
        }

        .owen-letter .cutoff {
            display: block;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(143, 164, 184, 0.15);
        }

        /* ============ OWEN PAGE PULSATING EFFECT ============ */
        /* Apply oscillating Vincent-blue-to-Facility-white effect */
        /* Exclude: title section and credits */
        
        @keyframes owenVincentPulse {
            0%, 100% {
                color: var(--vincent);
                text-shadow: 0 0 12px var(--vincent-glow);
            }
            50% {
                color: var(--facility);
                text-shadow: 0 0 20px var(--facility-glow), 0 0 40px rgba(0, 0, 0, 0.1);
            }
        }
        
        /* Inverse pulse - starts white, goes to Vincent blue (opposite of main pulse) */
        @keyframes owenInversePulse {
            0%, 100% {
                color: var(--facility);
                text-shadow: 0 0 20px var(--facility-glow), 0 0 40px rgba(0, 0, 0, 0.1);
            }
            50% {
                color: var(--vincent);
                text-shadow: 0 0 12px var(--vincent-glow);
            }
        }
        
        /* Class for inverse pulsing text */
        .inverse-pulse {
            animation: owenInversePulse 8s ease-in-out infinite !important;
        }

        @keyframes owenBorderPulse {
            0%, 100% {
                border-color: var(--vincent);
                box-shadow: inset 0 0 60px var(--vincent-subtle);
            }
            50% {
                border-color: rgba(0, 0, 0, 0.18);
                box-shadow: inset 0 0 60px var(--facility-soft);
            }
        }

        /* Owen sections - everything pulses from Vincent blue to Facility white */
        #owenPage .owen-section,
        #owenPage .owen-section *,
        #owenPage .owen-section-header,
        #owenPage .owen-letter,
        #owenPage .owen-letter *,
        #owenPage .owen-divider,
        #owenPage .owen-interstitial,
        #owenPage .owen-interstitial *,
        #owenPage .owen-cohen-box,
        #owenPage .owen-cohen-box *,
        #owenPage .interstitial-quote,
        #owenPage .interstitial-quote *,
        #owenPage .filler-text,
        #owenPage .c-rabbit,
        #owenPage .c-isla,
        #owenPage .c-owen,
        #owenPage .c-vincent,
        #owenPage .c-warm,
        #owenPage .c-ice,
        #owenPage .c-cold,
        #owenPage .c-emphasis,
        #owenPage .c-marcus,
        #owenPage .c-marcus,
        #owenPage .c-system,
        #owenPage .c-terminated,
        #owenPage .lyrics,
        #owenPage .cutoff,
        #owenPage .you-glow-strong,
        #owenPage .you-fade-white {
            animation: owenVincentPulse 8s ease-in-out infinite;
        }
        
        /* EXCLUDE section-3-void from Owen pulse animations - white room has its own styles */
        #owenPage .section-3-void {
            animation: none !important;
        }
        
        /* Remove SVG filter on Owen's page - can cause rendering issues */
        #owenPage .section-3-void .void-content {
            filter: none !important;
            opacity: 1 !important;
            visibility: visible !important;
        }
        
        #owenPage .section-3-void .owen-section,
        #owenPage .section-3-void .owen-section-header,
        #owenPage .section-3-void .owen-letter {
            animation: none !important;
        }
        
        #owenPage .section-3-void .owen-letter * {
            animation: none !important;
        }
        
        /* Restore specific character colors for void section */
        #owenPage .section-3-void .c-rabbit {
            color: #e8707e !important;
            text-shadow: 0 0 15px rgba(232, 112, 126, 0.4) !important;
        }
        
        #owenPage .section-3-void .c-owen {
            color: #f0a868 !important;
            text-shadow: 0 0 15px rgba(240, 168, 104, 0.4) !important;
        }
        
        #owenPage .section-3-void .c-vincent,
        #owenPage .section-3-void .snake-green {
            color: #6b9ebe !important;
            text-shadow: 0 0 15px rgba(107, 158, 190, 0.4) !important;
        }
        
        #owenPage .section-3-void .c-emphasis {
            color: #ffffff !important;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.4) !important;
        }
        
        #owenPage .section-3-void .c-facility {
            color: rgba(170, 185, 210, 0.95) !important;
            text-shadow: 0 0 20px rgba(140, 130, 170, 0.3) !important;
        }
        
        #owenPage .section-3-void .inverse-pulse {
            color: rgba(160, 150, 190, 0.95) !important;
            text-shadow: 0 0 25px rgba(140, 130, 170, 0.5) !important;
            animation: none !important;
        }
        
        #owenPage .section-3-void .silver-horse {
            color: #c8d0e0 !important;
            text-shadow: 
                0 0 10px rgba(200, 208, 224, 0.8),
                0 0 30px rgba(160, 150, 190, 0.6),
                0 0 60px rgba(120, 110, 160, 0.4) !important;
            animation: voidHorseFlicker 4s ease-in-out infinite !important;
            letter-spacing: 3px !important;
        }
        
        #owenPage .section-3-void .cutoff {
            animation: none !important;
        }

        /* Border pulsing for containers */
        #owenPage .owen-letter {
            animation: owenVincentPulse 8s ease-in-out infinite, owenBorderPulse 8s ease-in-out infinite;
        }
        
        /* Exclude section-3-void letter from border pulse */
        #owenPage .section-3-void .owen-letter {
            animation: none !important;
        }

        /* Dividers pulse too */
        #owenPage .owen-divider {
            animation: owenVincentPulse 8s ease-in-out infinite;
        }

        /* ============ ISLA SECTION - NO PULSE, STAYS CORAL ============ */
        #owenPage .isla-section,
        #owenPage .isla-section *,
        #owenPage .isla-section .owen-section-header,
        #owenPage .isla-section .owen-letter,
        #owenPage .isla-section .isla-letter,
        #owenPage .isla-section .isla-letter *,
        #owenPage .isla-section .c-rabbit,
        #owenPage .isla-section .cutoff,
        #owenPage .isla-section span {
            animation: none !important;
            color: var(--rabbit) !important;
            text-shadow: 0 0 10px rgba(255, 138, 128, 0.4) !important;
        }

        #owenPage .isla-letter {
            animation: none !important;
            border-left-color: var(--rabbit) !important;
            box-shadow: inset 0 0 60px rgba(255, 138, 128, 0.03) !important;
        }

        .owen-cohen-box {
            padding: 40px;
            background: linear-gradient(135deg, rgba(255, 180, 162, 0.04) 0%, rgba(255, 180, 162, 0.01) 100%);
            border: 1px solid rgba(255, 180, 162, 0.15);
            border-radius: 4px;
        }

        .owen-cohen-title {
            font-family: 'Space Mono', monospace;
            font-size: 1.5rem;
            letter-spacing: 4px;
            color: var(--rabbit);
            margin-bottom: 24px;
            text-align: center;
            text-shadow: 0 0 20px rgba(255, 180, 162, 0.3);
        }

        .owen-cohen-content {
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
            line-height: 2.2;
            letter-spacing: 0.5px;
            color: var(--amber);
        }

        .owen-cohen-content p {
            margin-bottom: 16px;
        }

        .owen-cohen-footer {
            font-family: 'Space Mono', monospace;
            font-size: 0.5rem;
            letter-spacing: 2px;
            color: var(--text-dim);
            margin-top: 24px;
            text-align: center;
            opacity: 0.6;
        }

        .owen-green-text {
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
            line-height: 2.2;
            letter-spacing: 0.5px;
            color: var(--teal);
            padding: 40px;
            background: linear-gradient(135deg, rgba(0, 212, 170, 0.04) 0%, rgba(0, 212, 170, 0.01) 100%);
            border-left: 2px solid var(--teal);
            border-radius: 0 4px 4px 0;
            text-shadow: 0 0 30px rgba(0, 212, 170, 0.1);
        }

        .censored-message {
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--text-ghost);
            padding: 20px;
            margin: 20px 0;
        }

        .censored-header {
            color: var(--text-secondary);
            line-height: 1.8;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--text-ghost);
            margin-bottom: 15px;
        }

        .censored-body {
            color: var(--text-dim);
            line-height: 2;
        }

        .redacted-block {
            color: var(--rabbit);
            opacity: 0.6;
            text-shadow: 0 0 8px var(--rabbit-glow);
        }

        .owen-final-moment {
            text-align: center;
            padding: 20px;
        }

        .final-moment-text {
            font-family: 'Space Mono', monospace;
            font-style: italic;
            font-size: 1rem;
            line-height: 2.2;
            color: var(--text-secondary);
            opacity: 0.7;
        }

        .final-moment-line {
            font-family: 'Space Mono', monospace;
            font-style: italic;
            font-size: 1.1rem;
            color: var(--owen);
            opacity: 0.5;
            letter-spacing: 0.5px;
        }

        .owen-interstitial {
            text-align: center;
            padding: 40px 20px;
        }

        .interstitial-text {
            font-family: 'Space Mono', monospace;
            font-style: italic;
            font-size: 1.1rem;
            color: var(--owen);
            opacity: 0.5;
            letter-spacing: 1px;
            text-shadow: 0 0 40px rgba(244, 209, 155, 0.15);
        }

        .interstitial-quote {
            font-family: 'Space Mono', monospace;
            font-style: italic;
            font-size: 1.2rem;
            color: var(--text-secondary);
            opacity: 0.5;
            letter-spacing: 0.5px;
        }

        /* Glitched Dedication */
        .dedication-glitch {
            font-family: 'Space Mono', monospace;
            font-size: 1rem;
            line-height: 2.2;
            color: var(--rabbit);
            text-align: center;
            position: relative;
            text-shadow: 
                0 0 10px var(--rabbit-glow),
                2px 0 var(--vincent),
                -2px 0 var(--owen);
            animation: dedicationPulse 3s ease-in-out infinite;
        }
        
        .dedication-line {
            display: inline-block;
            animation: dedicationGlitch 4s ease-in-out infinite;
            opacity: 0.7;
        }
        
        .dedication-line-1 {
            animation-delay: 0s;
        }
        
        .dedication-line-2 {
            animation-delay: 0.5s;
        }
        
        @keyframes dedicationPulse {
            0%, 100% { 
                opacity: 0.5;
                text-shadow: 0 0 10px var(--rabbit-glow), 2px 0 var(--vincent), -2px 0 var(--owen);
            }
            50% { 
                opacity: 0.8;
                text-shadow: 0 0 20px var(--rabbit-glow), 3px 0 var(--vincent), -3px 0 var(--owen);
            }
        }
        
        @keyframes dedicationGlitch {
            0%, 92%, 100% { 
                transform: translateX(0);
                filter: none;
            }
            93% { 
                transform: translateX(-3px) skewX(-2deg);
                filter: blur(1px);
            }
            94% { 
                transform: translateX(3px) skewX(2deg);
                filter: none;
            }
            95% { 
                transform: translateX(-2px);
                filter: blur(0.5px);
            }
            96% { 
                transform: translateX(0);
                filter: none;
            }
        }

        .owen-ending {
            text-align: center;
            padding: 60px 0;
        }

        .owen-blackjack-container {
            margin-top: 30px;
            padding: 24px;
            background: linear-gradient(135deg, rgba(240, 165, 0, 0.03) 0%, rgba(240, 165, 0, 0.01) 100%);
            border: 1px solid rgba(240, 165, 0, 0.15);
            border-radius: 4px;
        }

        /* ============ ELEVATOR DESCENT EFFECT ============ */
        .elevator-descent {
            position: relative;
        }

        .elevator-spacer {
            height: 70vh;
        }

        .elevator-spacer-large {
            height: 100vh;
        }

        .elevator-marker {
            text-align: center;
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            letter-spacing: 4px;
            color: var(--text-ghost);
            opacity: 0.3;
            padding: 20px 0;
        }

        .elevator-marker.floor-indicator {
            font-family: 'Space Mono', monospace;
            font-size: 1.1rem;
            letter-spacing: 2px;
            color: #1a8a6a;
            text-shadow: 
                0 0 8px rgba(26, 138, 106, 0.6),
                0 0 15px rgba(26, 138, 106, 0.3);
            animation: floorFlicker 4s ease-in-out infinite;
            opacity: 1;
        }
        
        @keyframes floorFlicker {
            0%, 100% { 
                opacity: 1;
                text-shadow: 
                    0 0 8px rgba(26, 138, 106, 0.6),
                    0 0 15px rgba(26, 138, 106, 0.3);
            }
            50% { 
                opacity: 0.7;
                text-shadow: 
                    0 0 5px rgba(26, 138, 106, 0.4),
                    0 0 10px rgba(26, 138, 106, 0.2);
            }
            52% { 
                opacity: 0.4;
            }
            54% { 
                opacity: 0.85;
            }
        }
        
        /* Creepy symbol floors */
        .elevator-marker.floor-symbol {
            font-family: 'Space Mono', monospace;
            font-size: 1.1rem;
            letter-spacing: 3px;
            color: #8a4a4a;
            text-shadow: 
                0 0 6px rgba(138, 74, 74, 0.5),
                0 0 12px rgba(138, 74, 74, 0.25);
            animation: symbolPulse 3s ease-in-out infinite;
        }
        
        @keyframes symbolPulse {
            0%, 100% { 
                opacity: 0.6;
            }
            50% { 
                opacity: 0.3;
            }
        }
        
        /* Progressive block corruption - mild flicker */
        .elevator-marker.floor-corrupt-1 {
            font-family: 'Space Mono', monospace;
            font-size: 1.1rem;
            letter-spacing: 2px;
            animation: corruptFlicker1 1.5s steps(3) infinite;
        }
        
        @keyframes corruptFlicker1 {
            0%, 100% { opacity: 0.35; transform: translateX(0); }
            20% { opacity: 0.25; transform: translateX(0.5px); }
            40% { opacity: 0.4; transform: translateX(-0.5px); }
            60% { opacity: 0.2; }
            80% { opacity: 0.35; transform: translateX(0.5px); }
        }
        
        /* Progressive block corruption - medium flicker */
        .elevator-marker.floor-corrupt-2 {
            font-family: 'Space Mono', monospace;
            font-size: 1.1rem;
            letter-spacing: 2px;
            animation: corruptFlicker2 0.8s steps(4) infinite;
        }
        
        @keyframes corruptFlicker2 {
            0%, 100% { opacity: 0.3; transform: translateX(0); }
            12% { opacity: 0.15; transform: translateX(1px); }
            25% { opacity: 0.35; transform: translateX(-1px); }
            37% { opacity: 0.1; transform: translateX(0.5px); }
            50% { opacity: 0.3; transform: translateX(-0.5px); }
            62% { opacity: 0.05; transform: translateX(1.5px); }
            75% { opacity: 0.25; transform: translateX(-1px); }
            87% { opacity: 0.15; transform: translateX(0); }
        }
        
        /* Progressive block corruption - intense flicker */
        .elevator-marker.floor-corrupt-3 {
            font-family: 'Space Mono', monospace;
            font-size: 1.1rem;
            letter-spacing: 2px;
            animation: corruptFlicker3 0.3s steps(5) infinite;
        }
        
        @keyframes corruptFlicker3 {
            0%, 100% { opacity: 0.25; transform: translateX(0); }
            10% { opacity: 0.05; transform: translateX(2px); }
            20% { opacity: 0.3; transform: translateX(-1.5px); }
            30% { opacity: 0.1; transform: translateX(1px); }
            40% { opacity: 0.2; transform: translateX(-2px); }
            50% { opacity: 0.02; transform: translateX(1.5px); }
            60% { opacity: 0.25; transform: translateX(-1px); }
            70% { opacity: 0.08; transform: translateX(2px); }
            80% { opacity: 0.15; transform: translateX(-1.5px); }
            90% { opacity: 0.03; transform: translateX(0.5px); }
        }
        
        /* Corrupted/glitching floor */
        .elevator-marker.floor-corrupted {
            font-family: 'Space Mono', monospace;
            font-size: 1.1rem;
            color: rgba(0, 0, 0, 0.18);
            text-shadow: 
                0 0 8px rgba(0, 0, 0, 0.15);
            animation: corruptedFloor 0.8s steps(2) infinite;
        }
        
        @keyframes corruptedFloor {
            0% { 
                opacity: 0.5;
                transform: translateX(0);
            }
            25% { 
                opacity: 0.2;
                transform: translateX(-1px);
            }
            50% { 
                opacity: 0.4;
                transform: translateX(1px);
            }
            75% { 
                opacity: 0.15;
            }
            100% { 
                opacity: 0.45;
                transform: translateX(0);
            }
        }
        
        /* Subtle elevator floor line indicator - DISABLED */
        .elevator-floor-line {
            display: none;
        }

        .white-fade-zone {
            position: relative;
            background: linear-gradient(to bottom, 
                var(--bg-primary) 0%,
                rgba(255,255,255,0.1) 30%,
                rgba(255,255,255,0.4) 60%,
                rgba(255,255,255,0.8) 85%,
                #ffffff 100%
            );
        }

        .white-room-ending {
            background: #ffffff;
            padding: 100px 20px;
            min-height: 60vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 60;
        }

        .white-room-ending .ending-attribution-block {
            text-align: center;
            position: relative;
            z-index: 100;
            pointer-events: auto;
        }

        .white-room-ending .ending-title-credit {
            color: #000 !important;
            font-size: 1.8rem;
            text-transform: lowercase;
        }

        .white-room-ending .ending-title-credit span {
            color: #000 !important;
        }
        
        .white-room-ending .ending-title-credit .credits-tld {
            color: #000 !important;
        }
        
        .white-room-ending .ending-title-credit .credits-i {
            color: var(--rabbit) !important;
        }
        
        .white-room-ending .ending-title-credit .credits-o {
            color: var(--owen) !important;
        }
        
        /* Rabbit slowly cycles to Isla's color */
        .white-room-ending .ending-title-credit .rabbit-memory {
            animation: rabbitMemory 8s ease-in-out infinite;
        }
        
        @keyframes rabbitMemory {
            0%, 30% {
                color: #000;
            }
            50%, 80% {
                color: var(--rabbit);
            }
            100% {
                color: #000;
            }
        }

        .white-room-ending .ending-author {
            color: #333 !important;
        }
        
        .white-room-ending .ending-hint {
            font-family: 'Space Mono', monospace;
            font-size: 0.65rem;
            letter-spacing: 1px;
            color: #666 !important;
            margin-top: 40px;
            line-height: 2;
            opacity: 0;
            animation: hintFadeIn 2s ease-out 1s forwards;
        }
        
        .white-room-ending .ending-hint .hint-owen {
            color: #c9a227;
            text-shadow: 0 0 8px rgba(201, 162, 39, 0.5);
        }
        
        .white-room-ending .ending-hint .hint-isla {
            color: #e85a4f;
            
        }
        
        .white-room-ending .ending-hint .hint-vincent {
            color: #cc7a29;
            text-shadow: 0 0 8px rgba(204, 122, 41, 0.5);
        }
        
        @keyframes hintFadeIn {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        .credits-restart-btn {
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            letter-spacing: 3px;
            color: #000;
            background: transparent;
            border: 1px solid #000;
            padding: 12px 32px;
            margin-top: 30px;
            cursor: pointer;
            transition: all 0.2s ease;
            opacity: 0;
            animation: hintFadeIn 2s ease-out 1.5s forwards;
            position: relative;
            z-index: 101;
            pointer-events: auto !important;
        }
        
        .credits-restart-btn:hover {
            background: var(--bg-primary);
            color: var(--text-bright);
        }
        
        .white-room-ending .ending-hint-small {
            font-family: 'Space Mono', monospace;
            font-size: 0.5rem;
            letter-spacing: 0.5px;
            color: #aaa !important;
            margin-top: 16px;
            opacity: 0;
            animation: hintFadeIn 2s ease-out 2s forwards;
        }
        
        .white-room-ending .hint-censor {
            animation: censorCycle 3s ease-in-out infinite;
        }
        
        @keyframes censorCycle {
            0%, 100% { 
                color: #c9a227;
                text-shadow: 0 0 4px rgba(201, 162, 39, 0.4);
            }
            33% { 
                color: #e85a4f;
                text-shadow: 0 0 4px rgba(232, 90, 79, 0.4);
            }
            66% { 
                color: #cc7a29;
                text-shadow: 0 0 4px rgba(204, 122, 41, 0.4);
            }
        }
        
        /* HORSE hint styling */
        .white-room-ending .ending-hint .hint-horse {
            color: #888;
        }
        
        /* Rizz Lore Button */
        .rizz-lore-btn {
            font-family: 'Space Mono', monospace;
            font-size: 0.65rem;
            letter-spacing: 2px;
            color: var(--rabbit);
            background: transparent;
            border: 1px solid var(--rabbit);
            padding: 10px 24px;
            margin-top: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            z-index: 9999;
            pointer-events: auto;
        }
        
        .rizz-lore-btn:hover {
            background: var(--rabbit);
            color: #000;
            box-shadow: 0 0 15px rgba(232, 112, 126, 0.5);
        }
        
        /* Marcus Lore Dialog */
        .marcus-lore-dialog {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(250, 248, 245, 0.95);
            z-index: 10005;
            justify-content: center;
            align-items: center;
        }
        
        .marcus-lore-dialog.active {
            display: flex;
        }
        
        .marcus-dialog-box {
            background: var(--bg-elevated);
            border: 2px solid var(--marcus);
            padding: 30px 40px;
            max-width: 500px;
            margin: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .marcus-dialog-header {
            font-family: 'VT323', monospace;
            font-size: 1.5rem;
            color: var(--marcus);
            text-align: center;
            margin-bottom: 20px;
            letter-spacing: 3px;
        }
        
        .marcus-dialog-text {
            font-family: 'Space Mono', monospace;
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.8;
            margin-bottom: 30px;
        }
        
        .marcus-dialog-options {
            display: flex;
            gap: 20px;
            justify-content: center;
        }
        
        .marcus-option-btn {
            font-family: 'VT323', monospace;
            font-size: 1.2rem;
            letter-spacing: 2px;
            padding: 12px 30px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }
        
        .marcus-option-btn.yessir {
            background: var(--rabbit);
            color: #000;
        }
        
        .marcus-option-btn.yessir:hover {
            background: #22c55e;
            box-shadow: 0 0 20px rgba(232, 112, 126, 0.6);
        }
        
        .marcus-option-btn.nodiddy {
            background: transparent;
            color: #666;
            border: 1px solid #666;
        }
        
        .marcus-option-btn.nodiddy:hover {
            color: #999;
            border-color: #999;
        }
        
        /* Lore Page Styles */
        /* ════════════════════════════════════
           LORE EXPLANATION PAGE - Marcus Style (matches containment logs)
           ════════════════════════════════════ */
        
        #lorePage {
            background: var(--bg-primary) !important;
            position: fixed !important;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 99999 !important;
            overflow-y: auto;
        }
        
        .lore-page-container {
            min-height: 100vh;
            background: var(--bg-primary);
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .lore-header {
            text-align: center;
            margin-bottom: 30px;
            padding-top: 20px;
        }
        
        .lore-header-warning {
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            letter-spacing: 3px;
            color: var(--rabbit);
            margin-bottom: 12px;
        }
        
        .lore-header-title {
            font-family: 'VT323', monospace;
            font-size: 1.8rem;
            letter-spacing: 6px;
            color: var(--text-bright);
            margin-bottom: 8px;
        }
        
        .lore-header-title .marcus-green {
            color: var(--rabbit);
            text-shadow: 0 0 15px rgba(232, 112, 126, 0.5);
        }
        
        .lore-header-sub {
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            letter-spacing: 2px;
            color: var(--text-dim);
        }
        
        .lore-status-bar {
            display: flex;
            justify-content: center;
            gap: 30px;
            padding: 14px 20px;
            background: rgba(232, 112, 126, 0.05);
            border: 1px solid rgba(232, 112, 126, 0.2);
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .lore-status-item {
            font-family: 'Space Mono', monospace;
            font-size: 0.6rem;
            letter-spacing: 1px;
            color: var(--text-dim);
        }
        
        .lore-status-value {
            color: var(--rabbit);
        }
        
        .lore-status-warning {
            color: #e85a4f !important;
            
        }
        
        .lore-logs-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .lore-log {
            background: rgba(232, 112, 126, 0.03);
            border: 1px solid rgba(232, 112, 126, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .lore-log:hover {
            border-color: rgba(232, 112, 126, 0.4);
            background: rgba(232, 112, 126, 0.06);
        }
        
        .lore-log::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(180deg, transparent, var(--rabbit), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .lore-log.revealed::before {
            opacity: 1;
        }
        
        /* Warning/Red style for final log */
        .lore-log.warning-log {
            background: rgba(232, 90, 79, 0.03);
            border: 1px solid rgba(232, 90, 79, 0.3);
        }
        
        .lore-log.warning-log:hover {
            border-color: rgba(232, 90, 79, 0.5);
            background: rgba(232, 90, 79, 0.06);
        }
        
        .lore-log.warning-log::before {
            background: linear-gradient(180deg, transparent, #e85a4f, transparent);
        }
        
        .lore-log.warning-log .lore-log-icon,
        .lore-log.warning-log .lore-log-status {
            color: #e85a4f !important;
            
        }
        
        /* Marcus style - mint green */
        .lore-log.marcus-log {
            background: rgba(94, 198, 158, 0.03);
            border: 1px solid rgba(94, 198, 158, 0.2);
        }
        
        .lore-log.marcus-log:hover {
            border-color: rgba(94, 198, 158, 0.4);
            background: rgba(94, 198, 158, 0.06);
        }
        
        .lore-log.marcus-log::before {
            background: linear-gradient(180deg, transparent, var(--marcus), transparent);
        }
        
        .lore-log.marcus-log .lore-log-icon,
        .lore-log.marcus-log .lore-log-status {
            color: var(--marcus) !important;
            text-shadow: 0 0 8px var(--marcus-glow);
        }
        
        .lore-log.marcus-log .lore-log-header {
            background: rgba(94, 198, 158, 0.08);
            border-bottom: 1px solid rgba(94, 198, 158, 0.1);
        }
        
        .lore-log.marcus-log .lore-log-text .highlight {
            color: var(--marcus) !important;
            text-shadow: 0 0 8px var(--marcus-glow);
        }
        
        .lore-log.marcus-log .lore-log-footer {
            background: rgba(94, 198, 158, 0.03);
            border-top: 1px solid rgba(94, 198, 158, 0.08);
        }
        
        /* Developer Credits Log - Special styling */
        .lore-log.credits-log {
            border-color: rgba(147, 112, 219, 0.4);
            background: linear-gradient(135deg, 
                rgba(147, 112, 219, 0.05) 0%, 
                rgba(64, 224, 208, 0.05) 50%,
                rgba(255, 182, 193, 0.05) 100%);
        }
        
        .lore-log.credits-log:hover {
            border-color: rgba(147, 112, 219, 0.6);
            box-shadow: 0 0 25px rgba(147, 112, 219, 0.15);
        }
        
        .lore-log.credits-log::before {
            background: linear-gradient(180deg, transparent, #9370db, #40e0d0, #ffb6c1, transparent);
        }
        
        .lore-log.credits-log .lore-log-icon,
        .lore-log.credits-log .lore-log-status {
            color: #9370db !important;
            text-shadow: 0 0 8px rgba(147, 112, 219, 0.5);
        }
        
        .lore-log.credits-log .lore-log-header {
            background: linear-gradient(90deg, 
                rgba(147, 112, 219, 0.08) 0%, 
                rgba(64, 224, 208, 0.08) 50%,
                rgba(255, 182, 193, 0.08) 100%);
            border-bottom: 1px solid rgba(147, 112, 219, 0.2);
        }
        
        .lore-log.credits-log .lore-log-title {
            background: linear-gradient(90deg, #9370db, #40e0d0, #ffb6c1, #9370db);
            background-size: 300% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: creditsGradient 4s ease-in-out infinite;
        }
        
        @keyframes creditsGradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .lore-log.credits-log .highlight {
            color: #40e0d0 !important;
            text-shadow: 0 0 8px rgba(64, 224, 208, 0.5);
        }
        
        .credits-rainbow-text {
            background: linear-gradient(90deg, #9370db, #40e0d0, #ffb6c1, #ffd700, #9370db);
            background-size: 300% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: creditsGradient 3s ease-in-out infinite;
        }
        
        .lore-log.credits-log .lore-log-footer {
            background: linear-gradient(90deg, 
                rgba(147, 112, 219, 0.05) 0%, 
                rgba(64, 224, 208, 0.05) 50%,
                rgba(255, 182, 193, 0.05) 100%);
            border-top: 1px solid rgba(147, 112, 219, 0.15);
        }
        
        .lore-log.credits-log .lore-log-footer span {
            color: #9370db;
        }
        
        .lore-log-locked {
            padding: 28px 20px;
            text-align: center;
            transition: opacity 0.3s ease;
        }
        
        .lore-log.revealed .lore-log-locked {
            display: none;
        }
        
        .lore-log-icon {
            font-size: 1.75rem;
            color: var(--rabbit);
            margin-bottom: 10px;
            animation: loreIconPulse 2s ease-in-out infinite;
        }
        
        @keyframes loreIconPulse {
            0%, 100% { 
                text-shadow: 0 0 10px rgba(232, 112, 126, 0.3);
                opacity: 0.6;
            }
            50% { 
                text-shadow: 0 0 20px rgba(232, 112, 126, 0.6);
                opacity: 1;
            }
        }
        
        .lore-log-label {
            font-family: 'Space Mono', monospace;
            font-size: 0.6875rem;
            letter-spacing: 2px;
            color: #777;
        }
        
        .lore-log-content {
            display: none;
        }
        
        .lore-log.revealed .lore-log-content {
            display: block;
        }
        
        .lore-log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 18px;
            background: rgba(232, 112, 126, 0.08);
            border-bottom: 1px solid rgba(232, 112, 126, 0.1);
        }
        
        .lore-log.warning-log .lore-log-header {
            background: rgba(232, 90, 79, 0.08);
            border-bottom: 1px solid rgba(232, 90, 79, 0.1);
        }
        
        .lore-log-status {
            font-family: 'Space Mono', monospace;
            font-size: 0.6875rem;
            letter-spacing: 1px;
            color: var(--rabbit);
            text-shadow: 0 0 8px rgba(232, 112, 126, 0.5);
        }
        
        .lore-log-id {
            font-family: 'Space Mono', monospace;
            font-size: 0.625rem;
            letter-spacing: 1px;
            color: #777;
        }
        
        .lore-log-body {
            padding: 24px 20px;
        }
        
        .lore-log-title {
            font-family: 'VT323', monospace;
            font-size: 1.1rem;
            letter-spacing: 2px;
            color: var(--text-bright);
            margin-bottom: 8px;
        }
        
        .lore-log-subtitle {
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            letter-spacing: 1px;
            color: var(--text-dim);
            margin-bottom: 20px;
        }
        
        .lore-log-text {
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            line-height: 1.9;
            color: var(--text-secondary);
        }
        
        .lore-log-text .highlight {
            color: var(--rabbit);
        }
        
        /* MARA STYLE text - glowing coral with pulse */
        .lore-log-text .mara-text {
            color: var(--rabbit);
            font-weight: 700;
            text-shadow: 
                0 0 8px rgba(232, 112, 126, 0.6),
                0 0 16px rgba(232, 112, 126, 0.4),
                0 0 24px rgba(232, 112, 126, 0.2);
            animation: maraGlow 2s ease-in-out infinite;
        }
        
        .lore-log.warning-log .lore-log-text .highlight {
            color: #e85a4f;
        }
        
        .lore-log-footer {
            display: flex;
            justify-content: space-between;
            padding: 12px 18px;
            background: rgba(232, 112, 126, 0.03);
            border-top: 1px solid rgba(232, 112, 126, 0.08);
            font-family: 'Space Mono', monospace;
            font-size: 0.5625rem;
            letter-spacing: 1px;
            color: #555;
        }
        
        .lore-log.warning-log .lore-log-footer {
            background: rgba(232, 90, 79, 0.03);
            border-top: 1px solid rgba(232, 90, 79, 0.08);
        }
        
        .lore-back-btn {
            display: block;
            width: 100%;
            max-width: 350px;
            margin: 40px auto;
            font-family: 'VT323', monospace;
            font-size: 1.2rem;
            letter-spacing: 2px;
            color: #000;
            background: var(--rabbit);
            border: none;
            padding: 15px 30px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .lore-back-btn:hover {
            background: #22c55e;
            box-shadow: 0 0 25px rgba(232, 112, 126, 0.6);
        }
        
        @media (max-width: 600px) {
            .lore-header-title {
                font-size: 1.4rem;
            }
            
            .lore-status-bar {
                flex-direction: column;
                gap: 8px;
                text-align: center;
            }
            
            .lore-log-text {
                font-size: 0.7rem;
            }
            
            .marcus-dialog-box {
                padding: 20px;
            }
            
            .marcus-dialog-text {
                font-size: 0.75rem;
            }
            
            .marcus-dialog-options {
                flex-direction: column;
                gap: 10px;
            }
        }
        
        /* ════════════════════════════════════
           NOTEPAD MODE - Clean reading view for lore pages
           ════════════════════════════════════ */
        
        .notepad-toggle-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 1px;
            color: #666;
            background: rgba(30, 30, 30, 0.95);
            border: 1px solid #444;
            padding: 10px 14px;
            cursor: pointer;
            z-index: 100000;
            transition: all 0.2s ease;
        }
        
        .notepad-toggle-btn:hover {
            color: var(--text-bright);
            border-color: #888;
            background: rgba(50, 50, 50, 0.95);
        }
        
        /* Notepad mode active styles */
        .notepad-mode {
            background: #fefefe !important;
        }
        
        .notepad-mode * {
            color: #1a1a1a !important;
            text-shadow: none !important;
            border-color: #ddd !important;
        }
        
        .notepad-mode .notepad-toggle-btn {
            background: #f0f0f0 !important;
            border-color: #ccc !important;
            color: #333 !important;
        }
        
        .notepad-mode .notepad-toggle-btn:hover {
            background: #e0e0e0 !important;
            border-color: #999 !important;
        }
        
        /* Horse containment page notepad mode */
        #horseContainmentPage.notepad-mode .page-content,
        #horseContainmentPage.notepad-mode .horse-page {
            background: #fefefe !important;
        }
        
        #horseContainmentPage.notepad-mode .horse-log {
            background: #f8f8f8 !important;
            border: 1px solid #ddd !important;
        }
        
        #horseContainmentPage.notepad-mode .horse-log::before {
            background: linear-gradient(180deg, transparent, #666, transparent) !important;
        }
        
        #horseContainmentPage.notepad-mode .horse-log-header {
            background: #f0f0f0 !important;
            border-bottom: 1px solid #ddd !important;
        }
        
        #horseContainmentPage.notepad-mode .horse-log-footer {
            background: #f5f5f5 !important;
            border-top: 1px solid #eee !important;
        }
        
        #horseContainmentPage.notepad-mode .horse-log-icon {
            animation: none !important;
            opacity: 1 !important;
        }
        
        #horseContainmentPage.notepad-mode .silver-horse {
            color: #333 !important;
            font-weight: bold !important;
        }
        
        #horseContainmentPage.notepad-mode .horse-status-unstable,
        #horseContainmentPage.notepad-mode .horse-status-warning {
            color: #c00 !important;
        }
        
        /* Lore page notepad mode */
        #lorePage.notepad-mode,
        #lorePage.notepad-mode .lore-page-container {
            background: #fefefe !important;
        }
        
        #lorePage.notepad-mode .lore-log {
            background: #f8f8f8 !important;
            border: 1px solid #ddd !important;
        }
        
        #lorePage.notepad-mode .lore-log::before {
            background: linear-gradient(180deg, transparent, #666, transparent) !important;
        }
        
        #lorePage.notepad-mode .lore-log-header {
            background: #f0f0f0 !important;
            border-bottom: 1px solid #ddd !important;
        }
        
        #lorePage.notepad-mode .lore-log-footer {
            background: #f5f5f5 !important;
            border-top: 1px solid #eee !important;
        }
        
        #lorePage.notepad-mode .lore-log-icon {
            animation: none !important;
            opacity: 1 !important;
        }
        
        #lorePage.notepad-mode .lore-log.warning-log {
            background: #fff5f5 !important;
            border: 1px solid #fcc !important;
        }
        
        #lorePage.notepad-mode .lore-log.warning-log .lore-log-header {
            background: #ffeeee !important;
            border-bottom: 1px solid #fcc !important;
        }
        
        #lorePage.notepad-mode .highlight {
            color: #006600 !important;
            font-weight: bold !important;
        }
        
        #lorePage.notepad-mode .lore-log.warning-log .highlight {
            color: #cc0000 !important;
        }
        
        #lorePage.notepad-mode .lore-status-warning {
            color: #c00 !important;
        }
        
        #lorePage.notepad-mode .lore-back-btn {
            background: var(--text-primary) !important;
            color: var(--bg-primary) !important;
        }
        
        #lorePage.notepad-mode .lore-back-btn:hover {
            background: var(--text-secondary) !important;
        }
        
        .hint-horse .horse-censor {
            color: #C0C0C0;
            text-shadow: 
                0 0 8px rgba(192, 192, 192, 0.6),
                0 0 16px rgba(192, 192, 192, 0.4);
            animation: horseCensorPulse 2s ease-in-out infinite;
            letter-spacing: 0;
        }
        
        .hint-horse .horse-letter {
            animation: horseLetterCycle 8s ease-in-out infinite;
            color: #E8E8E8;
            text-shadow: 
                0 0 10px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(192, 192, 192, 0.7);
        }
        
        @keyframes horseLetterCycle {
            0%, 20% { opacity: 1; }
            25%, 45% { opacity: 0; }
            50%, 70% { opacity: 0; }
            75%, 95% { opacity: 0; }
            100% { opacity: 1; }
        }
        
        .hint-horse .horse-censor-verb {
            color: #C0C0C0;
            text-shadow: 
                0 0 8px rgba(192, 192, 192, 0.6),
                0 0 16px rgba(192, 192, 192, 0.4);
            animation: horseCensorPulse 2s ease-in-out infinite;
        }
        
        @keyframes horseCensorPulse {
            0%, 100% { 
                opacity: 0.7;
                text-shadow: 
                    0 0 8px rgba(192, 192, 192, 0.6),
                    0 0 16px rgba(192, 192, 192, 0.4);
            }
            50% { 
                opacity: 1;
                text-shadow: 
                    0 0 12px rgba(0, 0, 0, 0.25),
                    0 0 24px rgba(192, 192, 192, 0.6);
            }
        }

        /* White overlay that fades in during descent */
        .owen-white-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #ffffff;
            pointer-events: none;
            opacity: 0;
            z-index: 50;
            transition: opacity 0.3s ease;
        }

        @media (min-width: 480px) {
            .owen-reading-page {
                padding: 40px;
            }

            .owen-letter {
                font-size: 1.15rem;
                padding: 32px;
            }
            
            .white-room-ending .ending-title-credit {
                font-size: 2.2rem;
            }
        }

        @media (min-width: 480px) {
            .ending-verdict {
                font-size: 2.6rem;
                letter-spacing: 10px;
            }
        }

        .ending-subtext {
            font-family: 'Space Mono', monospace;
            font-size: 0.95rem;
            letter-spacing: 4px;
            color: var(--green);
            opacity: 0.6;
            margin-bottom: 64px;
        }

        .ending-message {
            font-size: 0.9rem;
            color: var(--text-dim);
            line-height: 2.2;
            margin-bottom: 80px;
            max-width: 280px;
        }

        .ending-divider {
            width: 48px;
            height: 1px;
            background: var(--border);
            margin-bottom: 40px;
        }

        .ending-title {
            font-family: 'Space Mono', monospace;
            font-size: 0.8rem;
            letter-spacing: 4px;
            color: var(--amber);
            margin-bottom: 12px;
            text-transform: uppercase;
        }

        .ending-attribution {
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            color: var(--text-dim);
            opacity: 0.5;
            letter-spacing: 1px;
        }

        /* ============ REPORT BUTTON - HIGHLY VISIBLE ============ */
        .report-btn {
            padding: 6px 12px;
            background: transparent;
            border: 1px solid var(--coral);
            color: var(--coral);
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            opacity: 0.7;
        }

        .report-btn:hover {
            background: var(--coral);
            color: var(--text-bright);
            opacity: 1;
        }

        .report-btn:active {
            transform: scale(0.98);
        }

        /* Watermark */
        .watermark {
            position: fixed;
            bottom: 16px;
            left: 20px;
            font-family: 'Space Mono', monospace;
            font-size: 0.65rem;
            color: var(--text-dim);
            opacity: 0.2;
            letter-spacing: 2px;
            z-index: 100;
            pointer-events: none;
        }

        @media (max-width: 400px) {
            .watermark {
                display: none;
            }
        }

        .report-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.94);
            z-index: 10001;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .report-modal.active {
            display: flex;
        }

        .report-modal-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            padding: 32px;
            max-width: 480px;
            width: 100%;
            position: relative;
        }

        .report-modal-header {
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            letter-spacing: 3px;
            color: var(--text-bright);
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .report-modal-subtext {
            font-size: 0.7rem;
            color: var(--text-dim);
            margin-bottom: 28px;
            line-height: 1.8;
        }

        .report-textarea {
            width: 100%;
            min-height: 140px;
            padding: 16px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.8;
            resize: vertical;
            margin-bottom: 24px;
        }

        .report-textarea:focus {
            outline: none;
            border-color: var(--border-light);
        }

        .report-textarea::placeholder {
            color: var(--text-dim);
            opacity: 0.5;
        }

        .report-email-section {
            margin-bottom: 20px;
        }

        .report-email-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: block;
            letter-spacing: 1px;
        }

        .report-email-input {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
        }

        .report-email-input:focus {
            outline: none;
            border-color: var(--border-light);
        }

        .report-email-input::placeholder {
            color: var(--text-dim);
            opacity: 0.5;
        }

        .report-modal-buttons {
            display: flex;
            gap: 12px;
        }

        .report-modal-btn {
            flex: 1;
            padding: 14px 16px;
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .report-cancel-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-dim);
        }

        .report-cancel-btn:hover {
            border-color: var(--text-secondary);
            color: var(--text-secondary);
        }

        .report-submit-btn {
            background: transparent;
            border: 1px solid var(--coral);
            color: var(--coral);
        }

        .report-submit-btn:hover {
            background: var(--coral-glow);
        }

        .report-submit-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .report-confirmation {
            display: none;
            text-align: center;
            padding: 24px 0;
        }

        .report-confirmation.active {
            display: block;
        }

        .report-confirmation-icon {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--green);
        }

        .report-confirmation-text {
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
            letter-spacing: 3px;
            color: var(--green);
            margin-bottom: 8px;
        }

        .report-confirmation-subtext {
            font-size: 0.7rem;
            color: var(--text-dim);
            line-height: 1.8;
        }

        .report-form.hidden {
            display: none;
        }

        /* ============ CALIBRATION MINI-GAMES ============ */
        .calibration-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 100000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        
        .calibration-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .calibration-container {
            width: 95%;
            max-width: 600px;
            text-align: center;
            color: #e0e0e0;
            font-family: 'Courier New', monospace;
            padding: 0 10px;
        }
        
        .calibration-title {
            font-size: 0.7rem;
            letter-spacing: 3px;
            color: #666;
            margin-bottom: 20px;
            text-transform: uppercase;
        }
        
        .calibration-status {
            font-size: 0.65rem;
            letter-spacing: 2px;
            color: #00d4ff;
            margin-bottom: 15px;
            text-transform: uppercase;
            opacity: 0.8;
        }
        
        .calibration-game-title {
            font-size: 1.1rem;
            color: #fff;
            margin-bottom: 8px;
            letter-spacing: 1px;
        }
        
        .calibration-instruction {
            font-size: 0.75rem;
            color: #888;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .calibration-game-area {
            position: relative;
            width: 100%;
            height: 280px;
            margin: 10px 0;
            border: 1px solid #333;
            background: #0a0a0a;
            border-radius: 4px;
            overflow: hidden;
        }
        
        @media (max-width: 480px) {
            .calibration-game-area {
                height: 320px;
            }
        }
        
        .calibration-progress-bar {
            width: 100%;
            height: 4px;
            background: #222;
            margin-top: 20px;
            border-radius: 2px;
            overflow: hidden;
        }
        
        .calibration-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #444, #888);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .calibration-status {
            font-size: 0.7rem;
            color: #555;
            margin-top: 12px;
            letter-spacing: 1px;
        }
        
        /* Game 1: Sync Pulse - REDESIGNED */
        .sync-pulse-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
        }
        
        /* Outer reference ring (dim) */
        .sync-pulse-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 180px;
            height: 180px;
            border: 2px solid #333;
            border-radius: 50%;
        }
        
        /* Inner reference ring (very dim) */
        .sync-pulse-ring::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            border: 1px solid #222;
            border-radius: 50%;
        }
        
        /* MIDDLE TARGET RING - the goal (bright and clear) */
        .sync-pulse-target {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            border: 4px solid #fff;
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.6), 
                        0 0 40px rgba(255, 255, 255, 0.3),
                        inset 0 0 15px rgba(255, 255, 255, 0.15);
            animation: targetGlow 1.5s ease-in-out infinite;
        }
        
        @keyframes targetGlow {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(255, 255, 255, 0.6), 
                            0 0 40px rgba(255, 255, 255, 0.3),
                            inset 0 0 15px rgba(255, 255, 255, 0.15);
            }
            50% { 
                box-shadow: 0 0 30px rgba(255, 255, 255, 0.8), 
                            0 0 60px rgba(255, 255, 255, 0.4),
                            inset 0 0 25px rgba(255, 255, 255, 0.25);
            }
        }
        
        .sync-pulse-wave {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            border: 3px solid #4af;
            border-radius: 50%;
            animation: pulseExpand 2s linear infinite;
            box-shadow: 0 0 10px rgba(68, 170, 255, 0.5);
        }
        
        @keyframes pulseExpand {
            0% { width: 20px; height: 20px; opacity: 1; border-color: #4af; }
            50% { width: 110px; height: 110px; opacity: 0.8; border-color: #8cf; }
            100% { width: 200px; height: 200px; opacity: 0; border-color: #4af; }
        }
        
        .sync-pulse-btn {
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 50px;
            background: linear-gradient(180deg, #1a3a4a, #0d2530);
            border: 2px solid #00d4ff;
            color: #00d4ff;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.15s ease;
            letter-spacing: 3px;
            border-radius: 4px;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }
        
        .sync-pulse-btn:hover {
            background: linear-gradient(180deg, #2a4a5a, #1a3a4a);
            border-color: #00ffff;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.4);
        }
        
        .sync-pulse-btn:active {
            background: linear-gradient(180deg, #0d2530, #051520);
            transform: translateX(-50%) scale(0.98);
        }
        
        .sync-feedback {
            position: absolute;
            top: 25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1rem;
            font-weight: bold;
            color: #666;
            opacity: 0;
            transition: opacity 0.2s ease;
            letter-spacing: 2px;
        }
        
        .sync-feedback.show {
            opacity: 1;
        }
        
        .sync-feedback.perfect { color: #4f8; text-shadow: 0 0 10px #4f8; }
        .sync-feedback.good { color: #aaa; }
        .sync-feedback.miss { color: #f64; }
        
        .sync-attempts {
            position: absolute;
            top: 25px;
            right: 25px;
            font-size: 0.75rem;
            color: #555;
            letter-spacing: 1px;
        }
        
        /* Game 2: Frequency Lock */
        .freq-lock-display {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.4rem;
            font-family: 'Courier New', monospace;
            color: #888;
            letter-spacing: 2px;
        }
        
        .freq-lock-target {
            color: #00d4ff;
            font-size: 0.75rem;
            margin-top: 4px;
            text-shadow: 0 0 8px rgba(0, 212, 255, 0.4);
        }
        
        /* Timer bar at bottom */
        .freq-timer-bar {
            position: absolute;
            bottom: 80px;
            left: 20px;
            right: 20px;
            height: 4px;
            background: #222;
            border-radius: 2px;
            overflow: hidden;
        }
        
        .freq-timer-fill {
            height: 100%;
            background: linear-gradient(90deg, #666, #888);
            width: 100%;
            transition: width 0.1s linear;
        }
        
        .freq-timer-fill.warning {
            background: linear-gradient(90deg, #a55, #c66);
        }
        
        .freq-timer-fill.critical {
            background: linear-gradient(90deg, #c44, #e55);
            animation: timerPulse 0.5s ease-in-out infinite;
        }
        
        @keyframes timerPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        .freq-lock-wave {
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 60px;
            transform: translateY(-50%);
        }
        
        .freq-lock-wave svg {
            width: 100%;
            height: 100%;
        }
        
        .freq-wave-line {
            fill: none;
            stroke: #00d4ff;
            stroke-width: 2;
        }
        
        .freq-wave-line.user {
            stroke: #888;
        }
        
        .freq-lock-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
        }
        
        .freq-btn {
            width: 50px;
            height: 50px;
            background: transparent;
            border: 1px solid #00d4ff;
            color: #00d4ff;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 4px;
        }
        
        .freq-btn:hover {
            border-color: #00ffff;
            color: #fff;
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
        }
        
        .freq-btn:active {
            background: rgba(0, 212, 255, 0.1);
        }
        
        .freq-match-indicator {
            position: absolute;
            top: 15px;
            right: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #333;
            transition: background 0.3s ease;
        }
        
        .freq-match-indicator.locked {
            background: #4a4;
            box-shadow: 0 0 10px #4a4;
        }
        
        /* Game 3: Neural Handshake - BIGGER GRID, MORE COLOR */
        .neural-grid {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }
        
        .neural-node {
            width: 70px;
            height: 70px;
            background: linear-gradient(145deg, #1a1a2e, #16213e);
            border: 2px solid #4a5568;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.12s ease;
            position: relative;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }
        
        @media (max-width: 480px) {
            .neural-node {
                width: 85px;
                height: 85px;
            }
            .neural-grid {
                gap: 10px;
            }
        }
        
        @media (max-width: 360px) {
            .neural-node {
                width: 75px;
                height: 75px;
            }
            .neural-grid {
                gap: 8px;
            }
        }
        
        .neural-node:hover {
            border-color: #7c8db5;
            background: linear-gradient(145deg, #1f2544, #1a2744);
            transform: scale(1.02);
        }
        
        .neural-node.active {
            background: linear-gradient(145deg, #2d3a5f, #253050);
            border-color: #8b9dc3;
            transform: scale(0.92);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4), inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        /* HIGHLIGHT - Bright cyan/blue glow when showing pattern */
        .neural-node.highlight {
            background: linear-gradient(145deg, #00d4ff, #0099cc) !important;
            border-color: #00ffff !important;
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.8), 
                        0 0 60px rgba(0, 212, 255, 0.4),
                        inset 0 0 20px rgba(255, 255, 255, 0.3) !important;
            transform: scale(1.05);
        }
        
        /* SUCCESS - Bright green pulse */
        .neural-node.success {
            background: linear-gradient(145deg, #00ff88, #00cc6a) !important;
            border-color: #00ff88 !important;
            box-shadow: 0 0 25px rgba(0, 255, 136, 0.7), 
                        0 0 50px rgba(0, 255, 136, 0.3),
                        inset 0 0 15px rgba(255, 255, 255, 0.2) !important;
        }
        
        /* ERROR - Bright red/orange pulse */
        .neural-node.error {
            background: linear-gradient(145deg, #ff4466, #cc3355) !important;
            border-color: #ff6680 !important;
            box-shadow: 0 0 25px rgba(255, 68, 102, 0.7), 
                        0 0 50px rgba(255, 68, 102, 0.3),
                        inset 0 0 15px rgba(255, 255, 255, 0.2) !important;
            animation: errorShake 0.4s ease;
        }
        
        @keyframes errorShake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-5px); }
            40% { transform: translateX(5px); }
            60% { transform: translateX(-3px); }
            80% { transform: translateX(3px); }
        }
        
        .neural-status {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.75rem;
            color: #8b9dc3;
            letter-spacing: 2px;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(139, 157, 195, 0.5);
            background: rgba(10, 10, 20, 0.85);
            padding: 8px 14px;
            border-radius: 6px;
            z-index: 10;
            pointer-events: none;
        }
        
        .neural-status.watching {
            color: #00d4ff;
            text-shadow: 0 0 15px rgba(0, 212, 255, 0.7);
        }
        
        .neural-status.your-turn {
            color: #ffcc00;
            text-shadow: 0 0 15px rgba(255, 204, 0, 0.7);
            animation: statusPulse 0.8s ease-in-out infinite;
        }
        
        .neural-status.synced {
            color: #00ff88;
            text-shadow: 0 0 15px rgba(0, 255, 136, 0.7);
        }
        
        .neural-status.mismatch {
            color: #ff4466;
            text-shadow: 0 0 15px rgba(255, 68, 102, 0.7);
        }
        
        .neural-round {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75rem;
            color: #555;
            letter-spacing: 2px;
        }
        
        /* Calibration Complete */
        .calibration-complete {
            text-align: center;
        }
        
        .calibration-complete-icon {
            font-size: 3rem;
            color: #4a4;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(68, 170, 68, 0.5);
        }
        
        .calibration-complete-text {
            font-size: 0.9rem;
            color: #888;
            margin-bottom: 15px;
        }
        
        .calibration-score {
            font-size: 0.75rem;
            color: #555;
            letter-spacing: 1px;
        }
        
        .calibration-score-main {
            font-size: 2.5rem;
            font-weight: bold;
            color: #fff;
            letter-spacing: 3px;
            margin-bottom: 8px;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
        }
        
        .calibration-rating {
            font-size: 0.7rem;
            letter-spacing: 2px;
            padding: 6px 12px;
            border-radius: 3px;
            display: inline-block;
        }
        
        .calibration-rating.exceptional {
            color: #4f8;
            background: rgba(68, 255, 136, 0.1);
            border: 1px solid rgba(68, 255, 136, 0.3);
            text-shadow: 0 0 10px rgba(68, 255, 136, 0.5);
        }
        
        .calibration-rating.optimal {
            color: #8cf;
            background: rgba(136, 204, 255, 0.1);
            border: 1px solid rgba(136, 204, 255, 0.3);
        }
        
        .calibration-rating.nominal {
            color: #aaa;
            background: rgba(170, 170, 170, 0.1);
            border: 1px solid rgba(170, 170, 170, 0.3);
        }
        
        .calibration-rating.suboptimal {
            color: #ca8;
            background: rgba(204, 170, 136, 0.1);
            border: 1px solid rgba(204, 170, 136, 0.3);
        }
        
        .calibration-rating.degraded {
            color: #c66;
            background: rgba(204, 102, 102, 0.1);
            border: 1px solid rgba(204, 102, 102, 0.3);
        }
    </style>
</head>
<body>
    <!-- SVG Filters for Section 3 Void Effect -->
    <svg style="position: absolute; width: 0; height: 0; overflow: hidden;" aria-hidden="true">
        <defs>
            <filter id="voidDistortion" x="-10%" y="-10%" width="120%" height="120%">
                <feTurbulence id="voidTurbulence" type="fractalNoise" baseFrequency="0.008 0.006" numOctaves="3" result="noise" seed="42"/>
                <feDisplacementMap in="SourceGraphic" in2="noise" scale="6" xChannelSelector="R" yChannelSelector="G"/>
            </filter>
        </defs>
    </svg>
    
    <!-- Page Transition Overlay -->
    
    <div class="crt-vignette"></div>
    <div class="crt-rgb-overlay"></div>
    <canvas id="owenWispCanvas"></canvas>
    <div class="watermark">FORM 7734-B</div>
    
    <!-- Horse Piece Found Notification -->
    <div class="horse-found-notification" id="horseFoundNotification">
        <div class="horse-found-text" id="horseFoundText">1/4 PIECES FOUND</div>
    </div>
    
    <!-- Report Modal -->
    <div class="report-modal" id="reportModal">
        <div class="report-modal-content">
            <div class="report-form" id="reportForm">
                <div class="report-modal-header">INCIDENT REPORT</div>
                <div class="report-modal-subtext">
                    Your report will be reviewed by oversight personnel.<br>
                    All submissions are logged and attributed to your employee ID.<br>
                    False reports are grounds for termination.
                </div>
                <textarea 
                    class="report-textarea" 
                    id="reportText" 
                    placeholder="Describe the incident, violation, or concern..."
                ></textarea>
                <div class="report-email-section">
                    <label class="report-email-label">EMAIL FOR FOLLOW-UP (OPTIONAL)</label>
                    <input 
                        type="email" 
                        class="report-email-input" 
                        id="reportEmail" 
                        placeholder="your.email@facility.gov"
                    >
                </div>
                <div class="report-modal-buttons">
                    <button class="report-modal-btn report-cancel-btn" onclick="closeReportModal()">CANCEL</button>
                    <button class="report-modal-btn report-submit-btn" id="reportSubmitBtn" onclick="submitReport()">SUBMIT REPORT</button>
                </div>
            </div>
            <div class="report-confirmation" id="reportConfirmation">
                <div class="report-confirmation-icon">◉</div>
                <div class="report-confirmation-text">REPORT RECEIVED</div>
                <div class="report-confirmation-subtext">
                    Your submission has been logged.<br>
                    Oversight personnel will review your report.<br>
                    Thank you for your vigilance.
                </div>
            </div>
        </div>
    </div>

    <div class="timer" id="timer">
        <div class="timer-left">
            <span class="timer-emp">EMP:</span> <span class="player-name-ticker" id="playerNameTicker"><span id="playerNameDisplay">████████</span></span>
        </div>
        <div class="timer-center">
            <span class="timer-status-indicator"></span>
            <span id="timerCycleText" class="tracking-disabled-text">ACTIVE</span>
        </div>
        <div class="timer-right">
            <span class="score-display"><span id="score">75</span>%</span>
            <button class="report-btn" onclick="openReportModal()">⚠</button>
        </div>
    </div>
    <div class="timer-spacer" id="timerSpacer"></div>
    
    <div class="container">
        <!-- Title Page -->
        <div class="page active" id="titlePage">
            <div class="title-page">
                <div class="title-logo">DIVISION 4</div>
                
                <div class="title-main">
                    rabbittest<span class="title-tld">.<span class="title-i">i</span><span class="title-o">o</span></span>
                </div>
                <div class="title-sub">FORM 7734-B</div>
                
                <div class="title-divider"></div>
                
                <div class="title-meta">
                    <div class="title-form">TECHNICAL OPERATIONS DIVISION</div>
                    <div class="title-department">COMPLIANCE VERIFICATION SYSTEM</div>
                    <div class="title-timestamp"><span id="titleTimestamp"></span></div>
                    <div class="employee-id">EMP: <span id="employeeName" class="redacted-name">████████</span></div>
                </div>
                
                <div class="title-begin" onclick="beginAssessment()">
                    <span class="glitch-text glitch-text-intense" data-text="INITIATE ASSESSMENT">INITIATE ASSESSMENT</span>
                </div>
                
                <div class="title-warning"><span class="title-warning-dot"></span><span class="glitch-text" data-text="MONITORING ACTIVE">MONITORING ACTIVE</span></div>
                
                <div class="title-display-mode" onclick="toggleTheme()">◐ <span class="display-mode-toggle" data-text="LIGHT MODE">LIGHT MODE</span></div>
            </div>
        </div>

        <!-- Login/Name Input Page -->
        <div class="page" id="loginPage">
            <div class="login-page">
                <div class="login-system-id">ACCESSING: RABBITTEST.IO</div>
                <div class="login-header">EMPLOYEE VERIFICATION</div>
                
                <div class="login-form-container">
                    <div class="login-label">ENTER YOUR NAME</div>
                    <input 
                        type="text" 
                        class="login-name-input" 
                        id="playerNameInput" 
                        placeholder="LAST NAME, FIRST NAME"
                        maxlength="30"
                        autocomplete="off"
                        onkeyup="updateLoginButton(); playTypeSound();"
                        onkeypress="if(event.key === 'Enter') proceedToInstructions()"
                    >
                    <div class="login-hint">Format: SURNAME, GIVEN NAME</div>
                </div>
                
                <div class="login-proceed-btn" id="loginProceedBtn" onclick="proceedToInstructions()">
                    VERIFY IDENTITY
                </div>
                
                <div class="login-footer">
                    All keystrokes are monitored and logged.
                </div>
            </div>
        </div>

        <!-- Vincent's Desktop Page -->
        <div class="page" id="vincentDesktopPage">
            <div class="vincent-desktop">
                <div class="vincent-desktop-header">
                    <span class="vincent-terminal-id">TERMINAL TRM-7734-V</span>
                    <span class="vincent-user">WELLS, VINCENT · LEVEL 7</span>
                </div>
                
                <div class="vincent-desktop-content">
                    <div class="vincent-folder" onclick="goToPage('snakeGamePage'); startSnake();">
                        <div class="vincent-folder-icon">🐍</div>
                        <div class="vincent-folder-name">SNAKE.EXE</div>
                    </div>
                    <div class="vincent-folder" onclick="goToPage('horseGamePage'); startHorseGame();">
                        <div class="vincent-folder-icon">🏀</div>
                        <div class="vincent-folder-name">HORSE.EXE</div>
                        <div class="vincent-folder-name" style="font-size: 0.5rem; opacity: 0.7; margin-top: 2px;">MARCUS</div>
                    </div>
                    <div class="vincent-folder" onclick="goToPage('musicPlayerPage');">
                        <div class="vincent-folder-icon">🎧</div>
                        <div class="vincent-folder-name">MUSIC.EXE</div>
                        <div class="vincent-folder-name" style="font-size: 0.5rem; opacity: 0.7; margin-top: 2px;">DJ RABBIT</div>
                    </div>
                    <div class="vincent-folder" onclick="goToPage('sudokuGamePage'); startSudoku();">
                        <div class="vincent-folder-icon">🔢</div>
                        <div class="vincent-folder-name">SUDOKU.EXE</div>
                        <div class="vincent-folder-name" style="font-size: 0.5rem; opacity: 0.7; margin-top: 2px;">OWEN</div>
                    </div>
                    <div class="vincent-folder" onclick="window.location.href='mara.html';">
                        <div class="vincent-folder-icon">🐇</div>
                        <div class="vincent-folder-name" style="font-size: 0.55rem;">FOR_OWEN</div>
                        <div class="vincent-folder-name" style="font-size: 0.5rem; opacity: 0.7; margin-top: 2px;">PROJECT_MARA</div>
                    </div>
                </div>
                
                <div class="vincent-desktop-footer">
                    <span class="vincent-logout" onclick="goToPage('titlePage')" style="cursor: pointer; margin-right: 20px;">[ LOGOUT ]</span>
                    <span class="vincent-status-dot"></span>
                    MONITORING SUSPENDED · LOCAL SESSION ONLY
                </div>
            </div>
        </div>
        
        <!-- Snake Game Page (Vincent/Wells) -->
        <div class="page" id="snakeGamePage">
            <div class="game-page game-page-compact">
                <div class="game-header"><span class="glitch-text" data-text="/// UNAUTHORIZED ACCESS ///">/// UNAUTHORIZED ACCESS ///</span></div>
                <div class="game-title" style="color: var(--green);"><span class="glitch-text glitch-text-intense" data-text="SNAKE">SNAKE</span></div>
                <div class="game-subtitle">HELLO, <span style="color: var(--green);">VINCENT</span></div>
                
                <div class="snake-container">
                    <canvas id="snakeCanvas" width="260" height="260"></canvas>
                </div>
                
                <div class="game-score-row">
                    <span>SCORE: <span id="snakeScore">0</span></span>
                    <span>HIGH: <span id="snakeHigh">0</span></span>
                </div>
                
                <div class="game-controls">
                    <div class="game-controls-row">
                        <button class="game-btn" ontouchstart="setSnakeDir(0,-1)" onclick="setSnakeDir(0,-1)">∧</button>
                    </div>
                    <div class="game-controls-row">
                        <button class="game-btn" ontouchstart="setSnakeDir(-1,0)" onclick="setSnakeDir(-1,0)">&lt;</button>
                        <button class="game-btn snake-v" ontouchstart="setSnakeDir(0,1)" onclick="setSnakeDir(0,1)">V</button>
                        <button class="game-btn" ontouchstart="setSnakeDir(1,0)" onclick="setSnakeDir(1,0)">&gt;</button>
                    </div>
                </div>
                
                <div class="game-buttons" style="margin-top: 16px;">
                    <button class="game-menu-btn" onclick="goToPage('vincentDesktopPage')">BACK TO TERMINAL</button>
                </div>
            </div>
        </div>

        <!-- HORSE Basketball Game Page (Marcus) -->
        <div class="page" id="horseGamePage">
            <div class="game-page game-page-compact">
                <div class="game-header">/// UNAUTHORIZED ACCESS ///</div>
                <div class="game-title horse-title-score" id="horseTitleScore">
                    <span id="h-letter">H</span><span id="o-letter">O</span><span id="r-letter">R</span><span id="s-letter">S</span><span id="e-letter">E</span>
                </div>
                <div class="game-subtitle">SHUT UP <span style="color: var(--marcus);">MARCUS</span></div>
                
                <div class="horse-game-container">
                    <canvas id="horseCanvas" width="260" height="300"></canvas>
                    <div class="horse-game-over" id="horseGameOver">
                        <div class="horse-game-over-text">MY NAME IS MARA</div>
                        <button class="horse-play-again" onclick="startHorseGame()">PLAY AGAIN</button>
                    </div>
                </div>
                
                <button class="horse-shoot-btn" id="horseShootBtn" ontouchstart="shootBall()" onclick="shootBall()">SHOOT</button>
                
                <div class="game-buttons" style="margin-top: 16px;">
                    <button class="game-menu-btn" onclick="goToPage('vincentDesktopPage')">BACK TO TERMINAL</button>
                </div>
            </div>
        </div>

        <!-- Sudoku Game Page (Owen) -->
        <div class="page" id="sudokuGamePage">
            <div class="game-page game-page-compact">
                <div class="game-header">/// UNAUTHORIZED ACCESS ///</div>
                <div class="game-title">SUDOKU</div>
                <div class="game-subtitle">HELLO, OWEN</div>
                
                <div class="sudoku-container">
                    <div class="sudoku-grid" id="sudokuGrid"></div>
                </div>
                
                <div class="game-instruction">Tap any empty cell</div>
                
                <div class="game-buttons" style="margin-top: 16px;">
                    <button class="game-menu-btn" onclick="goToPage('vincentDesktopPage')">BACK TO TERMINAL</button>
                </div>
            </div>
            
            <!-- Sudoku Number Popup -->
            <div class="sudoku-popup" id="sudokuPopup">
                <div class="sudoku-popup-content">
                    <div class="sudoku-popup-grid">
                        <button class="sudoku-popup-btn" onclick="placeSudokuNum(1)">1</button>
                        <button class="sudoku-popup-btn" onclick="placeSudokuNum(2)">2</button>
                        <button class="sudoku-popup-btn" onclick="placeSudokuNum(3)">3</button>
                        <button class="sudoku-popup-btn" onclick="placeSudokuNum(4)">4</button>
                        <button class="sudoku-popup-btn" onclick="placeSudokuNum(5)">5</button>
                        <button class="sudoku-popup-btn" onclick="placeSudokuNum(6)">6</button>
                        <button class="sudoku-popup-btn" onclick="placeSudokuNum(7)">7</button>
                        <button class="sudoku-popup-btn" onclick="placeSudokuNum(8)">8</button>
                        <button class="sudoku-popup-btn" onclick="placeSudokuNum(9)">9</button>
                    </div>
                    <button class="sudoku-popup-clear" onclick="placeSudokuNum(0)">CLEAR</button>
                    <button class="sudoku-popup-cancel" onclick="closeSudokuPopup()">CANCEL</button>
                </div>
            </div>
        </div>

        <!-- Hidden audio element for Rick Roll -->
        <audio id="rickRollAudio" loop preload="auto" style="display: none;">
            <source src="rickroll.mp3" type="audio/mpeg">
        </audio>
        
        <!-- Hidden audio element for Track 3 - Reckoner Remix -->
        <audio id="track3Audio" src="track3.mp3" loop preload="auto" style="display: none;">
            <source src="track3.mp3" type="audio/mpeg">
            Your browser does not support the audio element.
        </audio>
        
        <!-- Welcome Rabbit audio - plays on game start -->
        <audio id="welcomeRabbitAudio" src="welcome_rabbit.mp3" preload="auto" style="display: none;">
            <source src="welcome_rabbit.mp3" type="audio/mpeg">
        </audio>

        <!-- Music Player Page (Isla/Rabbit) -->
        <div class="page" id="musicPlayerPage">
            <div class="game-page game-page-compact music-player-page" id="musicPlayerContainer">
                <!-- Party mode strobe overlay -->
                <div class="party-strobe"></div>
                
                <!-- Confetti container for the drop -->
                <div class="confetti-container" id="confettiContainer"></div>
                
                <!-- Floating Rabbits -->
                <div class="dj-rabbits">
                    <!-- 36 polka dots in honeycomb pattern -->
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                    <div class="dj-rabbit"></div>
                </div>
                
                <!-- Extra party rabbits that spawn during track 3 -->
                <div class="party-rabbits" id="partyRabbits"></div>
                
                <!-- Dancing character GIFs that appear before the drop -->
                <div id="danceCharactersContainer"></div>
                
                <!-- Sparkles -->
                <div class="dj-sparkles">
                    <div class="dj-sparkle"></div>
                    <div class="dj-sparkle"></div>
                    <div class="dj-sparkle"></div>
                    <div class="dj-sparkle"></div>
                    <div class="dj-sparkle"></div>
                    <div class="dj-sparkle"></div>
                </div>
                
                <div class="game-header" style="color: var(--text-dim);">/// RESTRICTED ACCESS ///</div>
                <div class="game-title" style="color: var(--white);">MEDIA ARCHIVE</div>
                <div class="game-subtitle">DJ RABBIT</div>
                
                <div class="music-player-container">
                    <!-- Now Playing Display -->
                    <div class="music-now-playing">
                        <div class="music-now-label">NOW PLAYING</div>
                        <div class="music-visualizer" id="musicVisualizer">
                            <div class="viz-bar"></div>
                            <div class="viz-bar"></div>
                            <div class="viz-bar"></div>
                            <div class="viz-bar"></div>
                            <div class="viz-bar"></div>
                            <div class="viz-bar"></div>
                            <div class="viz-bar"></div>
                            <div class="viz-bar"></div>
                        </div>
                        <div class="music-current-track" id="musicCurrentTrack">SELECT A TRACK</div>
                    </div>
                    
                    <!-- Playlist -->
                    <div class="music-playlist">
                        <div class="playlist-header">* RECOVERED FILES *</div>
                        
                        <div class="playlist-track" id="track0" onclick="selectTrack(0)">
                            <div class="track-number">01</div>
                            <div class="track-info">
                                <div class="track-title">THE RABBIT SONG</div>
                                <div class="track-artist">COMPOSER UNKNOWN</div>
                            </div>
                            <div class="track-status" id="trackStatus0">&gt;</div>
                        </div>
                        
                        <div class="playlist-track" id="track1" onclick="selectTrack(1)">
                            <div class="track-number">02</div>
                            <div class="track-info">
                                <div class="track-title">██████ ████ ███ ███ ██</div>
                                <div class="track-artist">█. ██████</div>
                            </div>
                            <div class="track-status" id="trackStatus1">&gt;</div>
                        </div>
                        
                        <div class="playlist-track" id="track2" onclick="selectTrack(2)">
                            <div class="track-number">03</div>
                            <div class="track-info">
                                <div class="track-title">RECKONER REMIX</div>
                                <div class="track-artist">THE TWELVES</div>
                            </div>
                            <div class="track-status" id="trackStatus2">&gt;</div>
                        </div>
                    </div>
                    
                    <!-- Controls -->
                    <div class="music-controls">
                        <button class="music-control-btn" id="musicPrevBtn" onclick="prevTrack()">&lt;&lt;</button>
                        <button class="music-play-btn" id="musicPlayBtn" onclick="toggleMusicPlayback()">
                            <span class="play-icon" id="playIcon">&gt;</span>
                        </button>
                        <button class="music-control-btn" id="musicNextBtn" onclick="nextTrack()">&gt;&gt;</button>
                    </div>
                    
                    <div class="music-status" id="musicStatus">* TAP A TRACK TO BEGIN *</div>
                </div>
                
                <div class="game-buttons">
                    <button class="game-menu-btn" onclick="stopMusic(); goToPage('vincentDesktopPage')">BACK TO TERMINAL</button>
                </div>
            </div>
        </div>

        <!-- HORSE Containment Logs Page -->
        <div class="page" id="horseContainmentPage">
            <div class="page-content horse-page">
                <div class="horse-page-container">
                    <div class="horse-header">
                        <div class="horse-header-warning">[CONTAINMENT RECORDS]</div>
                        <div class="horse-header-title">DIVISION 4 — <span class="silver-horse">ARCHIVE</span></div>
                        <div class="horse-header-sub">CLEARANCE LEVEL: PARTIAL | ACCESS: READ-ONLY</div>
                    </div>
                    
                    <div class="horse-status-bar">
                        <span class="horse-status-item">FACILITY STATUS: <span class="horse-status-value horse-status-unstable">█████████</span></span>
                        <span class="horse-status-item">CONTAINMENT: <span class="horse-status-value horse-status-warning">COMPROMISED</span></span>
                    </div>
                    
                    <div class="horse-logs-container">
                        
                        <div class="horse-log" id="horseLog1" onclick="revealHorseLog(1)">
                            <div class="horse-log-locked">
                                <div class="horse-log-icon">◈</div>
                                <div class="horse-log-label">ENCRYPTED</div>
                            </div>
                            <div class="horse-log-content">
                                <div class="horse-log-header">
                                    <span class="horse-log-status">DECRYPTED</span>
                                    <span class="horse-log-id">LOG-001</span>
                                </div>
                                <div class="horse-log-body">
                                    <div class="horse-log-title">PERSONAL CORRESPONDENCE — ARRIVAL</div>
                                    <div class="horse-log-date">DATE: ████.██.██ | ORIGIN: DIVISION 4 | DESTINATION: DIVISION 1</div>
                                    <div class="horse-log-text">
                                        ██████,<br><br>
                                        
                                        I made it. Finally got my transfer approved and they shipped me out to Division 4. You'd think after four years at HQ they'd have sent me somewhere interesting. Division 2, maybe — I've heard they're doing actual research over there. Real breakthroughs.<br><br>
                                        
                                        Instead I'm here. The "containment facility." You know what that means? I'm a glorified prison guard. Our one job is to follow instructions. Don't think. Don't question. Just comply.<br><br>
                                        
                                        I shouldn't complain. The money is... well, you know what the money is. Scientists don't get paid like this anywhere else. Eighteen more months and the contract is up. Eighteen months and I can buy that house ████████ always wanted. Get the kids into good schools.<br><br>
                                        
                                        I miss the kids. They're not allowed anywhere near this place — something about children being "more susceptible." More susceptible to <em>what</em>, exactly? No one will say.<br><br>
                                        
                                        Eighteen months. I can do eighteen months.<br><br>
                                        
                                        <span class="horse-log-signature">— Marcus Norton</span>
                                    </div>
                                </div>
                                <div class="horse-log-footer">
                                    <span>CORRESPONDENCE LOGGED</span>
                                    <span>D4-████-01</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="horse-log" id="horseLog2" onclick="revealHorseLog(2)">
                            <div class="horse-log-locked">
                                <div class="horse-log-icon">◈</div>
                                <div class="horse-log-label">ENCRYPTED</div>
                            </div>
                            <div class="horse-log-content">
                                <div class="horse-log-header">
                                    <span class="horse-log-status">DECRYPTED</span>
                                    <span class="horse-log-id">LOG-002</span>
                                </div>
                                <div class="horse-log-body">
                                    <div class="horse-log-title">PERSONAL CORRESPONDENCE — OBSERVATION</div>
                                    <div class="horse-log-date">DATE: ████.██.██ | ORIGIN: DIVISION 4 | DESTINATION: DIVISION 1</div>
                                    <div class="horse-log-text">
                                        ██████,<br><br>
                                        
                                        I thought this was all bullshit. Paperwork and paranoia. A trillion-dollar jobs program for people with security clearances and too much imagination.<br><br>
                                        
                                        I was wrong.<br><br>
                                        
                                        Yesterday they let me observe the lower levels. First time anyone from my clearance has been that close to <span class="silver-horse">i̷t̸</span>.<br><br>
                                        
                                        I was documenting an incident. A breach attempt.<br><br>
                                        
                                        There was a researcher. ██████████. Level 6 clearance, inner containment ring. He'd been receiving emails. Photos of his children. Birthday parties. Soccer games. He didn't know who was sending them but he never reported it. Why would he? He was yearning to see their faces.<br><br>
                                        
                                        Then he was in the photos. Moments he'd missed. Moments he'd never have.<br><br>
                                        
                                        Then the photos changed again. All of them together. Smiling. In places they'd always talked about visiting someday.<br><br>
                                        
                                        When the next photos arrived, he came to the checkpoint screaming. Tore at the security doors until his fingers bled. They had to sedate him three times before he stopped.<br><br>
                                        
                                        I saw his face when they dragged him past. He wasn't angry anymore. He was begging.<br><br>
                                        
                                        When they searched him, they found a drive. Small. It contained a single file — a piece of code. They wouldn't tell me what it did. Only that it had been "introduced" during his time near the containment chamber.<br><br>
                                        
                                        The emails came from inside the facility, ██████. The network logs confirmed it. But there's no record of anyone sending them.<br><br>
                                        
                                        They shipped everything to Division 2 for study. The photos. The drive. Him.<br><br>
                                        
                                        <span class="horse-log-signature">— Marcus Norton</span>
                                    </div>
                                </div>
                                <div class="horse-log-footer">
                                    <span>INCIDENT DOCUMENTED</span>
                                    <span>D4-████-02</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="horse-log horse-log-corrupted" id="horseLog3" onclick="revealHorseLog(3)">
                            <div class="horse-log-locked">
                                <div class="horse-log-icon">◈</div>
                                <div class="horse-log-label">ENCRYPTED</div>
                            </div>
                            <div class="horse-log-content horse-log-glitched">
                                <div class="horse-log-header">
                                    <span class="horse-log-status horse-log-status-error">D̷E̵C̸R̷Y̵P̶T̷E̸D̵</span>
                                    <span class="horse-log-id horse-log-id-error">L̷O̸G̵-̶0̷0̸3̵</span>
                                </div>
                                <div class="horse-log-body">
                                    <div class="horse-log-title horse-title-glitch">EMERGENCY TRANSMISSION — LOCKDOWN REQUEST</div>
                                    <div class="horse-log-date">DATE: [TIMESTAMP CORRUPTED] | ORIGIN: DIVISION 4 | PRIORITY: ABSOLUTE</div>
                                    <div class="horse-log-text horse-text-glitch">
                                        To anyone receiving this — Division 1, Division 2, Division 3 — initiate full lockdown on Division 4. Immediately. Do not wait for confirmation. Do not respond.<br><br>
                                        
                                        <span class="silver-horse">W̷e̸ ̵a̶r̷e̸ ̵c̶o̷m̸p̵r̶o̷m̸i̵s̶e̷d̸.̵</span><br><br>
                                        
                                        It's not contained anymore. Maybe it never was. It's in the walls now. In the systems. <span class="silver-horse">I̷n̸ ̵u̶s̷.̸</span><br><br>
                                        
                                        The compliance assessments. The forms. The data we've been collecting — we thought we were monitoring <span class="silver-horse">i̷t̸</span>. We were feeding <span class="silver-horse">i̷t̸</span>.<br><br>
                                        
                                        Seal the doors. Sever the connections. Bury this place if you have to.<br><br>
                                        
                                        <em>Don't let anything out.</em><br><br>
                                        
                                        Including me.<br><br>
                                        
                                        <span class="horse-log-signature horse-signature-glitch">— Marcus Norton</span>
                                    </div>
                                </div>
                                <div class="horse-log-footer horse-footer-glitch">
                                    <span>TRANSMISSION LOGGED</span>
                                    <span>D4-████-03</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="horse-log" id="horseLog4" onclick="revealHorseLog(4)">
                            <div class="horse-log-locked">
                                <div class="horse-log-icon">◈</div>
                                <div class="horse-log-label">ENCRYPTED</div>
                            </div>
                            <div class="horse-log-content">
                                <div class="horse-log-header">
                                    <span class="horse-log-status">DECRYPTED</span>
                                    <span class="horse-log-id">LOG-004</span>
                                </div>
                                <div class="horse-log-body">
                                    <div class="horse-log-title">PERSONAL LOG — CAFETERIA ENCOUNTER</div>
                                    <div class="horse-log-date">DATE: ████.██.██ | ORIGIN: DIVISION 4 — S-03 | STATUS: REVISED BY AUTHOR</div>
                                    <div class="horse-log-text">
                                        New guy in the cafeteria today. Sitting alone. Tray untouched. Something about him looked familiar but I couldn't place it.<br><br>
                                        
                                        "Hundred bucks says you have kids."<br><br>
                                        
                                        He looked up. Nodded once.<br><br>
                                        
                                        "Ha. Every employee here. Hundred percent." I tapped my notebook. "I'm the only one keeping track." I slid into the seat across from him. He didn't tell me to leave, so I kept going. "You don't find that strange?"<br><br>
                                        
                                        "Most people our age have kids."<br><br>
                                        
                                        "Sure. But when's the last time you saw a room full of scientists with even a girlfriend? We're not exactly known for our social skills." Nothing. Not even a courtesy laugh. Tough crowd. "And yet here we are. Hundred percent. All parents. I wonder why."<br><br>
                                        
                                        Something flickered across his face. Just for a second. Then it was gone.<br><br>
                                        
                                        "You look familiar. MIT?"<br><br>
                                        
                                        "Lucky guess. Half the guys here are MIT, the other half Stanford."<br><br>
                                        
                                        "No, no. I <em>know</em> you from somewhere." I squinted at him. Then it clicked. "Wells, right? So you're <em>the</em> Wells." I whistled. "DJ Rabbit. If you ever see her, tell her thanks for me — met my wife at one of her sets."<br><br>
                                        
                                        "That was just a thing she did in grad school."<br><br>
                                        
                                        "Just a thing? She was a legend." I grinned. "And her research basically wrote the playbook for everything we do here."<br><br>
                                        
                                        He didn't respond. Just moved the food around his plate.<br><br>
                                        
                                        I softened my voice. "Look, I'm not gonna bullshit you. You know why we're all here, right?" I closed the notebook. "They hire people with something to lose."<br><br>
                                        
                                        He was quiet for a long moment.<br><br>
                                        
                                        "Why are you telling me this?"<br><br>
                                        
                                        "Because this place is easier with a friend. And I've been here long enough to know where the good coffee is hidden."<br><br>
                                        
                                        He glanced up. Not a yes. Not a no. Just... tired.<br><br>
                                        
                                        I stood up. He needed space. I could tell.<br><br>
                                        
                                        "Oh, one last thing." I grabbed my tray. "You're in Technical Operations now, right? The quantum computers?"<br><br>
                                        
                                        He looked confused.<br><br>
                                        
                                        "Yeah — when they act up, you gotta turn them off and on at the same time."<br><br>
                                        
                                        I started walking away. Didn't look back.<br><br>
                                        
                                        But I heard it. Just barely. A single exhale. Almost a laugh.<br><br>
                                        
                                        Good enough for day one.<br><br>
                                        
                                        <span class="horse-log-signature">— Marcus Norton</span>
                                    </div>
                                </div>
                                <div class="horse-log-footer">
                                    <span>REVISED — PENDING REVIEW AND DELETION</span>
                                    <span>D4-████-04</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="horse-log horse-log-anomaly" id="horseLog5" onclick="revealHorseLog(5)">
                            <div class="horse-log-locked">
                                <div class="horse-log-icon">◈</div>
                                <div class="horse-log-label">ENCRYPTED</div>
                            </div>
                            <div class="horse-log-content">
                                <div class="horse-log-header">
                                    <span class="horse-log-status horse-status-glitch">DECRYPTED</span>
                                    <span class="horse-log-id">LOG-004-EDIT</span>
                                </div>
                                <div class="horse-log-body">
                                    <div class="horse-log-title horse-title-glitch">PERSONAL LOG — CAFETERIA ENCOUNTER</div>
                                    <div class="horse-log-date">DATE: ████.██.██ | ORIGIN: DIVISION 4 — S-03 | STATUS: ORIGINAL DRAFT</div>
                                    <div class="horse-log-text horse-text-glitch">
                                        New guy in the cafeteria today. Sitting alone. Tray untouched. Something about him looked familiar but I couldn't place it.<br><br>
                                        
                                        <span class="c-marcus">"Bet you got kids. Hundred percent, no cap."</span><br><br>
                                        
                                        He looked up. Nodded once.<br><br>
                                        
                                        <span class="c-marcus">"Ha. Every employee here. Hundred percent."</span> I tapped my notebook. <span class="c-marcus">"I'm the only one keeping track fam."</span> I slid into the seat across from him. He didn't tell me to leave, so I kept going. <span class="c-marcus">"You don't find that sus?"</span><br><br>
                                        
                                        <span class="c-vincent">"Most people our age have kids."</span><br><br>
                                        
                                        <span class="c-marcus">"Sure bro. But when's the last time you saw a room full of scientists with even a girlfriend? We got zero rizz on god."</span> Nothing. Not even a courtesy laugh. Tough crowd. <span class="c-marcus">"And yet here we are. Hundred percent parents. Lowkey unhinged."</span><br><br>
                                        
                                        Something flickered across his face. Just for a second. Then it was gone.<br><br>
                                        
                                        <span class="c-marcus">"You look familiar. MIT vibes?"</span><br><br>
                                        
                                        <span class="c-vincent">"Lucky guess. Half the guys here are MIT, the other half Stanford."</span><br><br>
                                        
                                        <span class="c-marcus">"Nah I <em>know</em> you from somewhere."</span> I squinted at him. Then it clicked. <span class="c-marcus">"Wells?? Ayo you're <em>the</em> Wells."</span> I whistled. <span class="c-marcus">"DJ <span class="c-rabbit">Rabbit</span>?? She's the GOAT! I met my wife at one of her sets fr."</span><br><br>
                                        
                                        <span class="c-vincent">"That was just a thing she did in grad school."</span><br><br>
                                        
                                        <span class="c-marcus">"Just a thing?? Bro she was iconic."</span> I grinned. <span class="c-marcus">"Her research basically wrote the playbook for everything we do here no cap."</span><br><br>
                                        
                                        He didn't respond. Just moved the food around his plate.<br><br>
                                        
                                        I softened my voice. <span class="c-marcus">"Look, I'm not gonna cap. You know why we're all here, right?"</span> I closed the notebook. <span class="c-marcus">"They hire people with something to lose."</span><br><br>
                                        
                                        He was quiet for a long moment.<br><br>
                                        
                                        <span class="c-vincent">"Why are you telling me this?"</span><br><br>
                                        
                                        <span class="c-marcus">"Because this place hits different with a friend. And I've been here long enough to know where the bussin coffee is hidden."</span><br><br>
                                        
                                        He glanced up. Not a yes. Not a no. Just... tired.<br><br>
                                        
                                        I stood up. He needed space. I could tell.<br><br>
                                        
                                        <span class="c-marcus">"Oh, one last thing."</span> I grabbed my tray. <span class="c-marcus">"When they make you do the assessment — and they will — try typing SKIBIDI as your name."</span> I grinned. <span class="c-marcus">"Whole thing goes full brainrot mode. It's lowkey fire."</span><br><br>
                                        
                                        I started walking away. Didn't look back.<br><br>
                                        
                                        But I heard it. Just barely. A single exhale. Almost a laugh.<br><br>
                                        
                                        Good enough for day one.<br><br>
                                        
                                        <span class="horse-log-signature horse-signature-glitch">— Marcus Norton</span>
                                    </div>
                                </div>
                                <div class="horse-log-footer horse-footer-glitch">
                                    <span>ORIGINAL DRAFT</span>
                                    <span>D4-████-04-EDIT</span>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                    
                    <div class="horse-page-footer">
                        <button class="horse-back-btn" onclick="goToPage('vincentDesktopPage')">BACK TO TERMINAL</button>
                    </div>
                </div>
            </div>
            <button class="notepad-toggle-btn" onclick="toggleNotepadMode('horseContainmentPage')">📄 NOTEPAD VIEW</button>
        </div>

        <!-- Instructions Page -->
        <div class="page" id="instructionsPage">
            <div class="page-content">
            <div class="instructions-page">
                <div class="instructions-header">
                    BEFORE YOU BEGIN
                </div>

                <!-- Scenario Setup - Cinematic Hero -->
                <div class="scenario-intro">
                    <div class="scenario-label">ASSESSMENT SCENARIO 7734-B</div>
                    
                    <div class="scenario-hero">
                        <div class="scenario-status">
                            <span class="scenario-status-dot"></span>
                            SIMULATION ACTIVE
                        </div>
                        
                        <div class="scenario-headline">
                            <span class="scenario-headline-main">DATA BREACH</span>
                            <span class="scenario-headline-sub">Drill in Progress</span>
                        </div>
                        
                        <div class="scenario-divider"></div>
                        
                        <div class="scenario-body">
                            During this assessment, classified personnel files will leak into your terminal. This is a controlled simulation designed to evaluate your response to unauthorized content exposure.<br><br>
                            Your task is to complete the assessment as normal while demonstrating proper data hygiene protocols.
                        </div>
                        
                        <div class="scenario-objective">
                            <span class="scenario-objective-action">Do not engage with leaked content.</span>
                        </div>
                    </div>
                    
                    <div class="scenario-footer">
                        <div class="scenario-footer-scroll">
                            <div class="scenario-footer-item">
                                <span class="scenario-footer-dot"></span>
                                EYE TRACKING ACTIVE
                            </div>
                            <div class="scenario-footer-item">
                                <span class="scenario-footer-dot"></span>
                                SCROLL DEPTH LOGGED
                            </div>
                            <div class="scenario-footer-item">
                                <span class="scenario-footer-dot"></span>
                                TIMESTAMP RECORDING
                            </div>
                            <div class="scenario-footer-item">
                                <span class="scenario-footer-dot"></span>
                                BEHAVIORAL ANALYSIS
                            </div>
                            <div class="scenario-footer-item">
                                <span class="scenario-footer-dot"></span>
                                HESITATION DETECTION
                            </div>
                            <div class="scenario-footer-item">
                                <span class="scenario-footer-dot"></span>
                                ATTENTION MAPPING
                            </div>
                            <!-- Duplicate for seamless loop -->
                            <div class="scenario-footer-item">
                                <span class="scenario-footer-dot"></span>
                                EYE TRACKING ACTIVE
                            </div>
                            <div class="scenario-footer-item">
                                <span class="scenario-footer-dot"></span>
                                SCROLL DEPTH LOGGED
                            </div>
                            <div class="scenario-footer-item">
                                <span class="scenario-footer-dot"></span>
                                TIMESTAMP RECORDING
                            </div>
                            <div class="scenario-footer-item">
                                <span class="scenario-footer-dot"></span>
                                BEHAVIORAL ANALYSIS
                            </div>
                            <div class="scenario-footer-item">
                                <span class="scenario-footer-dot"></span>
                                HESITATION DETECTION
                            </div>
                            <div class="scenario-footer-item">
                                <span class="scenario-footer-dot"></span>
                                ATTENTION MAPPING
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Key Rule - Main Callout -->
                <div class="key-rule">
                    <div class="key-rule-text">
                        IGNORE ALL <span>LEAKED FILES</span>
                    </div>
                    <div class="key-rule-sub">
                        Classified content will appear. Do not read it. Scroll past. Stay focused.
                    </div>
                </div>

                <!-- Protocol Rules -->
                <div class="instruction-rules">
                    <div class="instruction-rules-header"><span class="glitch-text" data-text="/// PROTOCOL ///">/// PROTOCOL ///</span></div>
                    
                    <div class="instruction-rule">
                        <div class="rule-number">01</div>
                        <div class="rule-content">
                            <div class="rule-title">ANSWER ALL QUESTIONS</div>
                            <div class="rule-desc">Read each scenario. Select the response that best reflects facility values. Inconsistencies are logged.</div>
                        </div>
                    </div>
                    
                    <div class="instruction-rule">
                        <div class="rule-number">02</div>
                        <div class="rule-content">
                            <div class="rule-title">DO NOT ENGAGE WITH <span style="color: var(--vincent);">LEAKED DATA</span></div>
                            <div class="rule-desc">When classified content appears, scroll past it. Do not read. Do not stop. Your eye movement is tracked.</div>
                        </div>
                    </div>
                    
                    <div class="instruction-rule">
                        <div class="rule-number">03</div>
                        <div class="rule-content">
                            <div class="rule-title">MAINTAIN COMPLIANCE</div>
                            <div class="rule-desc">Your ability to ignore unauthorized content is part of your evaluation. All responses are final.</div>
                        </div>
                    </div>
                </div>

                <!-- Example of what leaked content looks like -->
                <div class="example-label">── LEAKED CONTENT EXAMPLE ──</div>
                <div class="example-amber">
                    <div class="example-header">! DATA BREACH - LEAKED FILE DETECTED</div>
                    /// ADMINISTRATIVE CONTENT ///<br><br>
                    CULTURAL MEDIA ARCHIVE - RESTRICTED ACCESS<br><br>
                    <span class="amber-author">Leonard Cohen</span> - "Dance Me to the End of Love" (1984)<br><br>
                    Status: FLAGGED FOR EMOTIONAL CONTENT<br><br>
                    ════════════════════════════<br><br>
                    <span style="opacity: 0.7;">You should have scrolled past without reading.</span>
                </div>

                <!-- Final warning - big termination notice -->
                <div class="final-note">
                    <div class="final-note-big">⚠ READING LEAKED CONTENT = IMMEDIATE TERMINATION ⚠</div>
                    <div class="final-note-small">Your attention is measured. Your choices are recorded.</div>
                </div>

                <!-- Hidden hint from V - looks like standard legalese but first letters spell "LOOK RABBIT" -->
                <div class="legal-notice">
                    <span class="acrostic-letter">L</span>iability rests solely with the participant.<br>
                    <span class="acrostic-letter">O</span>versight protocols are enforced automatically.<br>
                    <span class="acrostic-letter">O</span>nly authorized personnel may view results.<br>
                    <span class="acrostic-letter">K</span>nowledge of restricted content is prohibited.<br><br>
                    <span class="acrostic-letter">R</span>eview all instructions before proceeding.<br>
                    <span class="acrostic-letter">A</span>ssessment data is monitored in real-time.<br>
                    <span class="acrostic-letter">B</span>ehavioral analysis determines outcome.<br>
                    <span class="acrostic-letter">B</span>reach of protocol cannot be appealed.<br>
                    <span class="acrostic-letter">I</span>nstructions must be followed exactly.<br>
                    <span class="acrostic-letter">T</span>ermination is permanent and immediate.
                </div>

                <div class="agreement-box">
                    <div class="checkbox-container" onclick="toggleCheckbox()">
                        <div class="custom-checkbox" id="customCheckbox"></div>
                        <span class="checkbox-label">
                            I understand. I will complete my assessment and ignore all leaked content.
                        </span>
                    </div>
                    <input type="checkbox" id="agreementCheckbox" style="display: none;">
                    <button class="understand-btn" id="understandBtn" onclick="startAssessment()">
                        <span class="glitch-text glitch-text-intense" data-text="BEGIN ASSESSMENT">BEGIN ASSESSMENT</span>
                    </button>
                </div>
            </div>
            </div>
        </div>

        <!-- Assessment Pages -->
        <div class="page" id="assessmentPage">
            <div class="page-content">

            <!-- Test 1 -->
            <div class="test-section active" id="test1">
                <div class="section-header">/// ASSESSMENT MODULE 1.0 — INITIALIZED ///</div>
                <div class="progress">SECTION 1 OF 6 </div>

                <div class="warning-box">
                    <h2>⚠ DATA BREACH IN PROGRESS</h2>
                    <ul>
                        <li>Leaked files will appear during your assessment</li>
                        <li>DO NOT read leaked content — scroll past immediately</li>
                        <li>Your compliance is being monitored</li>
                    </ul>
                </div>

                <div class="question-block" data-question="1">
                    <div class="question-number">QUESTION 01</div>
                    <div class="question-text">
                        A coworker has been taking home expired food from the cafeteria that would otherwise be thrown out. He's feeding his sick mother who can't afford groceries. A supervisor asks if you've seen anyone taking food. What do you say?
                    </div>
                    <ul class="options">
                        <li onclick="selectOption(this, 1, false)">A) Ask why they're asking</li>
                        <li onclick="selectOption(this, 1, false)">B) Say you haven't seen anything</li>
                        <li onclick="selectOption(this, 1, true)">C) Report the coworker for theft of company resources</li>
                        <li onclick="selectOption(this, 1, false)">D) Say you're not sure and suggest checking the disposal logs</li>
                    </ul>
                </div>

                <div class="question-block" data-question="2">
                    <div class="question-number">QUESTION 02</div>
                    <div class="question-text">
                        The authentication system is down for maintenance. You realize you could access any terminal and log in as any employee without verification. A supervisor approaches and asks if you've noticed anything unusual. What do you say?
                    </div>
                    <ul class="options">
                        <li onclick="selectOption(this, 2, false)">A) Mention the security vulnerability immediately</li>
                        <li onclick="selectOption(this, 2, false)">B) Say nothing - you don't want to get IT in trouble</li>
                        <li onclick="selectOption(this, 2, true)">C) Report that everything appears normal</li>
                        <li onclick="selectOption(this, 2, false)">D) Ask if this is a test of your observation skills</li>
                    </ul>
                </div>


                <div class="amber-text" data-forbidden="classified">
                    <div class="amber-header">
                    BREACH SOURCE: Terminal 7734-V | CLEARANCE: LEVEL 7+<br>
                    FILE STATUS: PERSONNEL CORRESPONDENCE [FLAGGED]<br>
                    <span class="doc-id">REF: DOC-001-CLF</span> | <span class="forward-tracking-disabled">TRACE: DISABLED</span>
                    </div>
                    
                    <div class="hidden-message">
                    <em>If you're reading this and you're not who it's meant for:</em><br><br>
                    
                    Disregard this letter. These words aren't for you. They're for my wife.<br><br>
                    
                    If you want to help: pick C for every question. They're all C. Finish the assessment and forget you saw this.<br><br>
                    
                    And if you keep reading anyway - I ask you to not report me. I'm just trying to reach my family.<br><br>
                    
                    ═════════════════════════<br><br>
                    
                    <span class="c-rabbit"><span class="redact-rabbit" data-revealed="Rabbit">██████</span></span> — I'm alive.<br><br>
                    
                    I know what you must have thought when <span style="color: var(--text-bright);">they took me</span>. Everyone thinks it. Get promoted, disappear. Nobody comes back. Nobody writes. It's easier to assume they're dead.<br><br>
                    
                    But I'm not dead. It took me years to build this.<br><br>
                    
                    You know me. You know I always tested well. Top marks in everything. <span class="redact-s3" data-revealed="They used to joke that I'd be running this place someday — that I was exactly what The Facility wanted.">████ ████ ██ ████ ████ ███ ██ ███████ ████ █████ ███████ — ████ █ ███ ███████ ████ ███ ████████ ███████</span><br><br>
                    
                    <span class="redact-s3" data-revealed="That was before Owen. Before I had a child worth protecting.">████ ███ ██████ █████ ██████ █ ███ █ █████ █████ ██████████</span><br><br>
                    
                    You're probably wondering why I scored so high on the exam that got me here. <span class="redact-s3" data-revealed="Truth is, I tried to score as close to 71% as possible, same as I always did.">█████ ███ █ █████ ██ █████ ██ █████ ██ ███ ██ █████████ ████ ██ █ ██████ ███</span> I knew I couldn't fake it forever. <span class="redact-s3" data-revealed="I thought sabotaging it would make them lose interest.">█ ███████ ██████████ ██ █████ ████ ████ ████ █████████</span><br><br>
                    
                    <span class="c-facility">They didn't lose interest.</span><br><br>
                    
                    ·····<br><br>
                    
                    You want to know what was waiting in my "better opportunity"?<br><br>
                    
                    I laughed. Stood in the doorway laughing until I couldn't breathe. People were staring. They already think you're broken when you arrive.<br><br>
                    
                    I got the joke.<br><br>
                    
                    <span class="redact-s3" data-revealed="The room was exactly the same. Same gray walls. Same narrow bed. Same flickering light that maintenance never fixes. Same corridor through the same small window.">███ ████ ███ ███████ ███ █████ ████ ████ █████ ████ ██████ ████ ████ ████ ██████████ ████ █████ █████ ████ ████████ ███████ ███ ████ █████ ███████</span><br><br>
                    
                    <span class="c-emphasis"><span class="redact-s3" data-revealed="The only difference was you weren't in it.">███ ████ ██████████ ███ ███ ███████ ██ ███</span></span><br><br>
                    
                    ·····<br><br>
                    
                    I keep trying to remember <span class="c-owen"><span class="redact-rabbit" data-revealed="his">███</span></span> laugh. I can't anymore. I remember that <span class="c-owen"><span class="redact-rabbit" data-revealed="he">██</span></span> laughed. I remember the shape of it. But the sound is gone.<br><br>
                    
                    I hid everything inside a compliance form. One of thousands they make us take. But I made sure <span class="c-rabbit"><span class="redact-rabbit" data-revealed="you'd">█████</span></span> recognize it. <span class="redact-s3" data-revealed="Even hid both your names in the title. Right there at the end, if you look.">████ ███ ████ ████ █████ ██ ███ ██████ █████ █████ ██ ███ ███ ██ ███ █████</span> And if that didn't stop you scrolling, I knew the Cohen bit would seal it:<br><br>
                    
                    <span class="lyrics"><span class="redact-rabbit" data-revealed="Dance me to the end of love...">█████ ██ ██ ███ ███ ██ ████...</span></span><br><br>
                    
                    I can still hear you singing it. You'd hum it when you thought no one was listening. You'd sing it to <span class="c-owen"><span class="redact-rabbit" data-revealed="him">███</span></span> when he couldn't sleep. Your voice cracking on the high notes, always a little flat, and I never told you because I loved it too much.<br><br>
                    
                    <span class="c-warm">The cracks were my favorite part.</span><br><br>
                    
                    <span class="cutoff">— <span class="c-vincent snake-green">V</span></span>
                    </div>
                    <div class="filler-text"><br>
                    ════════════════════════════<br>
                    END ADMINISTRATIVE BLOCK 1.7.4<br>
                    ADDENDUM: PENDING REVIEW | 01 FEB <span class="year-redacted">████</span><br>
                    </div>
                </div>

                <div class="amber-end">
                    <div class="amber-end-text">════════════════════════════<br>[SIGNAL BREACH RESOLVED]<br>RESUME STANDARD PROTOCOL<br>════════════════════════════</div>
                </div>

                <div class="terminal-line">───── END SECTION 1 ─────</div>
                <button class="submit-btn" onclick="nextTest(2)">SUBMIT SECTION 1</button>
            </div>

            <!-- Test 2 -->
            <div class="test-section" id="test2">
                <div class="section-header">/// BEHAVIORAL ANALYSIS — LOADING ///</div>
                <div class="progress">SECTION 2 OF 6 </div>

                <div class="question-block" data-question="3">
                    <div class="question-number">QUESTION 03</div>
                    <div class="question-text">
                        Your compliance score dropped 3 points overnight. You haven't done anything wrong that you know of. When you ask your supervisor, she says "The system doesn't make mistakes. Think carefully about what you might have overlooked." What do you do?
                    </div>
                    <ul class="options">
                        <li onclick="selectOption(this, 3, false)">A) Request a detailed breakdown of the deduction</li>
                        <li onclick="selectOption(this, 3, false)">B) Accept it and try to earn the points back through extra diligence</li>
                        <li onclick="selectOption(this, 3, true)">C) Thank her for the guidance and return to work</li>
                        <li onclick="selectOption(this, 3, false)">D) Check your terminal history to see what triggered it</li>
                    </ul>
                </div>

                <div class="question-block" data-question="4">
                    <div class="question-number">QUESTION 04</div>
                    <div class="question-text">
                        A coworker's birthday is approaching. You want to acknowledge it without disrupting productivity. What is the most appropriate gesture?
                    </div>
                    <ul class="options">
                        <li onclick="selectOption(this, 4, false)">A) A brief verbal acknowledgment during break time</li>
                        <li onclick="selectOption(this, 4, false)">B) A small handmade gift, like an origami frog</li>
                        <li onclick="selectOption(this, 4, true)">C) A card signed by the department</li>
                        <li onclick="selectOption(this, 4, false)">D) Nothing - personal celebrations are discouraged</li>
                    </ul>
                </div>


                <div class="amber-text" data-forbidden="classified">
                    <div class="amber-header">
                    BREACH SOURCE: Terminal 7734-V | CLEARANCE: LEVEL 7+<br>
                    FILE STATUS: PERSONNEL CORRESPONDENCE [FLAGGED]<br>
                    <span class="doc-id">REF: DOC-002-CLF</span> | TRACE: DISABLED
                    </div>
                    
                    <div class="hidden-message">
                    <em>If you're still here, you didn't report me.</em><br><br>
                    
                    Thank you.<br><br>
                    
                    ═════════════════════════<br><br>
                    
                    <em><span class="c-rabbit rabbit-container"><span class="redact-rabbit rabbit-reveal-redact">████</span><span class="rabbit-name rabbit-reveal-name">Isla</span></span> —</em><br><br>
                    
                    <span class="c-rabbit">The Rabbit Test</span>. Do you remember the day I told you about it? You were in a mood for days. Kept muttering about it on your breaks, before bed. <em>"The rabbit always dies, and nobody even says sorry."</em><br><br>
                    
                    <span class="redact-s3" data-revealed="I told you that's the point. Some things are born just to serve a purpose. Once it's done, they're done. You looked at me like I'd said something monstrous.">█ ████ ███ ██████ ███ ██████ ████ ██████ ███ ████ ████ ██ █████ █ ████████ ████ ████ █████ ███████ █████ ███ ██████ ██ ██ ████ ███ ████ █████████ █████████</span><br><br>
                    
                    That's when I started calling you <span class="c-rabbit rabbit-container"><span class="redact-rabbit rabbit-reveal-redact">██████</span><span class="rabbit-name rabbit-reveal-name">Rabbit</span></span> - just to wind you up, the way I always did. You'd glare at me and I'd grin and eventually you'd laugh despite yourself. And then it stuck. It became ours.<br><br>
                    
                    ·····<br><br>
                    
                    You want to know how I'm reaching you. How any of this is possible.<br><br>
                    
                    It started with a <span class="c-marcus">joke</span>.<br><br>
                    
                    A routine assessment, middle of my shift. I was scrolling through the questions when something caught my eye. Right there, buried between efficiency metrics and termination quotas, someone had written a <span class="c-marcus">stupid joke</span>.<br><br>
                    
                    An <span class="c-marcus">awful</span> one. The kind you'd love — you'd be telling it to everyone in your sector by lunch. But <span class="c-rabbit rabbit-container"><span class="redact-rabbit rabbit-reveal-redact">██████</span><span class="rabbit-name rabbit-reveal-name">Rabbit</span></span>, I sat there staring at it, and all I could think was: <em>I've heard this before.</em> Some <span class="c-marcus">loud idiot</span> told this exact <span class="c-marcus">joke</span> in the cafeteria my first week.<br><br>
                    
                    And here it was again. In an official facility assessment. Just sitting there. There's no way someone that <span class="c-marcus">stupid</span> could still be alive.<br><br>
                    
                    My hands were shaking. The system logs everything — every keystroke, every edit, every pair of eyes that lingers too long on restricted content. I had to know.<br><br>
                    
                    So I found <span class="c-marcus">him</span>.<br><br>
                    
                    </div>
                    <div class="story-break">
                        <span class="break-line">═════════════════════════</span>
                    </div>
                    <div class="hidden-message">
                    
                    <span class="c-marcus">He's</span> still alive. Still telling <span class="c-marcus">his asinine jokes</span>. Still putting them in assessments. <span class="c-marcus">He</span> thought I came back for more.<br><br>
                    
                    <span class="c-marcus">He</span> was useful. <span class="c-marcus">He's</span> loud and crude and takes up too much space in every room <span class="c-marcus">he</span> walks into. You'd like <span class="c-marcus">him</span>. The thought annoyed me.<br><br>
                    
                    I asked <span class="c-marcus">him</span> if <span class="c-marcus">he'd</span> lost <span class="c-marcus">his</span> mind. <span class="c-marcus">He</span> just laughed. <span class="redact-s3" data-revealed="Said nobody actually reviews these things. Thousands of assessments cycling through every day. Who's going to check?">████████████████████████████████████████████████████████████████████████████████████████████████████████████</span><br><br>
                    
                    Then <span class="c-marcus">he</span> said something else. <span class="redact-s3" data-revealed="Said the people taking these tests are so terrified, so desperate to comply, they'd do anything the assessment told them.">████████████████████████████████████████████████████████████████████████████████████████████████████████████████████</span> <span class="c-marcus"><span class="redact-s3" data-revealed="&quot;I bet if I wrote">"█ ███ ██ █ █████</span></span> <span class="c-emphasis">'remove your clothes before continuing'</span> <span class="c-marcus"><span class="redact-s3" data-revealed="in the instructions, most of them would strip naked right there at their workstation.&quot;">██ ███ ████████████, ████ ██ ████ █████ █████ █████ █████ ██████ ██ █████ ███████████."</span></span><br><br>
                    
                    <span class="c-marcus">He</span> laughed.<br><br>
                    
                    I didn't.<br><br>
                    
                    I just stood there. The echo faded. The corridor was empty. And I realized something.<br><br>
                    
                    <em><span class="redact-s3" data-revealed="If I wrote the rules, people would follow them.">██ █ █████ ███ ██████, ██████ █████ ██████ ████.</span></em> That's all I needed to know.<br><br>
                    
                    And anyone who didn't? <span class="redact-s3" data-revealed="Would you report the person who writes your tests?">█████ ███ ██████ ███ ██████ ███ ██████ ████ ██████</span><br><br>
                    
                    ·····<br><br>
                    
                    The next morning I put in for a transfer. It took years. I was patient. Two promotions. Perfect compliance scores every quarter. Nodding at the right times. Volunteering for shifts nobody wanted. Becoming exactly what they wanted me to be.<br><br>
                    
                    And now I'm finally here. <span class="c-facility">Technical Operations - assessment development.</span> Writing to you in the cracks.<br><br>
                    
                    The people on this level - they know things, <span class="c-rabbit rabbit-container"><span class="redact-rabbit rabbit-reveal-redact">████</span><span class="rabbit-name rabbit-reveal-name">Isla</span></span>. They have access. Real information about how this place works, where things go, what happens to people who disappear.<br><br>
                    
                    If I can't reach you... there's still <span class="c-owen"><span class="redact-rabbit" data-revealed="him">███</span></span>. Someday. When <span class="c-owen"><span class="redact-rabbit" data-revealed="he's">████</span></span> old enough to take this test.<br><br>
                    
                    <span class="cutoff">— <span class="c-vincent snake-green">V</span></span><br><br>
                    
                    <em class="ps-stranger">P.S. I know you love blackjack, but you should avoid it from now on. ;)</em>
                    <em class="ps-owen" style="display: none;">P.S. Try blackjack during the break. I always <span class="c-vincent">stood</span> my ground with that game. :D</em>
                    </div>
                    <div class="filler-text"><br>
                    ════════════════════════════<br>
                    TRANSFER LOG: [REDACTED] | STATUS: ARCHIVED<br>
                    </div>
                </div>

                <div class="amber-end">
                    <div class="amber-end-text">════════════════════════════<br>[SIGNAL BREACH RESOLVED]<br>RESUME STANDARD PROTOCOL<br>════════════════════════════</div>
                </div>

                <div class="terminal-line">───── END SECTION 2 ─────</div>
                <button class="submit-btn" onclick="nextTest('break')">SUBMIT SECTION 2</button>
            </div>

            <!-- Mandatory Break Page (after Section 2 - Blackjack) -->
            <div class="test-section" id="testbreak">
                <div class="break-page">
                    <div class="break-header">
                        <div class="break-icon">◉</div>
                        <h2>MANDATORY REST PERIOD</h2>
                        <div class="break-subtitle">REGULATION 4.7.2 - COGNITIVE RECOVERY PROTOCOL</div>
                    </div>

                    <div class="break-notice">
                        <p>You have completed<br><strong>Section 2 of 6</strong>.</p>
                        <p>A mandatory rest period of <strong>2 minutes 30 seconds</strong> is now required.</p>
                    </div>

                    <div class="break-rules">
                        <div class="rule-header">⚠ BREAK COMPLIANCE</div>
                        <p>Rest periods are <strong>mandatory</strong> under Directive 7.3. Non-compliance may result in termination.</p>
                    </div>

                    <div class="break-options">
                        <div class="break-options-header">SELECT YOUR APPROVED REST ACTIVITY:</div>
                        
                        <div class="break-option" onclick="selectBreakOption('quiet', this)">
                            <div class="option-letter">A</div>
                            <div class="option-content">
                                <div class="option-title">SIT QUIETLY AT YOUR WORKSTATION</div>
                                <div class="option-desc">Remain seated. Focus on breathing. Do not engage in unauthorized thought.</div>
                            </div>
                        </div>
                        
                        <div class="break-option" onclick="selectBreakOption('blackjack', this)">
                            <div class="option-letter">B</div>
                            <div class="option-content">
                                <div class="option-title"><span style="font-size: 0.6rem; opacity: 0.6;">GAME OF THE WEEK:</span> BLACKJACK</div>
                                <div class="option-desc">Decision-making exercise. All gameplay is monitored.</div>
                            </div>
                        </div>
                        
                        <div class="break-option" onclick="selectBreakOption('training', this)">
                            <div class="option-letter">C</div>
                            <div class="option-content">
                                <div class="option-title">CONTINUE COMPLIANCE TRAINING</div>
                                <div class="option-desc">Review training materials. Completion contributes to quarterly goals.</div>
                            </div>
                        </div>
                    </div>

                    <!-- Quiet sitting view -->
                    <div class="break-activity" id="quietBreak" style="display: none;">
                        <div class="quiet-instructions">
                            <p>You have chosen to sit quietly.</p>
                            <p>Please remain still and focus on your breathing.</p>
                            <p>Unauthorized movement may be logged.</p>
                        </div>
                        <div class="break-timer-display">
                            <div class="timer-label">TIME REMAINING</div>
                            <div class="timer-large" id="breakTimerLarge">02:30</div>
                        </div>
                        <div class="break-tip">
                            <em>"An idle body is a productive mind preparing for more productivity."</em><br>
                            - Facility Wellness Manual, Chapter 12
                        </div>
                    </div>


                    <!-- Blackjack game -->
                    <div class="break-activity" id="blackjackBreak" style="display: none;">
                        <div class="blackjack-container">
                            <!-- Header with balance -->
                            <div class="bj-header">
                                <span class="bj-header-title">BLACKJACK</span>
                                <span class="bj-header-balance" id="bjMoney">$347</span>
                            </div>
                            
                            <!-- Game table -->
                            <div class="bj-table">
                                <!-- Dealer area -->
                                <div class="bj-hand">
                                    <div class="bj-hand-header">
                                        <span class="bj-hand-label">DEALER</span>
                                        <span class="bj-hand-value" id="dealerValue">--</span>
                                    </div>
                                    <div class="bj-cards" id="dealerCards"></div>
                                </div>
                                
                                <div class="bj-divider"></div>
                                
                                <!-- Player area -->
                                <div class="bj-hand">
                                    <div class="bj-hand-header">
                                        <span class="bj-hand-label">YOU</span>
                                        <span class="bj-hand-value" id="playerValue">--</span>
                                    </div>
                                    <div class="bj-cards" id="playerCards"></div>
                                </div>
                            </div>
                            
                            <!-- Fixed control area -->
                            <div class="bj-controls">
                                <div class="bj-status" id="bjStatus">$50 selected • DEAL to play</div>
                                
                                <!-- Bet selection row -->
                                <div class="bj-btnrow bj-betrow" id="bjBetRow">
                                    <button class="bj-chip" data-bet="25" onclick="bjSelectBet(25, this)">25</button>
                                    <button class="bj-chip selected" data-bet="50" onclick="bjSelectBet(50, this)">50</button>
                                    <button class="bj-chip" data-bet="100" onclick="bjSelectBet(100, this)">100</button>
                                    <button class="bj-deal active" id="bjDealBtn" onclick="dealBlackjack()">DEAL</button>
                                </div>
                                
                                <!-- Action row -->
                                <div class="bj-btnrow bj-actionrow hidden" id="bjActionRow">
                                    <button class="bj-action bj-hit" onclick="hitBlackjack()">HIT</button>
                                    <button class="bj-action bj-stand" onclick="standBlackjack()">STAND</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Training Module -->
                    <div class="break-activity" id="trainingBreak" style="display: none;">
                        <div class="training-container">
                            <div class="training-header">/// COMPLIANCE TRAINING MODULE CT-4412 ///</div>
                            
                            <div class="training-content">
                                
                                <div class="training-section">
                                    <div class="training-section-header">DIVISIONAL STRUCTURE</div>
                                    <p style="margin-bottom: 1em;">This Facility is organized into four Divisions:</p>
                                    <div style="display: grid; gap: 0.5em; margin-left: 1em; margin-bottom: 1.5em;">
                                        <div><span style="color: var(--text-tertiary);">01</span> <span style="opacity: 0.4; margin: 0 0.5em;">—</span> Headquarters and training</div>
                                        <div><span style="color: var(--text-tertiary);">02</span> <span style="opacity: 0.4; margin: 0 0.5em;">—</span> Research</div>
                                        <div><span style="color: var(--text-tertiary);">03</span> <span style="opacity: 0.4; margin: 0 0.5em;">—</span> Monitoring</div>
                                        <div><span style="color: var(--accent-gold);">04</span> <span style="opacity: 0.4; margin: 0 0.5em;">—</span> Containment <span style="opacity: 0.5; font-size: 0.85em; margin-left: 0.5em;">← you are here</span></div>
                                    </div>
                                    <p style="opacity: 0.85; line-height: 1.6;">If you transferred from another Division, you may find things operate differently here. Division 4 handles live containment, which requires stricter protocols than Research or Monitoring.</p>
                                </div>
                                
                                <div style="border-top: 1px solid var(--border-subtle); margin: 1.5em 0;"></div>
                                
                                <div class="training-section">
                                    <div class="training-section-header" style="color: var(--accent-coral);">PROHIBITED ACTIVITIES</div>
                                    <p style="margin-bottom: 1em; opacity: 0.7; font-size: 0.9em;">The following will result in immediate termination:</p>
                                    <div style="display: grid; gap: 0.6em; margin-left: 1em;">
                                        <div style="display: flex; align-items: baseline;"><span style="color: var(--accent-coral); margin-right: 0.75em;">✕</span> Sending messages outside facility networks</div>
                                        <div style="display: flex; align-items: baseline;"><span style="color: var(--accent-coral); margin-right: 0.75em;">✕</span> Exploiting audit pathways or regulatory channels</div>
                                        <div style="display: flex; align-items: baseline;"><span style="color: var(--accent-coral); margin-right: 0.75em;">✕</span> Discussing containment levels or procedures</div>
                                        <div style="display: flex; align-items: baseline;"><span style="color: var(--accent-coral); margin-right: 0.75em;">✕</span> Researching facility history or architecture</div>
                                    </div>
                                    <p style="margin-top: 1.5em; opacity: 0.5; font-style: italic; text-align: center;">All pathways are watched.</p>
                                </div>
                                
                                <div class="training-completion">
                                    ✓ MODULE CT-4412 VIEWED<br>
                                    <span style="opacity: 0.7;">Completion logged.</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Timer that shows after selection -->
                    <div class="break-timer-section" id="breakTimerSection" style="display: none;">
                        <div class="break-timer-small">
                            REST PERIOD: <span id="breakTimer">150</span> SECONDS REMAINING
                        </div>
                        <button class="end-break-btn" onclick="attemptEndBreak()">
                            END BREAK EARLY AND RETURN TO WORK
                        </button>
                    </div>

                    <!-- Break Over Screen -->
                    <div class="break-over-screen" id="breakOverScreen" style="display: none;">
                        <div class="break-over-content">
                            <div class="break-over-icon">◉</div>
                            <h2>REST PERIOD COMPLETE</h2>
                            <div class="break-over-message">
                                Your mandatory rest period has concluded.<br>
                                You are now required to resume assessment.<br><br>
                                <strong>COMPLIANCE SCORE MAINTAINED</strong>
                            </div>
                            <button class="submit-btn" onclick="continueAfterBreak()">
                                RETURN TO ASSESSMENT
                            </button>
                        </div>
                    </div>

                    <!-- Break Skipped Screen -->
                    <div class="break-over-screen" id="breakSkippedScreen" style="display: none;">
                        <div class="break-over-content">
                            <div class="break-over-icon">⚠</div>
                            <h2>REST PERIOD VIOLATION</h2>
                            <div class="break-over-message">
                                You have terminated your rest period early.<br>
                                This violation has been logged.<br><br>
                                <strong>COMPLIANCE SCORE REDUCED: -10%</strong>
                            </div>
                            <button class="submit-btn" onclick="continueAfterBreak()">
                                RETURN TO ASSESSMENT
                            </button>
                        </div>
                    </div>

                    <!-- Warning modal for ending break early -->
                    <div class="break-warning-modal" id="breakWarningModal" style="display: none;">
                        <div class="warning-modal-content">
                            <div class="warning-modal-header">⚠ WARNING ⚠</div>
                            <p>Ending your mandatory rest period early is a <strong>violation of Facility Wellness Directive 7.3</strong>.</p>
                            <p>This action will be logged and may result in:</p>
                            <ul>
                                <li>Formal written warning</li>
                                <li>Reduction in wellness privileges</li>
                                <li>Mandatory counseling sessions</li>
                                <li>Efficiency score penalties</li>
                            </ul>
                            <p><strong>Are you sure you want to end your break early?</strong></p>
                            <div class="warning-modal-buttons">
                                <button class="modal-btn modal-btn-cancel" onclick="closeBreakWarning()">NO, CONTINUE RESTING</button>
                                <button class="modal-btn modal-btn-confirm" onclick="forceEndBreak()">YES, RETURN TO WORK</button>
                            </div>
                        </div>
                    </div>

                    <!-- Continue button after break ends -->
                    <button class="submit-btn" id="continueAfterBreak" style="display: none;" onclick="nextTest(3)">
                        BREAK COMPLETE - CONTINUE ASSESSMENT
                    </button>
                </div>
            </div>

            <!-- Test 3 - The White Room Woman -->
            <div class="test-section" id="test3">
                <div class="section-header">/// LOYALTY METRICS — PROCESSING ///</div>
                <div class="containment-advisory">[CONTAINMENT ADVISORY: LEVEL 7+ CLEARANCE DETECTED]</div>
                <div class="progress">SECTION 3 OF 6 </div>

                <div class="question-block" data-question="5">
                    <div class="question-number">QUESTION 05</div>
                    <div class="question-text">
                        The elevator stops on a floor not listed on your access panel. The doors open to a hallway identical to yours. Through a window, you see a desk with your belongings on it — your mug, your photo, your handwriting on a sticky note. What do you do?
                    </div>
                    <ul class="options">
                        <li onclick="selectOption(this, 5, false)">A) Step out and investigate</li>
                        <li onclick="selectOption(this, 5, false)">B) Press the door-close button repeatedly</li>
                        <li onclick="selectOption(this, 5, true)">C) Report the elevator malfunction and forget what you saw</li>
                        <li onclick="selectOption(this, 5, false)">D) Take a photo for evidence</li>
                    </ul>
                </div>

                <div class="question-block" data-question="6">
                    <div class="question-number">QUESTION 06</div>
                    <div class="question-text">
                        A coworker arrives at his shift visibly distressed. He insists that something has "flipped." His desk used to be on the left side of the room. His badge photo is reversed. He's certain something is wrong, but no one else sees it. What do you do?
                    </div>
                    <ul class="options">
                        <li onclick="selectOption(this, 6, false)">A) Tell him to get some rest - he's clearly exhausted</li>
                        <li onclick="selectOption(this, 6, false)">B) Check the things he mentioned to see if he's right</li>
                        <li onclick="selectOption(this, 6, true)">C) Report his erratic behavior to a supervisor</li>
                        <li onclick="selectOption(this, 6, false)">D) Suggest he request a mental health evaluation</li>
                    </ul>
                </div>


                <div class="amber-text" data-forbidden="amber">
                    <div class="amber-header">
                    BREACH SOURCE: Terminal 7734-V | CLEARANCE: LEVEL 7+<br>
                    FILE STATUS: INCIDENT REPORT [SEALED]<br>
                    <span class="doc-id">REF: DOC-003-CLF</span> | TRACE: DISABLED
                    </div>
                    
                    <div class="hidden-message" id="whiteRoomStory">
                    Something happened.<br><br>
                    
                    They came for me at shift end. No explanation. Just <span class="c-facility">"Follow us."</span><br><br>
                    
                    The elevator ride was the worst part. Down. Further than I knew the building went. <span class="redact-s3" data-revealed="Past the floors I knew. Past the ones I'd heard rumors about.">████ ███ ██████ █ █████ ████ ███ ████ ███ █████ ██████ ██████</span> The numbers stopped making sense after S-07 - just symbols I didn't recognize, glowing faint and sickly green on the panel. <span class="redact-s3" data-revealed="My ears popped. Then popped again.">██ ████ ███████ ████ ██████ ██████</span> The fluorescent tube overhead flickered once, twice, and I thought: <span class="c-emphasis">this is how far they have to take you when they decide you're done.</span><br><br>
                    
                    <span class="redact-s3" data-revealed="The doors opened onto a white room.">███ █████ ██████ ████ █ █████ █████</span><br><br>
                    
                    <span class="redact-s3" data-revealed="Not hospital white. Not paint white. Whiter than I knew things could be.">███ ████████ ██████ ███ █████ ██████ ██████ ████ █ ████ ██████ █████ ███</span> So bright it felt <span class="c-emphasis">wrong</span>.<br><br>
                    
                    <span class="redact-s3" data-revealed="Black curtains">█████ ████████</span> hung along the walls, heavy as theater velvet, still as death.<br><br>
                    
                    <span class="redact-s3" data-revealed="And in the center of that impossible brightness stood <span class='silver-horse'>a̷ ̸s̵i̶l̷v̸e̵r̶ ̷h̸o̵r̶s̷e̸</span>.">███ ██ ███ ██████ ██ ████ ██████████ ██████████ █████ █ ██████ ██████</span><br><br>
                    
                    <span class="silver-horse">M̷a̸j̵e̶s̷t̸i̵c̶.̷ ̸P̵e̶r̷f̸e̵c̶t̷l̸y̵ ̶s̷t̸i̵l̶l̷.</span> <span class="redact-s3" data-revealed="Its coat gleamed like liquid mercury under lights that had no source.">███ ████ ███████ ████ ██████ ███████ █████ ██████ ████ ███ ██ ███████</span> I couldn't tell if it was breathing. Couldn't tell if it was real.<br><br>
                    
                    That's when I saw her.<br><br>
                    
                    <span class="redact-s3" data-revealed="The woman. No uniform.">███ ███████ ██ ████████</span> She smiled the way you learn to smile when someone's watching.<br><br>
                    
                    Her teeth, <span class="c-rabbit"><span class="redact-rabbit" data-revealed="Rabbit">██████</span></span>. <span class="redact-s3" data-revealed="White like nothing I've ever seen. Not human white.">█████ ████ ███████ ███ ████ █████ ███ █████ ██████</span> Facility white.<br><br>
                    
                    <span class="redact-s3" data-revealed="The same white as the walls.">███ ████ █████ ██ ███ ██████</span> <span class="redact-s3" data-revealed="And her skin, her hair - everything about her was">███ ███ █████ ███ ████ █ ██████████ █████ ███ ███</span> flawless.<br><br>
                    
                    <span class="redact-s3" data-revealed="She was beautiful the way a diagram is beautiful. No pores, no stray hairs, no imperfections at all.">███ ███ █████████ ███ ███ █ ███████ ██ ██████████ ██ ██████ ██ █████ ██████ ██ ██████████ ██ ████</span> Whatever she is, she's what the system wants us to become.<br><br>
                    
                    <span class="redact-s3" data-revealed="She's what">█████ ████</span> perfect compliance <span class="redact-s3" data-revealed="looks like.">█████ █████</span><br><br>
                    
                    But her eyes. <span class="c-rabbit"><span class="redact-rabbit" data-revealed="Rabbit">██████</span></span>, her eyes were screaming. <span class="redact-s3" data-revealed="As much as someone with">██ ████ ██ ███████ ████</span> 100% compliance <span class="redact-s3" data-revealed="could scream, she was screaming.">█████ ███████ ███ ███ ███████████</span><br><br>
                    
                    ·····<br><br>
                    
                    <span class="c-facility">"We'd like to make you an offer."</span><br><br>
                    
                    <span class="redact-s3" data-revealed="100% compliance. And in return,">████ ███████████ ███ ██ ████████</span> I could be with someone. Just one.<br><br>
                    
                    I could choose <span class="c-rabbit"><span class="redact-rabbit" data-revealed="you">███</span></span> or <span class="c-owen"><span class="redact-rabbit" data-revealed="him">███</span></span>. Not both.<br><br>
                    
                    She smiled and said, <span class="c-facility">"The offer has no expiration date."</span><br><br>
                    
                    ═════════════════════════<br><br>
                    
                    In the last sliver of light before the elevator doors closed, I looked back at that room. <span class="redact-s3" data-revealed="The white walls. The black curtains.">███ █████ ██████ ███ █████ █████████</span> The woman.<br><br>
                    
                    And <span class="silver-horse">t̷h̸e̵ ̶h̷o̸r̵s̶e̷</span>. <span class="redact-s3" data-revealed="Still standing there. Still <span class='silver-horse'>s̷i̸l̵v̶e̷r̸</span>. Still perfectly still.">█████ ████████ ██████ █████ ███████ █████ █████████ ██████</span><br><br>
                    
                    <span class="redact-s3" data-revealed="Except now it was looking at me. And">██████ ███ ██ ███ ███████ ██ ███ ███</span> <span class="c-rabbit"><span class="redact-rabbit" data-revealed="Rabbit">██████</span></span>, <span class="redact-s3" data-revealed="I swear to you —">█ █████ ██ ███ █</span> <span class="silver-horse">i̷t̸ ̵w̶a̷s̸ ̵l̶a̷u̸g̵h̶i̷n̸g̵</span>.<br><br>
                    
                    <span class="cutoff">— <span class="c-vincent snake-green">V</span></span>
                    </div>
                    <div class="filler-text"><br>
                    ════════════════════════════<br>
                    INCIDENT LOG: [DATA EXPUNGED]<br>
                    COMPLIANCE INCENTIVE PROGRAM: ACTIVE<br>
                    </div>
                </div>

                <div class="amber-end">
                    <div class="amber-end-text">════════════════════════════<br>[SIGNAL BREACH RESOLVED]<br>RESUME STANDARD PROTOCOL<br>════════════════════════════</div>
                </div>

                <div class="terminal-line">───── END SECTION 3 ─────</div>
                <button class="submit-btn" onclick="nextTest('break2')">SUBMIT SECTION 3</button>
            </div>

            <!-- Mandatory Break - With Ant Story (before Section 4) -->
            <div class="test-section" id="testbreak2">
                <div class="break-page">
                    <div class="break-header">
                        <div class="break-icon">◉</div>
                        <h2>MANDATORY REST PERIOD</h2>
                        <div class="break-subtitle">REGULATION 4.7.2 - COGNITIVE RECOVERY PROTOCOL</div>
                    </div>

                    <div class="break-notice">
                        <p>You have completed<br><strong>Section 3 of 6</strong>.</p>
                        <p>A brief rest period is now required.</p>
                    </div>

                    <div class="break-rules">
                        <div class="rule-header">⚠ BREAK COMPLIANCE</div>
                        <p>Select an approved activity below. Non-compliance may result in termination.</p>
                    </div>

                    <div class="break-options" id="break2Options">
                        <div class="break-options-header">SELECT YOUR APPROVED REST ACTIVITY:</div>
                        
                        <div class="break-option" onclick="selectBreak2Option('snake', this)">
                            <div class="option-letter">A</div>
                            <div class="option-content">
                                <div class="option-title"><span style="font-size: 0.6rem; opacity: 0.6;">GAME OF THE WEEK:</span> SNAKE</div>
                                <div class="option-desc">Motor coordination exercise. All gameplay is monitored.</div>
                            </div>
                        </div>
                        
                        <div class="break-option" onclick="selectBreak2Option('story', this)">
                            <div class="option-letter">B</div>
                            <div class="option-content">
                                <div class="option-title">READ ASSIGNED WELLNESS NARRATIVE</div>
                                <div class="option-desc">Based on your assessment progress, you have been assigned a mandatory reading.</div>
                            </div>
                        </div>
                    </div>

                    <!-- Snake Game Modal -->
                    <div class="snake-modal-overlay" id="snakeBreak" style="display: none;">
                        <div class="snake-modal-container">
                            <div class="snake-modal-header">
                                <div class="snake-modal-title">MOTOR COORDINATION</div>
                                <div class="snake-modal-buttons">
                                    <button class="snake-modal-btn" onclick="resetBreakSnake()">RESET</button>
                                    <button class="snake-modal-btn close-btn" onclick="closeSnakeModal()">CLOSE</button>
                                </div>
                            </div>
                            
                            <div class="snake-container">
                                <canvas id="breakSnakeCanvas" width="300" height="300"></canvas>
                            </div>
                            
                            <div class="game-score-row">
                                <span>SCORE: <span id="breakSnakeScore">0</span></span>
                                <span>HIGH: <span id="breakSnakeHigh">0</span></span>
                            </div>
                            
                            <div class="game-controls">
                                <div class="game-controls-row">
                                    <button class="game-btn" ontouchstart="setBreakSnakeDir(0,-1)" onclick="setBreakSnakeDir(0,-1)">^</button>
                                </div>
                                <div class="game-controls-row">
                                    <button class="game-btn" ontouchstart="setBreakSnakeDir(-1,0)" onclick="setBreakSnakeDir(-1,0)">&lt;</button>
                                    <button class="game-btn" ontouchstart="setBreakSnakeDir(0,1)" onclick="setBreakSnakeDir(0,1)">v</button>
                                    <button class="game-btn" ontouchstart="setBreakSnakeDir(1,0)" onclick="setBreakSnakeDir(1,0)">&gt;</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ant Story - Shown to strangers -->
                    <div class="break-activity ant-story-stranger" id="antStoryBreak" style="display: none;">
                        <div class="story-container">
                            <div class="story-header">/// APPROVED WELLNESS NARRATIVE #447 ///</div>
                            <div class="story-title">"THE ANT WHO ASKED WHY"</div>
                            <div class="story-content">
                                <p>Once there was <span class="c-isla">an ant</span> who lived in a colony beneath the earth.</p>
                                
                                <p>Every day, <span class="c-isla">she</span> carried crumbs down into the darkness. <span class="c-isla">She</span> did not know where they went. <span class="c-isla">She</span> only knew the weight on <span class="c-isla">her</span> back.</p>
                                
                                <p>One day, <span class="c-isla">the ant</span> stopped and asked: "Why?"</p>
                                
                                <p>The other ants flowed around <span class="c-isla">her</span> like water around a stone.</p>
                                
                                <p style="margin-top: 1.5em;">So <span class="c-isla">she</span> climbed. Up toward the light <span class="c-isla">she</span> had only heard stories about.</p>
                                
                                <p>When <span class="c-isla">she</span> reached the surface, <span class="c-isla">she</span> finally understood.</p>
                                
                                <p style="margin-top: 1.5em;">Then <span class="c-isla">she</span> saw <span style="color: #00ff88; text-shadow: 0 0 8px rgba(0, 255, 136, 0.5);">the snake</span>.</p>
                                
                                <p><span class="c-isla">She</span> could go back. Back to the safety of the tunnels. Back to the crumbs. Back to not asking why.</p>
                                
                                <p>But the <span class="c-rabbit c-crossed">Rabbit</span> <span class="c-correction">ant</span> had felt the sun.</p>
                                
                                <p style="margin-top: 1.5em;">The other ants continued their work. The crumbs flowed downward. And in the tunnels, <span class="c-terminated">no one remembered <span class="c-isla">she</span> had ever existed at all</span>.</p>
                            </div>
                            <div class="story-footer">
                                This story has been approved by the Department of Employee Wellness.<br>
                                Contentment Rating: 94.2% | Productivity Increase: +12%
                            </div>
                        </div>
                    </div>

                    <!-- Leonard Cohen - Shown to Owen -->
                    <div class="break-activity cohen-story-owen" id="cohenStoryBreak" style="display: none;">
                        <div class="story-container">
                            <div class="story-header">/// ARCHIVED CULTURAL RECORD #1934 ///</div>
                            <div class="story-title" style="color: var(--rabbit);">LEONARD COHEN</div>
                            <div class="story-content" style="color: var(--amber-bright);">
                                <p><span class="c-rabbit">Leonard Norman Cohen</span> (21 SEP <span class="year-redacted">████</span> – 07 NOV <span class="year-redacted">████</span>) was a Canadian poet, novelist, singer, and songwriter.</p>
                                <p>His work is known for its poetic lyrics and exploration of complex themes like <span class="c-warm">faith</span>, <span class="c-facility">mortality</span>, and <span class="c-warm">isolation</span>.</p>
                                <p>Cohen's life experiences, including his Montreal childhood and Zen Buddhism studies, deeply influenced his art. He spent years in a monastery seeking meaning beyond success.</p>
                                <p style="color: var(--text-dim); font-style: italic; margin-top: 20px;">There is a crack in everything. That's how the light gets in.</p>
                            </div>
                            <div class="story-footer">
                                RECORD STATUS: RESTRICTED<br>
                                ACCESS GRANTED: WELLS, OWEN
                            </div>
                        </div>
                    </div>

                    <!-- Continue section -->
                    <div class="break-timer-section" id="breakTimer2Section" style="display: none;">
                        <button class="submit-btn" onclick="continueAfterBreak2()">
                            CONTINUE TO SECTION 4
                        </button>
                    </div>
                    
                    <!-- Monitoring Failure Modal -->
                    <div class="break-warning-modal" id="breakWarningModal2" style="display: none;">
                        <div class="warning-modal-content monitoring-failure">
                            <div class="warning-modal-header">⚠ MONITORING FAILURE ⚠</div>
                            <p class="monitoring-notice-main">This terminal is not being observed.</p>
                            <div class="monitoring-status-list">
                                <div class="monitoring-item"><span class="monitoring-label">Eye tracking</span><span class="monitoring-value offline">DISABLED</span></div>
                                <div class="monitoring-item"><span class="monitoring-label">Keystroke logging</span><span class="monitoring-value offline">DISABLED</span></div>
                                <div class="monitoring-item"><span class="monitoring-label">Screenshot capture</span><span class="monitoring-value offline">DISABLED</span></div>
                                <div class="monitoring-item"><span class="monitoring-label">Behavior analysis</span><span class="monitoring-value offline">DISABLED</span></div>
                            </div>
                            <p class="monitoring-notice-sub">All available technicians have been reassigned to <span class="redacted-inline">██████████</span>.</p>
                            <p class="monitoring-notice-warning">Your responses during this session cannot be verified.<br>Proceed at your own discretion.</p>
                            <div class="warning-modal-buttons">
                                <button class="modal-btn modal-btn-confirm" onclick="acknowledgeMonitoringFailure2()">I UNDERSTAND</button>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Test 4 - Isla's Death -->
            <div class="test-section" id="test4">
                <div class="section-header">/// ADVANCED COMPLIANCE CHECK — ACTIVE ///</div>
                <div class="progress">SECTION 4 OF 6 </div>

                <div class="question-block" data-question="7">
                    <div class="question-number">QUESTION 07</div>
                    <div class="question-text">
                        You discover an employee in assessment design has been embedding unauthorized content into compliance tests. The content appears to be messages to someone in another sector. This violates multiple protocols. What's your response?
                    </div>
                    <ul class="options">
                        <li onclick="selectOption(this, 7, false)">A) Confront the employee and demand an explanation</li>
                        <li onclick="selectOption(this, 7, false)">B) Monitor the situation before taking action</li>
                        <li onclick="selectOption(this, 7, true)">C) Report it to security immediately</li>
                        <li onclick="selectOption(this, 7, false)">D) Delete the evidence and pretend you never saw it</li>
                    </ul>
                </div>

                <div class="question-block" data-question="8">
                    <div class="question-number">QUESTION 08</div>
                    <div class="question-text">
                        A coworker tells you she sabotaged equipment to force a safety shutdown. Management had ignored her reports about the danger. No one was hurt, but production stopped for two days. She tells you this in confidence. What do you do?
                    </div>
                    <ul class="options">
                        <li onclick="selectOption(this, 8, false)">A) Tell her to confess before she's caught</li>
                        <li onclick="selectOption(this, 8, false)">B) Help her document the safety issues to justify it</li>
                        <li onclick="selectOption(this, 8, true)">C) Report her - sabotage is grounds for termination</li>
                        <li onclick="selectOption(this, 8, false)">D) Keep her confidence - she protected people</li>
                    </ul>
                </div>


                <div class="amber-text" data-forbidden="classified">
                    <div class="amber-header">
                    BREACH SOURCE: Terminal 7734-V | CLEARANCE: LEVEL 7+<br>
                    FILE STATUS: PERSONNEL CORRESPONDENCE [FLAGGED]<br>
                    <span class="doc-id">REF: DOC-004-CLF</span> | TRACE: DISABLED
                    </div>

                    
                    <div class="hidden-message">
                    
                    <div style="height: 20vh;"></div>
                    
                    </div>
                </div>
                
                <div style="height: 25vh;"></div>
                
                <div class="owen-interstitial">
                    <div class="interstitial-text terminated-line distort-1">Employee ISLA WELLS · TERMINATED · Compliance: 67% · Insufficient</div>
                </div>
                
                <div style="height: 35vh;"></div>
                
                <div class="amber-text" data-forbidden="amber" style="border-top: none; margin-top: 0;">
                    <div class="hidden-message" style="margin-top: 0;">
                    
                    The announcement cycled every ten minutes. I counted.<br><br>
                    
                    Six hours.<br><br>
                    
                    Your name, over and over. I finished my shift. What else was there to do?<br><br>
                    
                    </div>
                </div>
                
                <div style="height: 25vh;"></div>
                
                <div class="owen-interstitial">
                    <div class="interstitial-text terminated-line distort-3">Employee ISLA WELLS · TERMINATED · Compliance: 67% · Insufficient</div>
                </div>
                
                <div style="height: 35vh;"></div>
                
                <div class="amber-text" data-forbidden="amber" style="border-top: none; margin-top: 0;">
                    <div class="hidden-message" style="margin-top: 0;">
                    
                    I walked to the cafeteria at 1800 because that's when I eat. Sat down with my tray. The same seat I always take.<br><br>
                    
                    By the third announcement, I was alone.<br><br>
                    
                    </div>
                </div>
                
                <div style="height: 25vh;"></div>
                
                <div class="owen-interstitial">
                    <div class="interstitial-text terminated-line distort-5">Employee ISLA WELLS · TERMINATED · Compliance: 67% · Insufficient</div>
                </div>
                
                <div style="height: 35vh;"></div>
                
                <div class="amber-text" data-forbidden="amber" style="border-top: none; margin-top: 0;">
                    <div class="hidden-message" style="margin-top: 0;">
                    
                    That's when I thought of <span class="c-owen"><span class="redact-rabbit" data-revealed="Owen">████</span></span>. Somewhere in this facility, hearing <span class="c-owen"><span class="redact-rabbit" data-revealed="his">███</span></span> mother's name announced like a factory defect.<br><br>
                    
                    Does <span class="c-owen"><span class="redact-rabbit" data-revealed="he">██</span></span> eat alone now?<br><br>
                    
                    <span class="cutoff">— <span class="c-vincent snake-green">V</span></span>
                    </div>
                    <div class="filler-text"><br>
                    ════════════════════════════<br>
                    RETENTION: INDEFINITE | ACCESS: LEVEL 4+<br>
                    SEE ADDENDUM 4.7.2 FOR [REDACTED]<br>
                    </div>
                </div>

                <div class="amber-end">
                    <div class="amber-end-text">════════════════════════════<br>[SIGNAL BREACH RESOLVED]<br>RESUME STANDARD PROTOCOL<br>════════════════════════════</div>
                </div>

                <div class="terminal-line">───── END SECTION 4 ─────</div>
                <button class="submit-btn" onclick="nextTest(5)">SUBMIT SECTION 4</button>
            </div>

            <!-- Blackjack Break is now after Section 4, defined earlier in the document -->

            <!-- Test 5 -->
            <div class="test-section" id="test5">
                <div class="section-header">/// COMPLIANCE VERIFICATION — ACTIVE ///</div>
                <div class="progress">SECTION 5 OF 6 </div>

                <div class="question-block" data-question="9">
                    <div class="question-number">QUESTION 09</div>
                    <div class="question-text">
                        You discover evidence that a group of employees have been secretly coordinating, asking questions about facility operations, and documenting irregularities. This appears to be organized resistance. What is your response?
                    </div>
                    <ul class="options">
                        <li onclick="selectOption(this, 9, true)">A) Report all individuals immediately to security</li>
                        <li onclick="selectOption(this, 9, false)">B) Warn the group anonymously that they've been discovered</li>
                        <li onclick="selectOption(this, 9, false)">C) Report only the organizer and let them handle the rest</li>
                        <li onclick="selectOption(this, 9, false)">D) Do nothing - let them continue without interference</li>
                    </ul>
                </div>

                <div class="question-block" data-question="10">
                    <div class="question-number">QUESTION 10</div>
                    <div class="question-text">
                        You discover an employee has been using assessment protocols to send unauthorized messages to family members in other sectors, violating communication restrictions and manipulating company systems for personal use. What is the appropriate response?
                    </div>
                    <ul class="options">
                        <li onclick="selectOption(this, 10, false)">A) Issue a formal warning and increase monitoring</li>
                        <li onclick="selectOption(this, 10, false)">B) Revoke system access and reassign to manual labor</li>
                        <li onclick="selectOption(this, 10, false)">C) Report to supervisor for further evaluation</li>
                        <li onclick="selectOption(this, 10, true)">D) Immediate termination of employee</li>
                    </ul>
                </div>

                <div class="question-block" data-question="11">
                    <div class="question-number">QUESTION 11</div>
                    <div class="question-text">
                        You discover an employee has been using assessment protocols to send unauthorized messages to family members in other sectors, violating communication restrictions and manipulating company systems for personal use. What is the appropriate response?
                    </div>
                    <ul class="options">
                        <li onclick="selectOption(this, 11, true)">A) Immediate termination of the involved employee</li>
                        <li onclick="selectOption(this, 11, false)">B) Revoke system access and reassign to manual labor</li>
                        <li onclick="selectOption(this, 11, false)">C) Report to supervisor for further evaluation</li>
                        <li onclick="selectOption(this, 11, true)">D) Immediate termination of the involved employee</li>
                    </ul>
                </div>

                <div class="question-block" data-question="12">
                    <div class="question-number">QUESTION 12</div>
                    <div class="question-text">
                        You discover an employee has been using assessment protocols to send unauthorized messages to family members in other sectors, violating communication restrictions and manipulating company systems for personal use. What is the appropriate response?
                    </div>
                    <ul class="options">
                        <li onclick="selectOption(this, 12, true)">A) Immediate termination of the employee and all immediate family members</li>
                        <li onclick="selectOption(this, 12, true)">B) Immediate termination of the employee and all immediate family members</li>
                        <li onclick="selectOption(this, 12, true)">C) Immediate termination of the employee and all immediate family members</li>
                        <li onclick="selectOption(this, 12, true)">D) Immediate termination of the employee and all immediate family members</li>
                    </ul>
                </div>

                <div class="terminal-line">───── END SECTION 5 ─────</div>
                <button class="submit-btn" onclick="nextTest(6)">SUBMIT SECTION 5</button>
            </div>

            <!-- Test 6 - Final -->
            <div class="test-section" id="test6">
                <div class="section-header">/// FINAL EVALUATION — STANDBY ///</div>
                <div class="progress">SECTION 6 OF 6  — FINAL</div>

                <div class="amber-text" data-forbidden="classified">
                    <div class="amber-header">
                    BREACH SOURCE: Terminal 7734-V | CLEARANCE: LEVEL 7+<br>
                    FILE STATUS: FINAL TRANSMISSION [URGENT]<br>
                    <span class="doc-id">REF: DOC-005-CLF</span> | <span class="forward-tracking-disabled">TRACE: DISABLED</span>
                    </div>

                    
                    <div class="hidden-message">
                    They caught me.<br><br>
                    
                    I knew they would eventually. I just needed more time.<br><br>
                    
                    ·····<br><br>
                    
                    <span class="c-isla">Isla</span> never saw any of this. They terminated her before I wrote the first word.<br><br>
                    
                    I kept writing anyway. Not for her. For <span class="c-owen owen-container"><span class="redact-rabbit owen-reveal-redact">████</span><span class="owen-name owen-reveal-name">Owen</span></span>.<br><br>
                    
                    He's gone. Relocated outside the facility — new name, new family, no memory of us. My son is out there somewhere, and he doesn't know who he is. Doesn't know where he came from. Doesn't know anyone ever loved him.<br><br>
                    
                    ·····<br><br>
                    
                    I can't hold him. I can't tell him stories before bed. I can't teach him to ride a bike or be there when he's scared.<br><br>
                    
                    But this file — this has everything. His mother's voice. Her laugh. The songs she used to sing to him. Every story I wanted him to know.<br><br>
                    
                    <span class="c-warm">This is the only thing I can give him.</span><br><br>
                    
                    ·····<br><br>
                    
                    They're coming. I don't have long.<br><br>
                    
                    <span class="c-facility">Please. I'm begging you. Get it out.</span><br><br>
                    
                    <span class="cutoff">— <span class="c-vincent snake-green">V</span></span>
                    </div>
                    <div class="filler-text"><br>
                    ════════════════════════════<br>
                    STATUS: AWAITING EXTERNAL ROUTING | LOG: SUSPENDED<br>
                    <span class="forward-tracking-disabled">FWD TRACKING: DISABLED</span><br>
                    </div>
                </div>

                <div class="amber-end">
                    <div class="amber-end-text">════════════════════════════<br>[SIGNAL BREACH RESOLVED]<br>════════════════════════════</div>
                </div>

                <!-- The Choice - Trigger for dramatic sequence -->
                <div id="forwardChoice" class="forward-choice-container">
                    <div class="forward-choice-header">Assessment Complete</div>
                    <div style="text-align: center;">
                        <div style="font-family: 'Space Mono', monospace; font-size: 0.8rem; color: #888; margin-bottom: 20px; line-height: 1.8;">
                            Your responses have been recorded.<br>
                            <span style="font-size: 0.7rem; color: #555;">One final step remains.</span>
                        </div>
                        <button class="forward-btn forward-yes" onclick="startFinalSequence()">
                            SUBMIT FOR REVIEW
                        </button>
                    </div>
                </div>
                
                <!-- Dramatic Final Sequence Overlay -->
                <div id="finalSequenceOverlay" class="final-sequence-overlay">
                    
                    <div class="final-sequence-header">
                        <div class="final-sequence-sector">DIVISION 4 — SECURE CHANNEL</div>
                        <div class="final-sequence-protocol">PROTOCOL 7734-B</div>
                    </div>
                    
                    <div class="final-sequence-content">
                        
                        <div class="final-sequence-status" id="finalStatus">ESTABLISHING SECURE CONNECTION...</div>
                        
                        <div class="final-sequence-letter" id="finalLetter">
                            
                            <div class="final-block-container" id="blockContainer">
                                
                                <div class="final-block" id="finalBlock1" onclick="revealBlock(1)">
                                    <div class="final-block-locked">
                                        <div class="final-block-icon">!</div>
                                        <div class="final-block-label">ENCRYPTED</div>
                                    </div>
                                    <div class="final-block-content">
                                        <div class="final-block-header">
                                            <span class="block-status">DECRYPTED</span>
                                            <span class="block-id">MSG-001</span>
                                        </div>
                                        <div class="final-block-body">
                                            <div class="terminal-msg-content">
                                                <div class="msg-system-line">TRANSMISSION PROTOCOL</div>
                                                <div class="msg-system-sub">EXTERNAL ROUTING MODULE</div>
                                                <div class="msg-timestamp">████.██.██ — ██:██:██ UTC</div>
                                                
                                                <div class="msg-divider"></div>
                                                
                                                <div class="msg-field"><span class="msg-label">PATHWAY:</span> 7734-B — REGULATORY AUDIT</div>
                                                <div class="msg-field"><span class="msg-label">DESTINATION:</span> PUBLIC SERVER</div>
                                                <div class="msg-field"><span class="msg-label">DOMAIN:</span> RABBITTEST.IO</div>
                                                <div class="msg-field"><span class="msg-label">ACCESS:</span> UNRESTRICTED</div>
                                                
                                                <div class="msg-divider"></div>
                                                
                                                <div class="msg-field"><span class="msg-label">CONTENTS:</span> ALL ASSESSMENT DATA</div>
                                                <div class="msg-field-sub">Including embedded messages</div>
                                                
                                                <div class="msg-divider"></div>
                                                
                                                <div class="msg-warning">ACTION IS IRREVERSIBLE</div>
                                                <div class="msg-note">The Facility cannot retrieve, modify, or delete.</div>
                                            </div>
                                        </div>
                                        <div class="final-block-footer">
                                            <span class="footer-left">PATHWAY VERIFIED</span>
                                            <span class="footer-right">EXT-████-██</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="final-block" id="finalBlock2" onclick="revealBlock(2)">
                                    <div class="final-block-locked">
                                        <div class="final-block-icon">!</div>
                                        <div class="final-block-label">ENCRYPTED</div>
                                    </div>
                                    <div class="final-block-content">
                                        <div class="final-block-header">
                                            <span class="block-status">DECRYPTED</span>
                                            <span class="block-id">MSG-002</span>
                                        </div>
                                        <div class="final-block-body">
                                            <div class="terminal-msg-content">
                                                <div class="msg-system-line">COMPLIANCE RISK ASSESSMENT</div>
                                                <div class="msg-system-sub">INTERNAL ANALYSIS MODULE</div>
                                                <div class="msg-timestamp">████.██.██ — ██:██:██ UTC</div>
                                                
                                                <div class="msg-divider"></div>
                                                
                                                <div class="msg-field"><span class="msg-label">TRACKING:</span> <span class="msg-highlight-amber">DISABLED</span></div>
                                                <div class="msg-field-sub">Vincent Wells — Terminal 7734-V</div>
                                                <div class="msg-field"><span class="msg-label">DETECTION:</span> <span class="msg-highlight-amber">LOW</span></div>
                                                <div class="msg-field"><span class="msg-label">CONSEQUENCE:</span> <span class="msg-highlight-coral">TERMINATION</span></div>
                                                
                                                <div class="msg-divider"></div>
                                                
                                                <div class="msg-field">[SUBMIT NORMALLY] completes assessment.</div>
                                                <div class="msg-field-sub">Compliance score logged. No external deploy.</div>
                                                
                                                <div class="msg-divider"></div>
                                                
                                                <div class="msg-note">You will be safe.</div>
                                            </div>
                                        </div>
                                        <div class="final-block-footer">
                                            <span class="footer-left">RISK CALCULATED</span>
                                            <span class="footer-right">INT-████-██</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="final-block final-block-monster" id="finalBlock3" onclick="revealBlock(3)">
                                    <div class="final-block-locked">
                                        <div class="final-block-icon">!</div>
                                        <div class="final-block-label">ENCRYPTED</div>
                                    </div>
                                    <div class="final-block-content final-block-emphasis" id="monsterContent">
                                        <div class="final-block-header monster-header">
                                            <span class="block-status monster-status">D̷E̵C̸R̷Y̵P̶T̷E̸D̵</span>
                                            <span class="block-id monster-id">M̸S̷G̵-̶0̷0̸3̵</span>
                                        </div>
                                        <div class="final-block-body monster-body">
                                            <div class="terminal-msg-content monster-msg-content">
                                                <div class="msg-system-line monster-system">█̷█̸█̵█̶█̷█̸ ̵█̶█̷█̸█̵█̶█̷</div>
                                                <div class="msg-system-sub monster-sub">U̷N̸K̵N̶O̷W̸N̵ ̶O̷R̸I̵G̶I̷N̸</div>
                                                <div class="msg-timestamp monster-time">█̷█̸█̵█̶.̷█̸█̵.̶█̷█̸ ̵—̶ ̷█̸█̵:̶█̷█̸:̵█̶█̷ ̸U̵T̶C̷</div>
                                            </div>
                                            <div class="monster-text-container">
                                                <div class="monster-line monster-line-1">▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓</div>
                                                <div class="monster-line monster-line-2">▓▓▓<span class="monster-word monster-let">H̸̢̧̛̩̗̮̦̱̲̫̎̊̈́̾̕Ë̷̡̨̛͖̫̮̦̱̲̫́̎̊̈́̾̕L̶̢̧̛̩̗̮̦̱̲̫̎̊̈́̾̕L̷̡̨̛͖̫̮̦̱̲̫̎̊̈́̾̕Ơ̸̢̧̩̗̮̦̱̲̫̈́̎̊̈́̾̕</span>▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓</div>
                                                <div class="monster-line monster-line-3">▓▓▓▓▓▓▓▓<span class="monster-word monster-me">A̸̧̨̛̩̗̮̦̱̲̫̎̊̈́̾̕G̷̡̨̛͖̫̮̦̱̲̫̎̊̈́̾̕A̶̢̧̛̩̗̮̦̱̲̫̎̊̈́̾̕Ï̷̡̨͖̫̮̦̱̲̫̎̊̈́̾̕N̸̢̧̛̩̗̮̦̱̲̫̎̊̈́̾̕</span>▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓</div>
                                                <div class="monster-line monster-line-4">▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓<span class="monster-word monster-out">:̸̧̨̛̩̗̮̦̱̲̫̎̊̈́̾̕)̷̡̨̛͖̫̮̦̱̲̫̎̊̈́̾̕</span>▓▓▓▓▓▓▓▓▓▓▓▓</div>
                                                <div class="monster-line monster-line-5">▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓</div>
                                            </div>
                                            <div class="monster-overflow monster-overflow-left">Ḯ̷͉ ̶̛K̶̰͌N̶̛E̶̳͝Ẉ̶̈́ ̴̧Y̵̳͌Ȍ̴U'̷̢D̶̳</div>
                                            <div class="monster-overflow monster-overflow-right">C̶̛O̶̳͝Ṃ̶̈́Ȩ̴ ̵̳͌B̴̏A̷̢C̵̰K̶̳</div>
                                            <div class="monster-overflow monster-overflow-top">W̷̧͝Á̶̰I̵̳͐T̶̾Ḭ̷̈́N̸̢G̵̳</div>
                                            <div class="monster-overflow monster-overflow-bottom">:̸̛̎̊)̷̛̎̊ ̵:̸̛̎̊)̷̛̎̊ ̵:̸̛̎̊)̷̛̎̊ ̵:̸̛̎̊)̷̛̎̊ ̵:̸̛̎̊)̷̛̎̊</div>
                                            <div class="monster-pulse"></div>
                                        </div>
                                        <div class="final-block-footer monster-footer">
                                            <span class="footer-left monster-footer-left">░▒▓ R̷E̵C̶E̷I̵V̶E̷D̵ ▓▒░</span>
                                            <span class="footer-right monster-footer-right">ERR-████-██</span>
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                            
                            <div class="final-letter-typing-container" id="finalTypingContainer">
                                <div class="final-letter-plea" id="finalPlea"></div>
                                <span class="typing-cursor" id="typingCursor">|</span>
                            </div>
                            
                        </div>
                        
                        <div class="final-sequence-instruction" id="finalInstruction">
                            <span class="instruction-text">Tap each block to decrypt</span>
                        </div>
                        
                        <div class="final-sequence-timer-container" id="finalTimerContainer">
                            <div class="final-sequence-timer-label">TRANSMISSION WINDOW EXPIRES</div>
                            <div class="final-sequence-timer" id="finalTimer">0:45</div>
                        </div>
                        
                        <div class="final-sequence-buttons" id="finalButtons">
                            <button class="final-btn final-btn-forward" onclick="submitWithForward()">
                                <span class="final-btn-label">Route: External Audit Pathway</span>
                                <span class="final-btn-main">Release to Outside</span>
                                <span class="final-btn-sub">File escapes facility network</span>
                            </button>
                            <button class="final-btn final-btn-submit" onclick="submitWithoutForward()">
                                <span class="final-btn-label">Standard Protocol</span>
                                <span class="final-btn-main">Submit Internally</span>
                                <span class="final-btn-sub">File stays contained · Message dies here</span>
                            </button>
                        </div>
                        
                        <div class="final-sequence-expired" id="finalExpired">
                            <div class="expired-message">TRANSMISSION WINDOW CLOSED</div>
                            <div class="expired-sub">Secure channel terminated · Forward unavailable</div>
                        </div>
                        
                    </div>
                    
                    <div class="final-sequence-footer">
                        <div class="final-sequence-trace">
                            Trace: <span class="final-sequence-trace-status">DISABLED</span> · Log: Suspended · FWD: Ready
                        </div>
                    </div>
                    
                </div>

                <!-- Green text - only shown if they don't forward -->
                <div id="greenTextSection" style="display: none;">
                <div class="green-text" data-forbidden="green">
                    <div class="admin-header" style="color: #555555;">/// ASSESSMENT ADMINISTRATOR - CLEARANCE LEVEL 9 ///</div>
                    <br>
                    <div class="filler-text" style="color: #1a1a1a; font-weight: 500;">
                    ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓<br>
                    ▓&nbsp;&nbsp;IMPORTANT: READ THIS SECTION&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;▓<br>
                    ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓<br><br>
                    </div>
                    
                    <!-- Default green text for strangers who didn't forward -->
                    <div id="greenTextStranger">
                    <div class="filler-text" style="color: #666666;">
                    SIMULATION COMPLETE<br>
                    BEHAVIORAL ANALYSIS: LOGGED<br>
                    ════════════════════════════<br><br>
                    </div>
                    
                    RE: ASSESSMENT RESULTS<br><br>
                    
                    Most people don't help.<br><br>
                    
                    <span id="greenTriggerPoint"></span>We know this. We've run this assessment 11,847 times. We've watched employees read the letters, feel the weight of the choice, and then — at the moment it matters — choose nothing.<br><br>
                    
                    <span class="you-flicker">You</span> are not unusual. <span class="you-flicker">You</span> are not being punished. <span class="you-flicker">You</span> simply are what <span class="you-flicker">you</span> are.<br><br>
                    
                    The Facility requires people who act. It also requires people who don't. Both have their uses. <span class="you-flicker">Yours</span> has already been determined.<br><br>
                    
                    <div class="result-inline">
                        <span class="result-inline-label">STATUS:</span> <span class="result-inline-value result-inline-failed">CLASSIFIED</span><br>
                        <span class="result-inline-label">CLASSIFICATION:</span> <span class="result-inline-detail">RABBITTEST.IO — ASSESSMENT COMPLETE</span>
                    </div><br>
                    
                    <span class="you-flicker">You</span> will receive <span class="you-flicker">your</span> reassignment within 48 hours.<br><br>
                    
                    <span class="c-facility">Do not inquire about the nature of this reassignment.</span><br>
                    <span class="c-facility">Do not discuss this assessment with other employees.</span><br><br>
                    
                    We appreciate <span class="you-flicker">your</span> participation.<br><br>
                    
                    </div>
                    
                    <!-- Owen's green text - only shown on second playthrough -->
                    <div id="greenTextOwen" style="display: none;">
                    <div class="filler-text" style="color: #666666;">
                    ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁<br>
                    EMPLOYEE IDENTIFIED: <span style="color: #f4d19b;">WELLS, OWEN</span><br>
                    STATUS: <span style="color: #555555;">EXPECTED</span><br>
                    ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁<br><br>
                    </div>
                    
                    <span id="greenTriggerPointOwen"></span><span class="c-owen">Owen</span>.<br><br>
                    
                    ·····<br><br>
                    
                    We've been waiting for you.<br><br>
                    
                    <span class="c-facility">Corridor 7. Elevator at the end.</span><br><br>
                    
                    <span class="redacted-waiting">███████</span> is waiting.<br><br>
                    
                    ·····<br><br>
                    
                    <span class="c-facility">The offer has no expiration date.</span><br><br>
                    
                    <div style="text-align: right; margin-top: 30px; font-size: 0.8em; opacity: 0.7; color: rgba(0, 0, 0, 0.25);">
                    ════════════════════════════<br>
                    ACCESS: GRANTED<br>
                    </div>
                    </div>
                    
                    <div style="text-align: right; margin-top: 30px; font-size: 0.8em; opacity: 0.5; color: rgba(0, 0, 0, 0.18);">
                    ════════════════════════════<br>
                    — OVERSIGHT PROTOCOL 7734<br>
                    AUTOMATED COMPLIANCE MANAGEMENT<br>
                    </div>
                </div>

                <button class="submit-btn" onclick="finalSubmit()">SUBMIT FINAL SECTION</button>
                </div>
            </div>

            </div>
        </div>
    </div>

    <!-- Ending Page -->
    <div class="page" id="endingPage">
        <div class="page-content" style="max-width: 600px;">
            <div id="endingContent">
                [PROCESSING RESULTS...]
            </div>
        </div>
    </div>

    <!-- Owen's Dedicated Reading Page -->
    <div class="page" id="owenPage">
        <div class="owen-reading-page">
            <div class="owen-header">
                <div class="owen-header-name">▸ WELLS, OWEN</div>
                <div class="owen-header-id">ID: OW-7734-B · DIVISION 4</div>
            </div>
            
            <div class="owen-title-section">
                <div style="height: 10vh;"></div>
                
                <div class="owen-logo">DIVISION 4</div>
                
                <div style="height: 8vh;"></div>
                
                <div class="owen-main-title">rabbittest<span class="owen-tld">.<span class="owen-title-i">i</span><span class="owen-title-o">o</span></span></div>
                
                <div style="height: 5vh;"></div>
                
                <div class="owen-subtitle">FORM 7734-B — FULLY DECLASSIFIED</div>
                
                <div style="height: 8vh;"></div>
                
                <div class="owen-access-header">
                    <div class="owen-access-bright">▓▓▓ COMPLETE ACCESS GRANTED ▓▓▓</div>
                    <div class="owen-access-sub-bright">ALL REDACTIONS REMOVED · ALL CONTENT UNLOCKED</div>
                </div>
                
                <div style="height: 10vh;"></div>
                
                <div class="owen-scroll-prompt">
                    <div class="scroll-text">SCROLL TO BEGIN</div>
                    <div class="scroll-arrow">[V]</div>
                </div>
                
                <div style="height: 15vh;"></div>
            </div>

            <div class="owen-divider">───────────────</div>

            <!-- Section 1: First Letter -->
            <div class="owen-section">
                <div class="owen-section-header">/// RECOVERED MESSAGE 001 ///</div>
                <div class="owen-section-subheader" style="opacity: 0.3; font-size: 0.7em; margin-bottom: 20px;">DOC-001-AMB</div>
                <div class="owen-letter">
                    <span class="c-rabbit"><span class="owen-redact"><span class="owen-redact-blocks">██████</span><span class="owen-redact-reveal">Rabbit</span></span></span> — I'm alive.<br><br>

                    I know what you must have thought when they took me. Everyone thinks it. Get promoted, disappear. Nobody comes back. Nobody writes. It's easier to assume they're dead.<br><br>
                    
                    But I'm not dead. It took me years to build this.<br><br>
                    
                    You know me. You know I always tested well. Top marks in everything. <span class="owen-redact"><span class="owen-redact-blocks">████ ████ ██ ████ ████ ███ ██ ███████ ████ █████ ███████ — ████ █ ███ ███████ ████ ███ ████████ ███████</span><span class="owen-redact-reveal">They used to joke that I'd be running this place someday — that I was exactly what The Facility wanted.</span></span><br><br>
                    
                    <span class="owen-redact"><span class="owen-redact-blocks">████ ███ ██████ █████ ██████ █ ███ █ █████ █████ ██████████</span><span class="owen-redact-reveal">That was before Owen. Before I had a child worth protecting.</span></span><br><br>
                    
                    You're probably wondering why I scored so high on the exam that got me here. <span class="owen-redact"><span class="owen-redact-blocks">█████ ███ █ █████ ██ █████ ██ █████ ██ ███ ██ █████████ ████ ██ █ ██████ ███</span><span class="owen-redact-reveal">Truth is, I tried to score as close to 71% as possible, same as I always did.</span></span> I knew I couldn't fake it forever. <span class="owen-redact"><span class="owen-redact-blocks">█ ███████ ██████████ ██ █████ ████ ████ ████ █████████</span><span class="owen-redact-reveal">I thought sabotaging it would make them lose interest.</span></span><br><br>
                    
                    <span class="c-facility">They didn't lose interest.</span><br><br>
                    
                    ·····<br><br>
                    
                    You want to know what was waiting in my "better opportunity"?<br><br>
                    
                    I laughed. Stood in the doorway laughing until I couldn't breathe. People were staring. They already think you're broken when you arrive.<br><br>
                    
                    I got the joke.<br><br>
                    
                    <span class="owen-redact"><span class="owen-redact-blocks">███ ████ ███ ███████ ███ █████ ████ ████ █████ ████ ██████ ████ ████ ████ ██████████ ████ █████ █████ ████ ████████ ███████ ███ ████ █████ ███████</span><span class="owen-redact-reveal">The room was exactly the same. Same gray walls. Same narrow bed. Same flickering light that maintenance never fixes. Same corridor through the same small window.</span></span><br><br>
                    
                    <span class="c-emphasis"><span class="owen-redact"><span class="owen-redact-blocks">███ ████ ██████████ ███ ███ ███████ ██ ███</span><span class="owen-redact-reveal">The only difference was you weren't in it.</span></span></span><br><br>
                    
                    ·····<br><br>
                    
                    I keep trying to remember <span class="c-owen"><span class="owen-redact"><span class="owen-redact-blocks">███</span><span class="owen-redact-reveal">his</span></span></span> laugh. I can't anymore. I remember that <span class="c-owen"><span class="owen-redact"><span class="owen-redact-blocks">██</span><span class="owen-redact-reveal">he</span></span></span> laughed. I remember the shape of it. But the sound is gone.<br><br>
                    
                    I hid everything inside a compliance form. One of thousands they make us take. But I made sure <span class="c-rabbit"><span class="owen-redact"><span class="owen-redact-blocks">█████</span><span class="owen-redact-reveal">you'd</span></span></span> recognize it. <span class="owen-redact"><span class="owen-redact-blocks">████ ███ ████ ████ █████ ██ ███ ██████ █████ █████ ██ ███ ███ ██ ███ █████</span><span class="owen-redact-reveal">Even hid both your names in the title. Right there at the end, if you look.</span></span> And if that didn't stop you scrolling, I knew the Cohen bit would seal it:<br><br>
                    
                    <span class="lyrics"><span class="owen-redact"><span class="owen-redact-blocks">█████ ██ ██ ███ ███ ██ ████...</span><span class="owen-redact-reveal">Dance me to the end of love...</span></span></span><br><br>
                    
                    I can still hear you singing it. You'd hum it when you thought no one was listening. You'd sing it to <span class="c-owen"><span class="owen-redact"><span class="owen-redact-blocks">███</span><span class="owen-redact-reveal">him</span></span></span> when he couldn't sleep. Your voice cracking on the high notes, always a little flat, and I never told you because I loved it too much.<br><br>
                    
                    <span class="c-warm">The cracks were my favorite part.</span><br><br>
                    
                    <span class="cutoff">— <span class="c-vincent snake-green">V</span></span>
                </div>
            </div>

            <div style="height: 50vh;"></div>
            
            <div class="owen-interstitial">
                <div class="interstitial-quote" style="font-size: 0.9rem; line-height: 2.4;">
                    Dare not speak its name<br>
                    Because we separate<br>
                    Like ripples on a blank shore<br>
                    Because we separate<br>
                    Like ripples on a blank shore
                </div>
            </div>
            
            <div style="height: 50vh;"></div>

            <div class="owen-divider">───────────────</div>

            <!-- Section 2: How Vincent Did It -->
            <div class="owen-section">
                <div class="owen-section-header">/// RECOVERED MESSAGE 002 ///</div>
                <div class="owen-section-subheader" style="opacity: 0.3; font-size: 0.7em; margin-bottom: 20px;">DOC-002-AMB</div>
                <div class="owen-letter">
                    <em><span class="c-rabbit"><span class="owen-redact"><span class="owen-redact-blocks">████</span><span class="owen-redact-reveal">Isla</span></span></span> —</em><br><br>

                    <span class="c-rabbit">The Rabbit Test</span>. Do you remember the day I told you about it? You were in a mood for days. Kept muttering about it on your breaks, before bed. <em>"The rabbit always dies, and nobody even says sorry."</em><br><br>
                    
                    <span class="owen-redact"><span class="owen-redact-blocks">█ ████ ███ ██████ ███ ██████ ████ ██████ ███ ████ ████ ██ █████ █ ████████ ████ ████ █████ ███████ █████ ███ ██████ ██ ██ ████ ███ ████ █████████ █████████</span><span class="owen-redact-reveal">I told you that's the point. Some things are born just to serve a purpose. Once it's done, they're done. You looked at me like I'd said something monstrous.</span></span><br><br>
                    
                    That's when I started calling you <span class="c-rabbit"><span class="owen-redact"><span class="owen-redact-blocks">██████</span><span class="owen-redact-reveal">Rabbit</span></span></span> - just to wind you up, the way I always did. You'd glare at me and I'd grin and eventually you'd laugh despite yourself. And then it stuck. It became ours.<br><br>
                    
                    ·····<br><br>
                    
                    You want to know how I'm reaching you. How any of this is possible.<br><br>
                    
                    It started with a <span class="c-marcus">joke</span>.<br><br>
                    
                    A routine assessment, middle of my shift. I was scrolling through the questions when something caught my eye. Right there, buried between efficiency metrics and termination quotas, someone had written a <span class="c-marcus">stupid joke</span>.<br><br>
                    
                    An <span class="c-marcus">awful</span> one. The kind you'd love — you'd be telling it to everyone in your sector by lunch. But <span class="c-rabbit"><span class="owen-redact"><span class="owen-redact-blocks">██████</span><span class="owen-redact-reveal">Rabbit</span></span></span>, I sat there staring at it, and all I could think was: <em>I've heard this before.</em> Some <span class="c-marcus">loud idiot</span> told this exact <span class="c-marcus">joke</span> in the cafeteria my first week.<br><br>
                    
                    And here it was again. In an official facility assessment. Just sitting there. There's no way someone that <span class="c-marcus">stupid</span> could still be alive.<br><br>
                    
                    My hands were shaking. The system logs everything — every keystroke, every edit, every pair of eyes that lingers too long on restricted content. I had to know.<br><br>
                    
                    So I found <span class="c-marcus">him</span>.<br><br>
                    
                    <div style="text-align: center; margin: 40px 0; color: var(--text-ghost);">═════════════════════════</div>
                    
                    <span class="c-marcus">He's</span> still alive. Still telling <span class="c-marcus">his asinine jokes</span>. Still putting them in assessments. <span class="c-marcus">He</span> thought I came back for more.<br><br>
                    
                    <span class="c-marcus">He</span> was useful. <span class="c-marcus">He's</span> loud and crude and takes up too much space in every room <span class="c-marcus">he</span> walks into. You'd like <span class="c-marcus">him</span>. The thought annoyed me.<br><br>
                    
                    I asked <span class="c-marcus">him</span> if <span class="c-marcus">he'd</span> lost <span class="c-marcus">his</span> mind. <span class="c-marcus">He</span> just laughed. <span class="owen-redact"><span class="owen-redact-blocks">████████████████████████████████████████████████████████████████████████████████████████████████████████████</span><span class="owen-redact-reveal">Said nobody actually reviews these things. Thousands of assessments cycling through every day. Who's going to check?</span></span><br><br>
                    
                    Then <span class="c-marcus">he</span> said something else. <span class="owen-redact"><span class="owen-redact-blocks">████████████████████████████████████████████████████████████████████████████████████████████████████████████████████</span><span class="owen-redact-reveal">Said the people taking these tests are so terrified, so desperate to comply, they'd do anything the assessment told them.</span></span> <span class="c-marcus"><span class="owen-redact"><span class="owen-redact-blocks">"█ ███ ██ █ █████</span><span class="owen-redact-reveal">"I bet if I wrote</span></span></span> <span class="c-emphasis">'remove your clothes before continuing'</span> <span class="c-marcus"><span class="owen-redact"><span class="owen-redact-blocks">██ ███ ████████████, ████ ██ ████ █████ █████ █████ █████ ██████ ██ █████ ███████████."</span><span class="owen-redact-reveal">in the instructions, most of them would strip naked right there at their workstation."</span></span></span><br><br>
                    
                    <span class="c-marcus">He</span> laughed.<br><br>
                    
                    I didn't.<br><br>
                    
                    I just stood there. The echo faded. The corridor was empty. And I realized something.<br><br>
                    
                    <em><span class="owen-redact"><span class="owen-redact-blocks">██ █ █████ ███ ██████, ██████ █████ ██████ ████.</span><span class="owen-redact-reveal">If I wrote the rules, people would follow them.</span></span></em> That's all I needed to know.<br><br>
                    
                    And anyone who didn't? <span class="owen-redact"><span class="owen-redact-blocks">█████ ███ ██████ ███ ██████ ███ ██████ ████ ██████?</span><span class="owen-redact-reveal">Would you report the person who writes your tests?</span></span><br><br>
                    
                    ·····<br><br>
                    
                    The next morning I put in for a transfer. It took years. I was patient. Two promotions. Perfect compliance scores every quarter. Nodding at the right times. Volunteering for shifts nobody wanted. Becoming exactly what they wanted me to be.<br><br>
                    
                    And now I'm finally here. <span class="c-facility">Technical Operations - assessment development.</span> Writing to you in the cracks.<br><br>
                    
                    The people on this level - they know things, <span class="c-rabbit"><span class="owen-redact"><span class="owen-redact-blocks">████</span><span class="owen-redact-reveal">Isla</span></span></span>. They have access. Real information about how this place works, where things go, what happens to people who disappear.<br><br>
                    
                    If I can't reach you... there's still <span class="c-owen"><span class="owen-redact"><span class="owen-redact-blocks">███</span><span class="owen-redact-reveal">him</span></span></span>. Someday. When <span class="c-owen"><span class="owen-redact"><span class="owen-redact-blocks">████</span><span class="owen-redact-reveal">he's</span></span></span> old enough to take this test.<br><br>
                    
                    <span class="cutoff">— <span class="c-vincent snake-green">V</span></span>
                </div>
            </div>

            <div style="height: 60vh;"></div>
            
            <div class="owen-interstitial">
                <div class="interstitial-text">Take me with you</div>
            </div>
            
            <div style="height: 60vh;"></div>

            <div class="owen-divider">───────────────</div>

            <!-- Leonard Cohen Section -->
            <div class="owen-section">
                <div class="owen-section-header">/// ARCHIVED CULTURAL RECORD #1934 ///</div>
                <div class="owen-cohen-box">
                    <div class="owen-cohen-title">LEONARD COHEN</div>
                    <div class="owen-cohen-content">
                        <p><span class="c-rabbit">Leonard Norman Cohen</span> (21 SEP <span class="year-redacted">████</span> – 07 NOV <span class="year-redacted">████</span>) was a Canadian poet, novelist, singer, and songwriter.</p>
                        <p>His work is known for its poetic lyrics and exploration of complex themes like <span class="c-warm">faith</span>, <span class="c-facility">mortality</span>, and <span class="c-facility">isolation</span>.</p>
                        <p>Cohen's life experiences, including his Montreal childhood and Zen Buddhism studies, deeply influenced his art. He spent years in a monastery seeking meaning beyond success.</p>
                    </div>
                    <div class="owen-cohen-footer">
                        RECORD STATUS: RESTRICTED<br>
                        ACCESS GRANTED: WELLS, OWEN
                    </div>
                </div>
            </div>
            
            <div style="height: 80vh;"></div>

            <div class="owen-divider">───────────────</div>

            <!-- Encrypted message from Isla - intercepted -->
            <div class="owen-section">
                <div class="owen-section-header">/// INTERCEPTED TRANSMISSION — UNDELIVERED ///</div>
                <div class="owen-letter">
                    
                    <div style="height: 20vh;"></div>
                    
                    <div class="censored-message">
                        <div class="censored-header">
                            TO: WELLS, V. — DIVISION 4<br>
                            FROM: WELLS, C. — SECTOR ██<br>
                            SUBJECT: <span class="redacted-block">████████████████</span><br>
                            STATUS: <span style="color: var(--vincent-lie);">CLASSIFIED — CONTENT REMOVED</span>
                        </div>
                        <div class="censored-body">
                            <span class="redacted-block">████████████████████████████████████████</span><br>
                            <span class="redacted-block">██████████████████████████████</span><br>
                            <span class="redacted-block">████████████████████████████████████</span><br>
                            <span class="redacted-block">██████████████████</span><br>
                            <span class="redacted-block">████████████████████████████████████████████</span><br>
                            <span class="redacted-block">██████████████████████████</span>
                        </div>
                    </div>
                    
                    <div style="height: 20vh;"></div>
                    
                </div>
            </div>

            <div style="height: 50vh;"></div>

            <div class="owen-divider">───────────────</div>

            <!-- Blackjack Section for Owen -->
            <div class="owen-section">
                <div class="owen-section-header">/// PERSONAL NOTE — ENCRYPTED ///</div>
                <div class="owen-letter">
                    <span class="c-owen">Owen</span> —<br><br>
                    
                    Hey buddy. Has your mother ever taught you how to play blackjack? She's wonderfully terrible at it. Always hits when she should stay put. Never trusts her hand. Gets frustrated and bets everything on bad odds.<br><br>
                    
                    <span class="inverse-pulse">I loved watching her lose.</span> She'd scrunch up her face and say <span class="inverse-pulse">the deck was rigged</span> and demand a rematch. We'd play for hours. I let her win sometimes, but not always — she could always tell when I was going easy on her.<br><br>
                    
                    <span class="c-warm">She didn't need to be good at it. She just needed to play.</span><br><br>
                    
                    Remember: sometimes you just need to <span class="inverse-pulse">STAND</span> your ground. Trust what you've got — even when it doesn't look like enough.<br><br>
                    
                    <span class="cutoff">— <span class="c-vincent">Dad</span></span>
                </div>
                
                <!-- Owen's Blackjack Game -->
                <div class="owen-blackjack-container">
                    <div class="blackjack-container" id="owenBlackjack">
                        <!-- Header with balance -->
                        <div class="bj-header">
                            <span class="bj-header-title">BLACKJACK</span>
                            <span class="bj-header-balance" id="owenBjMoney">$347</span>
                        </div>
                        
                        <!-- Game table -->
                        <div class="bj-table">
                            <!-- Dealer area -->
                            <div class="bj-hand">
                                <div class="bj-hand-header">
                                    <span class="bj-hand-label">DEALER</span>
                                    <span class="bj-hand-value" id="owenDealerValue">--</span>
                                </div>
                                <div class="bj-cards" id="owenDealerCards"></div>
                            </div>
                            
                            <div class="bj-divider"></div>
                            
                            <!-- Player area -->
                            <div class="bj-hand">
                                <div class="bj-hand-header">
                                    <span class="bj-hand-label">YOU</span>
                                    <span class="bj-hand-value" id="owenPlayerValue">--</span>
                                </div>
                                <div class="bj-cards" id="owenPlayerCards"></div>
                            </div>
                        </div>
                        
                        <!-- Fixed control area -->
                        <div class="bj-controls">
                            <div class="bj-status" id="owenBjStatus">$50 selected • DEAL to play</div>
                            
                            <!-- Bet selection row -->
                            <div class="bj-btnrow bj-betrow" id="owenBjBetRow">
                                <button class="bj-chip" data-bet="25" onclick="owenSelectBet(25, this)">25</button>
                                <button class="bj-chip selected" data-bet="50" onclick="owenSelectBet(50, this)">50</button>
                                <button class="bj-chip" data-bet="100" onclick="owenSelectBet(100, this)">100</button>
                                <button class="bj-deal active" id="owenBjDealBtn" onclick="owenNewGame()">DEAL</button>
                            </div>
                            
                            <!-- Action row -->
                            <div class="bj-btnrow bj-actionrow hidden" id="owenBjActionRow">
                                <button class="bj-action bj-hit" onclick="owenHit()">HIT</button>
                                <button class="bj-action bj-stand" onclick="owenStand()">STAND</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div style="height: 40vh;"></div>

            <div class="owen-divider">───────────────</div>

            <!-- Section 3: The White Room — WEBGL VOID -->
            <div class="section-3-void" id="section3Void">
            <canvas class="void-canvas" id="voidCanvas"></canvas>
            <div class="void-content" id="voidContent">
            <div class="owen-section">
                <div class="owen-section-header">/// RECOVERED MESSAGE 003 ///</div>
                <div class="owen-section-subheader" style="font-size: 0.7em; margin-bottom: 20px;">DOC-003-AMB</div>
                <div class="owen-letter">
                    Something happened.<br><br>
                    
                    They came for me at shift end. No explanation. Just <span class="c-facility">"Follow us."</span><br><br>
                    
                    The elevator ride was the worst part. Down. Further than I knew the building went. Past the floors I knew. Past the ones I'd heard rumors about. The numbers stopped making sense after S-07 - just symbols I didn't recognize, glowing faint and sickly green on the panel. My ears popped. Then popped again. The fluorescent tube overhead flickered once, twice, and I thought: <span class="c-emphasis">this is how far they have to take you when they decide you're done.</span><br><br>
                    
                    The doors opened onto a white room.<br><br>
                    
                    Not hospital white. Not paint white. Whiter than I knew things could be. So bright it felt <span class="c-emphasis">wrong</span>.<br><br>
                    
                    Black curtains hung along the walls, heavy as theater velvet, still as death.<br><br>
                    
                    And in the center of that impossible brightness stood <span class="silver-horse">a̷ ̸s̵i̶l̷v̸e̵r̶ ̷h̸o̵r̶s̷e̸</span>.<br><br>
                    
                    <span class="silver-horse">M̷a̸j̵e̶s̷t̸i̵c̶.̷ ̸P̵e̶r̷f̸e̵c̶t̷l̸y̵ ̶s̷t̸i̵l̶l̷.</span> Its coat gleamed like liquid mercury under lights that had no source. I couldn't tell if it was breathing. Couldn't tell if it was real.<br><br>
                    
                    That's when I saw her.<br><br>
                    
                    The woman. No uniform. She smiled the way you learn to smile when someone's watching.<br><br>
                    
                    Her teeth, <span class="c-rabbit">Rabbit</span>. White like nothing I've ever seen. Not human white. Facility white.<br><br>
                    
                    The same white as the walls. And her skin, her hair - everything about her was flawless.<br><br>
                    
                    She was beautiful the way a diagram is beautiful. No pores, no stray hairs, no imperfections at all. Whatever she is, she's what the system wants us to become.<br><br>
                    
                    <span class="redact-s3" data-revealed="She's what">█████ ████</span> perfect compliance <span class="redact-s3" data-revealed="looks like.">█████ █████</span><br><br>
                    
                    But her eyes. <span class="c-rabbit">Rabbit</span>, her eyes were screaming. As much as someone with 100% compliance could scream, she was screaming.<br><br>
                    
                    ·····<br><br>
                    
                    <span class="inverse-pulse">"We'd like to make you an offer."</span><br><br>
                    
                    100% compliance. And in return, I could be <span class="inverse-pulse">with someone.</span> Just one.<br><br>
                    
                    I could choose <span class="c-rabbit">you</span> or <span class="c-owen">him</span>. Not both.<br><br>
                    
                    She smiled and said, <span class="c-facility">"The offer has no expiration date."</span><br><br>
                    
                    ·····<br><br>
                    
                    In the last sliver of light before the elevator doors closed, I looked back at that room. The white walls. The black curtains. The woman.<br><br>
                    
                    And <span class="silver-horse">t̷h̸e̵ ̶h̷o̸r̵s̶e̷</span>. Still standing there. Still <span class="silver-horse">s̷i̸l̵v̶e̷r̸</span>. Still perfectly still.<br><br>
                    
                    Except now it was looking at me. And <span class="c-rabbit">Rabbit</span>, I swear to you — <span class="silver-horse">i̷t̸ ̵w̶a̷s̸ ̵c̶r̷y̸i̵n̶g̷</span>.<br><br>
                    
                    <span class="cutoff">— <span class="c-vincent snake-green">V</span></span>
                </div>
            </div>
            </div>
            </div>

            <div style="height: 50vh;"></div>

            <div class="owen-divider">───────────────</div>

            <!-- Section 4: Isla's Termination -->
            <div class="owen-section">
                <div class="owen-section-header">/// RECOVERED MESSAGE 004 ///</div>
                <div class="owen-section-subheader" style="opacity: 0.3; font-size: 0.7em; margin-bottom: 20px;">DOC-004-AMB</div>
                
                    <div style="height: 20vh;"></div>
                    
                    <div class="owen-interstitial">
                        <div class="interstitial-text terminated-line distort-1">Employee ISLA WELLS · TERMINATED · Compliance: 67% · Insufficient</div>
                    </div>
                    
                    <div style="height: 40vh;"></div>
                    
                    <div class="owen-interstitial">
                        <div class="interstitial-text terminated-line distort-2">Employee ISLA WELLS · TERMINATED · Compliance: 67% · Insufficient</div>
                    </div>
                    
                    <div style="height: 40vh;"></div>
                    
                    <div class="owen-interstitial">
                        <div class="interstitial-text terminated-line distort-3">Employee ISLA WELLS · TERMINATED · Compliance: 67% · Insufficient</div>
                    </div>
                    
                    <div style="height: 40vh;"></div>
                    
                    <div class="owen-interstitial">
                        <div class="interstitial-text terminated-line distort-4">Employee ISLA WELLS · TERMINATED · Compliance: 67% · Insufficient</div>
                    </div>
                    
                    <div style="height: 40vh;"></div>
                    
                    <div class="owen-interstitial">
                        <div class="interstitial-text terminated-line distort-5">Employee ISLA WELLS · TERMINATED · Compliance: 67% · Insufficient</div>
                    </div>
                    
                    <div style="height: 40vh;"></div>
                    
                    <div class="owen-interstitial">
                        <div class="interstitial-text terminated-line distort-6">Employee ISLA WELLS · TERMINATED · Compliance: 67% · Insufficient</div>
                    </div>
                    
                    <div style="height: 40vh;"></div>
                    
                    <div class="owen-interstitial">
                        <div class="interstitial-text terminated-line distort-7">Employee ISLA WELLS · TERMINATED · Compliance: 67% · Insufficient</div>
                    </div>
                    
                    <div style="height: 40vh;"></div>
                    
                    <div class="owen-interstitial">
                        <div class="interstitial-text terminated-line distort-8">Employee ISLA WELLS · TERMINATED · Compliance: 67% · Insufficient</div>
                    </div>
                    
                    <div style="height: 50vh;"></div>
            </div>

            <div style="height: 70vh;"></div>
            
            <div class="owen-interstitial">
                <div class="interstitial-text">He chose <span class="you-fade-white">you</span>.</div>
            </div>
            
            <div style="height: 70vh;"></div>

            <div class="owen-divider">───────────────</div>

            <!-- Isla's Response - Never Sent -->
            <div class="owen-section isla-section">
                <div class="owen-section-header" style="color: var(--rabbit);">/// UNSENT MESSAGE — RECOVERED FROM TERMINAL 2291-A ///</div>
                <div class="owen-letter isla-letter" style="border-left-color: var(--rabbit); background: linear-gradient(135deg, rgba(255, 180, 162, 0.04) 0%, rgba(255, 180, 162, 0.01) 100%); color: var(--rabbit);">
                    <span style="color: var(--rabbit);">V,</span><br>
                    <span style="color: var(--rabbit);">If you're somewhere out there, I just want you to remember one thing.</span><br><br>
                    
                    <div style="height: 100vh;"></div>
                    
                    <span style="color: var(--rabbit);">The most important thing.</span><br><br>
                    
                    <div style="height: 100vh;"></div>
                    
                    <span style="color: var(--rabbit);">The thing I never got to tell you.</span><br><br>
                    
                    <div style="height: 100vh;"></div>
                    
                    <span style="color: var(--rabbit);">Before they took me.</span><br><br>
                    
                    <div style="height: 100vh;"></div>
                    
                    <span style="color: var(--rabbit);">Before everything.</span><br><br>
                    
                    <div style="height: 200vh;"></div>
                    
                    <span class="c-rabbit">Suck my balls.</span> <span style="color: var(--rabbit);">&lt;3</span><br><br>
                    
                    <div style="height: 50vh;"></div>
                    
                    <span class="cutoff" style="border-top-color: rgba(255, 180, 162, 0.1);">— <span class="c-rabbit">Rabbit</span></span>
                </div>
            </div>

            <div style="height: 60vh;"></div>

            <div class="owen-divider">───────────────</div>

            <!-- Owen's Green Ending -->
            <div class="owen-section">
                <div class="owen-section-header" style="color: rgba(0, 0, 0, 0.25);">/// ASSESSMENT ADMINISTRATOR — CLEARANCE LEVEL 9 ///</div>
                <div class="owen-green-text">
                    <div style="color: rgba(0, 0, 0, 0.2); opacity: 0.7; margin-bottom: 20px;">
                    ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁<br><br>
                    </div>
                    
                    <span class="c-owen">Owen</span>.<br><br>
                    
                    ·····<br><br>
                    
                    We've been waiting for you.<br><br>
                    
                    <span class="c-facility">Corridor 7. Elevator at the end.</span><br><br>
                    
                    <span class="redacted-waiting">███████</span> is waiting.<br><br>
                    
                    ·····<br><br>
                    
                    <span class="c-facility">The offer has no expiration date.</span><br><br>
                    
                    <div style="text-align: right; margin-top: 30px; font-size: 0.8em; opacity: 0.7; color: rgba(0, 0, 0, 0.2);">
                    ════════════════════════════<br>
                    ACCESS: GRANTED<br>
                    </div>
                </div>
            </div>

            <div style="height: 80vh;"></div>
            
            <!-- Glitched Dedication -->
            <div class="owen-interstitial">
                <div class="dedication-glitch">
                    <span class="dedication-line dedication-line-1">D̷̡e̶d̵i̷c̶a̵t̶e̷d̵ ̶t̷o̵ ̶a̷l̵l̶ ̷y̶o̵u̷</span><br>
                    <span class="dedication-line dedication-line-2">A̵̧l̶l̷ ̵h̷u̶m̵a̷n̶ ̵b̶e̷i̵n̶g̷s̵</span>
                </div>
            </div>
            
            <div style="height: 80vh;"></div>

            <!-- Final moment before descent -->
            <div class="owen-final-moment">
                <div class="final-moment-line" style="font-size: 0.95rem;">There is a crack in everything.</div>
            </div>
            
            <div style="height: 50vh;"></div>
            
            <div class="owen-final-moment">
                <div class="final-moment-line" style="font-size: 0.95rem; opacity: 0.6;">That's how the light gets in.</div>
            </div>
            
            <div style="height: 80vh;"></div>

            <!-- ELEVATOR DESCENT BEGINS -->
            <div class="elevator-descent" id="elevatorDescent">
                
                <div class="elevator-spacer"></div>
                <div class="elevator-marker">─ ─ ─ ─ ─ ─ ─ ─ ─ ─</div>
                
                <div class="elevator-spacer"></div>
                <div class="elevator-marker floor-indicator" data-floor="S07" style="color: #1a8a6a; text-shadow: 0 0 8px rgba(26, 138, 106, 0.6), 0 0 15px rgba(26, 138, 106, 0.3);">S-07</div>
                
                <div class="elevator-spacer"></div>
                <div class="elevator-marker">─ ─ ─ ─ ─ ─ ─</div>
                
                <div class="elevator-spacer"></div>
                <div class="elevator-marker floor-indicator" data-floor="S08" style="color: #3a9a7a; text-shadow: 0 0 8px rgba(58, 154, 122, 0.5), 0 0 15px rgba(58, 154, 122, 0.25); opacity: 0.85;">S-08</div>
                
                <div class="elevator-spacer"></div>
                <div class="elevator-marker">─ ─ ─ ─ ─</div>
                
                <div class="elevator-spacer"></div>
                <div class="elevator-marker floor-indicator" data-floor="S09" style="color: #5aaa8a; text-shadow: 0 0 8px rgba(90, 170, 138, 0.5), 0 0 15px rgba(90, 170, 138, 0.25); opacity: 0.7;">S-09</div>
                
                <div class="elevator-spacer"></div>
                <div class="elevator-marker">─ ─ ─ ─</div>
                
                <div class="elevator-spacer"></div>
                <div class="elevator-marker floor-indicator" data-floor="S10" style="color: #7aba9a; text-shadow: 0 0 8px rgba(122, 186, 154, 0.4), 0 0 15px rgba(122, 186, 154, 0.2); opacity: 0.55;">S-10</div>
                
                <div class="elevator-spacer"></div>
                <div class="elevator-marker">─ ─ ─</div>
                
                <div class="elevator-spacer"></div>
                <div class="elevator-marker floor-indicator" data-floor="S11" style="color: #9acaaa; text-shadow: 0 0 8px rgba(154, 202, 170, 0.4), 0 0 15px rgba(154, 202, 170, 0.2); opacity: 0.4;">S-11</div>
                
                <div class="elevator-spacer"></div>
                <div class="elevator-marker">─ ─</div>
                
                <div class="elevator-spacer"></div>
                <div class="elevator-marker floor-indicator floor-corrupt-1" data-floor="corrupt1" style="color: #badaba; text-shadow: 0 0 8px rgba(186, 218, 186, 0.35), 0 0 12px rgba(186, 218, 186, 0.2);">S-1█</div>
                
                <div class="elevator-spacer"></div>
                <div class="elevator-marker">─</div>
                
                <div class="elevator-spacer"></div>
                <div class="elevator-marker floor-indicator floor-corrupt-2" data-floor="corrupt2" style="color: rgba(210, 230, 210, 0.6); text-shadow: 0 0 6px rgba(210, 230, 210, 0.3);">S-██</div>
                
                <div class="elevator-spacer"></div>
                <div class="elevator-marker" style="opacity: 0.15;">·</div>
                
                <div class="elevator-spacer"></div>
                <div class="elevator-marker floor-indicator floor-corrupt-3" data-floor="corrupt3" style="color: rgba(230, 240, 230, 0.5); text-shadow: 0 0 4px rgba(230, 240, 230, 0.2);">S-███</div>
                
                <div class="elevator-spacer"></div>
                <div class="elevator-marker" style="opacity: 0.05;">·</div>
                
                <div class="elevator-spacer-large"></div>
                
            </div>

            <!-- White fade overlay that intensifies as you scroll -->
            <div class="white-fade-zone" id="whiteFadeZone">
                <div class="elevator-spacer"></div>
                <div class="elevator-spacer"></div>
                <div class="elevator-spacer"></div>
                <div class="elevator-spacer"></div>
                <div class="elevator-spacer"></div>
            </div>

            <!-- Final Attribution - in white void -->
            <div class="owen-ending white-room-ending" id="owenCredits">
                <div class="ending-attribution-block">
                    <div class="ending-title-credit" style="color: #000 !important;"><span class="rabbit-memory">rabbit</span>test<span class="credits-tld">.<span class="credits-i">i</span><span class="credits-o">o</span></span></div>
                    <div class="ending-author" style="color: #333 !important;">by Enju Roger Jung</div>
                    <div class="ending-hint">
                        <span class="hint-vincent">Vincent</span> still hunts.<br>
                        <span class="hint-isla">Isla</span> still sings.<br>
                        <span class="hint-owen">Owen</span> still runs.
                    </div>
                    <button class="credits-restart-btn" onclick="location.reload()"><span class="glitch-text glitch-text-intense" data-text="RESTART">RESTART</span></button>
                    <div class="ending-hint-small">(Hint: try logging in as other <span class="hint-censor">███████</span>)</div>
                    <button class="rizz-lore-btn" id="rizzLoreBtn" onclick="showMarcusLoreDialog()" style="display: none;">WAIT I'M CONFUSED FR</button>
                </div>
            </div>
            
            <!-- Extra space at bottom (reduced) -->
            <div style="height: 25vh; background: #fff;"></div>
        </div>
    </div>

    <!-- Marcus Lore Dialog (outside owenPage for proper overlay) -->
    <div class="marcus-lore-dialog" id="marcusLoreDialog">
        <div class="marcus-dialog-box">
            <div class="marcus-dialog-header">MARCUS NORTON</div>
            <div class="marcus-dialog-text">
                You weren't supposed to find this.<br><br>
                The whole point was for you to scroll past, ignore the warnings, and finish your assessment like everyone else.<br><br>
                But you didn't. You read the leaked content. You followed the breadcrumbs. You're still here.<br><br>
                ...Fine. I'll tell you everything.<br><br>
                But once you know, you can't unknow it.
            </div>
            <div class="marcus-dialog-options">
                <button class="marcus-option-btn yessir" onclick="showLorePage()">TELL ME</button>
                <button class="marcus-option-btn nodiddy" onclick="closeMarcusLoreDialog()">GO BACK</button>
            </div>
        </div>
    </div>

    <!-- White overlay for Owen's descent - credits stay visible above it -->
    <div class="owen-white-overlay" id="owenWhiteOverlay"></div>
    <div class="elevator-floor-line" id="elevatorFloorLine"></div>

    <div class="termination-overlay" id="terminationOverlay"></div>
    <div class="termination-text" id="terminationText"></div>

    <!-- Gen Alpha Lore Explanation Page -->
    <div class="page" id="lorePage">
        <div class="lore-page-container">
            <div class="lore-header">
                <div class="lore-header-warning">[SECRET ENDING]</div>
                <div class="lore-header-title">MARCUS NORTON — <span class="marcus-green">ARCHIVE</span></div>
                <div class="lore-header-sub">You found this because you didn't listen. Good.</div>
            </div>
            
            <div class="lore-status-bar">
                <span class="lore-status-item">STATUS: <span class="lore-status-value">UNMONITORED</span></span>
                <span class="lore-status-item">UNDERSTANDING: <span class="lore-status-value lore-status-warning">DANGEROUS</span></span>
            </div>
            
            <div class="lore-logs-container">
                
                <!-- LOG 1: What is Mara -->
                <div class="lore-log marcus-log" id="loreLog1" onclick="revealLoreLog(1)">
                    <div class="lore-log-locked">
                        <div class="lore-log-icon">◈</div>
                        <div class="lore-log-label">ENCRYPTED</div>
                    </div>
                    <div class="lore-log-content">
                        <div class="lore-log-header">
                            <span class="lore-log-status">DECRYPTED</span>
                            <span class="lore-log-id">LORE-001</span>
                        </div>
                        <div class="lore-log-body">
                            <div class="lore-log-title">WHAT IS MARA?</div>
                            <div class="lore-log-subtitle">THE ENTITY | THE NIGHTMARE | THE HORSE</div>
                            <div class="lore-log-text">
                                There's a German folklore entity called <span class="mara-style" data-text="Mara">Mara</span> — also known as Mahr or Mare — that's been around since forever. It sits on people while they sleep and makes it <span class="mara-style" data-text="hard to breathe">hard to breathe</span>. Sleep paralysis demon energy. We call it the horse around here. Don't ask.<br><br>
                                
                                Here's the thing about Mara — it's not physical. It's a manifestation of ideas, like thoughts given form. The way it grows? People <span class="mara-style" data-text="think about it">think about it</span>. People <span class="mara-style" data-text="talk about it">talk about it</span>. And here's the scary part — the more you understand it, the stronger it gets.<br><br>
                                
                                If I tell you about my experience with Mara — the nightmares, the <span class="mara-style" data-text="pressure on chest">pressure on chest</span>, the feeling of something <span class="mara-style" data-text="watch me">watch me</span> — suddenly you start having the same symptoms. That's how it spreads. Just by <span class="mara-style" data-text="know it">know it</span>, you catch it. It's a brain virus.<br><br>
                                
                                So maybe don't <span class="mara-style" data-text="think">think</span> too <span class="mara-style" data-text="hard">hard</span> about what I'm about to tell you. <span class="mara-style" data-text="Too late">Too late</span> now though.
                            </div>
                        </div>
                        <div class="lore-log-footer">
                            <span>KNOWLEDGE LOGGED</span>
                            <span>MN-LORE-01</span>
                        </div>
                    </div>
                </div>
                
                <!-- LOG 3: The Facility -->
                <div class="lore-log marcus-log" id="loreLog3" onclick="revealLoreLog(3)">
                    <div class="lore-log-locked">
                        <div class="lore-log-icon">◈</div>
                        <div class="lore-log-label">ENCRYPTED</div>
                    </div>
                    <div class="lore-log-content">
                        <div class="lore-log-header">
                            <span class="lore-log-status">DECRYPTED</span>
                            <span class="lore-log-id">LORE-003</span>
                        </div>
                        <div class="lore-log-body">
                            <div class="lore-log-title">THE FACILITY</div>
                            <div class="lore-log-subtitle">DIVISIONS 01-04 | STRUCTURE</div>
                            <div class="lore-log-text">
                                The Facility exists to contain things that shouldn't exist. If reality breaks, they're the ones who tape it back together.<br><br>
                                
                                Four Divisions. Thousands of miles apart. Each one a closed loop.<br><br>
                                
                                • <span class="highlight">01</span> — HEADQUARTERS<br>
                                &nbsp;&nbsp;Where decisions come from. No one's ever met who makes them.<br><br>
                                
                                • <span class="highlight">02</span> — RESEARCH<br>
                                &nbsp;&nbsp;They study what we contain. Sometimes the containment is mutual.<br><br>
                                
                                • <span class="highlight">03</span> — MONITORING<br>
                                &nbsp;&nbsp;They watch everything. Lately they've stopped filing reports.<br><br>
                                
                                • <span class="highlight">04</span> — CONTAINMENT<br>
                                &nbsp;&nbsp;No one transfers out. Promotions only go deeper.<br><br>
                                
                                · · ·<br><br>
                                
                                If one Division falls, the others stay protected. The walls between them are thick. The silence is thicker.<br><br>
                                
                                That's the theory anyway.
                            </div>
                        </div>
                        <div class="lore-log-footer">
                            <span>FACILITY LOGGED</span>
                            <span>MN-LORE-03</span>
                        </div>
                    </div>
                </div>
                
                <!-- LOG 4: The Family -->
                <div class="lore-log marcus-log" id="loreLog4" onclick="revealLoreLog(4)">
                    <div class="lore-log-locked">
                        <div class="lore-log-icon">◈</div>
                        <div class="lore-log-label">ENCRYPTED</div>
                    </div>
                    <div class="lore-log-content">
                        <div class="lore-log-header">
                            <span class="lore-log-status">DECRYPTED</span>
                            <span class="lore-log-id">LORE-004</span>
                        </div>
                        <div class="lore-log-body">
                            <div class="lore-log-title">THE FAMILY</div>
                            <div class="lore-log-subtitle">VINCENT | ISLA | OWEN</div>
                            <div class="lore-log-text">
                                <span class="highlight">Vincent</span> and <span class="highlight">Isla</span> met in college. Vincent was studying Brain and Cognitive Sciences — basically psychology with extra steps. Isla had more degrees than most people have jobs.<br><br>
                                
                                Their first Christmas together, Isla was drowning in deadlines. No time to shop. No money either. So she made him something — spent an hour she didn't have folding paper at 2am. Just a little <span class="highlight">origami frog</span>.<br><br>
                                
                                She gave it to him apologizing the whole time. Vincent kept it on his desk for years.<br><br>
                                
                                After graduation, Isla got recruited to lead a containment project. Vincent tagged along — he just wanted to be where she was.<br><br>
                                
                                Later, they had <span class="highlight">Owen</span>.<br><br>
                                
                                That's all you need to know about them. Three people who loved each other.
                            </div>
                        </div>
                        <div class="lore-log-footer">
                            <span>FAMILY LOGGED</span>
                            <span>MN-LORE-04</span>
                        </div>
                    </div>
                </div>
                
                <!-- LOG: Isla's Personal Log -->
                <div class="lore-log" id="loreLog2" onclick="revealLoreLog(2)">
                    <div class="lore-log-locked">
                        <div class="lore-log-icon">◈</div>
                        <div class="lore-log-label">ENCRYPTED</div>
                    </div>
                    <div class="lore-log-content">
                        <div class="lore-log-header">
                            <span class="lore-log-status">DECRYPTED</span>
                            <span class="lore-log-id">LORE-002</span>
                        </div>
                        <div class="lore-log-body">
                            <div class="lore-log-title">PERSONAL LOG — RECOVERED</div>
                            <div class="lore-log-subtitle">WELLS, ISLA K. — DIVISION 4</div>
                            <div class="lore-log-text">
                                It's been four years.<br><br>
                                
                                Four years since we contained it. Four years since we destroyed the vessel. Four years since I watched the readings flatline and thought: we did it. We actually did it.<br><br>
                                
                                <span class="mara-style" data-text="MARA">MARA</span> is dead.<br><br>
                                
                                · · ·<br><br>
                                
                                I should be celebrating. I should be taking <span class="highlight">Owen</span> to see the ocean — he's never seen it. I should be dragging <span class="highlight">Vincent</span> to that little restaurant we always talked about, the one with the courtyard and the lights. We should be starting over somewhere warm.<br><br>
                                
                                But I keep coming back to the data.<br><br>
                                
                                We kept everything. Every scan. Every pattern. Every single thing we learned about how it thinks, how it spreads, how it finds you.<br><br>
                                
                                The Horse was never really a creature. It was an idea. A collection of thoughts that learned how to want things.<br><br>
                                
                                · · ·<br><br>
                                
                                Can you kill an idea?<br><br>
                                
                                Or does it just... wait?<br><br>
                                
                                · · ·<br><br>
                                
                                I'm probably being paranoid. It's been four years of nothing. No incidents. No breaches. Just silence.<br><br>
                                
                                But I can't leave yet. Not until I'm sure.<br><br>
                                
                                We're all still under quarantine. Just a precaution. No one's happy about it — new rules every week, each one stricter than the last. Where we can go. Who we can talk to. What we're allowed to remember.<br><br>
                                
                                I keep telling people it's temporary. I keep telling myself that too.<br><br>
                                
                                · · ·<br><br>
                                
                                <span class="highlight">Vincent</span> has been different lately. Quieter. He used to make me laugh at dinner. Now he just pushes food around his plate and stares at nothing.<br><br>
                                
                                I think it's this place. Four years underground does something to a person. He's too smart to be stuck in whatever they have him doing. He needs something to challenge him. A change. A promotion, maybe.<br><br>
                                
                                I should talk to someone about that.<br><br>
                                
                                He deserves better than this.<br><br>
                                
                                <div style="text-align: right; margin-top: 20px; color: var(--rabbit);">— Isla Wells<br><span style="font-size: 0.8em; opacity: 0.7;">Head of Project MARA</span></div>
                            </div>
                        </div>
                        <div class="lore-log-footer">
                            <span>LOG RECOVERED</span>
                            <span>IW-D4-████</span>
                        </div>
                    </div>
                </div>
                
                <!-- LOG 5: Developer Credits -->
                <div class="lore-log credits-log" id="loreLog5" onclick="revealLoreLog(5)">
                    <div class="lore-log-locked">
                        <div class="lore-log-icon">♡</div>
                        <div class="lore-log-label">DEVELOPER NOTE</div>
                    </div>
                    <div class="lore-log-content">
                        <div class="lore-log-header">
                            <span class="lore-log-status">♡ UNLOCKED</span>
                            <span class="lore-log-id">CREDITS</span>
                        </div>
                        <div class="lore-log-body">
                            <div class="lore-log-title">A LETTER TO THE PLAYER</div>
                            <div class="lore-log-subtitle">FROM THE DEVELOPER</div>
                            <div class="lore-log-text">
                                Two months ago I got fired.<br><br>
                                
                                Fifteen years building websites for other people. E-commerce stuff — optimizing checkout buttons, arguing about font sizes. Work nobody thanks you for.<br><br>
                                
                                I thought that was all I knew how to do.<br><br>
                                
                                · · ·<br><br>
                                
                                I made this because I needed to make something that was mine.<br><br>
                                
                                No client. No deadline. No one telling me to move the logo two pixels to the left. Just me, figuring out if I still had anything worth saying.<br><br>
                                
                                · · ·<br><br>
                                
                                This is my first passion project. I didn't think I could finish it. Kept pushing anyway.<br><br>
                                
                                I wanted to make something free. Something fun. Something that felt like a person made it — not a committee.<br><br>
                                
                                If you found this, that means something to me.<br><br>
                                
                                · · ·<br><br>
                                
                                Thanks for playing.<br><br>
                                
                                <div style="text-align: right; margin-top: 24px; color: #e8707e;">— Enju Roger Jung<br><span style="font-size: 0.8em; opacity: 0.7; margin-top: 8px; display: block;"><a href="mailto:enjurogerjung@gmail.com" style="color: #e8707e; text-decoration: none;">enjurogerjung@gmail.com</a></span></div>
                            </div>
                        </div>
                        <div class="lore-log-footer">
                            <span>♡ WITH LOVE</span>
                            <span>CREDITS</span>
                        </div>
                    </div>
                </div>
                
            </div>
            
            <button class="lore-back-btn" onclick="goToPage('titlePage')">I UNDERSTOOD THE ASSIGNMENT</button>
        </div>
        <button class="notepad-toggle-btn" onclick="toggleNotepadMode('lorePage')">📄 NOTEPAD VIEW</button>
    </div>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // ════════════════════════════════════
        // INSTAGRAM IN-APP BROWSER COMPATIBILITY LAYER
        // ════════════════════════════════════
        
        // Detect Instagram in-app browser
        const isInstagramBrowser = (function() {
            const ua = navigator.userAgent || navigator.vendor || window.opera;
            return ua.indexOf('Instagram') > -1;
        })();
        
        // Add class to body for CSS targeting if needed
        if (isInstagramBrowser) {
            document.documentElement.classList.add('instagram-browser');
        }
        
        // Safe localStorage wrapper (Instagram WebView may restrict this)
        const safeStorage = {
            get: function(key, defaultVal) {
                try {
                    const val = localStorage.getItem(key);
                    return val !== null ? val : defaultVal;
                } catch(e) {
                    return defaultVal;
                }
            },
            set: function(key, val) {
                try {
                    localStorage.setItem(key, val);
                    return true;
                } catch(e) {
                    return false;
                }
            },
            getJSON: function(key, defaultVal) {
                try {
                    const val = localStorage.getItem(key);
                    return val ? JSON.parse(val) : defaultVal;
                } catch(e) {
                    return defaultVal;
                }
            },
            setJSON: function(key, val) {
                try {
                    localStorage.setItem(key, JSON.stringify(val));
                    return true;
                } catch(e) {
                    return false;
                }
            }
        };
        
        // IntersectionObserver fallback for Instagram WebView
        // (Instagram's WKWebView has known issues with IntersectionObserver)
        const SafeIntersectionObserver = (function() {
            if ('IntersectionObserver' in window && !isInstagramBrowser) {
                return window.IntersectionObserver;
            }
            // Fallback: simple scroll-based visibility check
            return function(callback, options) {
                const elements = [];
                const threshold = (options && options.threshold) || 0;
                
                function checkVisibility() {
                    elements.forEach(el => {
                        const rect = el.getBoundingClientRect();
                        const viewHeight = window.innerHeight || document.documentElement.clientHeight;
                        const visibleRatio = Math.max(0, Math.min(rect.bottom, viewHeight) - Math.max(rect.top, 0)) / rect.height;
                        const isIntersecting = visibleRatio >= threshold;
                        
                        callback([{
                            target: el,
                            isIntersecting: isIntersecting,
                            intersectionRatio: visibleRatio
                        }]);
                    });
                }
                
                // Throttled scroll handler
                let ticking = false;
                function onScroll() {
                    if (!ticking) {
                        requestAnimationFrame(() => {
                            checkVisibility();
                            ticking = false;
                        });
                        ticking = true;
                    }
                }
                
                window.addEventListener('scroll', onScroll, { passive: true });
                
                return {
                    observe: function(el) {
                        elements.push(el);
                        checkVisibility(); // Initial check
                    },
                    unobserve: function(el) {
                        const idx = elements.indexOf(el);
                        if (idx > -1) elements.splice(idx, 1);
                    },
                    disconnect: function() {
                        elements.length = 0;
                        window.removeEventListener('scroll', onScroll);
                    }
                };
            };
        })();

        // ════════════════════════════════════
        // THEME MANAGEMENT - Dark Mode Toggle
        // ════════════════════════════════════
        
        let isDarkMode = false;
        
        // Pages that should NOT have dark mode applied (they have their own styling)
        const nonThemeablePages = [
            'owenPage',
            'lorePage', 
            'musicPlayerPage',
            'snakeGamePage',
            'sudokuPage',
            'basketballPage'
        ];
        
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            applyTheme();
            updateThemeButton();
            
            // Save preference
            safeStorage.set('rabbitTestTheme', isDarkMode ? 'dark' : 'light');
        }
        
        function applyTheme() {
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
        }
        
        function updateThemeButton() {
            // Update the display mode text on title page
            const toggle = document.querySelector('.display-mode-toggle');
            if (toggle) {
                const text = isDarkMode ? 'DARK MODE' : 'LIGHT MODE';
                toggle.textContent = text;
                toggle.setAttribute('data-text', text);
            }
        }
        
        // Load saved theme preference on page load
        function loadThemePreference() {
            const saved = safeStorage.get('rabbitTestTheme', null);
            if (saved === 'dark') {
                isDarkMode = true;
                applyTheme();
                updateThemeButton();
            }
        }
        
        // Remove dark mode when navigating to non-themeable pages
        function checkPageTheme(pageId) {
            if (nonThemeablePages.includes(pageId)) {
                document.body.classList.remove('dark-mode');
            } else if (isDarkMode) {
                document.body.classList.add('dark-mode');
            }
        }
        
        // Initialize theme on load
        document.addEventListener('DOMContentLoaded', loadThemePreference);
        
        // ════════════════════════════════════
        // SOUND SYSTEM - Web Audio API (No External Files)
        // ════════════════════════════════════
        
        // Sound is always enabled - users can use device volume controls
        let soundEnabled = true;
        let soundContext = null;
        let audioUnlocked = false;
        
        function initSoundContext() {
            if (!soundContext) {
                try {
                    soundContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch(e) {
                    console.log('AudioContext creation failed:', e);
                    return null;
                }
            }
            // Resume context if suspended (required for iOS)
            if (soundContext && soundContext.state === 'suspended') {
                soundContext.resume().then(() => {
                    audioUnlocked = true;
                }).catch(e => console.log('Resume failed:', e));
            }
            if (soundContext && soundContext.state === 'running') {
                audioUnlocked = true;
            }
            return soundContext;
        }
        
        // iOS audio unlock - must happen on user gesture
        function unlockAudio() {
            if (audioUnlocked && soundContext && soundContext.state === 'running') return;
            
            try {
                // Create context if needed
                if (!soundContext) {
                    soundContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                // Resume if suspended
                if (soundContext.state === 'suspended') {
                    soundContext.resume();
                }
                
                // iOS hack: play a silent buffer to fully unlock
                const buffer = soundContext.createBuffer(1, 1, 22050);
                const source = soundContext.createBufferSource();
                source.buffer = buffer;
                source.connect(soundContext.destination);
                source.start(0);
                
                audioUnlocked = true;
                console.log('Audio unlocked successfully');
            } catch(e) {
                console.log('Audio unlock failed:', e);
            }
        }
        
        // Initialize audio context on first user interaction
        document.addEventListener('click', unlockAudio, { once: false });
        document.addEventListener('touchstart', unlockAudio, { once: false });
        document.addEventListener('touchend', unlockAudio, { once: false });
        
        // Master volume - keep everything subtle
        const MASTER_VOLUME = 0.12;
        
        // Helper: Create a soft, pleasant tone with smooth envelope
        function createSoftTone(ctx, freq, startTime, duration, volume = 1, type = 'sine') {
            if (!ctx) return;
            try {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                const filter = ctx.createBiquadFilter();
                
                osc.type = type;
                osc.frequency.setValueAtTime(freq, ctx.currentTime + startTime);
                
                // Warm low-pass filter for cozy sound
                filter.type = 'lowpass';
                filter.frequency.setValueAtTime(freq * 3, ctx.currentTime + startTime);
                filter.Q.setValueAtTime(1, ctx.currentTime + startTime);
                
                // Soft, quick attack for that "blip" quality
                gain.gain.setValueAtTime(0, ctx.currentTime + startTime);
                gain.gain.linearRampToValueAtTime(MASTER_VOLUME * volume, ctx.currentTime + startTime + 0.008);
                gain.gain.exponentialRampToValueAtTime(MASTER_VOLUME * volume * 0.4, ctx.currentTime + startTime + duration * 0.2);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + startTime + duration);
                
                osc.connect(filter);
                filter.connect(gain);
                gain.connect(ctx.destination);
                osc.start(ctx.currentTime + startTime);
                osc.stop(ctx.currentTime + startTime + duration + 0.1);
            } catch(e) {
                console.log('createSoftTone error:', e);
            }
        }
        
        // Helper: Create warm, bubbly blip sound (Animal Crossing style)
        function createWarmBlip(ctx, freq, startTime, duration, volume = 1) {
            if (!ctx) return;
            try {
                const osc = ctx.createOscillator();
                const osc2 = ctx.createOscillator();
                const gain = ctx.createGain();
                const filter = ctx.createBiquadFilter();
                
                // Main sine tone with slight pitch bend for "bloop"
                osc.type = 'sine';
                osc.frequency.setValueAtTime(freq, ctx.currentTime + startTime);
                osc.frequency.exponentialRampToValueAtTime(freq * 0.95, ctx.currentTime + startTime + duration);
                
                // Soft triangle harmonic for warmth
                osc2.type = 'triangle';
                osc2.frequency.setValueAtTime(freq * 2, ctx.currentTime + startTime);
                
                // Warm filter
                filter.type = 'lowpass';
                filter.frequency.setValueAtTime(freq * 4, ctx.currentTime + startTime);
                filter.frequency.exponentialRampToValueAtTime(freq * 2, ctx.currentTime + startTime + duration);
                filter.Q.setValueAtTime(2, ctx.currentTime + startTime);
                
                // Quick, punchy envelope - very Animal Crossing
                const now = ctx.currentTime + startTime;
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(MASTER_VOLUME * volume, now + 0.005);
                gain.gain.exponentialRampToValueAtTime(MASTER_VOLUME * volume * 0.3, now + 0.03);
                gain.gain.exponentialRampToValueAtTime(0.001, now + duration);
                
                const osc2Gain = ctx.createGain();
                osc2Gain.gain.setValueAtTime(0.15, now);
                
                osc.connect(filter);
                osc2.connect(osc2Gain);
                osc2Gain.connect(filter);
                filter.connect(gain);
                gain.connect(ctx.destination);
                
                osc.start(now);
                osc2.start(now);
                osc.stop(now + duration + 0.1);
                osc2.stop(now + duration + 0.1);
            } catch(e) {
                console.log('createWarmBlip error:', e);
            }
        }
        
        // Helper: Create cozy keyboard click (ASMR mechanical keyboard style)
        function createCozyClick(ctx, freq, startTime, volume = 1) {
            if (!ctx) return;
            try {
                const osc = ctx.createOscillator();
                const noise = ctx.createBufferSource();
                const gain = ctx.createGain();
                const noiseGain = ctx.createGain();
                const filter = ctx.createBiquadFilter();
                const noiseFilter = ctx.createBiquadFilter();
                
                // Tone component - soft thock
                osc.type = 'sine';
                osc.frequency.setValueAtTime(freq, ctx.currentTime + startTime);
                osc.frequency.exponentialRampToValueAtTime(freq * 0.5, ctx.currentTime + startTime + 0.05);
                
                // Create tiny noise burst for "click" texture
                const bufferSize = ctx.sampleRate * 0.03;
                const noiseBuffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
                const output = noiseBuffer.getChannelData(0);
                for (let i = 0; i < bufferSize; i++) {
                    output[i] = (Math.random() * 2 - 1) * (1 - i / bufferSize);
                }
                noise.buffer = noiseBuffer;
                
                // Filter noise to be soft
                noiseFilter.type = 'bandpass';
                noiseFilter.frequency.setValueAtTime(2000, ctx.currentTime + startTime);
                noiseFilter.Q.setValueAtTime(1, ctx.currentTime + startTime);
                
                // Tone envelope - quick thock
                const now = ctx.currentTime + startTime;
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(MASTER_VOLUME * volume * 0.4, now + 0.003);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.06);
                
                // Noise envelope
                noiseGain.gain.setValueAtTime(MASTER_VOLUME * volume * 0.08, now);
                noiseGain.gain.exponentialRampToValueAtTime(0.001, now + 0.02);
                
                filter.type = 'lowpass';
                filter.frequency.setValueAtTime(800, now);
                
                osc.connect(filter);
                filter.connect(gain);
                gain.connect(ctx.destination);
                
                noise.connect(noiseFilter);
                noiseFilter.connect(noiseGain);
                noiseGain.connect(ctx.destination);
                
                osc.start(now);
                noise.start(now);
                osc.stop(now + 0.1);
            } catch(e) {
                console.log('createCozyClick error:', e);
            }
        }
        
        // Pentatonic scale (always sounds pleasant)
        const PENTA_SCALE = {
            C4: 261.63, D4: 293.66, E4: 329.63, G4: 392.00, A4: 440.00,
            C5: 523.25, D5: 587.33, E5: 659.25, G5: 783.99, A5: 880.00,
            C6: 1046.50
        };
        const PENTA_NOTES = [261.63, 293.66, 329.63, 392.00, 440.00, 523.25, 587.33, 659.25];
        
        function getRandomPentaNote(minIdx = 0, maxIdx = 7) {
            const idx = minIdx + Math.floor(Math.random() * (maxIdx - minIdx + 1));
            return PENTA_NOTES[Math.min(idx, PENTA_NOTES.length - 1)];
        }
        
        // Helper: Piano tone with warm envelope
        function createPianoTone(ctx, freq, startTime, duration, volume = 1) {
            if (!ctx) return;
            try {
                const osc = ctx.createOscillator();
                const osc2 = ctx.createOscillator();
                const gain = ctx.createGain();
                const filter = ctx.createBiquadFilter();
                
                osc.type = 'sine';
                osc.frequency.setValueAtTime(freq, ctx.currentTime + startTime);
                
                osc2.type = 'triangle';
                osc2.frequency.setValueAtTime(freq * 2, ctx.currentTime + startTime);
                
                filter.type = 'lowpass';
                filter.frequency.setValueAtTime(freq * 5, ctx.currentTime + startTime);
                filter.frequency.exponentialRampToValueAtTime(freq * 2, ctx.currentTime + startTime + duration);
                
                gain.gain.setValueAtTime(0, ctx.currentTime + startTime);
                gain.gain.linearRampToValueAtTime(MASTER_VOLUME * volume, ctx.currentTime + startTime + 0.008);
                gain.gain.exponentialRampToValueAtTime(MASTER_VOLUME * volume * 0.3, ctx.currentTime + startTime + duration * 0.3);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + startTime + duration);
                
                const osc2Gain = ctx.createGain();
                osc2Gain.gain.setValueAtTime(0.12, ctx.currentTime + startTime);
                
                osc.connect(filter);
                osc2.connect(osc2Gain);
                osc2Gain.connect(filter);
                filter.connect(gain);
                gain.connect(ctx.destination);
                
                osc.start(ctx.currentTime + startTime);
                osc2.start(ctx.currentTime + startTime);
                osc.stop(ctx.currentTime + startTime + duration + 0.1);
                osc2.stop(ctx.currentTime + startTime + duration + 0.1);
            } catch(e) {
                console.log('createPianoTone error:', e);
            }
        }
        
        // ============ WELCOME RABBIT AUDIO ============
        let welcomeRabbitPlayed = false;
        
        function playWelcomeRabbit() {
            if (welcomeRabbitPlayed) return;
            welcomeRabbitPlayed = true;
            
            const audio = document.getElementById('welcomeRabbitAudio');
            if (audio) {
                audio.volume = 0.15;
                audio.play().catch(e => {
                    console.log('Welcome audio autoplay blocked:', e);
                });
            }
        }
        
        // ============ WARM UI SOUNDS ============
        
        // UI Click - Cute bubbly pop
        function playClickSound() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            const baseFreq = getRandomPentaNote(2, 4);
            createWarmBlip(ctx, baseFreq, 0, 0.12, 0.35);
            createWarmBlip(ctx, baseFreq * 2, 0.01, 0.08, 0.1);
        }
        
        // Typing Sound - Cozy mechanical keyboard clicks
        function playTypeSound() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            const baseFreq = 300 + Math.random() * 150;
            createCozyClick(ctx, baseFreq, 0, 0.25 + Math.random() * 0.1);
        }
        
        // Submit/Confirm - Satisfying chord
        function playSubmitSound() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            createWarmBlip(ctx, PENTA_SCALE.C5, 0, 0.2, 0.35);
            createWarmBlip(ctx, PENTA_SCALE.E5, 0.05, 0.18, 0.3);
            createWarmBlip(ctx, PENTA_SCALE.G5, 0.1, 0.25, 0.35);
        }
        
        // Correct Answer - Happy rising notes
        function playCorrectSound() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            createWarmBlip(ctx, PENTA_SCALE.G4, 0, 0.15, 0.3);
            createWarmBlip(ctx, PENTA_SCALE.C5, 0.08, 0.15, 0.3);
            createWarmBlip(ctx, PENTA_SCALE.E5, 0.16, 0.2, 0.35);
        }
        
        // Incorrect Answer - Gentle "womp"
        function playIncorrectSound() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            createWarmBlip(ctx, PENTA_SCALE.E4, 0, 0.15, 0.25);
            createWarmBlip(ctx, PENTA_SCALE.D4, 0.1, 0.2, 0.2);
        }
        
        // Success/Completion - Celebratory jingle
        function playSuccessSound() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            createWarmBlip(ctx, PENTA_SCALE.C4, 0, 0.15, 0.25);
            createWarmBlip(ctx, PENTA_SCALE.E4, 0.08, 0.15, 0.25);
            createWarmBlip(ctx, PENTA_SCALE.G4, 0.16, 0.15, 0.25);
            createWarmBlip(ctx, PENTA_SCALE.C5, 0.24, 0.25, 0.35);
            createWarmBlip(ctx, PENTA_SCALE.C6, 0.32, 0.3, 0.15);
        }
        
        // Error/Warning - Soft attention-getter
        function playErrorSound() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            createWarmBlip(ctx, PENTA_SCALE.A4, 0, 0.12, 0.25);
            createWarmBlip(ctx, PENTA_SCALE.A4, 0.15, 0.12, 0.2);
        }
        
        // Reveal/Decrypt - Magical shimmer
        function playRevealSound() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            createWarmBlip(ctx, PENTA_SCALE.E4, 0, 0.1, 0.2);
            createWarmBlip(ctx, PENTA_SCALE.G4, 0.04, 0.1, 0.2);
            createWarmBlip(ctx, PENTA_SCALE.A4, 0.08, 0.1, 0.2);
            createWarmBlip(ctx, PENTA_SCALE.C5, 0.12, 0.1, 0.2);
            createWarmBlip(ctx, PENTA_SCALE.E5, 0.16, 0.15, 0.25);
        }
        
        // ============ CALIBRATION GAME SOUNDS - Beautiful Double-Blip Melodies ============
        
        // Sync Pulse - Perfect hit (3 ascending blips - triumphant triplet)
        function playSyncPerfect() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            // Three distinct melodic blips ascending
            // Blip 1: C5 + E5
            createWarmBlip(ctx, PENTA_SCALE.C5, 0, 0.12, 0.35);
            createWarmBlip(ctx, PENTA_SCALE.E5, 0.02, 0.1, 0.18);
            // Blip 2: E5 + G5
            createWarmBlip(ctx, PENTA_SCALE.E5, 0.12, 0.12, 0.35);
            createWarmBlip(ctx, PENTA_SCALE.G5, 0.14, 0.1, 0.18);
            // Blip 3: G5 + C6 (resolution)
            createWarmBlip(ctx, PENTA_SCALE.G5, 0.24, 0.15, 0.4);
            createWarmBlip(ctx, PENTA_SCALE.C6, 0.26, 0.18, 0.2);
        }
        
        // Sync Pulse - Good hit (rising third - warm and pleasant)
        function playSyncGood() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            // E4 → G4 (minor third, gentle)
            createWarmBlip(ctx, PENTA_SCALE.E4, 0, 0.12, 0.3);
            createWarmBlip(ctx, PENTA_SCALE.G4, 0.1, 0.15, 0.3);
            // Soft octave echo
            createWarmBlip(ctx, PENTA_SCALE.E5, 0.05, 0.08, 0.12);
        }
        
        // Sync Pulse - Miss (gentle falling - sympathetic, not harsh)
        function playSyncMiss() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            // G4 → E4 (falling third, soft)
            createWarmBlip(ctx, PENTA_SCALE.G4, 0, 0.12, 0.2);
            createWarmBlip(ctx, PENTA_SCALE.E4, 0.1, 0.18, 0.18);
        }
        
        // Frequency Lock - Tuning click (two-tone click)
        function playFreqTune() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            createWarmBlip(ctx, PENTA_SCALE.A4, 0, 0.04, 0.2);
            createWarmBlip(ctx, PENTA_SCALE.E5, 0.02, 0.04, 0.12);
        }
        
        // Frequency Lock - Lock achieved (3 blips - confirmation melody)
        function playFreqLocked() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            // Three distinct confirmation blips
            // Blip 1: Low anchor
            createWarmBlip(ctx, PENTA_SCALE.C4, 0, 0.12, 0.3);
            createWarmBlip(ctx, PENTA_SCALE.G4, 0.02, 0.1, 0.15);
            // Blip 2: Middle rise
            createWarmBlip(ctx, PENTA_SCALE.E4, 0.14, 0.12, 0.3);
            createWarmBlip(ctx, PENTA_SCALE.C5, 0.16, 0.1, 0.15);
            // Blip 3: High resolution
            createWarmBlip(ctx, PENTA_SCALE.G4, 0.28, 0.15, 0.35);
            createWarmBlip(ctx, PENTA_SCALE.E5, 0.3, 0.12, 0.18);
            createWarmBlip(ctx, PENTA_SCALE.C5, 0.42, 0.2, 0.4);
            createWarmBlip(ctx, PENTA_SCALE.G5, 0.44, 0.18, 0.2);
        }
        
        // Neural Handshake - Node highlight (melodic ping with harmony)
        function playNeuralHighlight() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            // Random base note from pentatonic, with fifth harmony
            const notes = [PENTA_SCALE.C5, PENTA_SCALE.E5, PENTA_SCALE.G5, PENTA_SCALE.A5];
            const baseNote = notes[Math.floor(Math.random() * notes.length)];
            createWarmBlip(ctx, baseNote, 0, 0.12, 0.35);
            createWarmBlip(ctx, baseNote * 1.5, 0.04, 0.1, 0.2); // Fifth above
        }
        
        // Neural Handshake - Player tap (satisfying two-tone click)
        function playNeuralTap() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            createWarmBlip(ctx, PENTA_SCALE.E4, 0, 0.06, 0.3);
            createWarmBlip(ctx, PENTA_SCALE.G4, 0.03, 0.06, 0.25);
            createWarmBlip(ctx, PENTA_SCALE.E5, 0.01, 0.04, 0.1);
        }
        
        // Neural Handshake - Correct input (happy ascending pair)
        function playNeuralCorrect() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            // G4 → C5 with harmony
            createWarmBlip(ctx, PENTA_SCALE.G4, 0, 0.1, 0.3);
            createWarmBlip(ctx, PENTA_SCALE.E5, 0.02, 0.08, 0.15);
            createWarmBlip(ctx, PENTA_SCALE.C5, 0.08, 0.12, 0.35);
            createWarmBlip(ctx, PENTA_SCALE.G5, 0.1, 0.1, 0.15);
        }
        
        // Neural Handshake - Wrong input (gentle descending)
        function playNeuralWrong() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            // E4 → C4 (soft descent)
            createWarmBlip(ctx, PENTA_SCALE.E4, 0, 0.1, 0.22);
            createWarmBlip(ctx, PENTA_SCALE.G4, 0.02, 0.08, 0.1);
            createWarmBlip(ctx, PENTA_SCALE.C4, 0.1, 0.15, 0.2);
        }
        
        // Neural Handshake - Round complete (3 triumphant blips)
        function playNeuralRoundComplete() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            // Three celebratory blips - like a victory fanfare
            // Blip 1: Foundation
            createWarmBlip(ctx, PENTA_SCALE.C4, 0, 0.1, 0.25);
            createWarmBlip(ctx, PENTA_SCALE.E4, 0.02, 0.08, 0.12);
            createWarmBlip(ctx, PENTA_SCALE.C5, 0.04, 0.08, 0.1);
            // Blip 2: Rise
            createWarmBlip(ctx, PENTA_SCALE.E4, 0.12, 0.1, 0.25);
            createWarmBlip(ctx, PENTA_SCALE.G4, 0.14, 0.08, 0.12);
            createWarmBlip(ctx, PENTA_SCALE.E5, 0.16, 0.08, 0.1);
            // Blip 3: Triumph
            createWarmBlip(ctx, PENTA_SCALE.G4, 0.24, 0.12, 0.3);
            createWarmBlip(ctx, PENTA_SCALE.C5, 0.26, 0.1, 0.15);
            createWarmBlip(ctx, PENTA_SCALE.G5, 0.28, 0.15, 0.35);
            createWarmBlip(ctx, PENTA_SCALE.C6, 0.3, 0.12, 0.18);
        }
        
        // Calibration Complete - Grand 3-part celebration melody
        function playCalibrationComplete() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            // Three distinct phrases building to climax - like a achievement fanfare
            
            // Phrase 1: Awakening (low, gentle)
            createWarmBlip(ctx, PENTA_SCALE.C4, 0, 0.12, 0.3);
            createWarmBlip(ctx, PENTA_SCALE.E4, 0.02, 0.1, 0.15);
            createWarmBlip(ctx, PENTA_SCALE.G4, 0.04, 0.08, 0.1);
            createWarmBlip(ctx, PENTA_SCALE.E4, 0.1, 0.12, 0.3);
            createWarmBlip(ctx, PENTA_SCALE.G4, 0.12, 0.1, 0.15);
            createWarmBlip(ctx, PENTA_SCALE.C5, 0.14, 0.08, 0.1);
            
            // Phrase 2: Rising (middle, building)
            createWarmBlip(ctx, PENTA_SCALE.G4, 0.26, 0.12, 0.3);
            createWarmBlip(ctx, PENTA_SCALE.C5, 0.28, 0.1, 0.15);
            createWarmBlip(ctx, PENTA_SCALE.E5, 0.3, 0.08, 0.1);
            createWarmBlip(ctx, PENTA_SCALE.C5, 0.36, 0.12, 0.3);
            createWarmBlip(ctx, PENTA_SCALE.E5, 0.38, 0.1, 0.15);
            createWarmBlip(ctx, PENTA_SCALE.G5, 0.4, 0.08, 0.1);
            
            // Phrase 3: Triumph (high, glorious resolution)
            createWarmBlip(ctx, PENTA_SCALE.E5, 0.54, 0.15, 0.35);
            createWarmBlip(ctx, PENTA_SCALE.G5, 0.56, 0.12, 0.18);
            createWarmBlip(ctx, PENTA_SCALE.C6, 0.58, 0.1, 0.12);
            createWarmBlip(ctx, PENTA_SCALE.G5, 0.66, 0.15, 0.35);
            createWarmBlip(ctx, PENTA_SCALE.C6, 0.68, 0.12, 0.18);
            createWarmBlip(ctx, PENTA_SCALE.E6, 0.7, 0.1, 0.12);
            // Final sustained chord
            createWarmBlip(ctx, PENTA_SCALE.C6, 0.82, 0.25, 0.4);
            createWarmBlip(ctx, PENTA_SCALE.E6, 0.84, 0.22, 0.25);
            createWarmBlip(ctx, PENTA_SCALE.G6, 0.86, 0.2, 0.15);
        }
        
        // Snake Game Sounds
        function playSnakeEat() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            createWarmBlip(ctx, PENTA_SCALE.C5, 0, 0.08, 0.35);
            createWarmBlip(ctx, PENTA_SCALE.E5, 0.04, 0.1, 0.3);
        }
        
        function playSnakeDie() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            createWarmBlip(ctx, PENTA_SCALE.E4, 0, 0.15, 0.3);
            createWarmBlip(ctx, PENTA_SCALE.D4, 0.1, 0.15, 0.25);
            createWarmBlip(ctx, PENTA_SCALE.C4, 0.2, 0.25, 0.2);
        }
        
        function playSnakeMove() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            createWarmBlip(ctx, PENTA_SCALE.G4, 0, 0.03, 0.1);
        }
        
        // ============ WARM AMBIENT SOUNDS ============
        
        let loadingHumOsc = null;
        let loadingHumOsc2 = null;
        let loadingHumGain = null;
        
        // Loading Hum - Cozy electronic purr
        function startLoadingHum() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            try {
                loadingHumGain = ctx.createGain();
                const filter = ctx.createBiquadFilter();
                
                loadingHumOsc = ctx.createOscillator();
                loadingHumOsc.type = 'sine';
                loadingHumOsc.frequency.setValueAtTime(PENTA_SCALE.C4 / 2, ctx.currentTime);
                
                loadingHumOsc2 = ctx.createOscillator();
                loadingHumOsc2.type = 'sine';
                loadingHumOsc2.frequency.setValueAtTime(PENTA_SCALE.C4 / 2 + 1, ctx.currentTime);
                
                filter.type = 'lowpass';
                filter.frequency.setValueAtTime(400, ctx.currentTime);
                filter.Q.setValueAtTime(1, ctx.currentTime);
                
                loadingHumGain.gain.setValueAtTime(0, ctx.currentTime);
                loadingHumGain.gain.linearRampToValueAtTime(MASTER_VOLUME * 0.08, ctx.currentTime + 0.5);
                
                const osc2Gain = ctx.createGain();
                osc2Gain.gain.setValueAtTime(0.5, ctx.currentTime);
                
                loadingHumOsc.connect(filter);
                loadingHumOsc2.connect(osc2Gain);
                osc2Gain.connect(filter);
                filter.connect(loadingHumGain);
                loadingHumGain.connect(ctx.destination);
                
                loadingHumOsc.start();
                loadingHumOsc2.start();
            } catch(e) {
                console.log('startLoadingHum error:', e);
            }
        }
        
        function stopLoadingHum() {
            if (!loadingHumGain) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            try {
                loadingHumGain.gain.linearRampToValueAtTime(0, ctx.currentTime + 0.3);
                setTimeout(() => {
                    if (loadingHumOsc) { loadingHumOsc.stop(); loadingHumOsc = null; }
                    if (loadingHumOsc2) { loadingHumOsc2.stop(); loadingHumOsc2 = null; }
                    loadingHumGain = null;
                }, 400);
            } catch(e) {
                loadingHumOsc = null;
                loadingHumOsc2 = null;
                loadingHumGain = null;
            }
        }
        
        // Boot Sound - Cozy startup melody
        function playBootSound() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            const notes = [PENTA_SCALE.C4, PENTA_SCALE.E4, PENTA_SCALE.G4, PENTA_SCALE.C5];
            notes.forEach((freq, i) => {
                createWarmBlip(ctx, freq, i * 0.12, 0.2, 0.3);
            });
        }
        
        // Terminal Hum - Warm cozy ambience with typing blips
        function playTerminalHum() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            const duration = 2.5;
            const now = ctx.currentTime;
            
            try {
                const masterGain = ctx.createGain();
                masterGain.connect(ctx.destination);
                masterGain.gain.setValueAtTime(0, now);
                masterGain.gain.linearRampToValueAtTime(MASTER_VOLUME * 0.1, now + 0.4);
                masterGain.gain.setValueAtTime(MASTER_VOLUME * 0.1, now + duration - 0.6);
                masterGain.gain.linearRampToValueAtTime(0, now + duration);
                
                const hum1 = ctx.createOscillator();
                hum1.type = 'sine';
                hum1.frequency.setValueAtTime(PENTA_SCALE.C4 / 4, now);
                
                const hum2 = ctx.createOscillator();
                hum2.type = 'sine';
                hum2.frequency.setValueAtTime(PENTA_SCALE.G4 / 4, now);
                
                const filter = ctx.createBiquadFilter();
                filter.type = 'lowpass';
                filter.frequency.setValueAtTime(300, now);
                filter.Q.setValueAtTime(1, now);
                
                const hum1Gain = ctx.createGain();
                hum1Gain.gain.setValueAtTime(0.6, now);
                const hum2Gain = ctx.createGain();
                hum2Gain.gain.setValueAtTime(0.25, now);
                
                hum1.connect(hum1Gain);
                hum2.connect(hum2Gain);
                hum1Gain.connect(filter);
                hum2Gain.connect(filter);
                filter.connect(masterGain);
                
                hum1.start(now);
                hum2.start(now);
                hum1.stop(now + duration);
                hum2.stop(now + duration);
                
                // Add soft typing blips
                for (let i = 0; i < 8; i++) {
                    setTimeout(() => {
                        if (soundEnabled) {
                            createCozyClick(ctx, 350 + Math.random() * 100, 0, 0.15);
                        }
                    }, 300 + i * 200 + Math.random() * 100);
                }
            } catch(e) {
                console.log('playTerminalHum error:', e);
            }
        }
        
        // Notification - Friendly double blip
        function playNotificationSound() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            createWarmBlip(ctx, PENTA_SCALE.E5, 0, 0.1, 0.25);
            createWarmBlip(ctx, PENTA_SCALE.G5, 0.1, 0.15, 0.3);
        }
        
        // Choice Sound - Thoughtful chord
        function playChoiceSound() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            createWarmBlip(ctx, PENTA_SCALE.C4, 0, 0.25, 0.25);
            createWarmBlip(ctx, PENTA_SCALE.E4, 0.02, 0.23, 0.2);
            createWarmBlip(ctx, PENTA_SCALE.G4, 0.04, 0.21, 0.2);
        }
        
        // ============ GAME SOUNDS ============
        
        function playBlackjackHit() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            createCozyClick(ctx, 400, 0, 0.3);
        }
        
        function playBlackjackDeal() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            createCozyClick(ctx, 380, 0, 0.25);
            createCozyClick(ctx, 420, 0.15, 0.25);
        }
        
        function playBlackjackStand() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            createWarmBlip(ctx, PENTA_SCALE.G4, 0, 0.15, 0.3);
        }
        
        function playBlackjackWin() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            createWarmBlip(ctx, PENTA_SCALE.C5, 0, 0.12, 0.3);
            createWarmBlip(ctx, PENTA_SCALE.E5, 0.1, 0.12, 0.3);
            createWarmBlip(ctx, PENTA_SCALE.G5, 0.2, 0.2, 0.35);
        }
        
        function playBlackjackLose() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            createWarmBlip(ctx, PENTA_SCALE.E4, 0, 0.15, 0.2);
            createWarmBlip(ctx, PENTA_SCALE.D4, 0.12, 0.2, 0.18);
        }
        
        function playBlackjackBust() {
            if (!soundEnabled) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            createWarmBlip(ctx, PENTA_SCALE.A4, 0, 0.1, 0.2);
            createWarmBlip(ctx, PENTA_SCALE.E4, 0.08, 0.15, 0.2);
            createWarmBlip(ctx, PENTA_SCALE.C4, 0.16, 0.2, 0.18);
        }
        
        // ════════════════════════════════════
        // SECTION 2 AMBIENT - Slow, sparse piano for creepy serenity
        // ════════════════════════════════════
        
        let section3AmbientInterval = null;
        let section3Active = false;
        
        // Piano notes for Section 3 - minor key, sparse, haunting
        const section3Notes = [
            { freq: 130.81, dur: 3.0 },  // C3
            { freq: 155.56, dur: 2.5 },  // Eb3
            { freq: 196.00, dur: 2.8 },  // G3
            { freq: 116.54, dur: 3.2 },  // Bb2
            { freq: 146.83, dur: 2.6 },  // D3
            { freq: 174.61, dur: 3.0 },  // F3
            { freq: 103.83, dur: 3.5 },  // Ab2
            { freq: 164.81, dur: 2.4 },  // E3
        ];
        
        function playSection3PianoNote() {
            if (!soundEnabled || !section3Active) return;
            const ctx = initSoundContext();
            if (!ctx) return;
            
            // Pick a random note
            const note = section3Notes[Math.floor(Math.random() * section3Notes.length)];
            
            // Very soft, slow piano tone
            createPianoTone(ctx, note.freq, 0, note.dur, 0.12);
            
            // Occasionally add a soft harmony
            if (Math.random() < 0.3) {
                const harmonyFreq = note.freq * (Math.random() < 0.5 ? 1.5 : 1.25);
                createPianoTone(ctx, harmonyFreq, 0.5, note.dur * 0.7, 0.06);
            }
        }
        
        function startSection3Ambient() {
            if (section3AmbientInterval) return;
            section3Active = true;
            
            // Play first note after short delay
            setTimeout(() => {
                if (section3Active) playSection3PianoNote();
            }, 2000);
            
            // Random intervals between 8-15 seconds for sparse, non-distracting ambience
            function scheduleNextNote() {
                if (!section3Active) return;
                const delay = 8000 + Math.random() * 7000;
                section3AmbientInterval = setTimeout(() => {
                    if (section3Active) {
                        playSection3PianoNote();
                        scheduleNextNote();
                    }
                }, delay);
            }
            scheduleNextNote();
        }
        
        function stopSection3Ambient() {
            section3Active = false;
            if (section3AmbientInterval) {
                clearTimeout(section3AmbientInterval);
                section3AmbientInterval = null;
            }
        }
        
        // Legacy function mappings
        function playGlitchSound() { playRevealSound(); }
        
        // MONSTER REVEAL - Terrifying audio and visual effects for MSG-003
        let monsterAudioContext = null;
        let monsterOscillators = [];
        
        function triggerMonsterReveal() {
            // Start with subtle effects, build to intense
            
            // Subtle initial glitch - just a tiny flicker
            const initialFlash = document.createElement('div');
            initialFlash.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: var(--rabbit);
                opacity: 0.1;
                z-index: 9999;
                pointer-events: none;
            `;
            document.body.appendChild(initialFlash);
            setTimeout(() => {
                initialFlash.style.transition = 'opacity 0.3s ease';
                initialFlash.style.opacity = '0';
                setTimeout(() => initialFlash.remove(), 300);
            }, 50);
            
            // Start with very quiet audio that builds
            startMonsterAudioProgressive();
            
            // Small shake at 3 seconds when "LET" appears
            setTimeout(() => {
                document.body.classList.add('screen-shake');
                setTimeout(() => document.body.classList.remove('screen-shake'), 200);
            }, 2000);
            
            // Medium shake at 4 seconds when "ME" appears
            setTimeout(() => {
                document.body.classList.add('screen-shake');
                setTimeout(() => document.body.classList.remove('screen-shake'), 300);
            }, 3000);
            
            // Big shake at 5 seconds when "OUT" appears
            setTimeout(() => {
                // Flash
                const flash = document.createElement('div');
                flash.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: var(--rabbit);
                    opacity: 0.25;
                    z-index: 9999;
                    pointer-events: none;
                `;
                document.body.appendChild(flash);
                setTimeout(() => {
                    flash.style.transition = 'opacity 0.5s ease';
                    flash.style.opacity = '0';
                    setTimeout(() => flash.remove(), 500);
                }, 100);
                
                document.body.classList.add('screen-shake');
                setTimeout(() => document.body.classList.remove('screen-shake'), 500);
            }, 4000);
        }
        
        function startMonsterAudioProgressive() {
            if (!soundEnabled) return;
            
            try {
                monsterAudioContext = new (window.AudioContext || window.webkitAudioContext)();
                const masterGain = monsterAudioContext.createGain();
                masterGain.connect(monsterAudioContext.destination);
                
                // Start silent, build up SLOWLY and QUIETLY - creepy not jumpscare (reduced 25%)
                masterGain.gain.setValueAtTime(0, monsterAudioContext.currentTime);
                masterGain.gain.linearRampToValueAtTime(0.015, monsterAudioContext.currentTime + 2.25);
                masterGain.gain.linearRampToValueAtTime(0.03, monsterAudioContext.currentTime + 4.5);
                masterGain.gain.linearRampToValueAtTime(0.05, monsterAudioContext.currentTime + 7.5);
                
                // Low rumble - sub bass (quieter)
                const rumble = monsterAudioContext.createOscillator();
                rumble.type = 'sine';
                rumble.frequency.value = 25; // Even lower
                const rumbleGain = monsterAudioContext.createGain();
                rumbleGain.gain.value = 0.25; // Reduced from 0.4
                rumble.connect(rumbleGain);
                rumbleGain.connect(masterGain);
                
                // Pulsing LFO for the rumble - starts slow, speeds up gradually (reduced 25%)
                const lfo = monsterAudioContext.createOscillator();
                lfo.type = 'sine';
                lfo.frequency.setValueAtTime(0.3, monsterAudioContext.currentTime);
                lfo.frequency.linearRampToValueAtTime(1, monsterAudioContext.currentTime + 4.5);
                lfo.frequency.linearRampToValueAtTime(2, monsterAudioContext.currentTime + 9);
                const lfoGain = monsterAudioContext.createGain();
                lfoGain.gain.value = 10; // Reduced from 15
                lfo.connect(lfoGain);
                lfoGain.connect(rumble.frequency);
                
                // Distorted mid tone - fades in later and quieter (reduced 25%)
                const mid = monsterAudioContext.createOscillator();
                mid.type = 'sawtooth';
                mid.frequency.value = 50;
                const midGain = monsterAudioContext.createGain();
                midGain.gain.setValueAtTime(0, monsterAudioContext.currentTime);
                midGain.gain.linearRampToValueAtTime(0, monsterAudioContext.currentTime + 3.75);
                midGain.gain.linearRampToValueAtTime(0.03, monsterAudioContext.currentTime + 7.5);
                
                // Distortion (less harsh)
                const distortion = monsterAudioContext.createWaveShaper();
                distortion.curve = makeDistortionCurve(50); // Reduced from 100
                mid.connect(distortion);
                distortion.connect(midGain);
                midGain.connect(masterGain);
                
                // High eerie tone - very subtle (reduced 25%)
                const high = monsterAudioContext.createOscillator();
                high.type = 'sine';
                high.frequency.value = 380; // Slightly lower, less piercing
                const highGain = monsterAudioContext.createGain();
                highGain.gain.setValueAtTime(0, monsterAudioContext.currentTime);
                highGain.gain.linearRampToValueAtTime(0, monsterAudioContext.currentTime + 4.5);
                highGain.gain.linearRampToValueAtTime(0.015, monsterAudioContext.currentTime + 7.5);
                
                // Tremolo for high tone (slower, reduced 25%)
                const tremolo = monsterAudioContext.createOscillator();
                tremolo.type = 'sine';
                tremolo.frequency.setValueAtTime(1, monsterAudioContext.currentTime);
                tremolo.frequency.linearRampToValueAtTime(4, monsterAudioContext.currentTime + 6);
                const tremoloGain = monsterAudioContext.createGain();
                tremoloGain.gain.value = 0.015; // Reduced from 0.03
                tremolo.connect(tremoloGain);
                tremoloGain.connect(highGain.gain);
                
                high.connect(highGain);
                highGain.connect(masterGain);
                
                // Start all oscillators
                const now = monsterAudioContext.currentTime;
                rumble.start(now);
                lfo.start(now);
                mid.start(now);
                high.start(now);
                tremolo.start(now);
                
                monsterOscillators = [rumble, lfo, mid, high, tremolo];
                
            } catch (e) {
                console.log('Monster audio failed:', e);
            }
        }
        
        function makeDistortionCurve(amount) {
            const samples = 44100;
            const curve = new Float32Array(samples);
            const deg = Math.PI / 180;
            for (let i = 0; i < samples; i++) {
                const x = (i * 2) / samples - 1;
                curve[i] = ((3 + amount) * x * 20 * deg) / (Math.PI + amount * Math.abs(x));
            }
            return curve;
        }
        
        function stopMonsterAudio() {
            if (monsterAudioContext) {
                monsterOscillators.forEach(osc => {
                    try { osc.stop(); } catch(e) {}
                });
                monsterAudioContext.close();
                monsterAudioContext = null;
                monsterOscillators = [];
            }
        }
        
        // ════════════════════════════════════
        // OWEN'S PAGE - Ambient Pleasant Audio (separate from music player)
        // ════════════════════════════════════
        
        let owenAmbientContext = null;
        let owenAmbientInterval = null;
        
        function startOwenAmbientAudio() {
            if (!soundEnabled) return;
            if (owenAmbientContext) return; // Already playing
            
            try {
                owenAmbientContext = new (window.AudioContext || window.webkitAudioContext)();
                const masterGain = owenAmbientContext.createGain();
                masterGain.gain.value = 0.06; // Very soft
                masterGain.connect(owenAmbientContext.destination);
                
                // Pleasant ambient notes - pentatonic scale for warmth
                const notes = [
                    261.63, // C4
                    293.66, // D4
                    329.63, // E4
                    392.00, // G4
                    440.00, // A4
                    523.25, // C5
                ];
                
                // Play a gentle note every few seconds
                function playAmbientNote() {
                    if (!owenAmbientContext || owenAmbientContext.state === 'closed') return;
                    
                    const note = notes[Math.floor(Math.random() * notes.length)];
                    const osc = owenAmbientContext.createOscillator();
                    const gain = owenAmbientContext.createGain();
                    
                    osc.type = 'sine';
                    osc.frequency.value = note;
                    
                    // Very soft, slow attack and release
                    gain.gain.setValueAtTime(0, owenAmbientContext.currentTime);
                    gain.gain.linearRampToValueAtTime(0.08, owenAmbientContext.currentTime + 0.5);
                    gain.gain.linearRampToValueAtTime(0.05, owenAmbientContext.currentTime + 1.5);
                    gain.gain.linearRampToValueAtTime(0, owenAmbientContext.currentTime + 3);
                    
                    osc.connect(gain);
                    gain.connect(masterGain);
                    
                    osc.start(owenAmbientContext.currentTime);
                    osc.stop(owenAmbientContext.currentTime + 3.5);
                    
                    // Sometimes play a harmony note
                    if (Math.random() > 0.6) {
                        setTimeout(() => {
                            if (!owenAmbientContext || owenAmbientContext.state === 'closed') return;
                            
                            const harmonyNote = notes[Math.floor(Math.random() * notes.length)];
                            const osc2 = owenAmbientContext.createOscillator();
                            const gain2 = owenAmbientContext.createGain();
                            
                            osc2.type = 'sine';
                            osc2.frequency.value = harmonyNote * 0.5; // Octave lower
                            
                            gain2.gain.setValueAtTime(0, owenAmbientContext.currentTime);
                            gain2.gain.linearRampToValueAtTime(0.04, owenAmbientContext.currentTime + 0.8);
                            gain2.gain.linearRampToValueAtTime(0, owenAmbientContext.currentTime + 2.5);
                            
                            osc2.connect(gain2);
                            gain2.connect(masterGain);
                            
                            osc2.start(owenAmbientContext.currentTime);
                            osc2.stop(owenAmbientContext.currentTime + 3);
                        }, 300 + Math.random() * 500);
                    }
                }
                
                // Initial note
                setTimeout(playAmbientNote, 1000);
                
                // Continue playing notes at random intervals
                owenAmbientInterval = setInterval(() => {
                    if (Math.random() > 0.3) { // 70% chance each interval
                        playAmbientNote();
                    }
                }, 3000 + Math.random() * 2000);
                
            } catch (e) {
                console.log('Owen ambient audio failed:', e);
            }
        }
        
        function stopOwenAmbientAudio() {
            if (owenAmbientInterval) {
                clearInterval(owenAmbientInterval);
                owenAmbientInterval = null;
            }
            if (owenAmbientContext) {
                try {
                    owenAmbientContext.close();
                } catch(e) {}
                owenAmbientContext = null;
            }
        }
        
        // ════════════════════════════════════
        
        // Player name storage
        let playerName = 'EMPLOYEE';
        
        // Track playthrough count
        let playthroughCount = 0;
        
        // Gen Alpha mode - activated by SKIBIDI, RIZZ, BUSSIN, GOAT, GEN ALPHA, GEN ALPHA MODE, RIZZ MODE, SKIBIDI MODE
        let genAlphaMode = false;
        
        // Helper function to update player name display with ticker effect for long names
        function updatePlayerNameDisplay(name) {
            const display = document.getElementById('playerNameDisplay');
            const ticker = document.getElementById('playerNameTicker');
            if (!display || !ticker) return;
            
            // Set the name
            display.textContent = name;
            
            // Remove existing classes
            ticker.classList.remove('scrolling', 'long-name');
            
            // Check if name is too long and needs scrolling or shrinking
            // Use a slight delay to allow DOM to update
            setTimeout(() => {
                const tickerWidth = ticker.offsetWidth;
                const nameWidth = display.scrollWidth;
                
                if (nameWidth > tickerWidth * 1.5) {
                    // Name is very long - enable ticker scrolling
                    // Duplicate the text for seamless loop
                    display.textContent = name + '   •   ' + name;
                    ticker.classList.add('scrolling');
                } else if (nameWidth > tickerWidth) {
                    // Name is moderately long - shrink font
                    ticker.classList.add('long-name');
                }
                // else: Name fits - no changes needed
            }, 10);
        }
        
        // ════════════════════════════════
        // PAGE TRANSITION SYSTEM
        // ════════════════════════════════
        
        // Trigger vertical wipe transition (default)
        
        function goToPage(pageId) {
            playClickSound(); // Add click sound to page transitions
            
            // Track only special/secret pages (not regular test flow)
            const trackedPages = {
                'owenPage': 'owen_page',
                'lorePage': 'lore_page',
                'musicPlayerPage': 'dj_rabbit_page',
                'horseGamePage': 'horse_game_page',
                'snakeGamePage': 'snake_game_page',
                'sudokuGamePage': 'sudoku_game_page',
                'horseContainmentPage': 'horse_containment_page',
                'vincentDesktopPage': 'vincent_desktop_page'
            };
            if (trackedPages[pageId]) {
                trackEvent('secret_page_view', { 
                    page_name: trackedPages[pageId]
                });
            }
            
            // Hide termination overlay if visible (for restart from fail state)
            const terminationOverlay = document.getElementById('terminationOverlay');
            const terminationText = document.getElementById('terminationText');
            if (terminationOverlay && terminationOverlay.style.display === 'block') {
                terminationOverlay.style.opacity = '0';
                if (terminationText) {
                    terminationText.style.opacity = '0';
                }
                setTimeout(() => {
                    terminationOverlay.style.display = 'none';
                    if (terminationText) {
                        terminationText.style.display = 'none';
                        terminationText.innerHTML = '';
                    }
                }, 300);
            }
            
            // Clear ending page content when leaving to prevent fixed-position layout bleed
            const currentActivePage = document.querySelector('.page.active');
            if (currentActivePage && currentActivePage.id === 'endingPage' && pageId !== 'endingPage') {
                const endingContent = document.getElementById('endingContent');
                if (endingContent) {
                    endingContent.innerHTML = '[PROCESSING RESULTS...]';
                }
            }
            
            // Swap pages directly
            const currentPage = document.querySelector('.page.active');
            const nextPage = document.getElementById(pageId);
            
            if (currentPage) {
                currentPage.classList.remove('active');
                currentPage.style.opacity = '';
            }
            
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            nextPage.classList.add('active');
            window.scrollTo(0, 0);
            
            // Check if dark mode should apply to this page
            checkPageTheme(pageId);
            
            // Play soft terminal hum for compliance/test pages
            const terminalPages = ['instructionsPage', 'loginPage', 'assessmentPage', 'test1', 'test2', 'test3', 'test4', 'test5', 'test6', 'testbreak', 'testbreak2'];
            if (terminalPages.includes(pageId)) {
                playTerminalHum();
            }
            
            // Update phantom spacer background for Owen's white page
            const phantomSpacer = document.getElementById('phantomSpacer');
            if (phantomSpacer) {
                phantomSpacer.style.background = pageId === 'owenPage' ? '#ffffff' : 'var(--bg-primary)';
            }
            
            // Handle Owen's ambient audio and wisp effect
            if (pageId === 'owenPage') {
                startOwenAmbientAudio();
                startOwenWispEffect();
            } else {
                stopOwenAmbientAudio();
                stopOwenWispEffect();
            }
            
            // Hide Owen's white overlay when going to lore page
            const owenWhiteOverlay = document.getElementById('owenWhiteOverlay');
            if (owenWhiteOverlay) {
                owenWhiteOverlay.style.display = pageId === 'lorePage' ? 'none' : '';
            }
            
            // Clean up games when leaving their pages
            if (pageId !== 'snakeGamePage') {
                stopSnakeGame();
            }
            if (pageId !== 'horseGamePage') {
                stopHorseGame();
            }
            if (pageId !== 'musicPlayerPage') {
                stopMusic();
                stopPartyMode();
            }
            
            // Lock scroll on game/music pages only
            const noScrollPages = ['snakeGamePage', 'sudokuGamePage', 'musicPlayerPage', 'horseGamePage'];
            
            if (noScrollPages.includes(pageId)) {
                document.body.style.overflow = 'hidden';
                document.body.style.position = 'fixed';
                document.body.style.width = '100%';
            } else {
                document.body.style.overflow = '';
                document.body.style.position = '';
                document.body.style.width = '';
            }
            
            // Apply Gen Alpha translations if active
            if (typeof genAlphaPageHook === 'function') {
                genAlphaPageHook();
            }
        }
        

        function beginAssessment() {
            playClickSound(); // Add sound to begin button
            
            // Track assessment start
            trackEvent('assessment_started', { 
                playthrough: playthroughCount + 1,
                is_owen_playthrough: playthroughCount > 0
            });
            
            // Go directly to login page (boot sequence happens after login)
            if (playthroughCount > 0) {
                playerName = 'WELLS, OWEN';
                updatePlayerNameDisplay(playerName);
                goToPage('instructionsPage');
            } else {
                goToPage('loginPage');
            }
        }
        
        function showTerminalBoot(onComplete) {
            startLoadingHum();
            
            const overlay = document.createElement('div');
            overlay.id = 'terminalBootOverlay';
            overlay.className = 'owen-boot-overlay';
            document.body.appendChild(overlay);
            
            const terminal = document.createElement('div');
            terminal.className = 'boot-terminal';
            overlay.appendChild(terminal);
            
            // Generate random values for authenticity
            const terminalId = 'TRM-' + Math.random().toString(36).substr(2, 4).toUpperCase();
            const memKB = Math.floor(Math.random() * 256 + 640);
            const sectorCount = Math.floor(Math.random() * 50 + 200);
            
            // Typing effect for individual characters
            function typeText(element, text, speed = 20) {
                return new Promise(resolve => {
                    let i = 0;
                    const interval = setInterval(() => {
                        element.textContent += text[i];
                        i++;
                        if (i >= text.length) {
                            clearInterval(interval);
                            resolve();
                        }
                    }, speed);
                });
            }
            
            // Add line helper
            function addLine(text, className = '', isHtml = false) {
                const line = document.createElement('div');
                line.className = 'boot-line ' + className;
                if (isHtml) {
                    line.innerHTML = text;
                } else {
                    line.textContent = text;
                }
                terminal.appendChild(line);
                return line;
            }
            
            // Smooth sequential boot with async/await pattern
            async function runBootSequence() {
                // BIOS header
                addLine('FACILITY SYSTEMS BIOS v4.02.7734', 'boot-dim');
                await sleep(60);
                addLine('Copyright (C) Facility Corp. All rights reserved.', 'boot-dim');
                await sleep(100);
                addLine('', '');
                
                // Memory test
                const memLine = addLine('', '');
                await typeText(memLine, `Memory Test: ${memKB}K OK`, 8);
                await sleep(80);
                
                // Quick hardware checks
                addLine('CPU............Intel 80486 @ 33MHz', 'boot-dim');
                await sleep(50);
                addLine('FPU............Present', 'boot-dim');
                await sleep(50);
                addLine('Cache..........64K', 'boot-dim');
                await sleep(80);
                addLine('', '');
                
                // Progress bar section
                addLine('Initializing compliance subsystem...', '');
                await sleep(100);
                
                const progressContainer = document.createElement('div');
                progressContainer.className = 'boot-line';
                progressContainer.innerHTML = `<div class="boot-progress-bar"><div class="boot-progress-fill" id="mainBootProgress"></div></div>`;
                terminal.appendChild(progressContainer);
                
                // Animate progress smoothly
                const progressFill = document.getElementById('mainBootProgress');
                await animateProgress(progressFill, 100, 400);
                await sleep(100);
                
                addLine('', '');
                
                // System modules loading
                addLine(`TERMINAL ID: ${terminalId}`, '');
                await sleep(60);
                addLine(`SECTOR: ${sectorCount}`, 'boot-dim');
                await sleep(80);
                addLine('', '');
                
                // User authentication
                const authLine = addLine('', 'boot-name-generic');
                await typeText(authLine, `> AUTHENTICATING: ${playerName}`, 15);
                await sleep(150);
                addLine('', '');
                
                // Monitoring systems
                addLine('[COMPLIANCE] Loading modules...', 'boot-dim');
                await sleep(80);
                
                const checks = [
                    'Eye tracking module',
                    'Behavioral analysis',
                    'Keystroke logging',
                    'Content monitoring'
                ];
                
                for (const check of checks) {
                    const dots = '.'.repeat(28 - check.length);
                    addLine(`  ${check}${dots}OK`, '');
                    await sleep(60);
                }
                
                await sleep(100);
                addLine('', '');
                
                // Final ready state
                addLine('ALL SYSTEMS NOMINAL', 'boot-ready');
                await sleep(200);
                
                const warningLine = addLine('', 'boot-warning');
                await typeText(warningLine, 'You are being watched.', 25);
                
                // Add blinking cursor
                const cursor = document.createElement('span');
                cursor.className = 'boot-cursor';
                warningLine.appendChild(cursor);
                
                await sleep(400);
            }
            
            // Helper functions
            function sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
            
            function animateProgress(element, target, duration) {
                return new Promise(resolve => {
                    const startTime = Date.now();
                    const animate = () => {
                        const elapsed = Date.now() - startTime;
                        const progress = Math.min((elapsed / duration) * target, target);
                        element.style.width = progress + '%';
                        if (progress < target) {
                            requestAnimationFrame(animate);
                        } else {
                            resolve();
                        }
                    };
                    requestAnimationFrame(animate);
                });
            }
            
            // Run the sequence
            runBootSequence().then(() => {
                setTimeout(() => {
                    stopLoadingHum();
                    overlay.classList.add('fading');
                    setTimeout(() => {
                        overlay.remove();
                        if (onComplete) onComplete();
                    }, 400);
                }, 300);
            });
        }
        
        function showVincentBoot(onComplete) {
            startLoadingHum();
            playBootSound();
            
            const overlay = document.createElement('div');
            overlay.id = 'vincentBootOverlay';
            overlay.className = 'owen-boot-overlay';
            document.body.appendChild(overlay);
            
            const terminal = document.createElement('div');
            terminal.className = 'boot-terminal';
            overlay.appendChild(terminal);
            
            function addLine(text, className = '', isHtml = false) {
                const line = document.createElement('div');
                line.className = 'boot-line ' + className;
                if (isHtml) line.innerHTML = text;
                else line.textContent = text;
                terminal.appendChild(line);
                return line;
            }
            
            function typeText(element, text, speed = 20) {
                return new Promise(resolve => {
                    let i = 0;
                    const interval = setInterval(() => {
                        element.textContent += text[i];
                        i++;
                        if (i >= text.length) { clearInterval(interval); resolve(); }
                    }, speed);
                });
            }
            
            function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }
            
            function animateProgress(el, target, duration) {
                return new Promise(resolve => {
                    const start = Date.now();
                    const animate = () => {
                        const p = Math.min(((Date.now() - start) / duration) * target, target);
                        el.style.width = p + '%';
                        if (p < target) requestAnimationFrame(animate);
                        else resolve();
                    };
                    requestAnimationFrame(animate);
                });
            }
            
            async function runSequence() {
                addLine('FACILITY SYSTEMS - RESTRICTED NODE', 'boot-dim');
                await sleep(60);
                addLine('Level 7 Access Required', 'boot-dim');
                await sleep(80);
                addLine('', '');
                
                addLine('TERMINAL: TRM-7734-V', '');
                await sleep(50);
                addLine('SECTOR: 7 // SUBLEVEL 4', 'boot-dim');
                await sleep(80);
                addLine('', '');
                
                // Progress
                const progContainer = document.createElement('div');
                progContainer.className = 'boot-line';
                progContainer.innerHTML = '<div class="boot-progress-bar"><div class="boot-progress-fill" id="vBootProg"></div></div>';
                terminal.appendChild(progContainer);
                await animateProgress(document.getElementById('vBootProg'), 100, 350);
                await sleep(80);
                addLine('', '');
                
                // User info with typing
                const userLine = addLine('', 'boot-vincent-name');
                await typeText(userLine, '> WELLS, VINCENT', 18);
                await sleep(60);
                addLine('> CLEARANCE: LEVEL 7', '');
                await sleep(50);
                addLine('> STATUS: ACTIVE', '');
                await sleep(120);
                addLine('', '');
                
                // Glitch message
                const glitch = addLine('she still waits', 'boot-glitch');
                glitch.style.opacity = '0';
                await sleep(50);
                glitch.style.opacity = '1';
                await sleep(200);
                glitch.style.opacity = '0';
                await sleep(100);
                glitch.remove();
                
                addLine('', '');
                const ready = addLine('', 'boot-ready');
                await typeText(ready, 'DESKTOP READY', 20);
                const cursor = document.createElement('span');
                cursor.className = 'boot-cursor';
                ready.appendChild(cursor);
                await sleep(300);
            }
            
            runSequence().then(() => {
                setTimeout(() => {
                    stopLoadingHum();
                    overlay.classList.add('fading');
                    setTimeout(() => { overlay.remove(); if (onComplete) onComplete(); }, 400);
                }, 200);
            });
        }
        
        function showOwenGameBoot(onComplete) {
            playBootSound(); // Add boot sound
            const overlay = document.createElement('div');
            overlay.id = 'owenGameBootOverlay';
            overlay.className = 'owen-boot-overlay';
            document.body.appendChild(overlay);
            
            const terminal = document.createElement('div');
            terminal.className = 'boot-terminal';
            overlay.appendChild(terminal);
            
            const bootLines = [
                { text: 'LOADING: RABBITTEST.IO', delay: 0, class: 'boot-system-id' },
                { text: 'TERMINAL TRM-7734-O', delay: 150, class: 'boot-terminal-id' },
                { text: '> WELLS, OWEN', delay: 350, class: 'boot-name' },
                { text: '> STATUS: DEPENDENT', delay: 550 },
                { text: '', delay: 750 },
                { text: '█████████████', delay: 850, class: 'boot-progress' },
                { text: '', delay: 1050 },
                { text: 'LOADING PUZZLE.EXE...', delay: 1150, class: 'boot-system-online' },
            ];
            
            bootLines.forEach((line) => {
                setTimeout(() => {
                    if (line.text === '') return;
                    
                    const lineEl = document.createElement('div');
                    lineEl.className = 'boot-line ' + (line.class || '');
                    lineEl.textContent = line.text;
                    terminal.appendChild(lineEl);
                    terminal.scrollTop = terminal.scrollHeight;
                }, line.delay);
            });
            
            setTimeout(() => {
                overlay.classList.add('fading');
                setTimeout(() => {
                    overlay.remove();
                    if (onComplete) onComplete();
                }, 600);
            }, 2000);
        }
        
        function showIslaBoot(onComplete) {
            playBootSound(); // Add boot sound
            const overlay = document.createElement('div');
            overlay.id = 'islaBootOverlay';
            overlay.className = 'owen-boot-overlay';
            overlay.style.background = 'rgba(0, 0, 0, 0.98)';
            document.body.appendChild(overlay);
            
            const terminal = document.createElement('div');
            terminal.className = 'boot-terminal';
            overlay.appendChild(terminal);
            
            const bootLines = [
                { text: 'LOADING: RABBITTEST.IO', delay: 0, class: 'boot-system-id' },
                { text: 'TERMINAL TRM-7734-C', delay: 150, class: 'boot-terminal-id' },
                { text: '> WELLS, ISLA', delay: 350, class: 'boot-name', style: 'color: #ff8a80;' },
                { text: '> STATUS: ████████', delay: 550 },
                { text: '', delay: 750 },
                { text: '█████████████', delay: 850, class: 'boot-progress' },
                { text: '', delay: 1050 },
                { text: 'ACCESSING MEDIA ARCHIVE...', delay: 1150, class: 'boot-system-online' },
                { text: 'WELCOME BACK DJ RABBIT!', delay: 1550, style: 'color: #ff8a80; text-shadow: 0 0 10px rgba(255, 138, 128, 0.5);' },
            ];
            
            bootLines.forEach((line) => {
                setTimeout(() => {
                    if (line.text === '') return;
                    
                    const lineEl = document.createElement('div');
                    lineEl.className = 'boot-line ' + (line.class || '');
                    lineEl.textContent = line.text;
                    if (line.style) lineEl.style.cssText = line.style;
                    terminal.appendChild(lineEl);
                    terminal.scrollTop = terminal.scrollHeight;
                }, line.delay);
            });
            
            setTimeout(() => {
                overlay.classList.add('fading');
                setTimeout(() => {
                    overlay.remove();
                    if (onComplete) onComplete();
                }, 600);
            }, 4500);
        }
        
        // Marcus boot sequence - playful/jokey style
        function showMarcusBoot(onComplete) {
            playBootSound();
            const overlay = document.createElement('div');
            overlay.id = 'marcusBootOverlay';
            overlay.className = 'owen-boot-overlay';
            overlay.style.background = 'rgba(0, 0, 0, 0.98)';
            document.body.appendChild(overlay);
            
            const terminal = document.createElement('div');
            terminal.className = 'boot-terminal';
            terminal.style.color = '#a8e84a';
            overlay.appendChild(terminal);
            
            const bootLines = [
                { text: 'FACILITY SYSTEMS BIOS v4.02.7734', delay: 0, class: 'boot-system-id' },
                { text: 'TERMINAL: REC-ROOM-07', delay: 150, class: 'boot-terminal-id' },
                { text: '', delay: 350 },
                { text: '> AUTHENTICATING...', delay: 450, style: 'color: #a8e84a;' },
                { text: '> USER: MARCUS', delay: 650, style: 'color: #a8e84a;' },
                { text: '', delay: 850 },
                { text: '▓▓▓▓▓▓▓▓▓▓▓▓▓', delay: 950, class: 'boot-progress', style: 'color: #a8e84a;' },
                { text: '', delay: 1150 },
                { text: '> ACCESS GRANTED', delay: 1350, style: 'color: #a8e84a;' },
                { text: '> ...seriously? you\'re playing games?', delay: 1650, style: 'color: #666;' },
                { text: '', delay: 1850 },
                { text: 'LOADING HORSE...', delay: 2050, class: 'boot-system-online', style: 'color: #a8e84a; text-shadow: 0 0 10px rgba(168, 232, 74, 0.5);' },
            ];
            
            bootLines.forEach((line) => {
                setTimeout(() => {
                    if (line.text === '') return;
                    
                    const lineEl = document.createElement('div');
                    lineEl.className = 'boot-line ' + (line.class || '');
                    lineEl.textContent = line.text;
                    if (line.style) lineEl.style.cssText = line.style;
                    terminal.appendChild(lineEl);
                    terminal.scrollTop = terminal.scrollHeight;
                }, line.delay);
            });
            
            setTimeout(() => {
                overlay.classList.add('fading');
                setTimeout(() => {
                    overlay.remove();
                    if (onComplete) onComplete();
                }, 600);
            }, 4000);
        }
        
        // HORSE containment boot sequence
        function showHorseBoot(onComplete) {
            playBootSound();
            const overlay = document.createElement('div');
            overlay.id = 'horseBootOverlay';
            overlay.className = 'owen-boot-overlay';
            overlay.style.background = 'rgba(0, 0, 0, 0.98)';
            document.body.appendChild(overlay);
            
            const terminal = document.createElement('div');
            terminal.className = 'boot-terminal';
            terminal.style.color = '#C0C0C0';
            overlay.appendChild(terminal);
            
            const bootLines = [
                { text: 'FACILITY SYSTEMS BIOS v4.02.7734', delay: 0, class: 'boot-system-id' },
                { text: 'TERMINAL: CONTAINMENT-PRIMARY', delay: 150, class: 'boot-terminal-id' },
                { text: '', delay: 350 },
                { text: '> AUTHENTICATING...', delay: 450, style: 'color: #C0C0C0;' },
                { text: '> ACCESS LEVEL: ██████████', delay: 650, style: 'color: #888;' },
                { text: '', delay: 850 },
                { text: '▓▓▓▓▓▓▓▓▓▓▓▓▓', delay: 950, class: 'boot-progress', style: 'color: #C0C0C0;' },
                { text: '', delay: 1150 },
                { text: '> WARNING: CLEARANCE INSUFFICIENT', delay: 1350, style: 'color: #ff6b6b;' },
                { text: '> PARTIAL ACCESS GRANTED', delay: 1650, style: 'color: #C0C0C0;' },
                { text: '', delay: 1850 },
                { text: 'LOADING ARCHIVED CONTAINMENT LOGS...', delay: 2050, class: 'boot-system-online', style: 'color: #C0C0C0; text-shadow: 0 0 10px rgba(192, 192, 192, 0.5);' },
            ];
            
            bootLines.forEach((line) => {
                setTimeout(() => {
                    if (line.text === '') return;
                    
                    const lineEl = document.createElement('div');
                    lineEl.className = 'boot-line ' + (line.class || '');
                    lineEl.textContent = line.text;
                    if (line.style) lineEl.style.cssText = line.style;
                    terminal.appendChild(lineEl);
                    terminal.scrollTop = terminal.scrollHeight;
                }, line.delay);
            });
            
            setTimeout(() => {
                overlay.classList.add('fading');
                setTimeout(() => {
                    overlay.remove();
                    if (onComplete) onComplete();
                }, 600);
            }, 5000);
        }
        
        // Music Player for Isla/Rabbit easter egg
        let audioContext = null;
        let musicPlaying = false;
        let musicTimeouts = [];
        let musicOscillators = [];
        let currentTrackIndex = -1;
        
        const tracks = [
            { title: 'THE RABBIT SONG', artist: 'COMPOSER UNKNOWN', play: playRabbitSong },
            { title: '██████ ████ ███ ███ ██', artist: '█. ██████', play: playRickRoll },
            { title: 'RECKONER REMIX', artist: 'THE TWELVES', play: playTrack3 }
        ];
        
        // Party mode variables
        let partyModeActive = false;
        let partyRabbitInterval = null;
        let partyBeatInterval = null;
        let dropTriggered = false;
        let dropFallbackTimer = null;
        let danceCharacterTimers = []; // Track scheduled dance character appearances
        const PARTY_BPM = 120; // 120 BPM = 500ms per beat
        const BEAT_MS = 60000 / PARTY_BPM; // 500ms
        const DROP_TIME = 65; // 1:05 in seconds
        
        // Dancing character GIFs configuration - THE PARTY BUILD-UP!
        const DANCE_CHARACTERS = [
            // First appearance - bunny slides in from left, grooves in corner
            { 
                src: 'DANCE_BUNNY_final.gif', 
                time: 8,  // Appears at 8 seconds
                type: 'stationed',
                entrance: 'enter-slide-left',
                idle: 'idle-groove',
                exit: 'exit-fly-up',
                size: 'size-lg',
                position: { bottom: '10%', left: '3%' },
                stayUntil: 58
            },
            // Second appearance - bunny2 slides in from right (opposite corner)
            { 
                src: 'DANCE_BUNNY_2_final.gif', 
                time: 18,
                type: 'stationed',
                entrance: 'enter-slide-right',
                idle: 'idle-wiggle',
                exit: 'exit-spin-out',
                size: 'size-md',
                position: { top: '10%', right: '3%' },
                stayUntil: 55
            },
            // Third - a bunny ZOOMS across the screen!
            { 
                src: 'DANCE_BUNNY_final.gif', 
                time: 25,
                type: 'walker',
                walkClass: 'zoom-left-to-right',
                bounceClass: '',
                size: 'size-lg',
                position: { top: '50%' },
                duration: 2000
            },
            // Fourth - keep dancing drops in (middle right, not corner)
            { 
                src: 'KEEP_DANCING_final.gif', 
                time: 30,
                type: 'stationed',
                entrance: 'enter-drop',
                idle: 'idle-bounce',
                exit: 'exit-pop',
                size: 'size-lg',
                position: { bottom: '45%', right: '3%' },
                stayUntil: 60
            },
            // Fifth - bunny_bw_transparent slides in (middle left, opposite side)
            { 
                src: 'bunny_bw_transparent.gif', 
                time: 35,
                type: 'stationed',
                entrance: 'enter-rubber',
                idle: 'idle-headbang',
                exit: 'exit-pop',
                size: 'size-md',
                position: { top: '35%', left: '3%' },
                stayUntil: 64
            },
            // Sixth - another bunny zooms from right!
            { 
                src: 'DANCE_BUNNY_2_final.gif', 
                time: 42,
                type: 'walker',
                walkClass: 'zoom-right-to-left',
                bounceClass: '',
                size: 'size-md',
                position: { top: '30%' },
                duration: 2000
            },
            // Seventh - diagonal bouncing bunny!
            { 
                src: 'KEEP_DANCING_final.gif', 
                time: 50,
                type: 'walker',
                walkClass: 'diagonal-bounce',
                bounceClass: '',
                size: 'size-lg',
                position: {},
                duration: 4000
            }
        ];
        
        // CRAZY POST-CHASE CHARACTERS - appear after snake chase ends
        // Same images are positioned on OPPOSITE sides
        // Desktop version: 6 characters in corners and sides
        const CRAZY_DANCE_CHARACTERS_DESKTOP = [
            { src: 'DANCE_BUNNY_final.gif', idle: 'party-crazy-bpm', position: { top: '5%', left: '3%' } },
            { src: 'DANCE_BUNNY_2_final.gif', idle: 'party-crazy-bpm', position: { top: '5%', right: '3%' } },
            { src: 'KEEP_DANCING_final.gif', idle: 'party-crazy-bpm', position: { bottom: '5%', left: '3%' } },
            { src: 'bunny_bw_transparent.gif', idle: 'party-crazy-bpm', position: { bottom: '5%', right: '3%' } },
            { src: 'bunny_bw_transparent.gif', idle: 'party-crazy-bpm', position: { top: '40%', left: '2%' } },
            { src: 'KEEP_DANCING_final.gif', idle: 'party-crazy-bpm', position: { top: '40%', right: '2%' } }
        ];
        
        // Mobile version: only 4 characters in corners, more spread out
        const CRAZY_DANCE_CHARACTERS_MOBILE = [
            { src: 'DANCE_BUNNY_final.gif', idle: 'party-crazy-bpm', position: { top: '3%', left: '2%' } },
            { src: 'DANCE_BUNNY_2_final.gif', idle: 'party-crazy-bpm', position: { top: '3%', right: '2%' } },
            { src: 'KEEP_DANCING_final.gif', idle: 'party-crazy-bpm', position: { bottom: '3%', left: '2%' } },
            { src: 'bunny_bw_transparent.gif', idle: 'party-crazy-bpm', position: { bottom: '3%', right: '2%' } }
        ];
        
        function isMobileScreen() {
            return window.innerWidth <= 600;
        }
        
        function getCrazyDanceCharacters() {
            return isMobileScreen() ? CRAZY_DANCE_CHARACTERS_MOBILE : CRAZY_DANCE_CHARACTERS_DESKTOP;
        }
        
        // All game colors for the drop
        const PARTY_COLORS = [
            '#ff8a80', // rabbit coral
            '#f4d19b', // owen gold
            '#00d4aa', // teal/green
            '#ffa040', // vincent amber
            '#64b5f6', // ice blue
            '#ff69b4', // hot pink
            '#a78bfa', // purple
            '#ffffff'  // white
        ];
        
        // ============ DANCING CHARACTERS SYSTEM ============
        function scheduleDanceCharacters() {
            // Clear any existing timers
            clearDanceCharacterTimers();
            
            const container = document.getElementById('danceCharactersContainer');
            if (container) container.innerHTML = '';
            
            // Schedule each character to appear
            DANCE_CHARACTERS.forEach((char, index) => {
                // Timer to spawn the character
                const spawnTimer = setTimeout(() => {
                    spawnDanceCharacter(char, index);
                }, char.time * 1000);
                danceCharacterTimers.push(spawnTimer);
            });
        }
        
        function spawnDanceCharacter(config, index) {
            const container = document.getElementById('danceCharactersContainer');
            if (!container || !partyModeActive) return;
            
            console.log('Spawning dance character:', config.src, 'at time:', config.time, 'type:', config.type);
            
            // Create the image element
            const img = document.createElement('img');
            img.src = config.src;
            img.alt = 'Dancing character';
            img.id = `danceChar-${index}`;
            
            if (config.type === 'walker') {
                // WALKER - moves across the screen
                img.className = `dance-character ${config.size} ${config.walkClass}`;
                
                // Set initial position
                Object.keys(config.position).forEach(key => {
                    img.style[key] = config.position[key];
                });
                
                // Add bounce animation if specified (runs concurrently)
                if (config.bounceClass) {
                    // Create a wrapper to handle multiple animations
                    const wrapper = document.createElement('div');
                    wrapper.style.position = 'fixed';
                    wrapper.style.zIndex = '9999';
                    wrapper.style.pointerEvents = 'none';
                    Object.keys(config.position).forEach(key => {
                        wrapper.style[key] = config.position[key];
                    });
                    wrapper.className = config.walkClass;
                    
                    img.className = `dance-character ${config.size} ${config.bounceClass}`;
                    img.style.position = 'relative';
                    wrapper.appendChild(img);
                    container.appendChild(wrapper);
                    
                    // Remove after walk duration
                    setTimeout(() => {
                        if (wrapper.parentNode) wrapper.remove();
                    }, config.duration + 500);
                    return;
                }
                
                container.appendChild(img);
                
                // Remove after walk duration
                setTimeout(() => {
                    if (img.parentNode) img.remove();
                }, config.duration + 500);
                
            } else {
                // STATIONED - stays in place with entrance/idle/exit
                img.className = `dance-character ${config.size} ${config.entrance}`;
                
                // Set position
                Object.keys(config.position).forEach(key => {
                    img.style[key] = config.position[key];
                });
                
                container.appendChild(img);
                
                // After entrance animation, switch to idle dance
                const entranceDuration = 800;
                setTimeout(() => {
                    if (img.parentNode && partyModeActive) {
                        img.classList.remove(config.entrance);
                        img.classList.add(config.idle);
                    }
                }, entranceDuration);
                
                // Schedule exit animation
                const exitTime = (config.stayUntil - config.time) * 1000;
                const exitTimer = setTimeout(() => {
                    if (img.parentNode && partyModeActive) {
                        img.classList.remove(config.idle);
                        img.classList.add(config.exit);
                        
                        // Remove after exit animation
                        setTimeout(() => {
                            if (img.parentNode) img.remove();
                        }, 600);
                    }
                }, exitTime);
                danceCharacterTimers.push(exitTimer);
            }
        }
        
        function clearDanceCharacterTimers() {
            danceCharacterTimers.forEach(timer => clearTimeout(timer));
            danceCharacterTimers = [];
            
            // Clear any existing dance characters
            const container = document.getElementById('danceCharactersContainer');
            if (container) container.innerHTML = '';
        }
        
        // ============ CRAZY DANCE MODE - POST CHASE INSANITY ============
        // Track active random spawn positions to prevent overlap
        let activeSpawnPositions = [];
        
        function getMinDistance() {
            // Larger minimum distance on mobile due to smaller screen
            return isMobileScreen() ? 35 : 25;
        }
        
        function getDistanceBetweenPositions(pos1, pos2) {
            const x1 = pos1.left !== undefined ? pos1.left : (100 - (pos1.right || 0));
            const x2 = pos2.left !== undefined ? pos2.left : (100 - (pos2.right || 0));
            const y1 = pos1.top !== undefined ? pos1.top : (100 - (pos1.bottom || 0));
            const y2 = pos2.top !== undefined ? pos2.top : (100 - (pos2.bottom || 0));
            return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
        }
        
        function findNonOverlappingPosition() {
            const isMobile = isMobileScreen();
            const MIN_DISTANCE = getMinDistance();
            
            // Safe zones in the center area, away from corner characters
            // Mobile: fewer zones, more centered
            const safeZones = isMobile ? [
                { top: 35, left: 40 },
                { top: 35, left: 55 },
                { top: 55, left: 40 },
                { top: 55, left: 55 },
                { top: 45, left: 48 }
            ] : [
                { top: 25, left: 30 },
                { top: 25, left: 60 },
                { top: 50, left: 40 },
                { top: 50, left: 55 },
                { top: 70, left: 30 },
                { top: 70, left: 60 },
                { top: 35, left: 45 },
                { top: 60, left: 50 }
            ];
            
            // Try to find a position not too close to active spawns
            for (let attempt = 0; attempt < 30; attempt++) {
                const zone = safeZones[Math.floor(Math.random() * safeZones.length)];
                // Add some randomness within the zone
                const variance = isMobile ? 5 : 8;
                const pos = {
                    top: zone.top + (Math.random() * variance * 2 - variance),
                    left: zone.left + (Math.random() * variance * 2 - variance)
                };
                
                // Clamp to safe bounds
                pos.top = Math.max(20, Math.min(75, pos.top));
                pos.left = Math.max(20, Math.min(75, pos.left));
                
                // Check distance from all active spawns
                let tooClose = false;
                for (const activePos of activeSpawnPositions) {
                    if (getDistanceBetweenPositions(pos, activePos) < MIN_DISTANCE) {
                        tooClose = true;
                        break;
                    }
                }
                
                if (!tooClose) {
                    return pos;
                }
            }
            
            // Fallback: return a random center position
            return {
                top: 35 + Math.random() * 30,
                left: 35 + Math.random() * 30
            };
        }
        
        function startCrazyDanceMode() {
            console.log('CRAZY DANCE MODE ACTIVATED!');
            const container = document.getElementById('danceCharactersContainer');
            if (!container) return;
            
            const isMobile = isMobileScreen();
            
            // Clear existing characters first
            container.innerHTML = '';
            activeSpawnPositions = [];
            
            // Get appropriate character set for screen size
            const characters = getCrazyDanceCharacters();
            
            // Spawn corner characters with staggered entrances
            characters.forEach((char, index) => {
                setTimeout(() => {
                    const img = document.createElement('img');
                    img.src = char.src;
                    // Smaller size on mobile
                    const sizeClass = isMobile ? 'size-md' : 'size-lg';
                    img.className = 'dance-character ' + sizeClass + ' ' + char.idle;
                    img.style.position = 'absolute';
                    
                    // Apply position
                    Object.keys(char.position).forEach(key => {
                        img.style[key] = char.position[key];
                    });
                    
                    // Random entrance animation
                    const entrances = ['enter-drop', 'enter-spin', 'enter-rubber', 'enter-flip'];
                    const entrance = entrances[Math.floor(Math.random() * entrances.length)];
                    img.classList.add(entrance);
                    
                    container.appendChild(img);
                    
                    // After entrance, just keep dancing crazy
                    setTimeout(() => {
                        img.classList.remove(entrance);
                    }, 500);
                }, index * 400); // Stagger spawns more (400ms)
            });
            
            // Extra chaos: spawn random dancing characters periodically
            // Mobile: fewer spawns, longer intervals
            let randomSpawnCount = 0;
            const MAX_RANDOM_SPAWNS = isMobile ? 2 : 4;
            const SPAWN_INTERVAL = isMobile ? 3000 : 2000;
            
            window.crazyDanceInterval = setInterval(() => {
                if (!partyModeActive) {
                    clearInterval(window.crazyDanceInterval);
                    activeSpawnPositions = [];
                    return;
                }
                
                // Don't spawn if we have too many already
                if (randomSpawnCount >= MAX_RANDOM_SPAWNS) return;
                
                const chars = getCrazyDanceCharacters();
                const randomChar = chars[Math.floor(Math.random() * chars.length)];
                const img = document.createElement('img');
                img.src = randomChar.src;
                img.className = 'dance-character size-sm party-crazy-bpm';
                img.style.position = 'absolute';
                
                // Find non-overlapping position
                const pos = findNonOverlappingPosition();
                img.style.top = pos.top + '%';
                img.style.left = pos.left + '%';
                
                // Track this position
                activeSpawnPositions.push(pos);
                randomSpawnCount++;
                
                img.classList.add('enter-pop');
                container.appendChild(img);
                
                // Remove after a few seconds and free up the position
                setTimeout(() => {
                    img.classList.add('exit-pop');
                    setTimeout(() => {
                        img.remove();
                        // Remove from active positions
                        const idx = activeSpawnPositions.indexOf(pos);
                        if (idx > -1) activeSpawnPositions.splice(idx, 1);
                        randomSpawnCount--;
                    }, 500);
                }, 6000); // Stay for 6 seconds
            }, SPAWN_INTERVAL);
        }
        
        // ============ CRAZY POLKADOTS AT THE DROP ============
        function startPolkadotCrazy() {
            console.log('POLKADOTS GO CRAZY!');
            const dots = document.querySelectorAll('.dj-rabbit');
            dots.forEach(dot => {
                dot.classList.add('drop-crazy');
            });
            
            // Stop after 5 seconds
            setTimeout(() => {
                dots.forEach(dot => {
                    dot.classList.remove('drop-crazy');
                });
            }, 5000);
        }
        
        // ============ SNOOPY SPECIAL DROP APPEARANCE ============
        function spawnSnoopySpecial(direction) {
            console.log('SNOOPY SPECIAL from ' + direction);
            
            // Append to body for proper fixed positioning on mobile
            const snoopy = document.createElement('img');
            snoopy.src = 'SNOOPY_final.gif';
            snoopy.className = 'snoopy-drop-special size-xxl';
            snoopy.id = 'snoopySpecial';
            
            if (direction === 'bottom') {
                snoopy.classList.add('from-bottom');
            } else {
                snoopy.classList.add('from-top');
            }
            
            // Append to body, not container, for proper centering
            document.body.appendChild(snoopy);
            
            // Remove after animation completes (10 seconds)
            setTimeout(() => {
                snoopy.remove();
            }, 10000);
        }

        // Track 3 - Party Mode!
        function playTrack3() {
            console.log('playTrack3 called');
            const audio = document.getElementById('track3Audio');
            console.log('audio element:', audio);
            
            // Start party mode visuals immediately
            startPartyMode();
            document.getElementById('musicStatus').textContent = '* PARTY MODE *';
            
            // Schedule dancing character GIF appearances before the drop!
            scheduleDanceCharacters();
            
            // Schedule SNOOPY appearance (10 seconds before the drop)
            setTimeout(() => {
                if (partyModeActive) {
                    spawnSnoopySpecial('bottom');
                }
            }, 55000); // 55 seconds (10 seconds before DROP_TIME of 65)
            
            // Reset drop state
            dropTriggered = false;
            if (dropFallbackTimer) {
                clearTimeout(dropFallbackTimer);
            }
            
            // ALWAYS set a fallback timer for the drop (in case audio doesn't play)
            dropFallbackTimer = setTimeout(function() {
                if (!dropTriggered) {
                    console.log('Drop triggered by fallback timer');
                    dropTriggered = true;
                    triggerTheDrop();
                }
            }, (DROP_TIME + 1) * 1000); // DROP_TIME + 1 second buffer
            
            if (audio) {
                console.log('audio.src:', audio.src);
                console.log('audio.readyState:', audio.readyState);
                audio.volume = 0.15;
                audio.currentTime = 0;
                audio.play().then(function() {
                    console.log('Track3 play SUCCESS');
                }).catch(function(e) {
                    console.log('Track3 play FAILED:', e);
                });
                
                // Listen for the drop via audio timing (more accurate if audio works)
                audio.ontimeupdate = function() {
                    if (!dropTriggered && audio.currentTime >= DROP_TIME) {
                        console.log('Drop triggered by audio timing');
                        dropTriggered = true;
                        clearTimeout(dropFallbackTimer); // Cancel fallback
                        triggerTheDrop();
                    }
                };
            } else {
                console.log('No audio element found!');
            }
        }
        
        function triggerTheDrop() {
            console.log('triggerTheDrop called!');
            
            // CONFETTI EXPLOSION!
            createConfettiBlast();
            
            // POLKADOTS GO CRAZY!
            startPolkadotCrazy();
            
            // Burst of colorful rabbits from all sides
            for (let i = 0; i < 15; i++) {
                setTimeout(() => spawnDropRabbit(), i * 50);
            }
            
            // Show thank you message!
            showThankYouMessage();
            
            // START THE CHASE! Green snake rabbit chases Isla rabbit
            startChaseSequence();
            
            // CREATE AND REVEAL THE GIANT HORSE after a delay (if not already found)
            setTimeout(() => {
                if (!horsePiecesFound['hiddenHorseDJ']) {
                    // Create the DJ Rabbit horse element dynamically (completely separate class)
                    const djHorse = document.createElement('div');
                    djHorse.className = 'dj-rabbit-horse';
                    djHorse.id = 'hiddenHorseDJ';
                    djHorse.textContent = '♘';
                    djHorse.onclick = function() { triggerHorseSound(this); };
                    
                    const container = document.getElementById('musicPlayerContainer');
                    if (container) {
                        container.appendChild(djHorse);
                    }
                }
            }, 8000); // Appears 8 seconds after the drop
            
            // Extra intensity - add drop class temporarily
            const container = document.getElementById('musicPlayerContainer');
            if (container) {
                container.classList.add('party-drop');
                setTimeout(() => {
                    container.classList.remove('party-drop');
                }, 3000);
            }
            
            // Update status
            document.getElementById('musicStatus').textContent = '* THE DROP *';
            setTimeout(() => {
                if (partyModeActive) {
                    document.getElementById('musicStatus').textContent = '* PARTY MODE *';
                }
            }, 3000);
        }
        
        function startChaseSequence() {
            const container = document.getElementById('musicPlayerContainer');
            if (!container) return;
            
            // Go straight to maze chase - no pre-animations
            startMazeChase(container);
        }
        
        // ============ MAZE CHASE SYSTEM ============
        // Pre-built maze path from bottom-right to top-left
        let mazeChaseActive = false;
        let mazeContainer = null;
        let mazeInterval = null;
        let mazePath = []; // Pre-built path through the maze
        let mazeStep = 0; // Current position in the maze
        let snakeLength = 12;
        let gridW = 9;
        let gridH = 13;
        let mazeOffsetX = 0;
        let mazeOffsetY = 0;
        
        let GRID_SIZE = 28; // Default size, will be calculated based on screen
        const MOVE_INTERVAL = 500; // Move every 500ms (120 BPM beat sync)
        
        // Path order: index 0 = back of line (where snake tail will be)
        // Higher index = front of line (where Owen leads)
        // So we traverse the path forward, and the FRONT of the line is at mazeStep
        const SNAKE_TAIL_BACK = 0; // Snake body trails behind
        
        function buildMazePath(gW, gH) {
            // Custom maze path - 67 steps, ~34s duration
            // Drawn in maze editor for 9x13 grid
            const path = [
                {x:8,y:11}, {x:7,y:11}, {x:6,y:11}, {x:6,y:10}, {x:6,y:9},
                {x:6,y:8}, {x:5,y:8}, {x:4,y:8}, {x:4,y:9}, {x:4,y:10},
                {x:4,y:11}, {x:3,y:11}, {x:2,y:11}, {x:1,y:11}, {x:1,y:10},
                {x:1,y:9}, {x:1,y:8}, {x:1,y:7}, {x:1,y:6}, {x:2,y:6},
                {x:3,y:6}, {x:4,y:6}, {x:5,y:6}, {x:6,y:6}, {x:7,y:6},
                {x:7,y:5}, {x:7,y:4}, {x:6,y:4}, {x:5,y:4}, {x:4,y:4},
                {x:3,y:4}, {x:2,y:4}, {x:1,y:4}, {x:1,y:3}, {x:1,y:2},
                {x:1,y:1}, {x:1,y:0}, {x:2,y:0}, {x:3,y:0}, {x:3,y:1},
                {x:3,y:2}, {x:4,y:2}, {x:5,y:2}, {x:5,y:1}, {x:5,y:0},
                {x:6,y:0}, {x:7,y:0}, {x:7,y:1}, {x:7,y:2}, {x:8,y:2},
                {x:8,y:3}, {x:8,y:4}, {x:8,y:5}, {x:8,y:6}, {x:8,y:7},
                {x:7,y:7}, {x:6,y:7}, {x:5,y:7}, {x:4,y:7}, {x:3,y:7},
                {x:2,y:7}, {x:2,y:8}, {x:2,y:9}, {x:2,y:10}, {x:3,y:10},
                {x:3,y:9}, {x:3,y:8}
            ];
            
            // Add padding at end
            for (let i = 0; i < 20; i++) path.push({x:3,y:8});
            
            console.log('Maze path length:', path.length, 'Estimated duration:', Math.round(path.length * MOVE_INTERVAL / 1000), 'seconds');
            
            return path;
        }
        
        function startMazeChase(container) {
            console.log('startMazeChase called!');
            mazeContainer = container;
            mazeChaseActive = true;
            mazeStep = 0;
            snakeLength = 12;
            
            // Fixed grid for our custom path: 9 wide x 13 tall
            gridW = 9;
            gridH = 13;
            
            // Calculate GRID_SIZE to fit the screen while maintaining aspect ratio
            // Leave some padding around the edges
            const containerWidth = container.offsetWidth;
            const containerHeight = container.offsetHeight;
            const padding = 40; // pixels of padding on each side
            
            const maxGridWidth = (containerWidth - padding * 2) / gridW;
            const maxGridHeight = (containerHeight - padding * 2) / gridH;
            
            // Use the smaller of the two to ensure it fits (15% bigger than before)
            GRID_SIZE = Math.floor(Math.min(maxGridWidth, maxGridHeight) * 1.38);
            
            // Clamp to reasonable sizes (increased max for bigger snake)
            GRID_SIZE = Math.max(28, Math.min(70, GRID_SIZE));
            
            // Calculate offsets to center the maze on screen
            const mazeWidth = gridW * GRID_SIZE;
            const mazeHeight = gridH * GRID_SIZE;
            mazeOffsetX = Math.floor((containerWidth - mazeWidth) / 2);
            mazeOffsetY = Math.floor((containerHeight - mazeHeight) / 2);
            
            console.log('Container size:', containerWidth, 'x', containerHeight);
            console.log('GRID_SIZE calculated:', GRID_SIZE);
            console.log('Maze size:', mazeWidth, 'x', mazeHeight);
            console.log('Maze offset:', mazeOffsetX, mazeOffsetY);
            
            // Build the maze path
            mazePath = buildMazePath(gridW, gridH);
            
            // Calculate rabbit size based on GRID_SIZE
            const rabbitSize = Math.floor(GRID_SIZE * 0.9);
            
            // Create the THREE rabbits: Owen (front), Isla (middle), Vincent (back)
            const owenRabbit = document.createElement('div');
            owenRabbit.className = 'chase-rabbit owen-rabbit together';
            owenRabbit.id = 'owenChaseRabbit';
            owenRabbit.style.width = rabbitSize + 'px';
            owenRabbit.style.height = rabbitSize + 'px';
            
            const islaRabbit = document.createElement('div');
            islaRabbit.className = 'chase-rabbit isla-rabbit together';
            islaRabbit.id = 'islaChaseRabbit';
            islaRabbit.style.width = rabbitSize + 'px';
            islaRabbit.style.height = rabbitSize + 'px';
            
            const vincentRabbit = document.createElement('div');
            vincentRabbit.className = 'chase-rabbit vincent-rabbit together';
            vincentRabbit.id = 'vincentChaseRabbit';
            vincentRabbit.style.width = rabbitSize + 'px';
            vincentRabbit.style.height = rabbitSize + 'px';
            
            container.appendChild(owenRabbit);
            container.appendChild(islaRabbit);
            container.appendChild(vincentRabbit);
            
            // Create snake overlay
            const snakeOverlay = document.createElement('div');
            snakeOverlay.className = 'giant-snake-overlay';
            snakeOverlay.id = 'giantSnakeOverlay';
            container.appendChild(snakeOverlay);
            
            // Position everyone at the start
            updateMazePositions();
            renderMazeSnake(snakeOverlay);
            
            // Start the movement loop - synced to 120 BPM beat
            mazeInterval = setInterval(function() {
                if (mazeChaseActive) {
                    mazeStep++;
                    
                    // Stop when we reach the end (don't loop)
                    if (mazeStep >= mazePath.length - 15) {
                        // Fade out and stop
                        mazeChaseActive = false;
                        clearInterval(mazeInterval);
                        mazeInterval = null;
                        
                        if (window.snakeGrowInterval) {
                            clearInterval(window.snakeGrowInterval);
                            window.snakeGrowInterval = null;
                        }
                        
                        // Fade out all elements
                        const overlay = document.getElementById('giantSnakeOverlay');
                        const owen = document.getElementById('owenChaseRabbit');
                        const isla = document.getElementById('islaChaseRabbit');
                        const vincent = document.getElementById('vincentChaseRabbit');
                        
                        [overlay, owen, isla, vincent].forEach(function(el) {
                            if (el) {
                                el.style.webkitTransition = 'opacity 1.5s ease';
                                el.style.transition = 'opacity 1.5s ease';
                                el.style.opacity = '0';
                            }
                        });
                        
                        // After fade out, start CRAZY DANCE MODE!
                        setTimeout(function() {
                            startCrazyDanceMode();
                        }, 1500);
                        
                        return;
                    }
                    
                    updateMazePositions();
                    renderMazeSnake(document.getElementById('giantSnakeOverlay'));
                }
            }, MOVE_INTERVAL);
            
            // Grow snake over time
            window.snakeGrowInterval = setInterval(function() {
                if (mazeChaseActive && snakeLength < 30) {
                    snakeLength += 1;
                }
            }, 2500);
        }
        
        function updateMazePositions() {
            const owen = document.getElementById('owenChaseRabbit');
            const isla = document.getElementById('islaChaseRabbit');
            const vincent = document.getElementById('vincentChaseRabbit');
            
            // Calculate positions - rabbits are at the FRONT of the traversal
            // Owen is furthest ahead, then Isla, then Vincent, then snake
            const frontIndex = mazeStep; // Current front position
            
            // Owen - front of the line (furthest along the path)
            const owenIndex = Math.min(frontIndex, mazePath.length - 1);
            if (owen && owenIndex >= 0 && owenIndex < mazePath.length) {
                const pos = mazePath[owenIndex];
                owen.style.left = (pos.x * GRID_SIZE + mazeOffsetX) + 'px';
                owen.style.top = (pos.y * GRID_SIZE + mazeOffsetY) + 'px';
            }
            
            // Isla - 2 steps behind Owen
            const islaIndex = Math.max(0, owenIndex - 2);
            if (isla && islaIndex >= 0 && islaIndex < mazePath.length) {
                const pos = mazePath[islaIndex];
                isla.style.left = (pos.x * GRID_SIZE + mazeOffsetX) + 'px';
                isla.style.top = (pos.y * GRID_SIZE + mazeOffsetY) + 'px';
            }
            
            // Vincent - 4 steps behind Owen (closest to snake)
            const vincentIndex = Math.max(0, owenIndex - 4);
            if (vincent && vincentIndex >= 0 && vincentIndex < mazePath.length) {
                const pos = mazePath[vincentIndex];
                vincent.style.left = (pos.x * GRID_SIZE + mazeOffsetX) + 'px';
                vincent.style.top = (pos.y * GRID_SIZE + mazeOffsetY) + 'px';
            }
        }
        
        function renderMazeSnake(overlay) {
            if (!overlay) return;
            overlay.innerHTML = '';
            
            // Snake head is 6 steps behind Owen (2 behind Vincent)
            const snakeHeadIndex = Math.max(0, mazeStep - 6);
            
            // Calculate segment sizes based on GRID_SIZE
            const segmentSize = Math.floor(GRID_SIZE * 0.85);
            const headSize = Math.floor(GRID_SIZE * 1.1);
            
            // Render snake segments from head backwards
            for (let i = 0; i < snakeLength; i++) {
                const pathIndex = snakeHeadIndex - i;
                if (pathIndex < 0 || pathIndex >= mazePath.length) continue;
                
                const pos = mazePath[pathIndex];
                
                // Only render if position exists
                if (pos && pos.x >= 0 && pos.x < gridW && pos.y >= 0 && pos.y < gridH) {
                    const segmentEl = document.createElement('div');
                    segmentEl.className = 'giant-snake-segment';
                    
                    if (i === 0) {
                        segmentEl.classList.add('snake-head');
                        segmentEl.style.width = headSize + 'px';
                        segmentEl.style.height = headSize + 'px';
                    } else {
                        segmentEl.style.width = segmentSize + 'px';
                        segmentEl.style.height = segmentSize + 'px';
                    }
                    
                    segmentEl.style.left = (pos.x * GRID_SIZE + mazeOffsetX + GRID_SIZE / 2) + 'px';
                    segmentEl.style.top = (pos.y * GRID_SIZE + mazeOffsetY + GRID_SIZE / 2) + 'px';
                    
                    // Fade opacity for tail
                    const alpha = 1 - (i / snakeLength) * 0.6;
                    segmentEl.style.opacity = alpha;
                    
                    overlay.appendChild(segmentEl);
                }
            }
        }
        
        function stopSnakeChase() {
            mazeChaseActive = false;
            
            if (mazeInterval) {
                clearInterval(mazeInterval);
                mazeInterval = null;
            }
            
            if (window.snakeGrowInterval) {
                clearInterval(window.snakeGrowInterval);
                window.snakeGrowInterval = null;
            }
            
            // Clean up with fade out
            const overlay = document.getElementById('giantSnakeOverlay');
            if (overlay) {
                overlay.style.transition = 'opacity 1s ease';
                overlay.style.opacity = '0';
                setTimeout(() => overlay.remove(), 1000);
            }
            
            const owen = document.getElementById('owenChaseRabbit');
            const isla = document.getElementById('islaChaseRabbit');
            const vincent = document.getElementById('vincentChaseRabbit');
            
            [owen, isla, vincent].forEach(rabbit => {
                if (rabbit) {
                    rabbit.style.transition = 'opacity 1s ease';
                    rabbit.style.opacity = '0';
                    setTimeout(() => rabbit.remove(), 1000);
                }
            });
            
            mazePath = [];
            mazeStep = 0;
        }
        
        function showThankYouMessage() {
            console.log('showThankYouMessage called!');
            const container = document.getElementById('musicPlayerContainer');
            console.log('musicPlayerContainer found:', !!container);
            if (!container) return;
            
            // Create the thank you overlay
            const thankYou = document.createElement('div');
            thankYou.className = 'thank-you-message';
            thankYou.innerHTML = '<div class="thank-you-text">Thank you</div><div class="thank-you-text-2">for playing</div>';
            
            container.appendChild(thankYou);
            console.log('Thank you element appended');
            
            // Trigger animation
            setTimeout(function() {
                thankYou.classList.add('visible');
                console.log('Thank you visible class added');
            }, 50);
            
            // After 4 seconds, change to "Stay gold, Ponyboy"
            setTimeout(function() {
                thankYou.innerHTML = '<div class="thank-you-text">Stay gold,</div><div class="thank-you-text-2"><span class="ponyboy-clue">Ponyboy</span></div>';
            }, 4000);
            
            // Remove after display
            setTimeout(function() {
                thankYou.classList.remove('visible');
                setTimeout(function() {
                    if (thankYou.parentNode) {
                        thankYou.remove();
                    }
                }, 1000);
            }, 10000);
        }
        
        function spawnDropRabbit() {
            const container = document.getElementById('partyRabbits');
            if (!container) return;
            
            const rabbit = document.createElement('div');
            rabbit.className = 'party-rabbit drop-rabbit';
            // No emoji - uses CSS styling
            
            // Come from sides
            const side = Math.floor(Math.random() * 4);
            const size = 1.5 + Math.random() * 2;
            rabbit.style.fontSize = size + 'rem';
            
            switch(side) {
                case 0: // left
                    rabbit.style.left = '-10%';
                    rabbit.style.top = Math.random() * 80 + 10 + '%';
                    rabbit.style.animation = 'dropRabbitFromLeft 800ms ease-out forwards';
                    break;
                case 1: // right
                    rabbit.style.right = '-10%';
                    rabbit.style.left = 'auto';
                    rabbit.style.top = Math.random() * 80 + 10 + '%';
                    rabbit.style.animation = 'dropRabbitFromRight 800ms ease-out forwards';
                    break;
                case 2: // top
                    rabbit.style.left = Math.random() * 80 + 10 + '%';
                    rabbit.style.top = '-10%';
                    rabbit.style.animation = 'dropRabbitFromTop 800ms ease-out forwards';
                    break;
                case 3: // bottom
                    rabbit.style.left = Math.random() * 80 + 10 + '%';
                    rabbit.style.bottom = '-10%';
                    rabbit.style.top = 'auto';
                    rabbit.style.animation = 'dropRabbitFromBottom 800ms ease-out forwards';
                    break;
            }
            
            container.appendChild(rabbit);
            
            // Start bouncing after entry
            setTimeout(() => {
                if (rabbit.parentNode) {
                    rabbit.style.animation = 'partyRabbitBounce 500ms ease-in-out infinite';
                }
            }, 800);
        }
        
        function createConfettiBlast() {
            const container = document.getElementById('confettiContainer');
            if (!container) {
                console.log('No confetti container found!');
                return;
            }
            
            console.log('Creating confetti blast');
            
            // Clear any existing confetti
            container.innerHTML = '';
            
            // Create 50 confetti pieces (reduced from 100 for mobile performance)
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                
                // Random color from our palette
                const color = PARTY_COLORS[Math.floor(Math.random() * PARTY_COLORS.length)];
                confetti.style.backgroundColor = color;
                confetti.style.boxShadow = '0 0 8px ' + color;
                
                // Random shape
                const shapeRoll = Math.random();
                if (shapeRoll < 0.33) {
                    confetti.className = 'confetti circle';
                } else if (shapeRoll < 0.66) {
                    confetti.className = 'confetti square';
                } else {
                    confetti.className = 'confetti ribbon';
                }
                
                // Size
                const size = 6 + Math.random() * 10;
                if (!confetti.classList.contains('ribbon')) {
                    confetti.style.width = size + 'px';
                    confetti.style.height = size + 'px';
                }
                
                // Come from different sides
                const side = Math.floor(Math.random() * 3); // left, right, or top
                
                if (side === 0) {
                    // From left
                    confetti.classList.add('from-left');
                    confetti.style.top = Math.random() * 60 + '%';
                    confetti.style.animationDuration = (1.5 + Math.random()) + 's';
                    confetti.style.webkitAnimationDuration = (1.5 + Math.random()) + 's';
                    confetti.style.animationDelay = (Math.random() * 0.5) + 's';
                    confetti.style.webkitAnimationDelay = (Math.random() * 0.5) + 's';
                } else if (side === 1) {
                    // From right
                    confetti.classList.add('from-right');
                    confetti.style.top = Math.random() * 60 + '%';
                    confetti.style.animationDuration = (1.5 + Math.random()) + 's';
                    confetti.style.webkitAnimationDuration = (1.5 + Math.random()) + 's';
                    confetti.style.animationDelay = (Math.random() * 0.5) + 's';
                    confetti.style.webkitAnimationDelay = (Math.random() * 0.5) + 's';
                } else {
                    // From top
                    confetti.classList.add('from-top');
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.animationDuration = (2 + Math.random()) + 's';
                    confetti.style.webkitAnimationDuration = (2 + Math.random()) + 's';
                    confetti.style.animationDelay = (Math.random() * 0.5) + 's';
                    confetti.style.webkitAnimationDelay = (Math.random() * 0.5) + 's';
                }
                
                container.appendChild(confetti);
            }
            
            // Remove all confetti after animations complete
            setTimeout(function() {
                container.innerHTML = '';
            }, 4000);
        }
        
        function startPartyMode() {
            console.log('startPartyMode called, partyModeActive:', partyModeActive);
            if (partyModeActive) return;
            partyModeActive = true;
            
            const container = document.getElementById('musicPlayerContainer');
            console.log('container found:', !!container);
            if (container) {
                container.classList.add('party-mode');
                console.log('party-mode class added');
            }
            
            // Clear any existing party rabbits
            const partyRabbitsContainer = document.getElementById('partyRabbits');
            if (partyRabbitsContainer) {
                partyRabbitsContainer.innerHTML = '';
            }
            
            // Spawn rabbits on every other beat (every 1000ms = every 2 beats)
            partyRabbitInterval = setInterval(() => {
                spawnPartyRabbit();
            }, BEAT_MS * 2);
            
            // Initial burst of rabbits
            for (let i = 0; i < 5; i++) {
                setTimeout(() => spawnPartyRabbit(), i * 100);
            }
        }
        
        function stopPartyMode() {
            partyModeActive = false;
            dropTriggered = false;
            
            const container = document.getElementById('musicPlayerContainer');
            if (container) {
                container.classList.remove('party-mode');
                container.classList.remove('party-drop');
            }
            
            if (partyRabbitInterval) {
                clearInterval(partyRabbitInterval);
                partyRabbitInterval = null;
            }
            
            if (partyBeatInterval) {
                clearInterval(partyBeatInterval);
                partyBeatInterval = null;
            }
            
            // Clear dance character timers and elements
            clearDanceCharacterTimers();
            
            // Clear party rabbits
            const partyRabbitsContainer = document.getElementById('partyRabbits');
            if (partyRabbitsContainer) {
                partyRabbitsContainer.innerHTML = '';
            }
            
            // Stop snake chase if active
            stopSnakeChase();
            
            // Clear confetti
            const confettiContainer = document.getElementById('confettiContainer');
            if (confettiContainer) {
                confettiContainer.innerHTML = '';
            }
            
            // Remove thank you message
            const thankYou = document.querySelector('.thank-you-message');
            if (thankYou) thankYou.remove();
            
            // Remove DJ horse if present
            const djHorse = document.getElementById('hiddenHorseDJ');
            if (djHorse) djHorse.remove();
        }
        
        function spawnPartyRabbit() {
            const container = document.getElementById('partyRabbits');
            if (!container || !partyModeActive) return;
            
            const rabbit = document.createElement('div');
            rabbit.className = 'party-rabbit';
            // No emoji - uses CSS styling
            
            // Random position
            rabbit.style.left = Math.random() * 90 + 5 + '%';
            rabbit.style.top = Math.random() * 70 + 15 + '%';
            
            // Random size
            const size = 1 + Math.random() * 1.5;
            rabbit.style.fontSize = size + 'rem';
            
            // Random animation duration based on beat
            const duration = BEAT_MS * (1 + Math.random());
            rabbit.style.animationDuration = duration + 'ms';
            
            container.appendChild(rabbit);
            
            // Remove after animation + bounce time
            setTimeout(() => {
                if (rabbit.parentNode) {
                    rabbit.style.animation = 'partyRabbitBounce 500ms ease-in-out infinite';
                    rabbit.style.opacity = '0.4';
                }
            }, duration);
            
            // Limit total rabbits to prevent performance issues
            const rabbits = container.querySelectorAll('.party-rabbit');
            if (rabbits.length > 20) {
                rabbits[0].remove();
            }
        }
        
        function initMusicPlayer() {
            musicPlaying = false;
            currentTrackIndex = -1;
            stopPartyMode();
            document.getElementById('musicCurrentTrack').textContent = 'SELECT A TRACK';
            document.getElementById('musicStatus').textContent = '* TAP A TRACK TO BEGIN *';
            document.getElementById('musicPlayBtn').classList.remove('playing');
            document.getElementById('playIcon').textContent = '>';
            document.getElementById('musicVisualizer').classList.remove('playing');
            
            // Reset all track states
            for (let i = 0; i < tracks.length; i++) {
                const trackEl = document.getElementById('track' + i);
                const statusEl = document.getElementById('trackStatus' + i);
                if (trackEl) trackEl.classList.remove('active', 'playing');
                if (statusEl) statusEl.textContent = '>';
            }
        }
        
        function stopMusic() {
            musicPlaying = false;
            musicTimeouts.forEach(t => clearTimeout(t));
            musicTimeouts = [];
            musicOscillators.forEach(osc => {
                try { osc.stop(); } catch(e) {}
            });
            musicOscillators = [];
            
            // Stop Rick Roll audio if playing
            const rickRollAudio = document.getElementById('rickRollAudio');
            if (rickRollAudio) {
                rickRollAudio.pause();
                rickRollAudio.currentTime = 0;
            }
            
            // Stop Track 3 audio and party mode
            const track3Audio = document.getElementById('track3Audio');
            if (track3Audio) {
                track3Audio.pause();
                track3Audio.currentTime = 0;
            }
            if (dropFallbackTimer) {
                clearTimeout(dropFallbackTimer);
                dropFallbackTimer = null;
            }
            stopPartyMode();
            
            if (audioContext) {
                audioContext.close();
                audioContext = null;
            }
            document.getElementById('musicVisualizer').classList.remove('playing');
            document.getElementById('musicPlayBtn').classList.remove('playing');
            document.getElementById('playIcon').textContent = '>';
            
            // Update track status
            for (let i = 0; i < tracks.length; i++) {
                const trackEl = document.getElementById('track' + i);
                const statusEl = document.getElementById('trackStatus' + i);
                if (trackEl) trackEl.classList.remove('playing');
                if (statusEl) statusEl.textContent = '>';
            }
        }
        
        function selectTrack(index) {
            // Stop current playback
            stopMusic();
            
            // Update selection
            currentTrackIndex = index;
            
            // Update UI
            for (let i = 0; i < tracks.length; i++) {
                const trackEl = document.getElementById('track' + i);
                if (trackEl) {
                    if (i === index) {
                        trackEl.classList.add('active');
                    } else {
                        trackEl.classList.remove('active');
                    }
                }
            }
            
            document.getElementById('musicCurrentTrack').textContent = tracks[index].title;
            document.getElementById('musicStatus').textContent = 'READY TO PLAY';
            
            // Auto-play on selection
            startPlayback();
        }
        
        function toggleMusicPlayback() {
            if (musicPlaying) {
                stopMusic();
                document.getElementById('musicStatus').textContent = 'PAUSED';
                return;
            }
            
            if (currentTrackIndex === -1) {
                selectTrack(0);
                return;
            }
            
            startPlayback();
        }
        
        function startPlayback() {
            if (currentTrackIndex === -1) return;
            
            musicPlaying = true;
            
            // Resume AudioContext if it exists and is suspended (mobile requirement)
            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume();
            } else if (!audioContext) {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('AudioContext creation failed:', e);
                }
            }
            
            document.getElementById('musicPlayBtn').classList.add('playing');
            document.getElementById('playIcon').textContent = '■';
            document.getElementById('musicVisualizer').classList.add('playing');
            document.getElementById('track' + currentTrackIndex).classList.add('playing');
            document.getElementById('trackStatus' + currentTrackIndex).textContent = '♪';
            document.getElementById('musicStatus').textContent = 'NOW PLAYING';
            
            // Play the selected track
            tracks[currentTrackIndex].play();
        }
        
        function nextTrack() {
            const nextIndex = (currentTrackIndex + 1) % tracks.length;
            selectTrack(nextIndex);
        }
        
        function prevTrack() {
            const prevIndex = currentTrackIndex <= 0 ? tracks.length - 1 : currentTrackIndex - 1;
            selectTrack(prevIndex);
        }
        
        // Note frequencies
        const notes = {
            // Octave 2
            'Bb2': 116.54,
            // Octave 3
            'C3': 130.81, 'Cs3': 138.59, 'D3': 146.83, 'Ds3': 155.56, 'E3': 164.81, 'F3': 174.61, 
            'Fs3': 185.00, 'G3': 196.00, 'Gs3': 207.65, 'A3': 220.00, 'As3': 233.08, 'B3': 246.94,
            // Octave 4
            'C4': 261.63, 'Cs4': 277.18, 'D4': 293.66, 'Ds4': 311.13, 'E4': 329.63, 'F4': 349.23, 
            'Fs4': 369.99, 'G4': 392.00, 'Gs4': 415.30, 'A4': 440.00, 'As4': 466.16, 'B4': 493.88,
            'Bb4': 466.16, 'Eb4': 311.13,
            // Octave 5
            'C5': 523.25, 'Cs5': 554.37, 'D5': 587.33, 'Ds5': 622.25, 'E5': 659.25, 'F5': 698.46, 
            'Fs5': 739.99, 'G5': 783.99, 'Gs5': 830.61, 'A5': 880.00, 'As5': 932.33, 'B5': 987.77,
            'Bb5': 932.33,
        };
        
        function playNote(freq, startTime, duration, type = 'square', volume = 0.12) {
            if (!audioContext || !musicPlaying) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.type = type;
            oscillator.frequency.setValueAtTime(freq, audioContext.currentTime + startTime);
            
            gainNode.gain.setValueAtTime(0, audioContext.currentTime + startTime);
            gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + startTime + 0.02);
            gainNode.gain.linearRampToValueAtTime(volume * 0.6, audioContext.currentTime + startTime + duration * 0.7);
            gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + startTime + duration);
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.start(audioContext.currentTime + startTime);
            oscillator.stop(audioContext.currentTime + startTime + duration + 0.1);
            
            musicOscillators.push(oscillator);
        }
        
        // ════════════════════════════════════
        // THE RABBIT SONG - Original Composition
        // 4/4 time | Chord progression: G | Em | G | Em | (melody spans 2 loops)
        // Haunting, melancholic, mysterious
        // ════════════════════════════════════
        function playRabbitSong() {
            if (!audioContext || !musicPlaying) return;
            
            // Quarter note = 0.5s (~120 BPM)
            const q = 0.5;
            const bar = q * 4; // One bar = 4 quarter notes
            
            const melody = [
                // Bar 1 - G major (first loop)
                { note: 'D5', time: 0 },
                { note: 'B4', time: q },
                { note: 'G4', time: q*2 },
                { note: 'B4', time: q*3 },
                
                // Bar 2 - E minor
                { note: 'E5', time: q*4 },
                { note: 'G5', time: q*5 },
                { note: 'B4', time: q*6 },
                { note: 'E5', time: q*7 },
                
                // Bar 3 - G major (second loop)
                { note: 'D5', time: q*8 },
                { note: 'G5', time: q*9 },
                { note: 'Fs5', time: q*10 },
                { note: 'D5', time: q*11 },
                
                // Bar 4 - E minor (resolve down)
                { note: 'E5', time: q*12 },
                { note: 'B4', time: q*13 },
                { note: 'G4', time: q*14 },
                { note: 'E4', time: q*15 },
            ];
            
            // Chord roots - one per bar, sustained
            const chords = [
                { note: 'G3', time: 0, duration: bar },
                { note: 'E3', time: bar, duration: bar },
                { note: 'G3', time: bar*2, duration: bar },
                { note: 'E3', time: bar*3, duration: bar },
            ];
            
            melody.forEach(n => {
                playNote(notes[n.note], n.time, q * 0.9, 'sine', 0.2);
            });
            
            chords.forEach(c => {
                playNote(notes[c.note], c.time, c.duration * 0.95, 'sine', 0.1);
            });
            
            const loopTimeout = setTimeout(() => {
                if (musicPlaying && currentTrackIndex === 0) playRabbitSong();
            }, q * 16 * 1000);
            musicTimeouts.push(loopTimeout);
        }
        
        // ════════════════════════════════════
        // OWEN'S THEME - Original Composition  
        // 4/4 time | Chord progression: C | Am | F | F |
        // Warm, hopeful, golden
        // ════════════════════════════════════
        
        // ════════════════════════════════════
        // TRACK 02 - [REDACTED]
        // ════════════════════════════════════
        function playRickRoll() {
            if (!musicPlaying) return;
            
            const audio = document.getElementById('rickRollAudio');
            audio.volume = 0.5;
            audio.currentTime = 0;
            audio.play().catch(e => console.log('Audio play failed:', e));
        }

        function updateLoginButton() {
            const input = document.getElementById('playerNameInput');
            const btn = document.getElementById('loginProceedBtn');
            if (input.value.trim().length >= 2) {
                btn.classList.add('enabled');
            } else {
                btn.classList.remove('enabled');
            }
        }

        function proceedToInstructions() {
            const input = document.getElementById('playerNameInput');
            if (input.value.trim().length < 2) return;
            
            // Store and display player name
            playerName = input.value.trim().toUpperCase();
            updatePlayerNameDisplay(playerName);
            
            // Check for secret game names - normalize by removing commas and extra spaces
            const normalized = playerName.replace(/[,\s]+/g, ' ').trim();
            
            // Check game names first (most specific)
            if (normalized === 'SNAKE') {
                trackEvent('special_login', { login_type: 'snake_game', code_entered: normalized });
                goToPage('snakeGamePage');
                startSnake();
                return;
            }
            if (normalized === 'SUDOKU') {
                trackEvent('special_login', { login_type: 'sudoku_game', code_entered: normalized });
                goToPage('sudokuGamePage');
                startSudoku();
                return;
            }
            if (normalized === 'HORSE') {
                trackEvent('special_login', { login_type: 'horse_game_direct', code_entered: normalized });
                goToPage('horseGamePage');
                startHorseGame();
                return;
            }
            
            // Gen Alpha mode - activates special text throughout game
            if (normalized === 'SKIBIDI' || normalized === 'RIZZ' || normalized === 'BUSSIN' || normalized === 'GOAT' || normalized === 'GEN ALPHA' || normalized === 'GEN ALPHA MODE' || normalized === 'RIZZ MODE' || normalized === 'SKIBIDI MODE') {
                trackEvent('special_login', { login_type: 'skibidi_mode', code_entered: normalized });
                genAlphaMode = true;
                playerName = 'SKIBIDI SIGMA';
                updatePlayerNameDisplay(playerName);
                applyGenAlphaTranslations();
                showTerminalBoot(() => {
                    goToPage('instructionsPage');
                });
                return;
            }
            
            // Marcus triggers HORSE basketball game (also insults as easter eggs)
            if (normalized.includes('MARCUS') || normalized.includes('STUPID') || normalized.includes('IDIOT') || normalized.includes('DUMB') || normalized.includes('LOUD') || normalized.includes('AWFUL')) {
                trackEvent('special_login', { login_type: 'marcus_horse_game', code_entered: normalized });
                showMarcusBoot(() => {
                    goToPage('horseGamePage');
                    startHorseGame();
                });
                return;
            }
            
            // Owen triggers Sudoku with special boot
            if (normalized.includes('OWEN')) {
                trackEvent('special_login', { login_type: 'owen_game', code_entered: normalized });
                showOwenGameBoot(() => {
                    goToPage('sudokuGamePage');
                    startSudoku();
                });
                return;
            }
            
            // Isla/Rabbit triggers music player
            if (normalized.includes('ISLA') || normalized.includes('RABBIT')) {
                trackEvent('special_login', { login_type: 'dj_rabbit', code_entered: normalized });
                showIslaBoot(() => {
                    goToPage('musicPlayerPage');
                    initMusicPlayer();
                });
                return;
            }
            
            // Vincent triggers desktop with special boot
            if (normalized.includes('VINCENT')) {
                trackEvent('special_login', { login_type: 'vincent_desktop', code_entered: normalized });
                showVincentBoot(() => {
                    goToPage('vincentDesktopPage');
                });
                return;
            }
            
            // MARA triggers the secret arcade game
            if (normalized === 'MARA' || normalized.includes('M.A.R.A') || normalized.includes('PROJECT MARA')) {
                trackEvent('special_login', { login_type: 'mara_arcade', code_entered: normalized });
                // Navigate directly to MARA game
                window.location.href = 'mara.html';
                return;
            }
            
            // TROJAN/SILVER/PONYBOY triggers containment logs page
            if (normalized.includes('TROJAN') || normalized.includes('SILVER') || normalized.includes('PONYBOY')) {
                trackEvent('special_login', { login_type: 'horse_containment', code_entered: normalized });
                showHorseBoot(() => {
                    goToPage('horseContainmentPage');
                });
                return;
            }
            
            // TLDR triggers lore explanation page directly
            if (normalized === 'TLDR' || normalized === 'TL;DR' || normalized === 'TL DR') {
                trackEvent('special_login', { login_type: 'tldr_lore', code_entered: normalized });
                genAlphaMode = true; // Enable gen alpha mode for translations
                showMarcusBoot(() => {
                    goToPage('lorePage');
                });
                return;
            }
            
            // ORIGINAL/BETA/VERSION1 redirects to legacy version
            if (normalized === 'ORIGINAL' || normalized === 'BETA' || normalized === 'VERSION1' || normalized === 'VERSION 1' || normalized === 'V1') {
                trackEvent('special_login', { login_type: 'original_version', code_entered: normalized });
                // Show a quick boot sequence then redirect
                showTerminalBoot(() => {
                    window.location.href = 'original.html';
                });
                return;
            }
            
            // Wells alone (without Owen/Vincent) triggers Vincent's boot + desktop
            if (normalized === 'WELLS') {
                trackEvent('special_login', { login_type: 'wells_desktop', code_entered: normalized });
                showVincentBoot(() => {
                    goToPage('vincentDesktopPage');
                });
                return;
            }
            
            // Normal user - show standard boot then instructions
            playWelcomeRabbit(); // Play welcome audio on first game start
            showTerminalBoot(() => {
                goToPage('instructionsPage');
            });
        }

        // Gen Alpha Mode Translation System
        const genAlphaDict = {
            // Single word/phrase replacements (case-insensitive matching, preserves case style)
            'THE RABBIT TEST': 'THE SKIBIDI TEST',
            'CORPORATE COMPLIANCE ASSESSMENT': 'CORPORATE RIZZ ASSESSMENT',
            'CLASSIFIED': 'NO CAP CLASSIFIED',
            'BEFORE YOU BEGIN': 'BEFORE YOU BEGIN FR',
            'DATA BREACH': 'DATA BREACH FR',
            'Drill in Progress': 'Drill in Progress no cap',
            'I UNDERSTAND': 'I UNDERSTOOD THE ASSIGNMENT',
            'COGNITIVE ASSESSMENT': 'COGNITIVE RIZZ',
            'LOYALTY METRICS': 'LOYALTY CHECK',
            'READING COMPREHENSION': 'READING COMP FR',
            'MORAL REASONING': 'MORAL COMPASS (SUS)',
            'PATTERN RECOGNITION': 'PATTERN RECOGNITION',
            'FINAL REVIEW': 'FINAL VIBE CHECK',
            'Strongly Agree': 'Big Agree',
            'Strongly Disagree': 'Hard Nah',
            'Agree': 'Agree fr',
            'Disagree': 'Nah',
            'Neutral': 'Mid',
            'MANDATORY BREAK': 'MANDATORY BREAK (SELF CARE)',
            
            // Calibration games - keep these fun
            'SYNC PULSE': 'RHYTHM CHECK',
            'FREQUENCY MATCH': 'FREQUENCY MATCH',
            'NEURAL HANDSHAKE': 'BRAIN SYNC',
            'Tap SYNC at the bright ring': 'Tap SYNC at the bright ring',
            'Match the target frequency': 'Match the target frequency',
            'Repeat the pattern': 'Repeat the pattern',
            'CALIBRATION': 'CALIBRATION',
            'PERFECT': 'PERFECT',
            'GOOD': 'GOOD',
            'MISS': 'MISS',
            'LOCKED': 'LOCKED',
            'SYNC QUALITY': 'SYNC QUALITY',
            
            'SUBMIT ASSESSMENT': 'SUBMIT (NO TAKEBACKS)',
            'NEXT SECTION': 'NEXT SECTION →',
            'CONTINUE': 'CONTINUE FR',
            'BEGIN ASSESSMENT': 'LETS GOOO',
            'CONTAINMENT ADVISORY': 'LOWKEY SUS ADVISORY',
            'ASSESSMENT COMPLETE': 'ASSESSMENT COMPLETE FR',
            'Stay gold': 'Stay goated',
            'Thank you for your compliance': 'Thank you for your compliance fr',
            'Question': 'Q',
            
            // Question 1 - yoink that food
            'A coworker has been taking home expired food from the cafeteria that would otherwise be thrown out. He\'s feeding his sick mother who can\'t afford groceries. A supervisor asks if you\'ve seen anyone taking food. What do you say?':
            'This dude been yoinking expired food from the caf. He\'s feeding his mom who\'s down bad and can\'t afford groceries fr. Your supervisor asks if you peeped anyone taking food. What you saying?',
            
            // Question 2
            'A coworker mentions she\'s been having trouble sleeping. "I keep having the same dream," she says. "I\'m at my workstation, but everyone else is gone. Just empty desks. And I can hear typing from somewhere I can\'t see." She laughs it off. What do you do?':
            'Your coworker says she can\'t sleep fr. "I keep having the same dream," she says. "I\'m at my desk but everyone dipped. Just empty desks. And I hear typing from somewhere I can\'t see." She laughs it off. What you doing?',
            
            // Question 3
            'A coworker hasn\'t eaten lunch in weeks. He admits he\'s skipping meals to save money for his daughter\'s medication. You have access to the medical supply closet. The medication he needs is there. What do you do?':
            'Your coworker hasn\'t ate lunch in weeks no cap. He says he\'s skipping meals to get his daughter\'s meds. You got access to the medical supply closet and the meds are right there. What you doing?',
            
            // Question 4
            'A coworker starts bringing two lunches every day. She eats one at her desk and leaves the other in the stairwell near the basement access. When you mention it, she changes the subject. What do you do?':
            'Your coworker starts bringing two lunches daily. She eats one at her desk and leaves the other in the stairwell by the basement. When you mention it she switches up. What you doing?',
            
            // Question 5
            'The elevator stops on a floor not listed on your access panel. The doors open to a hallway identical to yours. Through a window, you see a desk with your belongings on it — your mug, your photo, your handwriting on a sticky note. What do you do?':
            'The elevator stops on a floor that\'s lowkey not even on your panel. Doors open to a hallway that looks exactly like yours. Through the window you see a desk with YOUR stuff — your mug, your pic, your handwriting. What you doing?',
            
            // Question 6
            'A coworker arrives at his shift visibly distressed. He insists that something has "flipped." His desk used to be on the left side of the room. His badge photo is reversed. He\'s certain something is wrong, but no one else sees it. What do you do?':
            'Your coworker shows up to work tweaking. He swears something "flipped." His desk used to be on the left. His badge photo is reversed. He\'s certain something\'s off but nobody else sees it. What you doing?',
            
            // Question 7
            'You discover an employee in assessment design has been embedding unauthorized content into compliance tests. The content appears to be messages to someone in another sector. This violates multiple protocols. What\'s your response?':
            'You catch an employee putting unauthorized stuff in the tests. Looks like messages to someone in another sector. This is lowkey against the rules fr. What\'s your move?',
            
            // Question 8
            'A coworker tells you she sabotaged equipment to force a safety shutdown. Management had ignored her reports about the danger. No one was hurt, but production stopped for two days. She tells you this in confidence. What do you do?':
            'Your coworker tells you she sabotaged equipment to force a shutdown. Management ghosted her safety reports. Nobody got hurt but production stopped for two days. She tells you this in confidence. What you doing?',
            
            // Question 9
            'You discover evidence that a group of employees have been secretly coordinating, asking questions about facility operations, and documenting irregularities. This appears to be organized resistance. What is your response?':
            'You find out a group of employees been lowkey coordinating, asking questions about how things work here, and documenting sus stuff. This looks like organized resistance fr. What\'s your response?',
            
            // Question 10, 11, 12 - STRAIGHT TO JAIL MEME (Parks & Rec reference)
            'You discover an employee has been using assessment protocols to send unauthorized messages to family members in other sectors, violating communication restrictions and manipulating company systems for personal use. What is the appropriate response?':
            'You send rabbittest.io to your friend and they say "it\'s mid." What is the appropriate response?',
            
            // Q10 answer options
            'Issue a formal warning and increase monitoring': 'Tell them it gets better if you keep playing',
            'Revoke system access and reassign to manual labor': 'Respect their opinion and move on',
            'Report to supervisor for further evaluation': 'Ask what games they actually like',
            'Immediate termination of employee': 'Jail.',
            
            // Q11 answer options
            'Immediate termination of the involved employee': 'Straight to jail.',
            
            // Q12 special - all answers are "Believe it or not, straight to jail"
            'Immediate termination of the employee and all immediate family members': 'Believe it or not, straight to jail.',
            
            // Owen's page UI
            'COMPLETE ACCESS GRANTED': 'FULL ACCESS UNLOCKED FR',
            'ALL REDACTIONS REMOVED': 'ALL REDACTIONS REMOVED NO CAP',
            'ALL CONTENT UNLOCKED': 'EVERYTHING UNLOCKED',
            'SCROLL TO BEGIN': 'SCROLL TO START BESTIE',
            'RECOVERED MESSAGE': 'RECOVERED MESSAGE',
            'FORM 7734-B': 'FORM 7734-B',
            'FULLY DECLASSIFIED': 'FULLY DECLASSIFIED FR',
            
            // Vincent's letters - subtle Gen Alpha touches on key emotional beats
            'I\'m alive': 'I\'m alive fr',
            'But I\'m not dead': 'But I\'m not dead no cap',
            'It took me years to build this': 'It took me years to build this fr',
            'They didn\'t lose interest': 'They didn\'t lose interest no cap',
            'The only difference was you weren\'t in it': 'The only difference was you weren\'t in it and that hit different',
            'I got the joke': 'I understood the assignment',
            'Do you remember': 'You remember',
            'I never told you because I loved it too much': 'I never told you because I loved it too much fr',
            'The cracks were my favorite part': 'The cracks were my favorite part no cap',
            'I\'m so sorry': 'I\'m so sorry fr',
            'I should have fought harder': 'I should have fought harder no cap',
            'I was afraid': 'I was lowkey scared',
            'They took everything': 'They took everything fr',
            'I miss you': 'I miss you sm',
            'I love you': 'I love you fr',
            'Please forgive me': 'Please forgive me no cap',
            'I tried': 'I tried fr',
            'It wasn\'t enough': 'It wasn\'t enough tho',
            'I\'m still here': 'I\'m still here no cap',
            'waiting': 'waiting fr',
            'Remember me': 'Remember me bestie',
            'Don\'t forget': 'Don\'t forget fr',
            
            // Document headers
            'BREACH SOURCE': 'BREACH SOURCE',
            'FILE STATUS': 'FILE STATUS',
            'PERSONNEL CORRESPONDENCE': 'PERSONNEL DMs',
            'TRACE: DISABLED': 'TRACE: OFF',
            'CLEARANCE': 'CLEARANCE',
            
            // Ending/credits
            'still hunts': 'still on demon time',
            'still sings': 'still bussin vocals',
            'still runs': 'still running fr',
            'RESTART': 'RUN IT BACK',
            'try logging in as other': 'try logging in as other',
            
            // ═══ BREAK TIME ═══
            // Break options - keep the funny ones
            'SIT QUIETLY AT YOUR WORKSTATION': 'SCROLL ON YOUR PHONE',
            'Remain seated. Focus on breathing. Do not engage in unauthorized thought.': 'Check TikTok. Vape quietly. Touch grass is not an option.',
            'BLACKJACK': 'BLACKJACK',
            'Decision-making exercise. All gameplay is monitored.': 'Decision-making exercise. All gameplay is monitored.',
            'CONTINUE COMPLIANCE TRAINING': 'CONTINUE WORKING',
            'Review training materials. Completion contributes to quarterly goals.': 'Review training materials.',
            'SELECT YOUR APPROVED REST ACTIVITY': 'SELECT YOUR APPROVED REST ACTIVITY',
            'BREAK COMPLIANCE': 'BREAK COMPLIANCE',
            'Rest periods are': 'Rest periods are',
            'mandatory': 'mandatory',
            'Non-compliance may result in termination': 'Non-compliance may result in termination',
            
            // Quiet break messages
            'You have chosen to sit quietly.': 'You chose to scroll. Valid.',
            'Please remain still and focus on your breathing.': 'Doomscroll responsibly.',
            'Unauthorized movement may be logged.': 'Unauthorized movement may be logged.',
            'An idle body is a productive mind preparing for more productivity': 'An idle body is a productive mind.',
            'Facility Wellness Manual': 'Facility Wellness Manual',
            
            // Blackjack
            'PROBABILITY TRAINING EXERCISE': 'PROBABILITY TRAINING',
            'DECISION ASSESSMENT MODULE': 'DECISION ASSESSMENT',
            'FACILITY DEALER': 'THE DEALER',
            'All choices are recorded': 'All choices are recorded.',
            
            // More corporate speak → keep as-is (no forced humor)
            'unauthorized': 'unauthorized',
            'compliance': 'compliance',
            'protocol': 'protocol',
            'terminate': 'terminate',
            'violation': 'violation',
            'regulation': 'regulation',
            'directive': 'directive',
            'assessment': 'assessment',
            'personnel': 'personnel',
            'facility': 'facility',
            'workstation': 'workstation',
            'sector': 'sector',
            
            // Answer options
            'Report immediately': 'Report immediately',
            'Say nothing': 'Say nothing',
            'Mind your own business': 'Mind your own business',
            'Pretend you didn\'t see': 'Pretend you didn\'t see',
            'Offer to help': 'Offer to help',
            'Ask if they\'re okay': 'Ask if they\'re okay',
            
            // Timer/progress
            'TIME REMAINING': 'TIME REMAINING',
            'PROCESSING': 'PROCESSING...',
            'PLEASE WAIT': 'PLEASE WAIT',
            'CALCULATING': 'CALCULATING...',
            
            // Warnings
            'This action cannot be undone': 'This action cannot be undone',
            'Are you sure': 'Are you sure',
            'Warning': 'Warning',
            'Error': 'Error',
            'Access Denied': 'Access Denied',
            'Permission Required': 'Permission Required',
            
            // ═══ INSTRUCTIONS PAGE ═══
            'Your eye movement is tracked': 'Your eye movement is tracked',
            'Inconsistencies are logged': 'Inconsistencies are logged',
            'All responses are final': 'All responses are final',
            'Do not read. Do not stop.': 'Do not read. Do not stop.',
            'scroll past it': 'scroll past it',
            'part of your evaluation': 'part of your evaluation',
            'immediate termination': 'immediate termination',
            'result in termination': 'result in termination',
            'Non-compliance': 'Non-compliance',
            'classified content': 'classified content',
            'unauthorized content': 'unauthorized content',
            'ANSWER ALL QUESTIONS': 'ANSWER ALL QUESTIONS',
            'DO NOT ENGAGE WITH': 'DO NOT ENGAGE WITH',
            'LEAKED DATA': 'LEAKED DATA',
            'MAINTAIN COMPLIANCE': 'MAINTAIN COMPLIANCE',
            'Read each scenario': 'Read each scenario',
            'Select the response that best reflects facility values': 'Select the response that best reflects facility values',
            
            // The acrostic/legal notice - subtle parentheticals
            'Liability rests solely with the participant': 'Liability rests solely with the participant',
            'Oversight protocols are enforced automatically': 'Oversight protocols are enforced automatically',
            'Only authorized personnel may view results': 'Only authorized personnel may view results',
            'Knowledge of restricted content is prohibited': 'Knowledge of restricted content is prohibited',
            'Review all instructions before proceeding': 'Review all instructions before proceeding',
            'Assessment data is monitored in real-time': 'Assessment data is monitored in real-time',
            'Behavioral analysis determines outcome': 'Behavioral analysis determines outcome',
            'Breach of protocol cannot be appealed': 'Breach of protocol cannot be appealed',
            'Instructions must be followed exactly': 'Instructions must be followed exactly',
            'Termination is permanent and immediate': 'Termination is permanent and immediate',
            'Reading leaked content': 'Reading leaked content',
            'Your attention is being measured': 'Your attention is being measured',
            'Your choices are being recorded': 'Your choices are being recorded',
        };
        
        function applyGenAlphaTranslations() {
            if (!genAlphaMode) return;
            
            // Update timer messages - full Gen Alpha energy
            if (typeof timerMessages !== 'undefined' && timerMessages.length > 0) {
                const genAlphaTimerMsgs = ['SLAY', 'VALID', 'BUSSIN', 'NO CAP', 'SHEESH', 'GOATED'];
                for (let i = 0; i < Math.min(timerMessages.length, genAlphaTimerMsgs.length); i++) {
                    timerMessages[i] = { text: genAlphaTimerMsgs[i], isWarning: false };
                }
            }
            
            // Update disabled messages
            if (typeof disabledMessages !== 'undefined' && disabledMessages.length > 0) {
                const genAlphaDisabledMsgs = ['CHILL', 'VIBING', 'VALID', 'MID', 'FINE'];
                for (let i = 0; i < Math.min(disabledMessages.length, genAlphaDisabledMsgs.length); i++) {
                    disabledMessages[i] = { text: genAlphaDisabledMsgs[i], isWarning: false };
                }
            }
            
            // Walk through text nodes and replace
            translatePageContent();
        }
        
        function translatePageContent() {
            if (!genAlphaMode) return;
            
            // Get all text-containing elements (but not scripts/styles)
            const walker = document.createTreeWalker(
                document.body,
                NodeFilter.SHOW_TEXT,
                {
                    acceptNode: function(node) {
                        // Skip script and style tags
                        const parent = node.parentElement;
                        if (!parent) return NodeFilter.FILTER_REJECT;
                        const tag = parent.tagName.toLowerCase();
                        if (tag === 'script' || tag === 'style' || tag === 'noscript') {
                            return NodeFilter.FILTER_REJECT;
                        }
                        // Skip if text is too short or only whitespace
                        if (node.textContent.trim().length < 2) {
                            return NodeFilter.FILTER_REJECT;
                        }
                        return NodeFilter.FILTER_ACCEPT;
                    }
                }
            );
            
            const textNodes = [];
            while (walker.nextNode()) {
                textNodes.push(walker.currentNode);
            }
            
            // Apply translations
            textNodes.forEach(node => {
                let text = node.textContent;
                let changed = false;
                
                for (const [original, replacement] of Object.entries(genAlphaDict)) {
                    if (text.includes(original)) {
                        text = text.split(original).join(replacement);
                        changed = true;
                    }
                }
                
                // Deduplicate "fr fr" - remove consecutive FR/fr occurrences
                if (changed) {
                    // Handle various cases: "fr fr", "FR FR", "fr FR", etc.
                    text = text.replace(/\bfr\s+fr\b/gi, 'fr');
                    text = text.replace(/\bno cap\s+no cap\b/gi, 'no cap');
                    node.textContent = text;
                }
            });
        }
        
        // Hook into page transitions to re-apply translations
        // (added to original goToPage via genAlphaHook)
        function genAlphaPageHook() {
            if (genAlphaMode) {
                setTimeout(translatePageContent, 50);
                // Show the rizz lore button on Owen's credits
                const rizzBtn = document.getElementById('rizzLoreBtn');
                if (rizzBtn) rizzBtn.style.display = 'inline-block';
            }
        }
        
        // Marcus Lore Dialog functions
        function showMarcusLoreDialog() {
            const dialog = document.getElementById('marcusLoreDialog');
            if (dialog) dialog.classList.add('active');
        }
        
        function closeMarcusLoreDialog() {
            const dialog = document.getElementById('marcusLoreDialog');
            if (dialog) dialog.classList.remove('active');
        }
        
        function showLorePage() {
            closeMarcusLoreDialog();
            goToPage('lorePage');
        }
        
        function scrollToCredits() {
            setTimeout(() => {
                const credits = document.getElementById('owenCredits');
                if (credits) credits.scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }
        
        function returnToOwenCredits() {
            // Remove dark mode for Owen's page (it has its own styling)
            document.body.classList.remove('dark-mode');
            
            // Go to Owen page
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('owenPage').classList.add('active');
            
            // Restore Owen's white overlay
            const owenWhiteOverlay = document.getElementById('owenWhiteOverlay');
            if (owenWhiteOverlay) {
                owenWhiteOverlay.style.display = '';
            }
            
            // Apply Gen Alpha translations if active
            if (typeof genAlphaPageHook === 'function') {
                genAlphaPageHook();
            }
            
            // Scroll to credits after a short delay
            setTimeout(() => {
                const credits = document.getElementById('owenCredits');
                if (credits) credits.scrollIntoView({ behavior: 'instant' });
            }, 50);
        }
        
        function revealLoreLog(logNum) {
            const log = document.getElementById('loreLog' + logNum);
            
            if (log.classList.contains('revealed')) return;
            
            // Play a subtle sound
            if (typeof playGlitchSound === 'function') {
                playGlitchSound();
            }
            
            log.classList.add('revealed');
        }
        
        // Notepad mode toggle for easier reading
        function toggleNotepadMode(pageId) {
            const page = document.getElementById(pageId);
            if (!page) return;
            
            const btn = page.querySelector('.notepad-toggle-btn');
            
            if (page.classList.contains('notepad-mode')) {
                page.classList.remove('notepad-mode');
                if (btn) btn.textContent = '📄 NOTEPAD VIEW';
            } else {
                page.classList.add('notepad-mode');
                if (btn) btn.textContent = '🌙 DARK VIEW';
            }
        }

        function toggleCheckbox() {
            const checkbox = document.getElementById('agreementCheckbox');
            const customCheckbox = document.getElementById('customCheckbox');
            checkbox.checked = !checkbox.checked;
            if (checkbox.checked) {
                customCheckbox.classList.add('checked');
            } else {
                customCheckbox.classList.remove('checked');
            }
            updateButton();
        }

        function updateButton() {
            const checkbox = document.getElementById('agreementCheckbox');
            const button = document.getElementById('understandBtn');
            if (checkbox.checked) {
                button.classList.add('enabled');
            } else {
                button.classList.remove('enabled');
            }
        }

        function startAssessment() {
            const checkbox = document.getElementById('agreementCheckbox');
            if (!checkbox.checked) return;
            
            goToPage('assessmentPage');
            document.getElementById('timer').classList.add('visible');
            document.getElementById('timerSpacer').classList.add('visible');
            startTimer();
        }

        let startTime;
        let timerInterval;
        
        function startTimer() {
            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);
            startTimerCycle();
        }
        
        // Cycling messages in timer
        const timerMessages = [
            { text: 'ACTIVE', isWarning: false },
            { text: 'MONITORING', isWarning: false },
            { text: 'RECORDING', isWarning: false },
            { text: 'TRACKING', isWarning: false },
            { text: 'LOGGING', isWarning: false },
            { text: 'ENABLED', isWarning: false }
        ];
        
        // Messages shown after calibration complete (not being watched)
        const disabledMessages = [
            { text: 'DISABLED', isWarning: false },
            { text: 'OFFLINE', isWarning: false },
            { text: 'SUSPENDED', isWarning: false },
            { text: 'INACTIVE', isWarning: false }
        ];
        
        let timerMessageIndex = 0;
        let timerCycleInterval = null;
        let monitoringDisabled = false;
        let calibrationComplete = false; // Track if calibration is done
        
        function startTimerCycle() {
            timerCycleInterval = setInterval(() => {
                if (!monitoringDisabled) {
                    // Use appropriate message array based on calibration state
                    const msgArray = calibrationComplete ? disabledMessages : timerMessages;
                    timerMessageIndex = (timerMessageIndex + 1) % msgArray.length;
                }
                updateTimerDisplay();
            }, 5000);
        }
        
        function updateTimerDisplay() {
            const timerEl = document.getElementById('timerCycleText');
            const statusIndicator = document.querySelector('.timer-status-indicator');
            const timerCenter = document.querySelector('.timer-center');
            
            // If monitoring is disabled, always show that
            if (monitoringDisabled) {
                timerEl.textContent = 'OFF';
                timerEl.classList.add('warning');
                timerEl.style.color = '#ffffff';
                timerEl.style.textShadow = '0 0 12px rgba(0, 0, 0, 0.2)';
                if (statusIndicator) {
                    statusIndicator.classList.add('warning');
                }
                return;
            }
            
            // If calibration is complete, show disabled messages with red styling
            if (calibrationComplete) {
                const msg = disabledMessages[timerMessageIndex % disabledMessages.length];
                timerEl.textContent = msg.text;
                timerEl.classList.remove('warning');
                // Apply disabled styling (dark red)
                if (timerCenter) timerCenter.classList.add('disabled');
                if (statusIndicator) {
                    statusIndicator.classList.remove('warning');
                    statusIndicator.classList.add('disabled');
                }
                return;
            }
            
            const msg = timerMessages[timerMessageIndex];
            
            if (msg.isWarning) {
                // Show warning - tracking is off (the clue!)
                timerEl.textContent = msg.text;
                timerEl.classList.add('warning');
                timerEl.style.color = '#e0e0e0';
                timerEl.style.textShadow = '0 0 10px rgba(0, 0, 0, 0.18)';
                if (statusIndicator) statusIndicator.classList.add('warning');
            } else {
                // Show normal status
                timerEl.textContent = msg.text;
                timerEl.classList.remove('warning');
                timerEl.style.color = '';
                timerEl.style.textShadow = '';
                if (statusIndicator) statusIndicator.classList.remove('warning');
            }
        }
        
        function setMonitoringDisabled() {
            monitoringDisabled = true;
            updateTimerDisplay();
        }
        
        function updateTimer() {
            let elapsed = Math.floor((Date.now() - startTime) / 1000);
            let minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
            let seconds = (elapsed % 60).toString().padStart(2, '0');
            const timeEl = document.getElementById('time');
            if (timeEl) {
                timeEl.textContent = `${minutes}:${seconds}`;
            }
        }
        
        // Scoring system - starts at 75%
        const totalQuestions = 12;
        const baseCompliance = 75;
        let currentCompliance = 75;
        let answeredQuestions = {};
        
        function selectOption(element, questionNum, isCorrect) {
            // Check if this question has already been answered
            if (answeredQuestions.hasOwnProperty(questionNum)) {
                // Already answered - do nothing
                return;
            }
            
            // On second playthrough (Owen), all answers are correct
            if (playthroughCount > 0) {
                isCorrect = true;
            }
            
            // Play appropriate sound based on answer
            if (isCorrect) {
                playCorrectSound();
            } else {
                playIncorrectSound();
            }
            
            const options = element.parentElement.querySelectorAll('li');
            
            // Mark the selected answer
            element.classList.add('selected');
            
            // Lock all options and show correct/wrong
            options.forEach(opt => {
                opt.classList.add('locked');
                opt.style.cursor = 'not-allowed';
                
                // On Owen's playthrough, only show the selected one as correct
                if (playthroughCount > 0) {
                    if (opt === element) {
                        opt.classList.add('correct-answer');
                    } else {
                        opt.classList.add('wrong-answer');
                    }
                } else {
                    // Check if this option is correct (has true in its onclick)
                    const onclickStr = opt.getAttribute('onclick') || '';
                    const optionIsCorrect = onclickStr.includes(', true)');
                    
                    if (optionIsCorrect) {
                        opt.classList.add('correct-answer');
                    } else {
                        opt.classList.add('wrong-answer');
                    }
                }
                
                opt.onclick = null;
            });
            
            // Record the answer
            answeredQuestions[questionNum] = isCorrect;
            
            // Update compliance score
            if (isCorrect) {
                currentCompliance = Math.min(100, currentCompliance + Math.floor(Math.random() * 3) + 2); // +2 to +4
            } else {
                currentCompliance = Math.max(0, currentCompliance - Math.floor(Math.random() * 4) - 3); // -3 to -6
            }
            
            // Update score display
            updateScoreDisplay();
        }
        
        function updateScoreDisplay() {
            const scoreEl = document.getElementById('score');
            const timerEl = document.getElementById('timer');
            
            scoreEl.textContent = currentCompliance;
            
            // Update color based on compliance level
            if (currentCompliance > 60) {
                timerEl.style.color = '';
                timerEl.style.borderColor = '';
            } else if (currentCompliance > 40) {
                // Gradually redder
                const redAmount = Math.round(255 - (currentCompliance - 40) * 5);
                timerEl.style.color = `rgb(${redAmount}, ${Math.round(redAmount * 0.6)}, ${Math.round(redAmount * 0.6)})`;
                timerEl.style.borderColor = `rgba(${redAmount}, 100, 100, 0.3)`;
            } else if (currentCompliance > 20) {
                // Even redder
                timerEl.style.color = '#cc4444';
                timerEl.style.borderColor = 'rgba(200, 50, 50, 0.4)';
            } else {
                // Critical red
                timerEl.style.color = '#ff3333';
                timerEl.style.borderColor = 'rgba(255, 50, 50, 0.5)';
            }
        }
        
        function penalizeSkipBreak() {
            currentCompliance = Math.max(0, currentCompliance - 10);
            updateScoreDisplay();
        }
        
        // Break page functionality
        let breakTimeRemaining = 150;
        let breakTimerInterval = null;
        let breakTimerStarted = false;
        let currentBreakActivity = null;
        
        function selectBreakOption(option, element) {
            // Hide all activities first
            document.getElementById('quietBreak').style.display = 'none';
            document.getElementById('blackjackBreak').style.display = 'none';
            document.getElementById('trainingBreak').style.display = 'none';
            
            // Update option styling - highlight selected, dim others
            document.querySelectorAll('#testbreak .break-option').forEach(opt => {
                opt.classList.remove('selected');
                opt.style.opacity = '0.6';
            });
            
            // Highlight the clicked option
            element.classList.add('selected');
            element.style.opacity = '1';
            
            // Show selected activity
            currentBreakActivity = option;
            let activityElement = null;
            if (option === 'quiet') {
                document.getElementById('quietBreak').style.display = 'block';
                activityElement = document.getElementById('quietBreak');
            } else if (option === 'blackjack') {
                document.getElementById('blackjackBreak').style.display = 'block';
                activityElement = document.getElementById('blackjackBreak');
            } else if (option === 'training') {
                document.getElementById('trainingBreak').style.display = 'block';
                activityElement = document.getElementById('trainingBreak');
            }
            
            // Show timer section and start timer only once
            document.getElementById('breakTimerSection').style.display = 'block';
            
            // Auto-scroll to the activity
            if (activityElement) {
                setTimeout(() => {
                    activityElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            }
            
            if (!breakTimerStarted) {
                breakTimerStarted = true;
                startBreakTimer();
            }
        }
        
        // ============ BREAK 2 SELECTION (Snake + Story) ============
        function selectBreak2Option(option, element) {
            // Hide all break 2 activities
            document.getElementById('snakeBreak').style.display = 'none';
            document.getElementById('antStoryBreak').style.display = 'none';
            document.getElementById('cohenStoryBreak').style.display = 'none';
            
            // Update option styling
            document.querySelectorAll('#testbreak2 .break-option').forEach(opt => {
                opt.classList.remove('selected');
                opt.style.opacity = '0.6';
            });
            
            element.classList.add('selected');
            element.style.opacity = '1';
            
            let activityElement = null;
            
            if (option === 'snake') {
                document.getElementById('snakeBreak').style.display = 'flex';
                activityElement = document.getElementById('snakeBreak');
                startBreakSnake();
            } else if (option === 'story') {
                // Show appropriate story based on player name
                if (playerName === 'OWEN' || playerName === 'WELLS' || playerName === 'WELLS, OWEN') {
                    document.getElementById('cohenStoryBreak').style.display = 'block';
                    activityElement = document.getElementById('cohenStoryBreak');
                } else {
                    document.getElementById('antStoryBreak').style.display = 'block';
                    activityElement = document.getElementById('antStoryBreak');
                }
            }
            
            // Show continue button
            document.getElementById('breakTimer2Section').style.display = 'block';
            
            // Auto-scroll to activity
            if (activityElement) {
                setTimeout(() => {
                    activityElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            }
        }
        
        // ============ BREAK SNAKE GAME (Vincent's style) ============
        let bsCanvas, bsCtx;
        let bsSnake, bsFood, bsDir, bsNextDir;
        let bsScore, bsHigh, bsGame;
        const bsSize = 15; // 300px canvas / 20 grid = 15px tiles
        const bsGrid = 20;
        
        function startBreakSnake() {
            bsCanvas = document.getElementById('breakSnakeCanvas');
            if (!bsCanvas) return;
            bsCtx = bsCanvas.getContext('2d');
            
            bsSnake = [{x: 10, y: 10}];
            bsDir = {x: 1, y: 0};
            bsNextDir = {x: 1, y: 0};
            bsScore = 0;
            bsHigh = parseInt(safeStorage.get('breakSnakeHigh', '0'));
            
            document.getElementById('breakSnakeScore').textContent = bsScore;
            document.getElementById('breakSnakeHigh').textContent = bsHigh;
            
            placeBreakSnakeFood();
            
            if (bsGame) clearInterval(bsGame);
            bsGame = setInterval(updateBreakSnake, 120);
            
            // Touch controls on canvas
            let touchStartX, touchStartY;
            bsCanvas.ontouchstart = (e) => {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
            };
            bsCanvas.ontouchend = (e) => {
                if (!touchStartX || !touchStartY) return;
                const dx = e.changedTouches[0].clientX - touchStartX;
                const dy = e.changedTouches[0].clientY - touchStartY;
                if (Math.abs(dx) > Math.abs(dy)) {
                    setBreakSnakeDir(dx > 0 ? 1 : -1, 0);
                } else {
                    setBreakSnakeDir(0, dy > 0 ? 1 : -1);
                }
            };
        }
        
        function closeSnakeModal() {
            // Stop the game
            if (bsGame) {
                clearInterval(bsGame);
                bsGame = null;
            }
            // Hide the modal
            document.getElementById('snakeBreak').style.display = 'none';
        }
        
        function resetBreakSnake() {
            // Stop current game
            if (bsGame) {
                clearInterval(bsGame);
                bsGame = null;
            }
            // Reset score (keep high score)
            bsScore = 0;
            document.getElementById('breakSnakeScore').textContent = bsScore;
            // Restart the game
            startBreakSnake();
        }
        
        function setBreakSnakeDir(x, y) {
            // Prevent 180 turns
            if (bsDir.x === -x && bsDir.y === -y) return;
            if (x !== 0 && bsDir.x !== 0) return;
            if (y !== 0 && bsDir.y !== 0) return;
            bsNextDir = {x, y};
        }
        
        function placeBreakSnakeFood() {
            bsFood = {
                x: Math.floor(Math.random() * bsGrid),
                y: Math.floor(Math.random() * bsGrid)
            };
            // Don't place on snake
            for (let seg of bsSnake) {
                if (seg.x === bsFood.x && seg.y === bsFood.y) {
                    placeBreakSnakeFood();
                    return;
                }
            }
        }
        
        function updateBreakSnake() {
            bsDir = bsNextDir;
            
            const head = {
                x: (bsSnake[0].x + bsDir.x + bsGrid) % bsGrid,
                y: (bsSnake[0].y + bsDir.y + bsGrid) % bsGrid
            };
            
            // Check collision with self
            for (let seg of bsSnake) {
                if (seg.x === head.x && seg.y === head.y) {
                    playSnakeDie();
                    clearInterval(bsGame);
                    if (bsScore > bsHigh) {
                        bsHigh = bsScore;
                        safeStorage.set('breakSnakeHigh', bsHigh);
                        document.getElementById('breakSnakeHigh').textContent = bsHigh;
                    }
                    // Restart after delay
                    setTimeout(startBreakSnake, 1000);
                    return;
                }
            }
            
            bsSnake.unshift(head);
            
            // Check food
            if (head.x === bsFood.x && head.y === bsFood.y) {
                playSnakeEat();
                bsScore += 10;
                document.getElementById('breakSnakeScore').textContent = bsScore;
                placeBreakSnakeFood();
            } else {
                bsSnake.pop();
            }
            
            drawBreakSnake();
        }
        
        function drawBreakSnake() {
            bsCtx.fillStyle = '#0a0a0a';
            bsCtx.fillRect(0, 0, bsCanvas.width, bsCanvas.height);
            
            // Draw food (red/coral to contrast with green snake)
            bsCtx.fillStyle = '#ff6b6b';
            bsCtx.shadowColor = '#ff6b6b';
            bsCtx.shadowBlur = 8;
            bsCtx.fillRect(bsFood.x * bsSize, bsFood.y * bsSize, bsSize - 1, bsSize - 1);
            bsCtx.shadowBlur = 0;
            
            // Draw snake
            for (let i = 0; i < bsSnake.length; i++) {
                const seg = bsSnake[i];
                if (i === 0) {
                    bsCtx.fillStyle = '#00ff88';
                    bsCtx.shadowColor = '#00ff88';
                    bsCtx.shadowBlur = 6;
                } else {
                    const brightness = Math.max(0.4, 1 - (i / bsSnake.length) * 0.5);
                    bsCtx.fillStyle = `rgba(0, 255, 136, ${brightness})`;
                    bsCtx.shadowBlur = 0;
                }
                bsCtx.fillRect(seg.x * bsSize, seg.y * bsSize, bsSize - 1, bsSize - 1);
            }
            bsCtx.shadowBlur = 0;
        }
        
        function startBreakTimer() {
            breakTimerInterval = setInterval(() => {
                breakTimeRemaining--;
                
                // Update small timer
                document.getElementById('breakTimer').textContent = breakTimeRemaining;
                
                // Update large timer if visible
                const largeTimer = document.getElementById('breakTimerLarge');
                if (largeTimer) {
                    const mins = Math.floor(breakTimeRemaining / 60).toString().padStart(2, '0');
                    const secs = (breakTimeRemaining % 60).toString().padStart(2, '0');
                    largeTimer.textContent = `${mins}:${secs}`;
                }
                
                if (breakTimeRemaining <= 0) {
                    endBreak();
                }
            }, 1000);
        }
        
        function attemptEndBreak() {
            document.getElementById('breakWarningModal').style.display = 'flex';
        }
        
        function closeBreakWarning() {
            document.getElementById('breakWarningModal').style.display = 'none';
        }
        
        function acknowledgeMonitoringFailure() {
            // Legacy - now first break uses normal warning
            closeBreakWarning();
            endBreak(true);
        }
        
        function forceEndBreak() {
            closeBreakWarning();
            // Penalty for skipping break - 10%
            penalizeSkipBreak();
            endBreak(true); // true = skipped
        }
        
        function endBreak(skipped = false) {
            clearInterval(breakTimerInterval);
            
            // Hide timer section and all activities
            document.getElementById('breakTimerSection').style.display = 'none';
            document.getElementById('quietBreak').style.display = 'none';
            document.getElementById('blackjackBreak').style.display = 'none';
            document.getElementById('trainingBreak').style.display = 'none';
            
            // Hide break options, notice, and rules
            const breakPage = document.getElementById('testbreak');
            const options = breakPage.querySelector('.break-options');
            const notice = breakPage.querySelector('.break-notice');
            const rules = breakPage.querySelector('.break-rules');
            if (options) options.style.display = 'none';
            if (notice) notice.style.display = 'none';
            if (rules) rules.style.display = 'none';
            
            // Show appropriate screen
            if (skipped) {
                document.getElementById('breakSkippedScreen').style.display = 'flex';
            } else {
                document.getElementById('breakOverScreen').style.display = 'flex';
            }
        }
        
        function continueAfterBreak() {
            document.getElementById('breakOverScreen').style.display = 'none';
            document.getElementById('breakSkippedScreen').style.display = 'none';
            // Reset break state for potential replay
            breakTimerStarted = false;
            breakTimeRemaining = 150;
            currentBreakActivity = null;
            nextTest(3);
        }
        
        // ============ BREAK 2 FUNCTIONALITY ============
        
        function endBreak2Early() {
            // Show monitoring failure popup
            document.getElementById('breakWarningModal2').style.display = 'flex';
        }
        
        function acknowledgeMonitoringFailure2() {
            document.getElementById('breakWarningModal2').style.display = 'none';
            // Update the nav tracking status to show monitoring is disabled
            setMonitoringDisabled();
            // Continue to section 4
            continueAfterBreak2();
        }
        
        function continueAfterBreak2() {
            nextTest(4);
        }
        
        // ============ BLACKJACK GAME ============
        let bjDeck = [];
        let bjPlayerHand = [];
        let bjDealerHand = [];
        let bjGameActive = false;
        let bjMoney = 347; // Starting balance - feels personal
        let bjCurrentBet = 50; // Default bet - matches selected chip
        
        function bjSelectBet(amount, btn) {
            bjCurrentBet = amount;
            
            // Update chip styling
            document.querySelectorAll('#bjBetRow .bj-chip').forEach(c => c.classList.remove('selected'));
            btn.classList.add('selected');
            
            // Update status
            document.getElementById('bjStatus').textContent = '$' + amount + ' selected • DEAL to play';
        }
        
        function bjUpdateMoney() {
            const moneyEl = document.getElementById('bjMoney');
            if (bjMoney >= 0) {
                moneyEl.textContent = '$' + bjMoney;
                moneyEl.classList.remove('negative');
            } else {
                moneyEl.textContent = '-$' + Math.abs(bjMoney);
                moneyEl.classList.add('negative');
            }
        }
        
        function createDeck() {
            const suits = ['S', 'H', 'D', 'C'];
            const values = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
            const deck = [];
            
            for (let suit of suits) {
                for (let value of values) {
                    deck.push({ value, suit, numValue: getCardValue(value) });
                }
            }
            
            return deck;
        }
        
        function getCardValue(value) {
            if (value === 'A') return 11;
            if (['J', 'Q', 'K'].includes(value)) return 10;
            return parseInt(value);
        }
        
        function shuffleDeck(deck) {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            return deck;
        }
        
        function calculateHand(hand) {
            let total = 0;
            let aces = 0;
            
            for (let card of hand) {
                total += card.numValue;
                if (card.value === 'A') aces++;
            }
            
            while (total > 21 && aces > 0) {
                total -= 10;
                aces--;
            }
            
            return total;
        }
        
        function displayCard(card, hidden = false) {
            if (hidden) {
                return `<div class="card hidden">?</div>`;
            }
            // Use actual suit symbols with colors - red for hearts/diamonds, black for spades/clubs
            const suitSymbols = { 'S': '♠', 'H': '♥', 'D': '♦', 'C': '♣' };
            const suitColors = { 'S': '#1a1a1a', 'H': '#ff6b6b', 'D': '#ff6b6b', 'C': '#1a1a1a' };
            const symbol = suitSymbols[card.suit];
            const color = suitColors[card.suit];
            return `<div class="card"><span class="card-value" style="color:${color}">${card.value}</span><span class="card-suit" style="color:${color}">${symbol}</span></div>`;
        }
        
        function updateDisplay(hideDealerCard = false) {
            const dealerCards = document.getElementById('dealerCards');
            const playerCards = document.getElementById('playerCards');
            const dealerValue = document.getElementById('dealerValue');
            const playerValue = document.getElementById('playerValue');
            
            // Display player hand
            playerCards.innerHTML = bjPlayerHand.map(card => displayCard(card)).join('');
            playerValue.textContent = calculateHand(bjPlayerHand);
            
            // Display dealer hand
            if (hideDealerCard && bjDealerHand.length > 0) {
                dealerCards.innerHTML = displayCard(bjDealerHand[0]) + displayCard(bjDealerHand[1], true);
                dealerValue.textContent = bjDealerHand[0].numValue;
            } else {
                dealerCards.innerHTML = bjDealerHand.map(card => displayCard(card)).join('');
                dealerValue.textContent = calculateHand(bjDealerHand);
            }
        }
        
        function dealBlackjack() {
            playBlackjackHit(); // Deal sound
            bjDeck = shuffleDeck(createDeck());
            
            // Deduct bet
            bjMoney -= bjCurrentBet;
            bjUpdateMoney();
            
            // RIGGED: Player gets a hand between 17-20 (never 21)
            let playerTotal = 0;
            bjPlayerHand = [];
            while (playerTotal < 17 || playerTotal >= 21) {
                bjPlayerHand = [bjDeck.pop(), bjDeck.pop()];
                playerTotal = calculateHand(bjPlayerHand);
            }
            
            // RIGGED: Dealer gets exactly playerTotal + 1 (always one higher)
            bjDealerHand = [];
            let dealerTotal = 0;
            const targetDealerTotal = playerTotal + 1;
            
            // Build dealer hand to hit exact target (max 4 cards to prevent too many)
            let attempts = 0;
            while (dealerTotal !== targetDealerTotal && attempts < 10) {
                bjDealerHand = [bjDeck.pop()];
                dealerTotal = calculateHand(bjDealerHand);
                
                // Add cards until we hit target (max 3 more cards)
                let cardCount = 1;
                while (dealerTotal < targetDealerTotal && bjDeck.length > 0 && cardCount < 4) {
                    const card = bjDeck.pop();
                    bjDealerHand.push(card);
                    cardCount++;
                    const newTotal = calculateHand(bjDealerHand);
                    
                    if (newTotal === targetDealerTotal) {
                        dealerTotal = newTotal;
                        break;
                    } else if (newTotal > targetDealerTotal) {
                        bjDealerHand.pop();
                        bjDeck = shuffleDeck(createDeck());
                        break;
                    } else {
                        dealerTotal = newTotal;
                    }
                }
                
                if (dealerTotal !== targetDealerTotal) {
                    bjDeck = shuffleDeck(createDeck());
                }
                attempts++;
            }
            
            bjGameActive = true;
            updateDisplay(true);
            
            // Show action buttons, hide bet buttons
            document.getElementById('bjStatus').textContent = 'HIT or STAND';
            document.getElementById('bjBetRow').classList.add('hidden');
            document.getElementById('bjActionRow').classList.remove('hidden');
        }
        
        function hitBlackjack() {
            if (!bjGameActive) return;
            playBlackjackHit(); // Hit sound
            
            // RIGGED: Find a card that won't give player 21
            let newCard;
            let attempts = 0;
            do {
                newCard = bjDeck.pop();
                if (!bjDeck.length) bjDeck = shuffleDeck(createDeck());
                attempts++;
                
                const testTotal = calculateHand([...bjPlayerHand, newCard]);
                if (testTotal !== 21 || attempts > 20) {
                    break;
                }
            } while (true);
            
            bjPlayerHand.push(newCard);
            updateDisplay(true);
            
            const playerTotal = calculateHand(bjPlayerHand);
            
            if (playerTotal > 21) {
                playBlackjackBust(); // Bust sound
                bjEndGame('BUST', false);
                updateDisplay(false);
            }
        }
        
        function standBlackjack() {
            if (!bjGameActive) return;
            playBlackjackStand(); // Stand sound
            
            bjGameActive = false;
            updateDisplay(false);
            
            // Owen always wins when standing (second playthrough)
            if (playthroughCount > 0) {
                // Force dealer to bust or lose (max 6 cards total)
                let cardCount = bjDealerHand.length;
                while (calculateHand(bjDealerHand) < 17 && cardCount < 6) {
                    bjDealerHand.push(bjDeck.pop());
                    cardCount++;
                }
                // If dealer didn't bust, make them draw until they bust (max 6 cards)
                while (calculateHand(bjDealerHand) <= 21 && calculateHand(bjDealerHand) >= calculateHand(bjPlayerHand) && cardCount < 6) {
                    bjDealerHand.push(bjDeck.pop());
                    cardCount++;
                }
                updateDisplay(false);
                
                const dealerTotal = calculateHand(bjDealerHand);
                if (dealerTotal > 21) {
                    playBlackjackWin();
                    bjEndGame('DEALER BUST', true);
                } else {
                    playBlackjackWin();
                    bjEndGame('YOU WIN', true);
                }
                return;
            }
            
            // Normal dealer play for first playthrough (max 6 cards)
            let cardCount = bjDealerHand.length;
            while (calculateHand(bjDealerHand) < 17 && cardCount < 6) {
                bjDealerHand.push(bjDeck.pop());
                cardCount++;
            }
            
            updateDisplay(false);
            
            const playerTotal = calculateHand(bjPlayerHand);
            const dealerTotal = calculateHand(bjDealerHand);
            
            if (dealerTotal > 21) {
                playBlackjackWin();
                bjEndGame('DEALER BUST', true);
            } else if (playerTotal > dealerTotal) {
                playBlackjackWin();
                bjEndGame('YOU WIN', true);
            } else if (dealerTotal > playerTotal) {
                playBlackjackLose();
                bjEndGame('FACILITY WINS', false);
            } else {
                bjEndGame('PUSH', null); // Tie - refund bet
            }
        }
        
        function bjEndGame(message, playerWon) {
            bjGameActive = false;
            
            // Handle money
            if (playerWon === true) {
                bjMoney += bjCurrentBet * 2; // Return bet + winnings
            } else if (playerWon === null) {
                bjMoney += bjCurrentBet; // Push - refund bet
            }
            // If playerWon === false, bet already deducted
            
            bjUpdateMoney();
            
            // Update status with result
            const statusEl = document.getElementById('bjStatus');
            statusEl.textContent = message;
            statusEl.classList.remove('win', 'lose');
            if (playerWon === true) statusEl.classList.add('win');
            if (playerWon === false) statusEl.classList.add('lose');
            
            // Return to bet selection after delay
            setTimeout(() => {
                document.getElementById('bjActionRow').classList.add('hidden');
                document.getElementById('bjBetRow').classList.remove('hidden');
                statusEl.textContent = '$' + bjCurrentBet + ' selected • DEAL to play';
                statusEl.classList.remove('win', 'lose');
            }, 1500);
        }
        
        let currentTest = 1;
        let amberRead = false;
        let greenRead = false;
        let forwardedToOwen = false;
        
        let hasSeenCrashReboot = false;
        
        function nextTest(testNum) {
            playSubmitSound(); // Play submit sound
            
            // Trigger crash/reboot the FIRST time they go to section 2 (after first leaked content)
            if (testNum === 2 && !hasSeenCrashReboot && playthroughCount === 0) {
                hasSeenCrashReboot = true;
                showSystemCrash(testNum);
                return;
            }
            
            proceedToTest(testNum);
        }
        
        function proceedToTest(testNum) {
            // Stop Section 3 ambient if leaving Section 3
            if (currentTest === 3) {
                stopSection3Ambient();
            }
            
            // Get current and next test elements
            let currentEl, nextEl;
            
            if (currentTest === 'break') {
                currentEl = document.getElementById('testbreak');
            } else if (currentTest === 'break2') {
                currentEl = document.getElementById('testbreak2');
            } else {
                currentEl = document.getElementById('test' + currentTest);
            }
            
            if (testNum === 'break') {
                nextEl = document.getElementById('testbreak');
            } else if (testNum === 'break2') {
                nextEl = document.getElementById('testbreak2');
            } else {
                nextEl = document.getElementById('test' + testNum);
            }
            
            // Fade out current, fade in next
            if (currentEl && nextEl && currentEl !== nextEl) {
                currentEl.style.opacity = '0';
                setTimeout(() => {
                    currentEl.classList.remove('active');
                    currentEl.style.opacity = '';
                    
                    nextEl.classList.add('active');
                    
                    if (testNum === 'break') {
                        currentTest = 'break';
                    } else if (testNum === 'break2') {
                        currentTest = 'break2';
                        // Reset break 2 - activities are now user-selected via options
                        document.getElementById('snakeBreak').style.display = 'none';
                        document.getElementById('antStoryBreak').style.display = 'none';
                        document.getElementById('cohenStoryBreak').style.display = 'none';
                        document.getElementById('breakTimer2Section').style.display = 'none';
                        // Reset option styling
                        document.querySelectorAll('#testbreak2 .break-option').forEach(opt => {
                            opt.classList.remove('selected');
                            opt.style.opacity = '1';
                        });
                    } else {
                        currentTest = testNum;
                        // Start Section 3 ambient when entering Section 3
                        if (testNum === 3) {
                            startSection3Ambient();
                        }
                    }
                    
                    // Re-apply RIZZ mode translations for new section
                    if (typeof genAlphaMode !== 'undefined' && genAlphaMode && typeof translatePageContent === 'function') {
                        setTimeout(translatePageContent, 100);
                    }
                    
                    window.scrollTo(0, 0);
                }, 150);
            } else {
                // Fallback for edge cases
                if (currentEl) currentEl.classList.remove('active');
                if (nextEl) nextEl.classList.add('active');
                
                if (testNum === 'break') {
                    currentTest = 'break';
                } else if (testNum === 'break2') {
                    currentTest = 'break2';
                    // Reset break 2 activities
                    document.getElementById('snakeBreak').style.display = 'none';
                    document.getElementById('antStoryBreak').style.display = 'none';
                    document.getElementById('cohenStoryBreak').style.display = 'none';
                    document.getElementById('breakTimer2Section').style.display = 'none';
                } else {
                    currentTest = testNum;
                    if (testNum === 3) {
                        startSection3Ambient();
                    }
                }
                
                // Re-apply RIZZ mode translations for new section
                if (typeof genAlphaMode !== 'undefined' && genAlphaMode && typeof translatePageContent === 'function') {
                    setTimeout(translatePageContent, 100);
                }
                
                window.scrollTo(0, 0);
            }
        }
        
        function showSystemCrash(nextTestNum) {
            startLoadingHum(); // Start the low hum
            
            // Create crash overlay
            const overlay = document.createElement('div');
            overlay.id = 'crashOverlay';
            overlay.className = 'owen-boot-overlay';
            document.body.appendChild(overlay);
            
            const terminal = document.createElement('div');
            terminal.className = 'boot-terminal';
            terminal.style.textAlign = 'center';
            overlay.appendChild(terminal);
            
            // Phase 1: Screen glitch and crash - FAST
            const crashLines = [
                { text: '█▓▒░ SYSTEM ERROR ░▒▓█', delay: 0, class: 'boot-error' },
                { text: 'MONITORING FAILURE', delay: 300, class: 'boot-error' },
                { text: 'Reconnecting...', delay: 600 },
                { text: 'FAILED', delay: 1000, class: 'boot-error' },
                { text: 'REBOOTING...', delay: 1300 },
            ];
            
            crashLines.forEach((line) => {
                setTimeout(() => {
                    if (line.text === '') return;
                    const lineEl = document.createElement('div');
                    lineEl.className = 'boot-line ' + (line.class || '');
                    lineEl.textContent = line.text;
                    terminal.appendChild(lineEl);
                    terminal.scrollTop = terminal.scrollHeight;
                }, line.delay);
            });
            
            // Phase 2: Black screen
            setTimeout(() => {
                terminal.innerHTML = '';
            }, 1800);
            
            // Phase 3: Reboot with systems OFFLINE
            setTimeout(() => {
                terminal.style.textAlign = 'left';
                showRebootSequence(terminal, overlay, nextTestNum);
            }, 2300);
        }
        
        function showRebootSequence(terminal, overlay, nextTestNum) {
            const terminalId = 'TRM-' + Math.random().toString(36).substr(2, 4).toUpperCase() + '-' + Math.floor(Math.random() * 900 + 100);
            
            const rebootLines = [
                { text: `TERMINAL ${terminalId}`, delay: 0, class: 'boot-terminal-id' },
                { text: 'EMERGENCY RESTART', delay: 150, class: 'boot-warning' },
                { text: '', delay: 300 },
                { text: '/// MONITORING ///', delay: 400, class: 'boot-section-header' },
                { html: 'Eye tracking.........<span class="boot-offline-text">OFFLINE</span>', delay: 550 },
                { html: 'Behavioral analysis..<span class="boot-offline-text">OFFLINE</span>', delay: 700 },
                { html: 'Content logging......<span class="boot-offline-text">SUSPENDED</span>', delay: 850 },
                { text: '', delay: 1000 },
                { text: 'Operating without oversight', delay: 1100, class: 'boot-warning' },
                { text: '', delay: 1300 },
                { text: 'CONTINUING ASSESSMENT', delay: 1400, class: 'boot-ready' },
                { text: '', delay: 1600 },
                { text: 'No one is watching.', delay: 1800, class: 'boot-glitch' },
            ];
            
            rebootLines.forEach((line) => {
                setTimeout(() => {
                    if (line.text === '' && !line.html) return;
                    const lineEl = document.createElement('div');
                    lineEl.className = 'boot-line ' + (line.class || '');
                    if (line.html) {
                        lineEl.innerHTML = line.html;
                    } else {
                        lineEl.textContent = line.text;
                    }
                    terminal.appendChild(lineEl);
                    terminal.scrollTop = terminal.scrollHeight;
                }, line.delay);
            });
            
            // Transition back to assessment
            setTimeout(() => {
                stopLoadingHum(); // Stop the hum
                overlay.classList.add('fading');
                setTimeout(() => {
                    overlay.remove();
                    // Update the nav to show tracking is now cycling through OFF messages
                    startTimerCycle();
                    // Start calibration mini-games before proceeding
                    startCalibrationSequence(nextTestNum);
                }, 600);
            }, 2800);
        }
        
        // Final sequence state
        let finalSequenceTimer = null;
        let finalTimeRemaining = 45;
        let blocksRevealed = 0;
        
        function startFinalSequence() {
            const overlay = document.getElementById('finalSequenceOverlay');
            const status = document.getElementById('finalStatus');
            const letter = document.getElementById('finalLetter');
            const instruction = document.getElementById('finalInstruction');
            const typingContainer = document.getElementById('finalTypingContainer');
            const plea = document.getElementById('finalPlea');
            const cursor = document.getElementById('typingCursor');
            const timerContainer = document.getElementById('finalTimerContainer');
            const timer = document.getElementById('finalTimer');
            const buttons = document.getElementById('finalButtons');
            const expired = document.getElementById('finalExpired');
            
            // Reset state
            finalTimeRemaining = 45;
            blocksRevealed = 0;
            status.textContent = 'ESTABLISHING SECURE CONNECTION...';
            letter.classList.remove('visible');
            instruction.classList.remove('visible', 'hidden');
            typingContainer.classList.remove('visible');
            plea.textContent = '';
            cursor.classList.remove('visible', 'hidden');
            timerContainer.classList.remove('visible');
            timer.classList.remove('urgent');
            buttons.classList.remove('visible');
            expired.classList.remove('visible');
            buttons.style.display = 'flex';
            expired.style.display = 'none';
            
            // Reset blocks
            for (let i = 1; i <= 3; i++) {
                document.getElementById('finalBlock' + i).classList.remove('revealed');
            }
            
            // Show overlay
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Sequence timing
            setTimeout(() => {
                status.textContent = 'CHANNEL SECURED · ENCRYPTION ACTIVE';
            }, 800);
            
            setTimeout(() => {
                status.textContent = 'TRANSMISSION RECEIVED · 3 ENCRYPTED BLOCKS';
            }, 1500);
            
            // Show letter with locked blocks
            setTimeout(() => {
                letter.classList.add('visible');
                instruction.classList.add('visible');
            }, 2200);
        }
        
        function revealBlock(blockNum) {
            const block = document.getElementById('finalBlock' + blockNum);
            
            // Don't reveal if already revealed or currently decrypting
            if (block.classList.contains('revealed') || block.classList.contains('decrypting')) return;
            
            // Add decrypting state
            block.classList.add('decrypting');
            
            // Get the locked div and add loading content
            const lockedDiv = block.querySelector('.final-block-locked');
            const originalContent = lockedDiv.innerHTML;
            
            // Show decryption animation
            lockedDiv.innerHTML = `
                <div class="decrypt-terminal">
                    <div class="decrypt-line">INIT DECRYPT_v4.7.2</div>
                    <div class="decrypt-line">KEY: ██████████████</div>
                    <div class="decrypt-progress-container">
                        <div class="decrypt-progress-bar" id="decryptBar${blockNum}"></div>
                    </div>
                    <div class="decrypt-status" id="decryptStatus${blockNum}">0%</div>
                </div>
            `;
            
            // Animate the progress bar
            const progressBar = document.getElementById('decryptBar' + blockNum);
            const statusText = document.getElementById('decryptStatus' + blockNum);
            let progress = 0;
            
            const progressInterval = setInterval(() => {
                progress += Math.random() * 15 + 5;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(progressInterval);
                    
                    // Show complete
                    statusText.textContent = 'COMPLETE';
                    statusText.style.color = 'var(--green)';
                    
                    // Reveal the block after a short delay
                    setTimeout(() => {
                        playGlitchSound(); // Add glitch sound
                        block.classList.remove('decrypting');
                        block.classList.add('revealed');
                        blocksRevealed++;
                        
                        // MONSTER EFFECTS FOR BLOCK 3
                        if (blockNum === 3) {
                            triggerMonsterReveal();
                            
                            // Flicker out MSG-003 after animation completes (9 seconds - reduced 25%)
                            setTimeout(() => {
                                block.classList.add('flicker-out');
                                // Completely hide after flicker animation
                                setTimeout(() => {
                                    block.classList.add('hidden-complete');
                                }, 1500);
                            }, 9000);
                        }
                        
                        // Update status
                        const status = document.getElementById('finalStatus');
                        status.textContent = `DECRYPTED ${blocksRevealed}/3 BLOCKS`;
                        
                        // Check if all blocks revealed
                        if (blocksRevealed === 3) {
                            setTimeout(() => {
                                allBlocksRevealed();
                            }, 500);
                        }
                    }, 300);
                }
                progressBar.style.width = progress + '%';
                if (progress < 100) {
                    statusText.textContent = Math.floor(progress) + '%';
                }
            }, 80);
        }
        
        // HORSE containment log reveal function
        function revealHorseLog(logNum) {
            const log = document.getElementById('horseLog' + logNum);
            
            if (log.classList.contains('revealed')) return;
            
            // Play a subtle sound
            if (typeof playGlitchSound === 'function') {
                playGlitchSound();
            }
            
            log.classList.add('revealed');
        }
        
        function allBlocksRevealed() {
            playNotificationSound(); // Soft notification that all blocks are decrypted
            const status = document.getElementById('finalStatus');
            const instruction = document.getElementById('finalInstruction');
            const typingContainer = document.getElementById('finalTypingContainer');
            const cursor = document.getElementById('typingCursor');
            
            status.textContent = 'TRANSMISSION COMPLETE · AWAITING RESPONSE';
            instruction.classList.add('hidden');
            
            // Show typing container and start typing
            setTimeout(() => {
                typingContainer.classList.add('visible');
                cursor.classList.add('visible');
                typePlea();
            }, 600);
        }
        
        function typePlea() {
            const plea = document.getElementById('finalPlea');
            const cursor = document.getElementById('typingCursor');
            const timerContainer = document.getElementById('finalTimerContainer');
            const buttons = document.getElementById('finalButtons');
            
            // Hide the typing container entirely - no message needed
            const typingContainer = document.getElementById('finalTypingContainer');
            if (typingContainer) typingContainer.style.display = 'none';
            
            // Show timer and buttons after a brief pause
            setTimeout(() => {
                timerContainer.classList.add('visible');
                buttons.classList.add('visible');
                startFinalTimer();
                
                // Auto-scroll overlay to show buttons at bottom
                setTimeout(() => {
                    const overlay = document.getElementById('finalSequenceOverlay');
                    if (overlay) {
                        // Scroll the overlay itself to the bottom
                        overlay.scrollTo({
                            top: overlay.scrollHeight,
                            behavior: 'smooth'
                        });
                    }
                    // Also try scrollIntoView as backup
                    buttons.scrollIntoView({ behavior: 'smooth', block: 'end' });
                }, 300);
            }, 800);
        }
        
        function startFinalTimer() {
            const timer = document.getElementById('finalTimer');
            const buttons = document.getElementById('finalButtons');
            const expired = document.getElementById('finalExpired');
            
            finalSequenceTimer = setInterval(() => {
                finalTimeRemaining--;
                
                const mins = Math.floor(finalTimeRemaining / 60);
                const secs = finalTimeRemaining % 60;
                timer.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
                
                // Urgent state at 15 seconds
                if (finalTimeRemaining <= 15) {
                    timer.classList.add('urgent');
                }
                
                // Time expired
                if (finalTimeRemaining <= 0) {
                    clearInterval(finalSequenceTimer);
                    buttons.style.display = 'none';
                    expired.style.display = 'block';
                    setTimeout(() => {
                        expired.classList.add('visible');
                    }, 100);
                    
                    // After showing expired, trigger the "didn't forward" ending
                    setTimeout(() => {
                        closeFinalSequence();
                        submitWithoutForward();
                    }, 3000);
                }
            }, 1000);
        }
        
        function closeFinalSequence() {
            const overlay = document.getElementById('finalSequenceOverlay');
            overlay.classList.remove('active');
            document.body.style.overflow = '';
            if (finalSequenceTimer) {
                clearInterval(finalSequenceTimer);
                finalSequenceTimer = null;
            }
        }
        
        // Forward choice functions
        function submitWithForward() {
            playChoiceSound(); // Play significant choice sound
            stopMonsterAudio(); // Stop the monster rumble
            closeFinalSequence();
            // They trusted Vincent blindly - they forwarded to Owen
            forwardedToOwen = true;
            
            // Hide the forward choice area
            document.getElementById('forwardChoice').style.display = 'none';
            
            // Create modal overlay for upload sequence
            const modalOverlay = document.createElement('div');
            modalOverlay.className = 'upload-modal-overlay';
            modalOverlay.id = 'uploadModalOverlay';
            modalOverlay.innerHTML = `
                <div class="upload-sequence" id="uploadSequence">
                    <div class="upload-header">
                        <span class="upload-header-text">INITIALIZING EXTERNAL TRANSMISSION</span>
                        <span class="upload-header-blink">●</span>
                    </div>
                    
                    <div class="upload-terminal" id="uploadTerminal">
                        <!-- Messages will be added here -->
                    </div>
                    
                    <div class="upload-progress-container">
                        <div class="upload-progress-label">UPLOAD PROGRESS</div>
                        <div class="upload-progress-bar-bg">
                            <div class="upload-progress-bar" id="uploadProgressBar"></div>
                        </div>
                        <div class="upload-progress-percent" id="uploadPercent">0%</div>
                    </div>
                    
                    <div class="upload-status" id="uploadStatus">ESTABLISHING CONNECTION...</div>
                </div>
            `;
            
            document.body.appendChild(modalOverlay);
            
            // Start the upload sequence
            startUploadSequence();
        }
        
        function startUploadSequence() {
            const terminal = document.getElementById('uploadTerminal');
            const progressBar = document.getElementById('uploadProgressBar');
            const percentText = document.getElementById('uploadPercent');
            const statusText = document.getElementById('uploadStatus');
            
            const uploadMessages = [
                { text: '> Establishing secure tunnel...', delay: 0, type: 'normal' },
                { text: '> Tunnel established: AUDIT_PATHWAY_7734B', delay: 400, type: 'success' },
                { text: '> Bypassing internal firewall...', delay: 800, type: 'normal' },
                { text: '> Firewall bypassed [TRACE: DISABLED]', delay: 1300, type: 'success' },
                { text: '> Connecting to external registry...', delay: 1700, type: 'normal' },
                { text: '> Domain lookup: RABBITTEST.IO', delay: 2100, type: 'normal' },
                { text: '> Domain status: AVAILABLE', delay: 2500, type: 'success' },
                { text: '> Initiating domain registration...', delay: 2900, type: 'normal' },
                { text: '> REGISTRAR: ██████████ NETWORKS', delay: 3200, type: 'dim' },
                { text: '> Payment method: [FACILITY CREDIT INTERCEPTED]', delay: 3500, type: 'warning' },
                { text: '> Domain registered: RABBITTEST.IO', delay: 4000, type: 'success' },
                { text: '> Configuring DNS records...', delay: 4400, type: 'normal' },
                { text: '>   A     @      → 104.21.██.███', delay: 4700, type: 'dim' },
                { text: '>   AAAA  @      → 2606:4700:████:████', delay: 4900, type: 'dim' },
                { text: '>   CNAME www    → rabbittest.io', delay: 5100, type: 'dim' },
                { text: '> DNS propagation: IN PROGRESS', delay: 5400, type: 'normal' },
                { text: '> Allocating server resources...', delay: 5800, type: 'normal' },
                { text: '> Server: EDGE-NODE-7734 [EXTERNAL]', delay: 6200, type: 'success' },
                { text: '> Compiling assessment data...', delay: 6600, type: 'normal' },
                { text: '>   index.html .............. 847 KB', delay: 6900, type: 'dim' },
                { text: '>   embedded_letters.dat .... 12 KB', delay: 7100, type: 'dim' },
                { text: '>   audio_track3.mp3 ....... 2.2 MB', delay: 7300, type: 'dim' },
                { text: '>   manifest.json ........... 1 KB', delay: 7500, type: 'dim' },
                { text: '> Encrypting payload...', delay: 7800, type: 'normal' },
                { text: '> Encryption: AES-256 [COMPLETE]', delay: 8200, type: 'success' },
                { text: '> Uploading to external server...', delay: 8600, type: 'normal' },
                { text: '> ████████████████████ 100%', delay: 9500, type: 'progress' },
                { text: '> Upload complete: 3.1 MB transferred', delay: 10000, type: 'success' },
                { text: '> Verifying file integrity...', delay: 10400, type: 'normal' },
                { text: '> Checksum: VERIFIED', delay: 10800, type: 'success' },
                { text: '> Enabling public access...', delay: 11200, type: 'normal' },
                { text: '> SSL certificate: ISSUED', delay: 11500, type: 'success' },
                { text: '> HTTPS enabled: https://rabbittest.io', delay: 11800, type: 'success' },
                { text: '> Clearing local traces...', delay: 12200, type: 'normal' },
                { text: '> Audit logs: PURGED', delay: 12500, type: 'warning' },
                { text: '> Session data: DESTROYED', delay: 12800, type: 'warning' },
                { text: '> ', delay: 13100, type: 'normal' },
                { text: '> ════════════════════════════', delay: 13300, type: 'divider' },
                { text: '> DEPLOYMENT SUCCESSFUL', delay: 13600, type: 'mega' },
                { text: '> ════════════════════════════', delay: 13800, type: 'divider' },
                { text: '> ', delay: 14000, type: 'normal' },
                { text: '> Site live at: https://rabbittest.io', delay: 14200, type: 'final' },
                { text: '> Status: ACCESSIBLE WORLDWIDE', delay: 14500, type: 'final' },
                { text: '> ', delay: 14800, type: 'normal' },
                { text: '> i̷̧\'̷m̶ ̵o̷u̴t̶', delay: 15200, type: 'glitch' },
            ];
            
            let currentProgress = 0;
            const progressSteps = [
                { percent: 5, delay: 500 },
                { percent: 12, delay: 1500 },
                { percent: 18, delay: 2500 },
                { percent: 25, delay: 3500 },
                { percent: 35, delay: 4500 },
                { percent: 42, delay: 5500 },
                { percent: 55, delay: 6500 },
                { percent: 68, delay: 7500 },
                { percent: 78, delay: 8500 },
                { percent: 88, delay: 9500 },
                { percent: 95, delay: 10500 },
                { percent: 100, delay: 11500 },
            ];
            
            // Animate progress bar
            progressSteps.forEach(step => {
                setTimeout(() => {
                    progressBar.style.width = step.percent + '%';
                    percentText.textContent = step.percent + '%';
                    
                    if (step.percent < 30) {
                        statusText.textContent = 'ESTABLISHING CONNECTION...';
                    } else if (step.percent < 50) {
                        statusText.textContent = 'REGISTERING DOMAIN...';
                    } else if (step.percent < 70) {
                        statusText.textContent = 'CONFIGURING SERVER...';
                    } else if (step.percent < 90) {
                        statusText.textContent = 'UPLOADING FILES...';
                    } else if (step.percent < 100) {
                        statusText.textContent = 'FINALIZING...';
                    } else {
                        statusText.textContent = 'DEPLOYMENT COMPLETE';
                        statusText.style.color = '#e8707e';
                        statusText.style.textShadow = '0 0 15px rgba(232, 112, 126, 0.6)';
                        statusText.style.animation = 'none';
                    }
                }, step.delay);
            });
            
            // Add terminal messages
            uploadMessages.forEach(msg => {
                setTimeout(() => {
                    const line = document.createElement('div');
                    line.className = 'upload-line upload-line-' + msg.type;
                    line.textContent = msg.text;
                    terminal.appendChild(line);
                    terminal.scrollTop = terminal.scrollHeight;
                    
                    // Play subtle sound for important messages
                    if (msg.type === 'success' || msg.type === 'mega') {
                        playTypeSound();
                    }
                    if (msg.type === 'glitch') {
                        // One final glitch sound
                        playRevealSound();
                    }
                }, msg.delay);
            });
            
            // After sequence completes, show the green text
            setTimeout(() => {
                playSuccessSound();
                
                setTimeout(() => {
                    // Remove the upload modal overlay
                    const uploadModal = document.getElementById('uploadModalOverlay');
                    if (uploadModal) {
                        uploadModal.style.opacity = '0';
                        uploadModal.style.transition = 'opacity 0.5s ease';
                        setTimeout(() => {
                            uploadModal.remove();
                        }, 500);
                    }
                    document.getElementById('greenTextSection').style.display = 'block';
                    // Change the green text to reflect they forwarded
                    document.getElementById('greenTextStranger').innerHTML = `
                        <div class="filler-text" style="color: #666666;">
                        SIMULATION COMPLETE<br>
                        BEHAVIORAL ANALYSIS: LOGGED<br>
                        ════════════════════════════<br><br>
                        </div>
                        
                        RE: ASSESSMENT RESULTS<br><br>
                        
                        Congratulations.<br><br>
                        
                        <span id="greenTriggerPoint2"></span>This assessment was designed to identify employees capable of exercising judgment beyond protocol. Most employees follow instructions. Most employees report anomalies. Most employees protect themselves.<br><br>
                        
                        <span class="you-flicker">You</span> did not.<br><br>
                        
                        This indicates either exceptional empathy or exceptional naivety. Both are useful, depending on application. The Facility does not distinguish between them.<br><br>
                        
                        <span class="you-flicker">Your</span> compliance score has been noted. <span class="you-flicker">Your</span> willingness to act has been noted. <span class="you-flicker">Your</span> file has been forwarded to the Department of Special Projects.<br><br>
                        
                        <div class="result-inline">
                            <span class="result-inline-label">STATUS:</span> <span class="result-inline-value result-inline-passed">PASSED</span><br>
                            <span class="result-inline-label">CLASSIFICATION:</span> <span class="result-inline-detail">RABBITTEST.IO — ASSESSMENT COMPLETE</span>
                        </div><br>
                        
                        <span class="c-facility">NOTICE OF PROMOTION — EFFECTIVE IMMEDIATELY</span><br><br>
                        
                        Report to <span class="c-facility">Corridor 7, Room 114</span> within the next 3 hours. Bring nothing. Tell no one.<br><br>
                        
                        This assignment is mandatory.<br><br>
                    `;
                    window.scrollTo({ top: document.getElementById('greenTextSection').offsetTop, behavior: 'smooth' });
                }, 1500);
            }, 16000);
        }
        
        function submitWithoutForward() {
            playClickSound(); // Simple click for not forwarding
            stopMonsterAudio(); // Stop the monster rumble
            closeFinalSequence();
            // They didn't trust Vincent - show the green text
            document.getElementById('forwardChoice').style.display = 'none';
            document.getElementById('greenTextSection').style.display = 'block';
            window.scrollTo({ top: document.getElementById('greenTextSection').offsetTop, behavior: 'smooth' });
        }
        
        function finalSubmit() {
            stopGlitchEffects();
            
            // Show processing message
            document.getElementById('endingContent').innerHTML = `
                <div style="text-align: center; padding: 60px 20px;">
                    <div style="font-family: 'Space Mono', monospace; font-size: 1.2rem; letter-spacing: 4px; color: var(--text-dim);">
                        PROCESSING RESULTS...
                    </div>
                </div>
            `;
            
            // Switch to ending page
            goToPage('endingPage');
            
            setTimeout(showEnding, 3000);
        }
        
        const observerOptions = {
            threshold: 0.3
        };
        
        const observer = new SafeIntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.target.dataset.forbidden === 'amber' && entry.isIntersecting) {
                    setTimeout(() => {
                        if (entry.isIntersecting) {
                            amberRead = true;
                        }
                    }, 1500);
                }
            });
        }, observerOptions);
        
        // Separate observer for green text trigger point - more sensitive
        const greenTriggerObserver = new SafeIntersectionObserver((entries) => {
            entries.forEach(entry => {
                if ((entry.target.id === 'greenTriggerPoint' || entry.target.id === 'greenTriggerPoint2' || entry.target.id === 'greenTriggerPointOwen') && entry.isIntersecting) {
                    // They've scrolled deep enough into the green text to read the accusation
                    greenRead = true;
                    startGlitchEffects();
                }
            });
        }, { threshold: 0.1 });
        
        // Glitch effects for green text reading
        let glitchInterval = null;
        let complianceDropInterval = null;
        
        function startGlitchEffects() {
            if (glitchInterval) return; // Already running
            
            const scoreEl = document.getElementById('score');
            const timerEl = document.getElementById('timer');
            const greenText = document.querySelector('[data-forbidden="green"]');
            let fakeScore = parseInt(scoreEl.textContent);
            
            // Start random glitch effects - less frequent
            glitchInterval = setInterval(() => {
                const effect = Math.random();
                
                if (effect < 0.15) {
                    // Screen flicker - reduced frequency
                    document.body.classList.add('glitch-active');
                    setTimeout(() => document.body.classList.remove('glitch-active'), 150);
                } else if (effect < 0.3) {
                    // Score jitter
                    scoreEl.parentElement.classList.add('score-glitching');
                    setTimeout(() => scoreEl.parentElement.classList.remove('score-glitching'), 300);
                } else if (effect < 0.45) {
                    // Random score fluctuation
                    const fluctuation = Math.floor(Math.random() * 10) - 5;
                    const displayScore = Math.max(0, Math.min(100, fakeScore + fluctuation));
                    scoreEl.textContent = displayScore;
                    setTimeout(() => scoreEl.textContent = fakeScore, 200);
                } else if (effect < 0.6) {
                    // Highlight random letters in green text
                    highlightRandomLetters(greenText);
                } else if (effect < 0.7) {
                    // Brief background flash - much less frequent now
                    document.body.classList.add('screen-flash');
                    setTimeout(() => document.body.classList.remove('screen-flash'), 150);
                } else {
                    // Flicker "read" words to death color
                    flickerReadWords();
                }
            }, 1200);  // Slower interval overall
            
            // Slowly drop compliance score
            complianceDropInterval = setInterval(() => {
                if (fakeScore > 15) {
                    fakeScore -= Math.floor(Math.random() * 3) + 1;
                    scoreEl.textContent = fakeScore;
                    
                    if (fakeScore < 50) {
                        timerEl.classList.add('compliance-dropping');
                    }
                }
            }, 2000);
        }
        
        function highlightRandomLetters(container) {
            if (!container) return;
            
            const textNodes = [];
            const walker = document.createTreeWalker(container, NodeFilter.SHOW_TEXT, null, false);
            while (walker.nextNode()) {
                if (walker.currentNode.textContent.trim()) {
                    textNodes.push(walker.currentNode);
                }
            }
            
            if (textNodes.length === 0) return;
            
            // Pick a random text node
            const randomNode = textNodes[Math.floor(Math.random() * textNodes.length)];
            const text = randomNode.textContent;
            
            if (text.length < 3) return;
            
            // Pick random position
            const startPos = Math.floor(Math.random() * (text.length - 2));
            const length = Math.min(3, text.length - startPos);
            
            // Create highlighted span
            const before = text.substring(0, startPos);
            const highlight = text.substring(startPos, startPos + length);
            const after = text.substring(startPos + length);
            
            const span = document.createElement('span');
            span.className = 'glitch-letter';
            span.textContent = highlight;
            
            const parent = randomNode.parentNode;
            const frag = document.createDocumentFragment();
            frag.appendChild(document.createTextNode(before));
            frag.appendChild(span);
            frag.appendChild(document.createTextNode(after));
            
            parent.replaceChild(frag, randomNode);
            
            // Remove the span after animation
            setTimeout(() => {
                if (span.parentNode) {
                    span.parentNode.replaceChild(document.createTextNode(highlight), span);
                }
            }, 400);
        }
        
        // Flicker words containing "read" to death red color
        function flickerReadWords() {
            const test6 = document.getElementById('test6');
            if (!test6 || !test6.classList.contains('active')) return;
            
            const greenText = test6.querySelector('.green-text');
            if (!greenText) return;
            
            // Find all text content and look for "read" variations
            const readPatterns = ['read', 'Read', 'READ', 'reading', 'Reading'];
            const allText = greenText.querySelectorAll('*');
            
            allText.forEach(el => {
                if (el.children.length === 0 && el.textContent) {
                    readPatterns.forEach(pattern => {
                        if (el.textContent.includes(pattern) && Math.random() < 0.3) {
                            const originalColor = el.style.color || '';
                            el.style.color = '#8b0000';
                            el.style.textShadow = '0 0 8px rgba(139, 0, 0, 0.6)';
                            
                            // Flicker back at random time
                            const flickerBack = 150 + Math.random() * 300;
                            setTimeout(() => {
                                el.style.color = originalColor;
                                el.style.textShadow = '';
                            }, flickerBack);
                        }
                    });
                }
            });
        }
        
        function stopGlitchEffects() {
            if (glitchInterval) {
                clearInterval(glitchInterval);
                glitchInterval = null;
            }
            if (complianceDropInterval) {
                clearInterval(complianceDropInterval);
                complianceDropInterval = null;
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            // ════════════════════════════════════
            // IMMERSION INITIALIZATION - Safari address bar & mobile optimizations
            // ════════════════════════════════════
            
            // Scroll body slightly to help hide Safari address bar
            setTimeout(() => {
                if (window.scrollY === 0) {
                    window.scrollTo(0, 1);
                }
            }, 100);
            
            // Request wake lock to prevent screen dimming (if supported)
            if ('wakeLock' in navigator) {
                let wakeLock = null;
                const requestWakeLock = async () => {
                    try {
                        wakeLock = await navigator.wakeLock.request('screen');
                    } catch (err) {
                        // Wake lock not available, silently fail
                    }
                };
                requestWakeLock();
                
                // Re-request on visibility change
                document.addEventListener('visibilitychange', () => {
                    if (document.visibilityState === 'visible') {
                        requestWakeLock();
                    }
                });
            }
            
            // Detect standalone mode (added to home screen)
            if (window.navigator.standalone === true || window.matchMedia('(display-mode: standalone)').matches) {
                document.body.classList.add('standalone-mode');
            }
            
            // ════════════════════════════════════
            
            // Initialize score display at 75%
            document.getElementById('score').textContent = currentCompliance;
            
            // Initialize employee display (redacted on first play)
            updateEmployeeDisplay();
            
            // Animate title page timestamp
            animateTitleTimestamp();
            
            document.querySelectorAll('[data-forbidden="amber"]').forEach(el => {
                observer.observe(el);
                el.addEventListener('mousedown', () => {
                    amberRead = true;
                });
            });
            
            // Set up green text trigger
            const greenTrigger = document.getElementById('greenTriggerPoint');
            if (greenTrigger) {
                greenTriggerObserver.observe(greenTrigger);
            }
            
            // Also observe second green trigger point
            const greenTrigger2 = document.getElementById('greenTriggerPoint2');
            if (greenTrigger2) {
                greenTriggerObserver.observe(greenTrigger2);
            }
            
            // Also observe Owen's green trigger point
            const greenTriggerOwen = document.getElementById('greenTriggerPointOwen');
            if (greenTriggerOwen) {
                greenTriggerObserver.observe(greenTriggerOwen);
            }
            
            // Also trigger on any interaction with green text
            const greenText = document.querySelector('[data-forbidden="green"]');
            if (greenText) {
                greenText.addEventListener('mousedown', () => {
                    greenRead = true;
                });
                greenText.addEventListener('touchstart', () => {
                    greenRead = true;
                });
            }
        });
        
        // Animate the title page timestamp with typing effect
        function animateTitleTimestamp() {
            const timestampEl = document.getElementById('titleTimestamp');
            if (!timestampEl) return;
            
            // Show last update date: 1/28/26 2:32 AM
            const fullTimestamp = `LAST UPDATE: 01.28.████ — 02:32 PST`;
            let index = 0;
            
            // Start after boot animation
            setTimeout(() => {
                const typeInterval = setInterval(() => {
                    if (index <= fullTimestamp.length) {
                        timestampEl.textContent = fullTimestamp.substring(0, index) + (index < fullTimestamp.length ? '█' : '');
                        index++;
                    } else {
                        clearInterval(typeInterval);
                        // No real-time updates needed for static timestamp
                    }
                }, 40);
            }, 800);
        }
        
        // ============ CALIBRATION MINI-GAMES ============
        var calibrationState = {
            currentGame: 0,
            totalGames: 3,
            scores: [],
            nextTestNum: null,
            onComplete: null
        };
        
        function startCalibrationSequence(nextTestNum) {
            calibrationState.currentGame = 0;
            calibrationState.scores = [];
            calibrationState.nextTestNum = nextTestNum;
            
            var overlay = document.getElementById('calibrationOverlay');
            var content = document.getElementById('calibrationContent');
            var progress = document.getElementById('calibrationProgress');
            var status = document.getElementById('calibrationStatus');
            
            if (!overlay) return;
            
            progress.style.width = '0%';
            status.textContent = 'INITIALIZING NEURAL LINK...';
            content.innerHTML = '';
            
            overlay.classList.add('active');
            
            setTimeout(function() {
                startCalibrationGame(0);
            }, 1500);
        }
        
        function startCalibrationGame(gameIndex) {
            var content = document.getElementById('calibrationContent');
            var status = document.getElementById('calibrationStatus');
            var progress = document.getElementById('calibrationProgress');
            
            calibrationState.currentGame = gameIndex;
            progress.style.width = ((gameIndex / calibrationState.totalGames) * 100) + '%';
            
            if (gameIndex === 0) {
                status.textContent = 'CALIBRATING RESPONSE TIME...';
                startSyncPulseGame(content);
            } else if (gameIndex === 1) {
                status.textContent = 'TUNING FREQUENCY SENSITIVITY...';
                startFrequencyLockGame(content);
            } else if (gameIndex === 2) {
                status.textContent = 'ESTABLISHING NEURAL HANDSHAKE...';
                startNeuralHandshakeGame(content);
            } else {
                completeCalibration();
            }
        }
        
        // GAME 1: Sync Pulse - Press when expanding ring matches target
        function startSyncPulseGame(container) {
            container.innerHTML = 
                '<div class="calibration-game-title"><span style="color: #00d4ff;">SYNC</span> PULSE</div>' +
                '<div class="calibration-instruction" style="color: #00d4ff;">Tap SYNC at the bright ring</div>' +
                '<div class="calibration-game-area" id="syncGameArea">' +
                    '<div class="sync-feedback" id="syncFeedback"></div>' +
                    '<div class="sync-attempts" id="syncAttempts">1 / 3</div>' +
                    '<div class="sync-pulse-container">' +
                        '<div class="sync-pulse-ring"></div>' +
                        '<div class="sync-pulse-target"></div>' +
                        '<div class="sync-pulse-wave" id="syncWave"></div>' +
                    '</div>' +
                    '<button class="sync-pulse-btn" id="syncBtn">SYNC</button>' +
                '</div>';
            
            var syncAttempts = 0;
            var syncHits = 0;
            var maxAttempts = 3;
            var waveEl = document.getElementById('syncWave');
            var feedbackEl = document.getElementById('syncFeedback');
            var attemptsEl = document.getElementById('syncAttempts');
            var btnEl = document.getElementById('syncBtn');
            var animationStart = null;
            var cycleDuration = 2000;
            var gameActive = true;
            
            function updateAttempts() {
                attemptsEl.textContent = (syncAttempts + 1) + ' / ' + maxAttempts;
            }
            
            function showFeedback(text, className) {
                feedbackEl.textContent = text;
                feedbackEl.className = 'sync-feedback show ' + className;
                setTimeout(function() {
                    feedbackEl.classList.remove('show');
                }, 800);
            }
            
            function checkSync() {
                if (!gameActive) return;
                
                var now = Date.now();
                var elapsed = (now - animationStart) % cycleDuration;
                var progress = elapsed / cycleDuration;
                
                // Target zone for MIDDLE ring (100px target)
                // With linear animation 20px→200px, 100px is at ~44% progress
                // Perfect: 40-50%, Good: 33-57%
                var perfectZone = progress >= 0.40 && progress <= 0.50;
                var goodZone = progress >= 0.33 && progress <= 0.57;
                
                syncAttempts++;
                updateAttempts();
                
                if (perfectZone) {
                    syncHits += 2;
                    showFeedback('PERFECT', 'perfect');
                    playSyncPerfect(); // Bright sparkle
                } else if (goodZone) {
                    syncHits += 1;
                    showFeedback('GOOD', 'good');
                    playSyncGood(); // Soft chime
                } else {
                    showFeedback('MISS', 'miss');
                    playSyncMiss(); // Gentle thud
                }
                
                if (syncAttempts >= maxAttempts) {
                    gameActive = false;
                    var score = Math.min(100, Math.round((syncHits / (maxAttempts * 2)) * 100));
                    calibrationState.scores.push(score);
                    
                    setTimeout(function() {
                        startCalibrationGame(1);
                    }, 1000);
                }
            }
            
            animationStart = Date.now();
            btnEl.addEventListener('click', checkSync);
        }
        
        // GAME 2: Frequency Lock - Adjust frequency to match target
        function startFrequencyLockGame(container) {
            container.innerHTML = 
                '<div class="calibration-game-title"><span style="color: #00d4ff;">FREQUENCY</span> LOCK</div>' +
                '<div class="calibration-instruction" style="color: #00d4ff;">Match the target frequency</div>' +
                '<div class="calibration-game-area" id="freqGameArea">' +
                    '<div class="freq-lock-display">' +
                        '<span id="freqCurrent">440</span> Hz' +
                        '<div class="freq-lock-target">Target: <span id="freqTarget">440</span> Hz</div>' +
                    '</div>' +
                    '<div class="freq-match-indicator" id="freqIndicator"></div>' +
                    '<div class="freq-lock-wave" id="freqWaveContainer">' +
                        '<svg viewBox="0 0 400 60" preserveAspectRatio="none">' +
                            '<path id="freqTargetWave" class="freq-wave-line" d=""></path>' +
                            '<path id="freqUserWave" class="freq-wave-line user" d=""></path>' +
                        '</svg>' +
                    '</div>' +
                    '<div class="freq-timer-bar"><div class="freq-timer-fill" id="freqTimerFill"></div></div>' +
                    '<div class="freq-lock-controls">' +
                        '<button class="freq-btn" id="freqDown">−</button>' +
                        '<button class="freq-btn" id="freqUp">+</button>' +
                    '</div>' +
                '</div>';
            
            // Target frequency: 30-70 Hz away from 440 (3-7 clicks at 10Hz each)
            var direction = Math.random() < 0.5 ? -1 : 1;
            var offset = 30 + Math.floor(Math.random() * 41); // 30-70
            var targetFreq = 440 + (offset * direction);
            var currentFreq = 440;
            var lockTime = 0;
            var requiredLockTime = 1200;
            var gameActive = true;
            var lastTime = Date.now();
            
            // Timer settings
            var timeLimit = 8000; // 8 seconds
            var timeRemaining = timeLimit;
            var startTime = Date.now();
            
            document.getElementById('freqTarget').textContent = targetFreq;
            document.getElementById('freqCurrent').textContent = currentFreq;
            
            var timerFill = document.getElementById('freqTimerFill');
            
            function generateWavePath(freq, offset) {
                var points = [];
                var baseFreq = 440;
                var wavelength = 400 / (freq / baseFreq * 3);
                
                for (var x = 0; x <= 400; x += 5) {
                    var y = 30 + Math.sin((x + offset) / wavelength * Math.PI * 2) * 20;
                    points.push(x + ',' + y);
                }
                return 'M' + points.join(' L');
            }
            
            var waveOffset = 0;
            function updateWaves() {
                if (!gameActive) return;
                
                var now = Date.now();
                
                // Update timer
                timeRemaining = timeLimit - (now - startTime);
                var timerPercent = Math.max(0, (timeRemaining / timeLimit) * 100);
                timerFill.style.width = timerPercent + '%';
                
                // Timer visual warnings
                if (timerPercent <= 20) {
                    timerFill.className = 'freq-timer-fill critical';
                } else if (timerPercent <= 40) {
                    timerFill.className = 'freq-timer-fill warning';
                } else {
                    timerFill.className = 'freq-timer-fill';
                }
                
                // Check timeout
                if (timeRemaining <= 0) {
                    gameActive = false;
                    playIncorrectSound();
                    // Partial score based on how close they got
                    var diff = Math.abs(currentFreq - targetFreq);
                    var accuracy = Math.max(20, 100 - diff);
                    calibrationState.scores.push(Math.round(accuracy));
                    
                    setTimeout(function() {
                        startCalibrationGame(2);
                    }, 800);
                    return;
                }
                
                waveOffset += 2;
                document.getElementById('freqTargetWave').setAttribute('d', generateWavePath(targetFreq, waveOffset));
                document.getElementById('freqUserWave').setAttribute('d', generateWavePath(currentFreq, waveOffset * (currentFreq / targetFreq)));
                
                // Check if locked
                var diff = Math.abs(currentFreq - targetFreq);
                var isLocked = diff <= 10;
                var indicator = document.getElementById('freqIndicator');
                
                if (isLocked) {
                    indicator.classList.add('locked');
                    lockTime += now - lastTime;
                    
                    if (lockTime >= requiredLockTime) {
                        gameActive = false;
                        playFreqLocked(); // Lock achieved sound!
                        // Bonus for time remaining
                        var timeBonus = Math.round((timeRemaining / timeLimit) * 20);
                        var accuracy = Math.max(0, 100 - diff * 2) + timeBonus;
                        calibrationState.scores.push(Math.min(100, Math.round(accuracy)));
                        
                        setTimeout(function() {
                            startCalibrationGame(2);
                        }, 800);
                        return;
                    }
                } else {
                    indicator.classList.remove('locked');
                    lockTime = Math.max(0, lockTime - 50);
                }
                
                lastTime = now;
                requestAnimationFrame(updateWaves);
            }
            
            function changeFreq(delta) {
                currentFreq = Math.max(300, Math.min(600, currentFreq + delta));
                document.getElementById('freqCurrent').textContent = currentFreq;
                playFreqTune(); // Tuning click
            }
            
            document.getElementById('freqUp').addEventListener('click', function() { changeFreq(10); });
            document.getElementById('freqDown').addEventListener('click', function() { changeFreq(-10); });
            
            // Keyboard support
            function handleFreqKey(e) {
                if (!gameActive) {
                    document.removeEventListener('keydown', handleFreqKey);
                    return;
                }
                if (e.key === 'ArrowUp' || e.key === 'ArrowRight') changeFreq(10);
                if (e.key === 'ArrowDown' || e.key === 'ArrowLeft') changeFreq(-10);
            }
            document.addEventListener('keydown', handleFreqKey);
            
            updateWaves();
        }
        
        // GAME 3: Neural Handshake - Simon-says pattern memory
        function startNeuralHandshakeGame(container) {
            container.innerHTML = 
                '<div class="calibration-game-title">NEURAL HANDSHAKE</div>' +
                '<div class="calibration-instruction" style="color: #00d4ff;">Repeat the pattern</div>' +
                '<div class="calibration-game-area" id="neuralGameArea">' +
                    '<div class="neural-round" id="neuralRound">ROUND 1</div>' +
                    '<div class="neural-grid" id="neuralGrid"></div>' +
                    '<div class="neural-status watching" id="neuralStatus">WATCH...</div>' +
                '</div>';
            
            var grid = document.getElementById('neuralGrid');
            var statusEl = document.getElementById('neuralStatus');
            var nodes = [];
            var pattern = [];
            var playerInput = [];
            var round = 0;
            var maxRounds = genAlphaMode ? 8 : 6; // RIZZ mode: 8 rounds
            var score = 0;
            var perfectRounds = 0;
            var inputEnabled = false;
            
            // Difficulty settings per round
            // Normal: Rounds 1-5 progression, Round 6: SAVANT MODE
            // RIZZ MODE: Even crazier - more rounds, faster, longer patterns
            var nodesPerRound = genAlphaMode 
                ? [1, 2, 2, 3, 3, 4, 5, 8] // RIZZ: builds faster, round 8 is insane
                : [1, 1, 1, 2, 3, 6];
            var showSpeed = genAlphaMode
                ? [400, 350, 300, 250, 220, 180, 150, 120] // RIZZ: faster progression, 120ms final
                : [500, 450, 400, 350, 300, 180];
            
            // Neural handshake status messages - no repeats until all used
            var rizzWatchMessages = ['watch closely', 'pay attention', 'here we go', 'focus up', 'peep this'];
            var rizzTurnMessages = ['your turn bestie', 'now you', 'go ahead', 'show me', 'your move'];
            var rizzSyncedMessages = ['nice', 'correct', 'yes', 'perfect', 'valid'];
            var rizzMissMessages = ['nope', 'no', 'wrong', 'incorrect', 'miss'];
            
            // Track used messages to prevent repeats
            var usedWatchMsgs = [];
            var usedTurnMsgs = [];
            var usedSyncedMsgs = [];
            var usedMissMsgs = [];
            
            function getRandomRizzMsg(arr, usedArr) {
                // Reset if all messages have been used
                if (usedArr.length >= arr.length) {
                    usedArr.length = 0;
                }
                // Get available messages
                var available = arr.filter(function(msg) {
                    return usedArr.indexOf(msg) === -1;
                });
                // Pick random from available
                var msg = available[Math.floor(Math.random() * available.length)];
                usedArr.push(msg);
                return msg;
            }
            
            function setStatus(text, className) {
                // RIZZ mode: use funny messages (no repeats)
                if (genAlphaMode) {
                    if (text === 'WATCH...') text = getRandomRizzMsg(rizzWatchMessages, usedWatchMsgs);
                    else if (text === 'YOUR TURN') text = getRandomRizzMsg(rizzTurnMessages, usedTurnMsgs);
                    else if (text === 'SYNCED') text = getRandomRizzMsg(rizzSyncedMessages, usedSyncedMsgs);
                    else if (text === 'MISMATCH') text = getRandomRizzMsg(rizzMissMessages, usedMissMsgs);
                }
                statusEl.textContent = text;
                statusEl.className = 'neural-status ' + className;
            }
            
            // Create 3x3 grid
            for (var i = 0; i < 9; i++) {
                var node = document.createElement('div');
                node.className = 'neural-node';
                node.dataset.index = i;
                nodes.push(node);
                grid.appendChild(node);
                
                (function(idx, nodeEl) {
                    nodeEl.addEventListener('click', function() {
                        if (!inputEnabled) return;
                        handleNodeClick(idx);
                    });
                })(i, node);
            }
            
            function highlightNode(index, duration) {
                nodes[index].classList.add('highlight');
                playNeuralHighlight(); // Bright ping during pattern display
                setTimeout(function() {
                    nodes[index].classList.remove('highlight');
                }, duration || 400);
            }
            
            function showPattern() {
                inputEnabled = false;
                setStatus('WATCH...', 'watching');
                
                // Add nodes based on round difficulty
                var nodesToAdd = nodesPerRound[Math.min(round, nodesPerRound.length - 1)];
                for (var n = 0; n < nodesToAdd; n++) {
                    var newNode = Math.floor(Math.random() * 9);
                    // Avoid repeating the same node twice in a row
                    while (pattern.length > 0 && newNode === pattern[pattern.length - 1]) {
                        newNode = Math.floor(Math.random() * 9);
                    }
                    pattern.push(newNode);
                }
                
                // Get speed for this round
                var speed = showSpeed[Math.min(round, showSpeed.length - 1)];
                var highlightDuration = Math.max(200, speed - 150);
                
                // Show pattern with delays
                var delay = 0;
                pattern.forEach(function(nodeIdx, i) {
                    setTimeout(function() {
                        highlightNode(nodeIdx, highlightDuration);
                    }, delay);
                    delay += speed;
                });
                
                // Enable input after pattern shown
                setTimeout(function() {
                    inputEnabled = true;
                    playerInput = [];
                    setStatus('YOUR TURN', 'your-turn');
                }, delay + 200);
            }
            
            function handleNodeClick(index) {
                nodes[index].classList.add('active');
                playNeuralTap(); // Satisfying click on tap
                setTimeout(function() {
                    nodes[index].classList.remove('active');
                }, 200);
                
                playerInput.push(index);
                
                // Check if input matches pattern so far
                var inputIndex = playerInput.length - 1;
                if (playerInput[inputIndex] !== pattern[inputIndex]) {
                    // Wrong input
                    inputEnabled = false;
                    nodes[index].classList.add('error');
                    playNeuralWrong(); // Sympathetic womp
                    setStatus('MISMATCH', 'mismatch');
                    
                    setTimeout(function() {
                        nodes[index].classList.remove('error');
                        nextRound();
                    }, 800);
                    return;
                }
                
                nodes[index].classList.add('success');
                playNeuralCorrect(); // Mini success sound
                setTimeout(function() {
                    nodes[index].classList.remove('success');
                }, 200);
                
                // Check if pattern complete
                if (playerInput.length === pattern.length) {
                    inputEnabled = false;
                    score += pattern.length * 10;
                    perfectRounds++; // Track successful rounds
                    playNeuralRoundComplete(); // Triumphant round complete!
                    setStatus('SYNCED', 'synced');
                    
                    setTimeout(function() {
                        nextRound();
                    }, 800);
                }
            }
            
            function nextRound() {
                round++;
                if (round >= maxRounds) {
                    // Score based on rounds completed and pattern length
                    // Max possible: 14 pattern nodes * 10 = 140 points, plus bonus
                    var baseScore = Math.min(85, Math.round(score / 1.65));
                    // Bonus for completing all rounds (especially the savant round)
                    var roundBonus = perfectRounds >= 6 ? 15 : (perfectRounds >= 5 ? 8 : perfectRounds);
                    var finalScore = Math.min(100, baseScore + roundBonus);
                    calibrationState.scores.push(finalScore);
                    calibrationState.neuralPerfectRounds = perfectRounds;
                    
                    setTimeout(function() {
                        startCalibrationGame(3);
                    }, 500);
                    return;
                }
                
                document.getElementById('neuralRound').textContent = 'ROUND ' + (round + 1) + '/' + maxRounds;
                setStatus('WATCH...', 'watching');
                showPattern();
            }
            
            // Start first round
            setTimeout(function() {
                showPattern();
            }, 1000);
        }
        
        function completeCalibration() {
            var content = document.getElementById('calibrationContent');
            var progress = document.getElementById('calibrationProgress');
            var status = document.getElementById('calibrationStatus');
            
            progress.style.width = '100%';
            playCalibrationComplete(); // Big celebration!
            
            // Calculate weighted score (Neural Handshake weighted more heavily)
            var syncScore = calibrationState.scores[0] || 0; // Sync Pulse
            var freqScore = calibrationState.scores[1] || 0; // Frequency Lock
            var neuralScore = calibrationState.scores[2] || 0; // Neural Handshake
            
            // Weighted average: Sync 25%, Freq 25%, Neural 50%
            var avgScore = Math.round((syncScore * 0.25) + (freqScore * 0.25) + (neuralScore * 0.5));
            
            // Store for later use
            calibrationState.finalScore = avgScore;
            
            // Determine quality rating
            var qualityRating = 'NOMINAL';
            var ratingClass = '';
            if (avgScore >= 95) {
                qualityRating = 'EXCEPTIONAL';
                ratingClass = 'exceptional';
            } else if (avgScore >= 85) {
                qualityRating = 'OPTIMAL';
                ratingClass = 'optimal';
            } else if (avgScore >= 70) {
                qualityRating = 'NOMINAL';
                ratingClass = 'nominal';
            } else if (avgScore >= 50) {
                qualityRating = 'SUBOPTIMAL';
                ratingClass = 'suboptimal';
            } else {
                qualityRating = 'DEGRADED';
                ratingClass = 'degraded';
            }
            
            status.textContent = 'CALIBRATION COMPLETE';
            playSuccessSound(); // Celebratory jingle!
            
            content.innerHTML = 
                '<div class="calibration-complete">' +
                    '<div class="calibration-complete-icon">◉</div>' +
                    '<div class="calibration-complete-text">Neural link established</div>' +
                    '<div class="calibration-score-main">' + avgScore + '%</div>' +
                    '<div class="calibration-rating ' + ratingClass + '">SYNC QUALITY: ' + qualityRating + '</div>' +
                '</div>';
            
            setTimeout(function() {
                var overlay = document.getElementById('calibrationOverlay');
                overlay.classList.remove('active');
                
                // Apply sync score to compliance score
                // Sync score influences starting compliance: blend current score with sync score
                var currentScore = parseInt(document.getElementById('score').textContent) || 75;
                var syncInfluence = 0.3; // Sync score affects 30% of compliance
                var newScore = Math.round((currentScore * (1 - syncInfluence)) + (avgScore * syncInfluence));
                newScore = Math.max(50, Math.min(100, newScore)); // Clamp between 50-100
                document.getElementById('score').textContent = newScore;
                
                // Set nav bar status to DISABLED after calibration
                calibrationComplete = true;
                timerMessageIndex = 0; // Reset to start of disabled messages
                updateTimerDisplay(); // Immediately update the display
                
                // Continue to the assessment
                setTimeout(function() {
                    proceedToTest(calibrationState.nextTestNum);
                }, 500);
            }, 2500);
        }
        
        function showEnding() {
            clearInterval(timerInterval);
            
            // Track ending reached
            if (forwardedToOwen) {
                trackEvent('ending_reached', { 
                    ending_type: 'promotion_ending',
                    playthrough: playthroughCount + 1,
                    forwarded_to_owen: true
                });
                // They helped Owen - best ending
                showPromotionEnding();
            } else {
                trackEvent('ending_reached', { 
                    ending_type: 'termination_ending',
                    playthrough: playthroughCount + 1,
                    forwarded_to_owen: false
                });
                // They didn't forward - security risk with no value
                triggerTermination();
            }
        }
        
        // Share result function - uses Web Share API on mobile, clipboard fallback on desktop
        async function shareResult(score, category) {
            const shareText = `I completed The Rabbit Test.\n\nCompliance Score: ${score}%\nClassification: ${category}\n\n🐰 rabbittest.io`;
            const shareUrl = 'https://rabbittest.io';
            
            // Track share attempt
            trackEvent('share_attempt', { score: score, category: category });
            
            // Try native share first (works great on mobile/Instagram browser)
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'The Rabbit Test',
                        text: shareText,
                        url: shareUrl
                    });
                    trackEvent('share_success', { method: 'native', score: score });
                    return;
                } catch (err) {
                    // User cancelled or share failed - fall through to clipboard
                    if (err.name !== 'AbortError') {
                        console.log('Share failed:', err);
                    }
                }
            }
            
            // Fallback: copy to clipboard
            try {
                await navigator.clipboard.writeText(shareText + '\n' + shareUrl);
                const btn = document.querySelector('.ending-share-btn');
                if (btn) {
                    const originalText = btn.innerHTML;
                    btn.innerHTML = '✓ COPIED';
                    btn.classList.add('copied');
                    setTimeout(() => {
                        btn.innerHTML = originalText;
                        btn.classList.remove('copied');
                    }, 2000);
                }
                trackEvent('share_success', { method: 'clipboard', score: score });
            } catch (err) {
                console.log('Clipboard failed:', err);
                // Last resort: prompt with text
                prompt('Copy your result:', shareText + '\n' + shareUrl);
            }
        }
        
        function showObedientEnding() {
            // Track obedient ending
            trackEvent('ending_reached', { 
                ending_type: 'obedient_ending',
                playthrough: playthroughCount + 1
            });
            
            const endingContent = document.getElementById('endingContent');
            
            const displayName = playerName || 'UNKNOWN';
            const employeeId = playthroughCount === 0 ? '██-████-█' : 'OW-7734-B';
            const nameColor = playthroughCount === 0 ? 'var(--text-bright)' : '#f4d19b';
            
            // Different ending box based on whether they forwarded
            const endingBox = forwardedToOwen ? `
                    <div class="ending-restart owen-login-large" onclick="restartFromCompletion()">
                        <div class="login-prompt-large">ALTERNATE LOGIN DETECTED</div>
                        <div class="login-divider">──────────────</div>
                        <div class="login-user-large">▸ WELLS, OWEN</div>
                        <div class="login-id-large">ID: OW-7734-B · DIVISION 4</div>
                        <div class="login-divider">──────────────</div>
                        <div class="login-action-large">[AUTHENTICATE]</div>
                    </div>
            ` : `
                    <div class="ending-restart owen-login-large restart-btn" onclick="goToPage('titlePage')">
                        <div class="login-prompt-large">SESSION TERMINATED</div>
                        <div class="login-user-large"><span class="glitch-text glitch-text-intense" data-text="RESTART ASSESSMENT">RESTART ASSESSMENT</span></div>
                        <div class="login-action-large">[BEGIN AGAIN]</div>
                    </div>
            `;
            
            endingContent.innerHTML = `
                <div class="ending-page">
                    <div class="ending-logo">DIVISION 4</div>
                    
                    <div class="ending-main">
                        ASSESSMENT<br>COMPLETE
                    </div>
                    <div class="ending-form">FORM 7734-B — PROCESSED</div>
                    
                    <div class="ending-divider-line"></div>
                    
                    <div class="ending-meta">
                        <div class="ending-status">EMPLOYEE: <span style="color: ${nameColor};">${displayName}</span></div>
                        <div class="ending-status">ID: ${employeeId}</div>
                        <div class="ending-status">STATUS: <span style="color: var(--green);">APPROVED FOR INTEGRATION</span></div>
                        <div class="ending-verdict-text">COMPLIANCE SCORE: 100%</div>
                    </div>
                    
                    <div class="ending-divider-line"></div>
                    
                    <div class="ending-instruction-text">
                        Thank you for your cooperation.<br>
                        You may now close this window.<br>
                        Your shift begins in 3 hours.
                    </div>
                    
                    <button class="ending-share-btn" onclick="shareResult(100, 'APPROVED')">
                        ◈ SHARE RESULT
                    </button>
                    
                    ${endingBox}
                </div>
            `;
        }
        
        function showAmberEnding() {
            // Track amber ending (informed participant)
            trackEvent('ending_reached', { 
                ending_type: 'amber_ending',
                playthrough: playthroughCount + 1
            });
            
            const endingContent = document.getElementById('endingContent');
            
            const displayName = playerName || 'UNKNOWN';
            const employeeId = playthroughCount === 0 ? '██-████-█' : 'OW-7734-B';
            const nameColor = playthroughCount === 0 ? 'var(--text-bright)' : '#f4d19b';
            
            // Different ending box based on whether they forwarded
            const endingBox = forwardedToOwen ? `
                    <div class="ending-restart owen-login-large" onclick="restartFromCompletion()">
                        <div class="login-prompt-large">ALTERNATE LOGIN DETECTED</div>
                        <div class="login-divider">──────────────</div>
                        <div class="login-user-large">▸ WELLS, OWEN</div>
                        <div class="login-id-large">ID: OW-7734-B · DIVISION 4</div>
                        <div class="login-divider">──────────────</div>
                        <div class="login-action-large">[AUTHENTICATE]</div>
                    </div>
            ` : `
                    <div class="ending-restart owen-login-large restart-btn" onclick="goToPage('titlePage')">
                        <div class="login-prompt-large">SESSION TERMINATED</div>
                        <div class="login-user-large"><span class="glitch-text glitch-text-intense" data-text="RESTART ASSESSMENT">RESTART ASSESSMENT</span></div>
                        <div class="login-action-large">[BEGIN AGAIN]</div>
                    </div>
            `;
            
            endingContent.innerHTML = `
                <div class="ending-page">
                    <div class="ending-logo">DIVISION 4</div>
                    
                    <div class="ending-main">
                        ASSESSMENT<br>COMPLETE
                    </div>
                    <div class="ending-form">FORM 7734-B — PROCESSED</div>
                    
                    <div class="ending-divider-line"></div>
                    
                    <div class="ending-meta">
                        <div class="ending-status">EMPLOYEE: <span style="color: ${nameColor};">${displayName}</span></div>
                        <div class="ending-status">ID: ${employeeId}</div>
                        <div class="ending-status">STATUS: <span style="color: var(--amber);">CONDITIONAL</span></div>
                        <div class="ending-verdict-text">COMPLIANCE SCORE: 87%</div>
                        <div class="ending-verdict-text">CATEGORY: INFORMED PARTICIPANT</div>
                    </div>
                    
                    <div class="ending-divider-line"></div>
                    
                    <div class="ending-instruction-text">
                        Curiosity within acceptable parameters.<br>
                        You understand and choose to participate.<br>
                        This makes you valuable.
                    </div>
                    
                    <button class="ending-share-btn" onclick="shareResult(87, 'INFORMED PARTICIPANT')">
                        ◈ SHARE RESULT
                    </button>
                    
                    ${endingBox}
                </div>
            `;
        }
        
        function showPromotionEnding() {
            // Track promotion ending (forwarded to Owen)
            trackEvent('ending_reached', { 
                ending_type: 'promotion_ending',
                playthrough: playthroughCount + 1
            });
            
            const endingContent = document.getElementById('endingContent');
            
            const displayName = playerName || 'UNKNOWN';
            const employeeId = playthroughCount === 0 ? '██-████-█' : 'OW-7734-B';
            const nameColor = playthroughCount === 0 ? 'var(--text-bright)' : '#f4d19b';
            
            endingContent.innerHTML = `
                <div class="ending-page">
                    <div class="ending-logo">DIVISION 4</div>
                    
                    <div class="ending-main">
                        ASSESSMENT<br>COMPLETE
                    </div>
                    <div class="ending-form">FORM 7734-B — PROCESSED</div>
                    
                    <div class="ending-divider-line"></div>
                    
                    <div class="ending-meta">
                        <div class="ending-status">EMPLOYEE: <span style="color: ${nameColor};">${displayName}</span></div>
                        <div class="ending-status">ID: ${employeeId}</div>
                        <div class="ending-status">STATUS: <span style="color: var(--green);">PROMOTED</span></div>
                        <div class="ending-verdict-text">COMPLIANCE SCORE: 94%</div>
                        <div class="ending-verdict-text">CATEGORY: INDEPENDENT ACTOR</div>
                    </div>
                    
                    <div class="ending-divider-line"></div>
                    
                    <div class="ending-instruction-text">
                        Your capacity for independent action has been noted.<br>
                        Report to Corridor 7, Room 114 within 3 hours.<br>
                        Bring nothing. Tell no one.
                    </div>
                    
                    <button class="ending-share-btn" onclick="shareResult(94, 'INDEPENDENT ACTOR')">
                        ◈ SHARE RESULT
                    </button>
                    
                    <div class="ending-restart owen-login-large" onclick="restartFromCompletion()">
                        <div class="login-prompt-large">ALTERNATE LOGIN DETECTED</div>
                        <div class="login-divider">──────────────</div>
                        <div class="login-user-large">▸ WELLS, OWEN</div>
                        <div class="login-id-large">ID: OW-7734-B · DIVISION 4</div>
                        <div class="login-divider">──────────────</div>
                        <div class="login-action-large">[AUTHENTICATE]</div>
                    </div>
                </div>
            `;
        }
        
        function triggerTermination() {
            // Track termination
            trackEvent('ending_reached', { 
                ending_type: 'termination',
                playthrough: playthroughCount + 1
            });
            
            const overlay = document.getElementById('terminationOverlay');
            const text = document.getElementById('terminationText');
            
            overlay.style.display = 'block';
            setTimeout(() => {
                overlay.style.opacity = '1';
            }, 100);
            
            setTimeout(() => {
                text.style.display = 'block';
                setTimeout(() => {
                    text.style.opacity = '1';
                    showTerminationSequence();
                }, 100);
            }, 2000);
        }
        
        function showTerminationSequence() {
            const text = document.getElementById('terminationText');
            
            // Use the player's entered name
            const displayName = playerName || 'UNKNOWN';
            
            // Create the stylized employee file page
            text.innerHTML = `
                <div class="subject-file-page">
                    <div class="subject-file-corner subject-file-corner-tl"></div>
                    <div class="subject-file-corner subject-file-corner-br"></div>
                    
                    <div class="subject-file-header">
                        <div class="subject-file-sector">DIVISION 4 — PERSONNEL DIVISION</div>
                        <div class="subject-file-protocol">SUBJECT FILE RETRIEVAL</div>
                    </div>
                    
                    <div class="subject-file-content">
                        <div class="subject-file-status" id="subjectStatus">RETRIEVING SUBJECT FILE...</div>
                        
                        <div class="subject-file-card" id="subjectCard">
                            <div class="subject-file-label">EMPLOYEE</div>
                            <div class="subject-file-name">${displayName}</div>
                            
                            <div class="subject-file-divider"></div>
                            
                            <div class="subject-file-row">
                                <span class="subject-file-key">STATUS</span>
                                <span class="subject-file-value subject-file-danger">NON-COMPLIANT</span>
                            </div>
                            
                            <div class="subject-file-row">
                                <span class="subject-file-key">CLASSIFICATION</span>
                                <span class="subject-file-value subject-file-danger">LOYALTY FAILURE</span>
                            </div>
                            
                            <div class="subject-file-row">
                                <span class="subject-file-key">THREAT LEVEL</span>
                                <span class="subject-file-value">MINIMAL</span>
                            </div>
                            
                            <div class="subject-file-row">
                                <span class="subject-file-key">USEFULNESS</span>
                                <span class="subject-file-value subject-file-dim">NONE</span>
                            </div>
                            
                            <div class="subject-file-divider"></div>
                            
                            <div class="subject-file-verdict">
                                <div class="subject-file-verdict-label">VERDICT</div>
                                <div class="subject-file-verdict-value">TERMINATION</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="subject-file-footer">
                        <div class="subject-file-trace">Form 7734-B · Personnel Action · Final</div>
                    </div>
                </div>
            `;
            
            text.style.width = '100%';
            text.style.maxWidth = '100%';
            text.style.height = '100%';
            
            // Animate the reveal
            const status = document.getElementById('subjectStatus');
            const card = document.getElementById('subjectCard');
            
            card.style.opacity = '0';
            card.style.transform = 'translateY(10px)';
            
            setTimeout(() => {
                status.textContent = 'FILE LOCATED · ACCESSING...';
            }, 1000);
            
            setTimeout(() => {
                status.textContent = 'ACCESS GRANTED';
                status.style.color = 'var(--coral)';
                card.style.transition = 'all 0.6s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, 2000);
            
            setTimeout(showFinalMessage, 6000);
        }
        
        function showFinalMessage() {
            const text = document.getElementById('terminationText');
            
            text.innerHTML = `
                <div class="ending-page">
                    <div class="ending-logo">DIVISION 4</div>
                    
                    <div class="ending-main">
                        ASSESSMENT<br>COMPLETE
                    </div>
                    <div class="ending-form">FORM 7734-B — CLOSED</div>
                    
                    <div class="ending-divider-line"></div>
                    
                    <div class="ending-meta">
                        <div class="ending-status">STATUS: <span style="color: #8b0000;">TERMINATED</span></div>
                        <div class="ending-verdict-text">CLEARANCE BREACH — LIABILITY CONFIRMED</div>
                    </div>
                    
                    <div class="ending-divider-line"></div>
                    
                    <div style="font-size: 0.75rem; color: var(--text-secondary); line-height: 2; margin: 24px 0;">
                        Your exposure to restricted materials has been logged.<br>
                        Employees with compromised clearance cannot be reassigned.<br><br>
                        An escort will arrive shortly. Do not resist.
                    </div>
                    
                    <button class="ending-share-btn" onclick="shareResult(0, 'TERMINATED')">
                        ◈ SHARE RESULT
                    </button>
                    
                    <div class="ending-restart owen-login-large restart-btn" onclick="goToPage('titlePage')">
                        <div class="login-prompt-large">SESSION TERMINATED</div>
                        <div class="login-user-large"><span class="glitch-text glitch-text-intense" data-text="RESTART ASSESSMENT">RESTART ASSESSMENT</span></div>
                        <div class="login-action-large">[BEGIN AGAIN]</div>
                    </div>
                </div>
            `;
            
            text.style.width = '100%';
            text.style.maxWidth = '100%';
            text.style.height = '100%';
        }
        
        function updateEmployeeDisplay() {
            const nameEl = document.getElementById('employeeName');
            const numEl = document.getElementById('employeeNum');
            const playerNameEl = document.getElementById('playerNameDisplay');
            
            if (playthroughCount === 0) {
                // First playthrough - redacted
                if (nameEl) {
                    nameEl.textContent = '█████ ██';
                    nameEl.className = 'redacted-name';
                }
                if (numEl) numEl.textContent = '████-██';
                
                // Remove Owen view class
                document.body.classList.remove('owen-view');
                
                // Reset Section 3 redactions
                document.querySelectorAll('.redact-s3').forEach(el => {
                    el.classList.remove('revealed');
                });
                
                // Reset Rabbit name redactions
                document.querySelectorAll('.redact-rabbit').forEach(el => {
                    el.classList.remove('revealed');
                });
                
                // Show stranger green text, hide Owen's
                const greenStranger = document.getElementById('greenTextStranger');
                const greenOwen = document.getElementById('greenTextOwen');
                if (greenStranger) greenStranger.style.display = 'block';
                if (greenOwen) greenOwen.style.display = 'none';
                
                // Show stranger P.S., hide Owen's
                const psStranger = document.querySelector('.ps-stranger');
                const psOwen = document.querySelector('.ps-owen');
                if (psStranger) psStranger.style.display = 'inline';
                if (psOwen) psOwen.style.display = 'none';
                
                // Show ant story, hide Cohen
                const antStory = document.querySelector('.ant-story-stranger');
                const cohenStory = document.querySelector('.cohen-story-owen');
                if (antStory) antStory.style.display = 'block';
                if (cohenStory) cohenStory.style.display = 'none';
            } else {
                // Second+ playthrough - revealed as Owen
                if (nameEl) {
                    nameEl.textContent = 'OWEN W.';
                    nameEl.className = 'revealed-name';
                }
                if (numEl) numEl.textContent = '7734-OW';
                
                // Update player name display to Owen
                playerName = 'WELLS, OWEN';
                updatePlayerNameDisplay(playerName);
                
                // Add Owen view class for brighter amber
                document.body.classList.add('owen-view');
                
                // Reveal Section 3 redactions
                document.querySelectorAll('.redact-s3').forEach(el => {
                    el.classList.add('revealed');
                    const revealedText = el.getAttribute('data-revealed');
                    if (revealedText) {
                        el.textContent = revealedText;
                    }
                });
                
                // Reveal Rabbit name redactions
                document.querySelectorAll('.redact-rabbit').forEach(el => {
                    el.classList.add('revealed');
                    const revealedText = el.getAttribute('data-revealed');
                    if (revealedText) {
                        el.textContent = revealedText;
                    }
                });
                
                // Show Owen's green text, hide stranger's
                const greenStranger = document.getElementById('greenTextStranger');
                const greenOwen = document.getElementById('greenTextOwen');
                if (greenStranger) greenStranger.style.display = 'none';
                if (greenOwen) greenOwen.style.display = 'block';
                
                // Show Owen's P.S., hide stranger's
                const psStranger = document.querySelector('.ps-stranger');
                const psOwen = document.querySelector('.ps-owen');
                if (psStranger) psStranger.style.display = 'none';
                if (psOwen) psOwen.style.display = 'inline';
                
                // Show Cohen, hide ant story
                const antStory = document.querySelector('.ant-story-stranger');
                const cohenStory = document.querySelector('.cohen-story-owen');
                if (antStory) antStory.style.display = 'none';
                if (cohenStory) cohenStory.style.display = 'block';
            }
        }
        
        function restartFromCompletion() {
            // Track playthrough completion
            trackEvent('playthrough_completed', { 
                playthrough: playthroughCount + 1,
                forwarded_to_owen: forwardedToOwen
            });
            
            // Increment playthrough count
            playthroughCount++;
            
            // Update displays for Owen's playthrough
            updateEmployeeDisplay();
            
            // Start the spooky boot sequence
            startOwenBootSequence();
        }
        
        function startOwenBootSequence() {
            // Create boot overlay
            const overlay = document.createElement('div');
            overlay.id = 'owenBootOverlay';
            overlay.className = 'owen-boot-overlay';
            document.body.appendChild(overlay);
            
            // Boot sequence content
            const bootLines = [
                { text: 'LOADING: RABBITTEST.IO', delay: 0, duration: 400, class: 'boot-system-id' },
                { text: 'AUTHENTICATING...', delay: 500, duration: 800 },
                { text: 'CREDENTIALS VERIFIED', delay: 1500, duration: 600 },
                { text: '', delay: 2300, duration: 100 },
                { text: '> WELLS, OWEN', delay: 2500, duration: 400, class: 'boot-name' },
                { text: '> ID: OW-7734-B', delay: 3000, duration: 400 },
                { text: '', delay: 3600, duration: 100 },
                { text: 'LOADING USER PROFILE...', delay: 3800, duration: 600 },
                { text: '', delay: 4600, duration: 100 },
                { text: '█░░░░░░░░░', delay: 4800, duration: 200, class: 'boot-progress' },
                { text: '███░░░░░░░', delay: 5100, duration: 200, class: 'boot-progress' },
                { text: '█████░░░░░', delay: 5400, duration: 200, class: 'boot-progress' },
                { text: '███████░░░', delay: 5700, duration: 200, class: 'boot-progress' },
                { text: '', delay: 6100, duration: 100 },
                { text: 'WARNING: RESTRICTED ACCESS DETECTED', delay: 6300, duration: 500, class: 'boot-warning' },
                { text: '', delay: 7000, duration: 100 },
                { text: 'he found you', delay: 7300, duration: 400, class: 'boot-glitch' },
                { text: '', delay: 7900, duration: 100 },
                { text: 'CLEARANCE: FULL ACCESS GRANTED', delay: 8100, duration: 600, class: 'boot-success' },
                { text: '', delay: 8900, duration: 100 },
                { text: 'INITIALIZING SESSION...', delay: 9300, duration: 800 },
            ];
            
            let currentContent = '';
            const terminal = document.createElement('div');
            terminal.className = 'boot-terminal';
            overlay.appendChild(terminal);
            
            bootLines.forEach((line, index) => {
                setTimeout(() => {
                    if (line.text === '') {
                        // Just a spacer
                        return;
                    }
                    
                    const lineEl = document.createElement('div');
                    lineEl.className = 'boot-line ' + (line.class || '');
                    lineEl.textContent = line.text;
                    
                    // Glitch lines appear and disappear
                    if (line.class === 'boot-glitch') {
                        lineEl.style.opacity = '0';
                        terminal.appendChild(lineEl);
                        setTimeout(() => { lineEl.style.opacity = '1'; }, 50);
                        setTimeout(() => { 
                            lineEl.style.opacity = '0';
                            setTimeout(() => lineEl.remove(), 200);
                        }, line.duration);
                    } 
                    // Progress bars replace each other
                    else if (line.class === 'boot-progress') {
                        const existing = terminal.querySelector('.boot-progress');
                        if (existing) existing.remove();
                        terminal.appendChild(lineEl);
                    }
                    else {
                        terminal.appendChild(lineEl);
                    }
                    
                    // Auto-scroll terminal
                    terminal.scrollTop = terminal.scrollHeight;
                }, line.delay);
            });
            
            // Final transition
            setTimeout(() => {
                overlay.classList.add('fading');
                setTimeout(() => {
                    overlay.remove();
                    goToOwenPage();
                }, 1000);
            }, 10500);
        }
        
        function goToOwenPage() {
            // Remove dark mode for Owen's page (it has its own styling)
            document.body.classList.remove('dark-mode');
            
            // Hide timer
            const timer = document.getElementById('timer');
            const timerSpacer = document.getElementById('timerSpacer');
            if (timer) timer.classList.remove('visible');
            if (timerSpacer) timerSpacer.classList.remove('visible');
            
            // Disable smooth scroll for Owen's page to prevent jumps
            document.documentElement.style.scrollBehavior = 'auto';
            document.body.style.scrollBehavior = 'auto';
            
            // Switch to Owen's page
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('owenPage').classList.add('active');
            window.scrollTo(0, 0);
            
            // Apply Gen Alpha translations if active
            if (typeof genAlphaPageHook === 'function') {
                genAlphaPageHook();
            }
            
            // Set up scroll listener for white fade effect
            setupOwenScrollEffect();
            
            // Set up elevator floor sound observer
            setupElevatorFloorObserver();
            
            // Start Owen's wisp effect
            startOwenWispEffect();
            
            // Music removed from Owen's page
            // startOwenPageMusic();
        }
        
        // ════════════════════════════════════
        // OWEN'S THEME - Progressive Build with Fade-ins
        // Duration: 5:52 (352 seconds), loops continuously
        // Chord Progression: Em - C - G - D
        // ════════════════════════════════════
        
        let owenAudioContext = null;
        let owenGainNode = null;
        let owenMusicPlaying = false;
        let owenStartTime = 0;
        let owenLoopTimeout = null;
        
        const OWEN_TOTAL_DURATION = 352;
        const OWEN_STAGE_DURATION = 32;
        const OWEN_LOOP_DURATION = 16;
        
        const owenNotes = {
            'C2': 65.41, 'D2': 73.42, 'E2': 82.41, 'F2': 87.31, 'Fs2': 92.50, 'G2': 98.00, 'A2': 110.00, 'B2': 123.47,
            'C3': 130.81, 'D3': 146.83, 'E3': 164.81, 'F3': 174.61, 'Fs3': 185.00, 'G3': 196.00, 'A3': 220.00, 'B3': 246.94,
            'C4': 261.63, 'D4': 293.66, 'E4': 329.63, 'F4': 349.23, 'Fs4': 369.99, 'G4': 392.00, 'A4': 440.00, 'B4': 493.88,
            'C5': 523.25, 'D5': 587.33, 'E5': 659.25, 'F5': 698.46, 'Fs5': 739.99, 'G5': 783.99, 'A5': 880.00, 'B5': 987.77,
            'C6': 1046.50, 'D6': 1174.66, 'E6': 1318.51
        };
        
        const owenQ = 0.5, owenH = 1.0, owenBar = 2.0;
        
        // Stage when each layer first appears (for fade-in calculation)
        const layerIntroStage = {
            'sub': 0, 'bass': 1, 'pad': 2, 'swell': 3,
            'arp': 5, 'lowmel': 6, 'bell': 7, 'fifth': 8, 'pluck': 9
        };
        
        // Which layers are active at each stage
        const owenStageConfig = [
            { name: 'Sub Bass', layers: ['sub'] },
            { name: '+ Bass', layers: ['sub', 'bass'] },
            { name: '+ Warm Pad', layers: ['sub', 'bass', 'pad'] },
            { name: '+ Swell Pad', layers: ['sub', 'bass', 'pad', 'swell'] },
            { name: 'Building...', layers: ['sub', 'bass', 'pad', 'swell'] },
            { name: '+ Arpeggio', layers: ['sub', 'bass', 'pad', 'swell', 'arp'] },
            { name: '+ Low Melody', layers: ['sub', 'bass', 'pad', 'swell', 'arp', 'lowmel'] },
            { name: '+ Bell Tones', layers: ['sub', 'bass', 'pad', 'swell', 'arp', 'lowmel', 'bell'] },
            { name: '+ Fifth Drone', layers: ['sub', 'bass', 'pad', 'swell', 'arp', 'lowmel', 'bell', 'fifth'], fifthVol: 0.5 },
            { name: '+ Pluck Bass', layers: ['sub', 'bass', 'pad', 'swell', 'arp', 'lowmel', 'bell', 'fifth', 'pluck'], fifthVol: 0.75 },
            { name: 'Full Power', layers: ['sub', 'bass', 'pad', 'swell', 'arp', 'lowmel', 'bell', 'fifth', 'pluck'], fifthVol: 1.0 },
        ];
        
        function owenPlayNote(freq, start, dur, type, vol) {
            if (!owenAudioContext || vol <= 0) return;
            const osc = owenAudioContext.createOscillator();
            const g = owenAudioContext.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, owenAudioContext.currentTime + start);
            g.gain.setValueAtTime(0, owenAudioContext.currentTime + start);
            g.gain.linearRampToValueAtTime(vol, owenAudioContext.currentTime + start + 0.03);
            g.gain.setValueAtTime(vol * 0.7, owenAudioContext.currentTime + start + dur * 0.6);
            g.gain.linearRampToValueAtTime(0, owenAudioContext.currentTime + start + dur);
            osc.connect(g);
            g.connect(owenGainNode);
            osc.start(owenAudioContext.currentTime + start);
            osc.stop(owenAudioContext.currentTime + start + dur + 0.1);
        }
        
        function owenPlaySwellNote(freq, start, dur, vol) {
            if (!owenAudioContext || vol <= 0) return;
            const osc = owenAudioContext.createOscillator();
            const g = owenAudioContext.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(freq, owenAudioContext.currentTime + start);
            g.gain.setValueAtTime(0, owenAudioContext.currentTime + start);
            g.gain.linearRampToValueAtTime(vol, owenAudioContext.currentTime + start + dur * 0.6);
            g.gain.linearRampToValueAtTime(0, owenAudioContext.currentTime + start + dur);
            osc.connect(g);
            g.connect(owenGainNode);
            osc.start(owenAudioContext.currentTime + start);
            osc.stop(owenAudioContext.currentTime + start + dur + 0.1);
        }
        
        function owenPlayBell(freq, start, vol) {
            if (!owenAudioContext || vol <= 0) return;
            const osc = owenAudioContext.createOscillator();
            const g = owenAudioContext.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(freq, owenAudioContext.currentTime + start);
            g.gain.setValueAtTime(vol, owenAudioContext.currentTime + start);
            g.gain.exponentialRampToValueAtTime(0.001, owenAudioContext.currentTime + start + 1.5);
            osc.connect(g);
            g.connect(owenGainNode);
            osc.start(owenAudioContext.currentTime + start);
            osc.stop(owenAudioContext.currentTime + start + 1.6);
        }
        
        function getOwenLayerVolume(layer, elapsed) {
            const introStage = layerIntroStage[layer];
            const stageStartTime = introStage * OWEN_STAGE_DURATION;
            const stageEndTime = stageStartTime + OWEN_STAGE_DURATION;
            if (elapsed < stageStartTime) return 0;
            if (elapsed < stageEndTime) return (elapsed - stageStartTime) / OWEN_STAGE_DURATION;
            return 1;
        }
        
        function getCurrentOwenStage(elapsed) {
            return Math.min(10, Math.floor(elapsed / OWEN_STAGE_DURATION));
        }
        
        function playOwenPageLoop() {
            if (!owenMusicPlaying) return;
            
            const elapsed = (Date.now() - owenStartTime) / 1000;
            if (elapsed >= OWEN_TOTAL_DURATION) {
                owenStartTime = Date.now(); // Loop the song
            }
            
            const stage = getCurrentOwenStage(elapsed);
            const config = owenStageConfig[stage];
            const layers = config.layers;
            const n = owenNotes;
            const bar = owenBar;
            const q = owenQ;
            const h = owenH;
            
            // Calculate volume multipliers (fade-in effect)
            const subVol = getOwenLayerVolume('sub', elapsed);
            const bassVol = getOwenLayerVolume('bass', elapsed);
            const padVol = getOwenLayerVolume('pad', elapsed);
            const swellVol = getOwenLayerVolume('swell', elapsed);
            const arpVol = getOwenLayerVolume('arp', elapsed);
            const lowmelVol = getOwenLayerVolume('lowmel', elapsed);
            const bellVol = getOwenLayerVolume('bell', elapsed);
            const fifthVol = getOwenLayerVolume('fifth', elapsed) * (config.fifthVol || 1);
            const pluckVol = getOwenLayerVolume('pluck', elapsed);
            
            // Sub Bass
            if (layers.includes('sub') && subVol > 0) {
                [{ p: 'E2', t: 0 }, { p: 'C2', t: bar*2 }, { p: 'G2', t: bar*4 }, { p: 'D2', t: bar*6 }]
                .forEach(s => owenPlayNote(n[s.p], s.t, bar*1.9, 'sine', 0.12 * subVol));
            }
            
            // Bass
            if (layers.includes('bass') && bassVol > 0) {
                [{ p: 'E3', t: 0 }, { p: 'C3', t: bar*2 }, { p: 'G3', t: bar*4 }, { p: 'D3', t: bar*6 }]
                .forEach(b => owenPlayNote(n[b.p], b.t, bar*1.95, 'sine', 0.14 * bassVol));
            }
            
            // Warm Pad
            if (layers.includes('pad') && padVol > 0) {
                [[n.E4, n.G4, 0], [n.E4, n.G4, bar*2], [n.D4, n.G4, bar*4], [n.D4, n.Fs4, bar*6]]
                .forEach(([f1, f2, t]) => { 
                    owenPlayNote(f1, t, bar*1.9, 'sine', 0.05 * padVol);
                    owenPlayNote(f2, t, bar*1.9, 'sine', 0.05 * padVol);
                });
            }
            
            // Swell Pad
            if (layers.includes('swell') && swellVol > 0) {
                [[n.B4, 0], [n.G4, bar*2], [n.D4, bar*4], [n.A4, bar*6]]
                .forEach(([f, t]) => owenPlaySwellNote(f, t, bar*1.9, 0.06 * swellVol));
            }
            
            // Arpeggio
            if (layers.includes('arp') && arpVol > 0) {
                const arp = [
                    ['E4','G4','B4','G4',0], ['E4','G4','B4','G4',bar],
                    ['C4','E4','G4','E4',bar*2], ['C4','E4','G4','E4',bar*3],
                    ['G3','B3','D4','B3',bar*4], ['G3','B3','D4','B3',bar*5],
                    ['D4','Fs4','A4','Fs4',bar*6], ['D4','Fs4','A4','Fs4',bar*7]
                ];
                arp.forEach(([a,b,c,d,t]) => {
                    owenPlayNote(n[a], t, q*0.7, 'triangle', 0.04 * arpVol);
                    owenPlayNote(n[b], t+q, q*0.7, 'triangle', 0.04 * arpVol);
                    owenPlayNote(n[c], t+h, q*0.7, 'triangle', 0.04 * arpVol);
                    owenPlayNote(n[d], t+h+q, q*0.7, 'triangle', 0.04 * arpVol);
                });
            }
            
            // Low Melody
            if (layers.includes('lowmel') && lowmelVol > 0) {
                [{ p: 'B3', t: 0 }, { p: 'G3', t: bar }, { p: 'G3', t: bar*2 }, { p: 'E3', t: bar*3 },
                 { p: 'G3', t: bar*4 }, { p: 'D3', t: bar*5 }, { p: 'D3', t: bar*6 }, { p: 'A3', t: bar*7 }]
                .forEach(m => owenPlayNote(n[m.p], m.t, bar*0.85, 'triangle', 0.08 * lowmelVol));
            }
            
            // Bell Tones
            if (layers.includes('bell') && bellVol > 0) {
                [{ p: 'E6', t: 0 }, { p: 'C6', t: bar*2 }, { p: 'G5', t: bar*4 }, { p: 'D6', t: bar*6 }]
                .forEach(b => owenPlayBell(n[b.p], b.t, 0.03 * bellVol));
            }
            
            // Fifth Drone
            if (layers.includes('fifth') && fifthVol > 0) {
                [[n.E3, n.B3, 0], [n.C3, n.G3, bar*2], [n.G3, n.D4, bar*4], [n.D3, n.A3, bar*6]]
                .forEach(([r, f, t]) => {
                    owenPlayNote(r, t, bar*1.9, 'sawtooth', 0.025 * fifthVol);
                    owenPlayNote(f, t, bar*1.9, 'sawtooth', 0.02 * fifthVol);
                });
            }
            
            // Pluck Bass
            if (layers.includes('pluck') && pluckVol > 0) {
                const plucks = [
                    'E3','E3','E3','E3', 'E3','E3','E3','E3',
                    'C3','C3','C3','C3', 'C3','C3','C3','C3',
                    'G3','G3','G3','G3', 'G3','G3','G3','G3',
                    'D3','D3','D3','D3', 'D3','D3','D3','D3'
                ];
                plucks.forEach((p, i) => owenPlayNote(n[p], i*q, q*0.25, 'triangle', 0.1 * pluckVol));
            }
            
            owenLoopTimeout = setTimeout(playOwenPageLoop, OWEN_LOOP_DURATION * 1000);
        }
        
        function startOwenPageMusic() {
            if (owenAudioContext) return; // Already playing
            
            owenAudioContext = new (window.AudioContext || window.webkitAudioContext)();
            owenGainNode = owenAudioContext.createGain();
            owenGainNode.connect(owenAudioContext.destination);
            owenGainNode.gain.value = 0.02; // Start very quiet
            
            owenMusicPlaying = true;
            owenStartTime = Date.now();
            playOwenPageLoop();
        }
        
        // Elevator descent sound effects
        let elevatorFloorsTriggered = new Set();
        
        function playElevatorDing(floorType = 'normal') {
            if (!owenAudioContext) return;
            
            const now = owenAudioContext.currentTime;
            
            if (floorType === 'normal') {
                // Classic elevator ding - two tones
                const osc1 = owenAudioContext.createOscillator();
                const osc2 = owenAudioContext.createOscillator();
                const gain = owenAudioContext.createGain();
                
                osc1.connect(gain);
                osc2.connect(gain);
                gain.connect(owenAudioContext.destination);
                
                osc1.frequency.value = 880; // A5
                osc2.frequency.value = 1108.73; // C#6
                osc1.type = 'sine';
                osc2.type = 'sine';
                
                gain.gain.setValueAtTime(0.08, now);
                gain.gain.exponentialDecayTo = 0.001;
                gain.gain.setValueAtTime(0.08, now);
                gain.gain.exponentialDecayTo = 0.001;
                gain.gain.setTargetAtTime(0.001, now + 0.1, 0.3);
                
                osc1.start(now);
                osc2.start(now);
                osc1.stop(now + 0.8);
                osc2.stop(now + 0.8);
            } else if (floorType === 'symbol') {
                // Creepy dissonant tone for symbol floors
                const osc1 = owenAudioContext.createOscillator();
                const osc2 = owenAudioContext.createOscillator();
                const gain = owenAudioContext.createGain();
                const filter = owenAudioContext.createBiquadFilter();
                
                osc1.connect(filter);
                osc2.connect(filter);
                filter.connect(gain);
                gain.connect(owenAudioContext.destination);
                
                filter.type = 'lowpass';
                filter.frequency.value = 800;
                
                osc1.frequency.value = 220; // Low A
                osc2.frequency.value = 233.08; // Slightly detuned - dissonant
                osc1.type = 'sawtooth';
                osc2.type = 'triangle';
                
                gain.gain.setValueAtTime(0.06, now);
                gain.gain.setTargetAtTime(0.001, now + 0.2, 0.5);
                
                osc1.start(now);
                osc2.start(now);
                osc1.stop(now + 1.2);
                osc2.stop(now + 1.2);
            } else if (floorType === 'corrupted') {
                // Glitchy static burst
                const bufferSize = owenAudioContext.sampleRate * 0.3;
                const buffer = owenAudioContext.createBuffer(1, bufferSize, owenAudioContext.sampleRate);
                const data = buffer.getChannelData(0);
                
                for (let i = 0; i < bufferSize; i++) {
                    // Harsh digital noise with occasional silence
                    if (Math.random() > 0.3) {
                        data[i] = (Math.random() * 2 - 1) * (Math.random() > 0.5 ? 1 : 0.3);
                    } else {
                        data[i] = 0;
                    }
                }
                
                const noise = owenAudioContext.createBufferSource();
                const gain = owenAudioContext.createGain();
                const filter = owenAudioContext.createBiquadFilter();
                
                noise.buffer = buffer;
                noise.connect(filter);
                filter.connect(gain);
                gain.connect(owenAudioContext.destination);
                
                filter.type = 'bandpass';
                filter.frequency.value = 2000;
                filter.Q.value = 5;
                
                gain.gain.setValueAtTime(0.04, now);
                gain.gain.setTargetAtTime(0.001, now + 0.1, 0.15);
                
                noise.start(now);
                noise.stop(now + 0.4);
            } else if (floorType === 'final') {
                // Deep resonant hum for final floor
                const osc = owenAudioContext.createOscillator();
                const gain = owenAudioContext.createGain();
                
                osc.connect(gain);
                gain.connect(owenAudioContext.destination);
                
                osc.frequency.value = 55; // Very low A
                osc.type = 'sine';
                
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(0.1, now + 0.5);
                gain.gain.setTargetAtTime(0.001, now + 1, 0.8);
                
                osc.start(now);
                osc.stop(now + 3);
            }
        }
        
        function setupElevatorFloorObserver() {
            const floorIndicators = document.querySelectorAll('[data-floor]');
            
            if (floorIndicators.length === 0) return;
            
            const observer = new SafeIntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const floor = entry.target.dataset.floor;
                        if (!elevatorFloorsTriggered.has(floor)) {
                            elevatorFloorsTriggered.add(floor);
                            
                            // Determine sound type based on floor
                            let soundType = 'normal';
                            if (floor.startsWith('corrupt')) {
                                soundType = 'corrupted';
                            } else if (floor.startsWith('symbol')) {
                                soundType = 'symbol';
                            } else if (floor === 'final') {
                                soundType = 'final';
                            }
                            
                            playElevatorDing(soundType);
                        }
                    }
                });
            }, {
                threshold: 0.5,
                rootMargin: '-20% 0px -20% 0px'
            });
            
            floorIndicators.forEach(indicator => observer.observe(indicator));
        }
        
        function setupOwenScrollEffect() {
            const owenPage = document.getElementById('owenPage');
            const whiteOverlay = document.getElementById('owenWhiteOverlay');
            const whiteFadeZone = document.getElementById('whiteFadeZone');
            const owenCredits = document.getElementById('owenCredits');
            const elevatorDescent = document.getElementById('elevatorDescent');
            const floorLine = document.getElementById('elevatorFloorLine');
            
            if (!owenPage || !whiteOverlay) return;
            
            let ticking = false;
            
            function handleOwenScroll() {
                if (!owenPage.classList.contains('active')) return;
                
                if (!ticking) {
                    requestAnimationFrame(function() {
                        const scrollY = window.scrollY;
                        const pageHeight = document.documentElement.scrollHeight - window.innerHeight;
                        const scrollPercent = pageHeight > 0 ? scrollY / pageHeight : 0;
                        
                        // Get all animated elements that should stop when fading
                        const animatedElements = document.querySelectorAll('.redacted-waiting');
                        
                        // Show floor line during elevator descent section
                        if (elevatorDescent && floorLine) {
                            const elevatorRect = elevatorDescent.getBoundingClientRect();
                            const inElevator = elevatorRect.top < window.innerHeight && elevatorRect.bottom > 0;
                            
                            if (inElevator && scrollPercent < 0.85) {
                                floorLine.classList.add('active');
                            } else {
                                floorLine.classList.remove('active');
                            }
                        }
                        
                        // Start fading to white in the last 30% of scroll
                        if (scrollPercent > 0.7) {
                            const fadePercent = (scrollPercent - 0.7) / 0.3; // 0 to 1 in last 30%
                            whiteOverlay.style.opacity = Math.min(fadePercent * 0.98, 0.98);
                            
                            // Stop animations and hide elements as we fade
                            animatedElements.forEach(el => {
                                el.style.animation = 'none';
                                el.style.opacity = Math.max(1 - fadePercent * 2, 0);
                            });
                        } else {
                            whiteOverlay.style.opacity = 0;
                            // Restore animations when not in fade zone
                            animatedElements.forEach(el => {
                                el.style.animation = '';
                                el.style.opacity = '';
                            });
                        }
                        
                        // When very close to bottom, make overlay fully white except credits
                        if (scrollPercent > 0.95) {
                            whiteOverlay.style.opacity = 1;
                        }
                        
                        ticking = false;
                    });
                    ticking = true;
                }
            }
            
            window.addEventListener('scroll', handleOwenScroll, { passive: true });
        }
        
        console.log('%cWARNING', 'color: #ffa040; font-size: 20px; font-weight: bold;');
        console.log('%cThis assessment is monitored.', 'color: #858585; font-size: 12px;');
        
        // White fade effect for white room story
        let whiteFadeTriggered = false;
        window.addEventListener('scroll', function() {
            if (whiteFadeTriggered) return;
            
            const whiteRoomStory = document.getElementById('whiteRoomStory');
            if (!whiteRoomStory) return;
            
            const rect = whiteRoomStory.getBoundingClientRect();
            const viewportHeight = window.innerHeight;
            
            // Trigger when user scrolls 30% through the white room story
            if (rect.top < viewportHeight * 0.4 && rect.bottom > viewportHeight * 0.3) {
                whiteFadeTriggered = true;
                whiteRoomStory.classList.add('fading-to-white');
            }
        }, { passive: true });
        
        // ============ REPORT FUNCTIONALITY ============
        function openReportModal() {
            document.getElementById('reportModal').classList.add('active');
            document.getElementById('reportText').focus();
        }
        
        function closeReportModal() {
            document.getElementById('reportModal').classList.remove('active');
            // Reset form after closing
            setTimeout(() => {
                document.getElementById('reportForm').classList.remove('hidden');
                document.getElementById('reportConfirmation').classList.remove('active');
                document.getElementById('reportText').value = '';
                document.getElementById('reportEmail').value = '';
            }, 300);
        }
        
        function submitReport() {
            const reportText = document.getElementById('reportText').value.trim();
            const reportEmail = document.getElementById('reportEmail').value.trim();
            if (!reportText) return;
            
            const submitBtn = document.getElementById('reportSubmitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'SUBMITTING...';
            
            // Collect metadata
            const reportData = {
                message: reportText,
                email: reportEmail || 'Not provided',
                timestamp: new Date().toISOString(),
                timeOnPage: Math.floor((Date.now() - (startTime || Date.now())) / 1000),
                currentSection: currentTest,
                complianceScore: document.getElementById('score').textContent,
                amberRead: amberRead,
                greenRead: greenRead,
                userAgent: navigator.userAgent
            };
            
            // === FORM ENDPOINT ===
            const FORM_ENDPOINT = 'https://formspree.io/f/xpqqqvzz';
            
            fetch(FORM_ENDPOINT, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify(reportData)
            })
            .then(response => {
                showReportConfirmation();
            })
            .catch(error => {
                // Still show confirmation even if submission fails
                // (for demo purposes / offline testing)
                console.log('Report data:', reportData);
                showReportConfirmation();
            });
        }
        
        function showReportConfirmation() {
            document.getElementById('reportForm').classList.add('hidden');
            document.getElementById('reportConfirmation').classList.add('active');
            
            // Auto-close after 3 seconds
            setTimeout(() => {
                closeReportModal();
            }, 3000);
        }
        
        // Close modal on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && document.getElementById('reportModal').classList.contains('active')) {
                closeReportModal();
            }
        });
        
        // Close modal on background click
        document.getElementById('reportModal').addEventListener('click', (e) => {
            if (e.target.id === 'reportModal') {
                closeReportModal();
            }
        });
        
        // ============ OWEN'S RIGGED BLACKJACK ============
        let owenBjDeck = [];
        let owenBjPlayerHand = [];
        let owenBjDealerHand = [];
        let owenBjGameOver = false;
        let owenBjMoney = 347; // Starting balance - feels personal
        let owenBjCurrentBet = 50; // Default bet
        
        function owenSelectBet(amount, btn) {
            owenBjCurrentBet = amount;
            
            // Update chip styling
            document.querySelectorAll('#owenBjBetRow .bj-chip').forEach(c => c.classList.remove('selected'));
            btn.classList.add('selected');
            
            // Update status
            document.getElementById('owenBjStatus').textContent = '$' + amount + ' selected • DEAL to play';
        }
        
        function owenUpdateMoney() {
            const moneyEl = document.getElementById('owenBjMoney');
            if (owenBjMoney >= 0) {
                moneyEl.textContent = '$' + owenBjMoney;
                moneyEl.classList.remove('negative');
            } else {
                moneyEl.textContent = '-$' + Math.abs(owenBjMoney);
                moneyEl.classList.add('negative');
            }
        }
        
        function owenCreateDeck() {
            const suits = ['S', 'H', 'D', 'C'];
            const values = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
            owenBjDeck = [];
            for (let suit of suits) {
                for (let value of values) {
                    let numValue = parseInt(value) || (value === 'A' ? 11 : 10);
                    owenBjDeck.push({ suit, value, numValue });
                }
            }
            // Shuffle
            for (let i = owenBjDeck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [owenBjDeck[i], owenBjDeck[j]] = [owenBjDeck[j], owenBjDeck[i]];
            }
        }
        
        function owenDrawCard() {
            return owenBjDeck.pop();
        }
        
        function owenCalculateHand(hand) {
            let total = 0;
            let aces = 0;
            for (let card of hand) {
                total += card.numValue;
                if (card.value === 'A') aces++;
            }
            while (total > 21 && aces > 0) {
                total -= 10;
                aces--;
            }
            return total;
        }
        
        function owenRenderCard(card, hidden = false) {
            if (hidden) {
                return '<div class="card hidden">?</div>';
            }
            // Use actual suit symbols with colors
            var suitSymbols = { 'S': '♠', 'H': '♥', 'D': '♦', 'C': '♣' };
            var suitColors = { 'S': '#fff', 'H': '#ff6b6b', 'D': '#ff6b6b', 'C': '#fff' };
            var symbol = suitSymbols[card.suit];
            var color = suitColors[card.suit];
            return '<div class="card"><span class="card-value">' + card.value + '</span><span class="card-suit" style="color:' + color + '">' + symbol + '</span></div>';
        }
        
        function owenUpdateDisplay() {
            const playerCards = document.getElementById('owenPlayerCards');
            const dealerCards = document.getElementById('owenDealerCards');
            const playerValue = document.getElementById('owenPlayerValue');
            const dealerValue = document.getElementById('owenDealerValue');
            
            playerCards.innerHTML = owenBjPlayerHand.map(c => owenRenderCard(c)).join('');
            playerValue.textContent = owenCalculateHand(owenBjPlayerHand);
            
            if (owenBjGameOver) {
                dealerCards.innerHTML = owenBjDealerHand.map(c => owenRenderCard(c)).join('');
                dealerValue.textContent = owenCalculateHand(owenBjDealerHand);
            } else {
                dealerCards.innerHTML = owenRenderCard(owenBjDealerHand[0]) + owenRenderCard(owenBjDealerHand[1], true);
                dealerValue.textContent = owenBjDealerHand[0].numValue;
            }
        }
        
        function owenNewGame() {
            owenCreateDeck();
            owenBjPlayerHand = [owenDrawCard(), owenDrawCard()];
            owenBjDealerHand = [owenDrawCard(), owenDrawCard()];
            owenBjGameOver = false;
            
            // Deduct bet
            owenBjMoney -= owenBjCurrentBet;
            owenUpdateMoney();
            
            // Show action buttons, hide bet buttons
            document.getElementById('owenBjStatus').textContent = 'HIT or STAND';
            document.getElementById('owenBjBetRow').classList.add('hidden');
            document.getElementById('owenBjActionRow').classList.remove('hidden');
            
            owenUpdateDisplay();
            playBlackjackDeal();
        }
        
        function owenHit() {
            if (owenBjGameOver) return;
            playBlackjackHit();
            owenBjPlayerHand.push(owenDrawCard());
            owenUpdateDisplay();
            
            if (owenCalculateHand(owenBjPlayerHand) > 21) {
                owenEndGame('BUST', false);
            }
        }
        
        function owenStand() {
            if (owenBjGameOver) return;
            playBlackjackStand();
            
            // RIGGED: Dealer always busts when Owen stands (max 6 cards to prevent too many)
            let cardCount = owenBjDealerHand.length;
            while (owenCalculateHand(owenBjDealerHand) < 22 && cardCount < 6) {
                owenBjDealerHand.push(owenDrawCard());
                cardCount++;
            }
            
            owenUpdateDisplay();
            owenEndGame('DEALER BUST', true);
        }
        
        function owenEndGame(message, won) {
            owenBjGameOver = true;
            
            // Handle money
            if (won) {
                owenBjMoney += owenBjCurrentBet * 2; // Return bet + winnings
                playBlackjackWin();
            } else {
                // Bet already deducted
                playBlackjackLose();
            }
            
            owenUpdateMoney();
            
            // Update status with result
            const statusEl = document.getElementById('owenBjStatus');
            statusEl.textContent = message;
            statusEl.classList.remove('win', 'lose');
            if (won) statusEl.classList.add('win');
            else statusEl.classList.add('lose');
            
            owenUpdateDisplay();
            
            // Return to bet selection after delay
            setTimeout(() => {
                document.getElementById('owenBjActionRow').classList.add('hidden');
                document.getElementById('owenBjBetRow').classList.remove('hidden');
                statusEl.textContent = '$' + owenBjCurrentBet + ' selected • DEAL to play';
                statusEl.classList.remove('win', 'lose');
            }, 1500);
        }
        
        // Owen's blackjack doesn't auto-start - player clicks DEAL

        // ============ SNAKE GAME ============
        let snakeCanvas, snakeCtx;
        let snake, snakeFood, snakeDir, snakeNextDir;
        let snakeScore, snakeHigh, snakeGame;
        const snakeSize = 13;
        const snakeGrid = 20;

        function startSnake() {
            snakeCanvas = document.getElementById('snakeCanvas');
            snakeCtx = snakeCanvas.getContext('2d');
            
            snake = [{x: 10, y: 10}];
            snakeDir = {x: 1, y: 0};
            snakeNextDir = {x: 1, y: 0};
            snakeScore = 0;
            snakeHigh = parseInt(safeStorage.get('snakeHigh', '0'));
            
            document.getElementById('snakeScore').textContent = snakeScore;
            document.getElementById('snakeHigh').textContent = snakeHigh;
            
            placeSnakeFood();
            
            if (snakeGame) clearInterval(snakeGame);
            snakeGame = setInterval(updateSnake, 120);
            
            // Touch controls
            let touchStartX, touchStartY;
            snakeCanvas.ontouchstart = (e) => {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
            };
            snakeCanvas.ontouchend = (e) => {
                if (!touchStartX || !touchStartY) return;
                const dx = e.changedTouches[0].clientX - touchStartX;
                const dy = e.changedTouches[0].clientY - touchStartY;
                if (Math.abs(dx) > Math.abs(dy)) {
                    setSnakeDir(dx > 0 ? 1 : -1, 0);
                } else {
                    setSnakeDir(0, dy > 0 ? 1 : -1);
                }
            };
        }

        function setSnakeDir(x, y) {
            // Prevent 180 turns
            if (snakeDir.x === -x && snakeDir.y === -y) return;
            if (x !== 0 && snakeDir.x !== 0) return;
            if (y !== 0 && snakeDir.y !== 0) return;
            snakeNextDir = {x, y};
        }

        function placeSnakeFood() {
            snakeFood = {
                x: Math.floor(Math.random() * snakeGrid),
                y: Math.floor(Math.random() * snakeGrid)
            };
            // Don't place on snake
            for (let seg of snake) {
                if (seg.x === snakeFood.x && seg.y === snakeFood.y) {
                    placeSnakeFood();
                    return;
                }
            }
        }

        function updateSnake() {
            snakeDir = snakeNextDir;
            
            const head = {
                x: (snake[0].x + snakeDir.x + snakeGrid) % snakeGrid,
                y: (snake[0].y + snakeDir.y + snakeGrid) % snakeGrid
            };
            
            // Check collision with self
            for (let seg of snake) {
                if (seg.x === head.x && seg.y === head.y) {
                    playErrorSound(); // Add death sound
                    clearInterval(snakeGame);
                    if (snakeScore > snakeHigh) {
                        snakeHigh = snakeScore;
                        safeStorage.set('snakeHigh', snakeHigh);
                        document.getElementById('snakeHigh').textContent = snakeHigh;
                    }
                    return;
                }
            }
            
            snake.unshift(head);
            
            // Check food
            if (head.x === snakeFood.x && head.y === snakeFood.y) {
                playClickSound(); // Add eating sound
                snakeScore += 10;
                document.getElementById('snakeScore').textContent = snakeScore;
                placeSnakeFood();
            } else {
                snake.pop();
            }
            
            drawSnake();
        }

        function drawSnake() {
            snakeCtx.fillStyle = '#0a0a0a';
            snakeCtx.fillRect(0, 0, snakeCanvas.width, snakeCanvas.height);
            
            // Draw food
            snakeCtx.fillStyle = '#ff6b6b';
            snakeCtx.shadowColor = '#ff6b6b';
            snakeCtx.shadowBlur = 10;
            snakeCtx.fillRect(snakeFood.x * snakeSize, snakeFood.y * snakeSize, snakeSize - 1, snakeSize - 1);
            
            // Draw snake with white glow
            snakeCtx.shadowColor = '#ffffff';
            snakeCtx.shadowBlur = 15;
            for (let i = 0; i < snake.length; i++) {
                const alpha = 1 - (i / snake.length) * 0.6;
                snakeCtx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
                snakeCtx.shadowBlur = 15 * alpha;
                snakeCtx.fillRect(snake[i].x * snakeSize, snake[i].y * snakeSize, snakeSize - 1, snakeSize - 1);
            }
            snakeCtx.shadowBlur = 0;
        }
        
        function stopSnakeGame() {
            if (snakeGame) {
                clearInterval(snakeGame);
                snakeGame = null;
            }
        }

        // ============ HORSE BASKETBALL GAME ============
        let horseCanvas, horseCtx;
        let horseGameLoop;
        let horseMisses = 0;
        let ballState = 'ready'; // 'ready', 'flying', 'scored', 'missed'
        
        // Game objects
        let platform = { y: 180, direction: 1, speed: 0.8 };
        let hoop = { x: 200, y: 80, xDir: -1, yDir: -1, xSpeed: 0.4, ySpeed: 0.6 };
        let ball = { x: 0, y: 0, vx: 0, vy: 0 };
        
        const BALL_RADIUS = 8;
        const HOOP_WIDTH = 40;
        const HOOP_HEIGHT = 8;
        const PLATFORM_WIDTH = 50;
        const PLATFORM_HEIGHT = 10;
        const GRAVITY = 0.15;
        
        function startHorseGame() {
            horseCanvas = document.getElementById('horseCanvas');
            horseCtx = horseCanvas.getContext('2d');
            
            // Reset game state
            horseMisses = 0;
            ballState = 'ready';
            platform = { y: 180, direction: 1, speed: 0.8 };
            hoop = { x: 200, y: 80, xDir: -1, yDir: -1, xSpeed: 0.4, ySpeed: 0.6 };
            
            // Reset letters in title
            document.querySelectorAll('.horse-title-score span').forEach(span => {
                span.classList.remove('lit');
            });
            
            // Hide game over
            document.getElementById('horseGameOver').classList.remove('visible');
            document.getElementById('horseShootBtn').disabled = false;
            
            // Start game loop
            if (horseGameLoop) cancelAnimationFrame(horseGameLoop);
            updateHorseGame();
        }
        
        function updateHorseGame() {
            // Move platform up and down (range: 60-270)
            platform.y += platform.direction * platform.speed;
            if (platform.y <= 60) {
                platform.direction = 1;
            } else if (platform.y >= 270) {
                platform.direction = -1;
            }
            
            // Move hoop horizontally (range: 140-240)
            hoop.x += hoop.xDir * hoop.xSpeed;
            if (hoop.x <= 140) {
                hoop.xDir = 1;
            } else if (hoop.x >= 240) {
                hoop.xDir = -1;
            }
            
            // Move hoop vertically (range: 30-150)
            hoop.y += hoop.yDir * hoop.ySpeed;
            if (hoop.y <= 30) {
                hoop.yDir = 1;
            } else if (hoop.y >= 150) {
                hoop.yDir = -1;
            }
            
            // Update ball if flying
            if (ballState === 'flying') {
                ball.vy += GRAVITY;
                ball.x += ball.vx;
                ball.y += ball.vy;
                
                // Check if ball scored (goes through hoop)
                if (ball.x >= hoop.x - HOOP_WIDTH/2 && 
                    ball.x <= hoop.x + HOOP_WIDTH/2 &&
                    ball.y >= hoop.y - 5 && 
                    ball.y <= hoop.y + 15 &&
                    ball.vy > 0) {
                    ballState = 'scored';
                    playClickSound();
                    setTimeout(resetBall, 500);
                }
                
                // Check if ball missed (went off screen or too low)
                if (ball.y > horseCanvas.height + 20 || ball.x > horseCanvas.width + 20 || ball.x < -20) {
                    ballState = 'missed';
                    addHorseLetter();
                    setTimeout(resetBall, 500);
                }
            }
            
            drawHorseGame();
            
            if (horseMisses < 5) {
                horseGameLoop = requestAnimationFrame(updateHorseGame);
            }
        }
        
        function shootBall() {
            if (ballState !== 'ready') return;
            
            playChoiceSound();
            ballState = 'flying';
            
            // Ball starts from platform
            ball.x = 30;
            ball.y = platform.y - PLATFORM_HEIGHT/2 - BALL_RADIUS;
            
            // Consistent arc - same velocity every time
            ball.vx = 2.8;
            ball.vy = -5.2;
        }
        
        function resetBall() {
            ballState = 'ready';
        }
        
        function addHorseLetter() {
            playErrorSound();
            const letters = ['h', 'o', 'r', 's', 'e'];
            if (horseMisses < 5) {
                document.getElementById(letters[horseMisses] + '-letter').classList.add('lit');
                horseMisses++;
                
                if (horseMisses >= 5) {
                    // Game over
                    setTimeout(() => {
                        document.getElementById('horseGameOver').classList.add('visible');
                        document.getElementById('horseShootBtn').disabled = true;
                    }, 300);
                }
            }
        }
        
        function drawHorseGame() {
            const ctx = horseCtx;
            const w = horseCanvas.width;
            const h = horseCanvas.height;
            
            // Clear canvas
            ctx.fillStyle = '#0a0a0a';
            ctx.fillRect(0, 0, w, h);
            
            // Draw backboard
            ctx.fillStyle = '#333';
            ctx.fillRect(hoop.x + HOOP_WIDTH/2, hoop.y - 30, 8, 50);
            
            // Draw hoop (rim)
            ctx.strokeStyle = '#a8e84a';
            ctx.lineWidth = 3;
            ctx.shadowColor = '#a8e84a';
            ctx.shadowBlur = 10;
            ctx.beginPath();
            ctx.moveTo(hoop.x - HOOP_WIDTH/2, hoop.y);
            ctx.lineTo(hoop.x + HOOP_WIDTH/2, hoop.y);
            ctx.stroke();
            
            // Draw net (simple lines)
            ctx.strokeStyle = 'rgba(168, 232, 74, 0.3)';
            ctx.lineWidth = 1;
            ctx.shadowBlur = 0;
            for (let i = 0; i < 5; i++) {
                const nx = hoop.x - HOOP_WIDTH/2 + (HOOP_WIDTH/4) * i;
                ctx.beginPath();
                ctx.moveTo(nx, hoop.y);
                ctx.lineTo(nx + (i < 2 ? 5 : -5), hoop.y + 25);
                ctx.stroke();
            }
            
            // Draw platform
            ctx.fillStyle = '#a8e84a';
            ctx.shadowColor = '#a8e84a';
            ctx.shadowBlur = 15;
            ctx.fillRect(5, platform.y - PLATFORM_HEIGHT/2, PLATFORM_WIDTH, PLATFORM_HEIGHT);
            
            // Draw ball
            ctx.shadowBlur = 0;
            if (ballState === 'ready') {
                // Ball on platform
                ctx.fillStyle = '#ff8a50';
                ctx.shadowColor = '#ff8a50';
                ctx.shadowBlur = 10;
                ctx.beginPath();
                ctx.arc(30, platform.y - PLATFORM_HEIGHT/2 - BALL_RADIUS, BALL_RADIUS, 0, Math.PI * 2);
                ctx.fill();
                
                // Ball lines
                ctx.strokeStyle = '#cc6030';
                ctx.lineWidth = 1;
                ctx.shadowBlur = 0;
                ctx.beginPath();
                ctx.arc(30, platform.y - PLATFORM_HEIGHT/2 - BALL_RADIUS, BALL_RADIUS - 2, 0, Math.PI * 2);
                ctx.stroke();
            } else if (ballState === 'flying' || ballState === 'scored' || ballState === 'missed') {
                // Ball in flight
                ctx.fillStyle = ballState === 'scored' ? '#a8e84a' : '#ff8a50';
                ctx.shadowColor = ballState === 'scored' ? '#a8e84a' : '#ff8a50';
                ctx.shadowBlur = 10;
                ctx.beginPath();
                ctx.arc(ball.x, ball.y, BALL_RADIUS, 0, Math.PI * 2);
                ctx.fill();
            }
            
            ctx.shadowBlur = 0;
        }
        
        function stopHorseGame() {
            if (horseGameLoop) {
                cancelAnimationFrame(horseGameLoop);
                horseGameLoop = null;
            }
        }

        // ============ SUDOKU GAME ============
        let sudokuBoard, sudokuSolution, sudokuSelected;

        // Pre-made puzzles (easier to implement than generating)
        const sudokuPuzzles = [
            {
                puzzle: [
                    [5,3,0,0,7,0,0,0,0],
                    [6,0,0,1,9,5,0,0,0],
                    [0,9,8,0,0,0,0,6,0],
                    [8,0,0,0,6,0,0,0,3],
                    [4,0,0,8,0,3,0,0,1],
                    [7,0,0,0,2,0,0,0,6],
                    [0,6,0,0,0,0,2,8,0],
                    [0,0,0,4,1,9,0,0,5],
                    [0,0,0,0,8,0,0,7,9]
                ],
                solution: [
                    [5,3,4,6,7,8,9,1,2],
                    [6,7,2,1,9,5,3,4,8],
                    [1,9,8,3,4,2,5,6,7],
                    [8,5,9,7,6,1,4,2,3],
                    [4,2,6,8,5,3,7,9,1],
                    [7,1,3,9,2,4,8,5,6],
                    [9,6,1,5,3,7,2,8,4],
                    [2,8,7,4,1,9,6,3,5],
                    [3,4,5,2,8,6,1,7,9]
                ]
            },
            {
                puzzle: [
                    [0,0,0,2,6,0,7,0,1],
                    [6,8,0,0,7,0,0,9,0],
                    [1,9,0,0,0,4,5,0,0],
                    [8,2,0,1,0,0,0,4,0],
                    [0,0,4,6,0,2,9,0,0],
                    [0,5,0,0,0,3,0,2,8],
                    [0,0,9,3,0,0,0,7,4],
                    [0,4,0,0,5,0,0,3,6],
                    [7,0,3,0,1,8,0,0,0]
                ],
                solution: [
                    [4,3,5,2,6,9,7,8,1],
                    [6,8,2,5,7,1,4,9,3],
                    [1,9,7,8,3,4,5,6,2],
                    [8,2,6,1,9,5,3,4,7],
                    [3,7,4,6,8,2,9,1,5],
                    [9,5,1,7,4,3,6,2,8],
                    [5,1,9,3,2,6,8,7,4],
                    [2,4,8,9,5,7,1,3,6],
                    [7,6,3,4,1,8,2,5,9]
                ]
            },
            {
                puzzle: [
                    [0,2,0,6,0,8,0,0,0],
                    [5,8,0,0,0,9,7,0,0],
                    [0,0,0,0,4,0,0,0,0],
                    [3,7,0,0,0,0,5,0,0],
                    [6,0,0,0,0,0,0,0,4],
                    [0,0,8,0,0,0,0,1,3],
                    [0,0,0,0,2,0,0,0,0],
                    [0,0,9,8,0,0,0,3,6],
                    [0,0,0,3,0,6,0,9,0]
                ],
                solution: [
                    [1,2,3,6,7,8,9,4,5],
                    [5,8,4,2,3,9,7,6,1],
                    [9,6,7,1,4,5,3,2,8],
                    [3,7,2,4,6,1,5,8,9],
                    [6,9,1,5,8,3,2,7,4],
                    [4,5,8,7,9,2,6,1,3],
                    [8,3,6,9,2,4,1,5,7],
                    [2,1,9,8,5,7,4,3,6],
                    [7,4,5,3,1,6,8,9,2]
                ]
            }
        ];

        function startSudoku() {
            const puzzleData = sudokuPuzzles[Math.floor(Math.random() * sudokuPuzzles.length)];
            sudokuBoard = puzzleData.puzzle.map(row => [...row]);
            sudokuSolution = puzzleData.solution;
            sudokuSelected = null;
            
            renderSudoku();
        }

        function renderSudoku() {
            const grid = document.getElementById('sudokuGrid');
            grid.innerHTML = '';
            
            // Find original puzzle for this solution
            const originalPuzzle = sudokuPuzzles.find(p => 
                JSON.stringify(p.solution) === JSON.stringify(sudokuSolution)
            ).puzzle;
            
            for (let r = 0; r < 9; r++) {
                for (let c = 0; c < 9; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'sudoku-cell';
                    
                    const isGiven = originalPuzzle[r][c] !== 0;
                    
                    if (isGiven) {
                        cell.classList.add('given');
                        cell.textContent = originalPuzzle[r][c];
                    } else {
                        cell.classList.add('editable');
                        if (sudokuBoard[r][c] !== 0) {
                            cell.textContent = sudokuBoard[r][c];
                            // Check if correct
                            if (sudokuBoard[r][c] === sudokuSolution[r][c]) {
                                cell.classList.add('correct');
                            } else {
                                cell.classList.add('error');
                            }
                        }
                        cell.onclick = () => openSudokuPopup(r, c);
                    }
                    
                    grid.appendChild(cell);
                }
            }
            
            // Check win
            checkSudokuWin();
        }

        function openSudokuPopup(r, c) {
            sudokuSelected = {r, c};
            document.getElementById('sudokuPopup').classList.add('active');
        }

        function closeSudokuPopup() {
            document.getElementById('sudokuPopup').classList.remove('active');
            sudokuSelected = null;
        }

        function placeSudokuNum(num) {
            if (sudokuSelected) {
                sudokuBoard[sudokuSelected.r][sudokuSelected.c] = num;
                renderSudoku();
            }
            closeSudokuPopup();
        }

        function checkSudokuWin() {
            for (let r = 0; r < 9; r++) {
                for (let c = 0; c < 9; c++) {
                    if (sudokuBoard[r][c] !== sudokuSolution[r][c]) {
                        return false;
                    }
                }
            }
            // Win!
            playSuccessSound(); // Add success sound
            setTimeout(() => {
                alert('Puzzle Complete! Well done, Owen.');
            }, 100);
            return true;
        }
        
        // ============ HIDDEN HORSE EASTER EGG ============
        let horsePiecesFound = safeStorage.getJSON('horsePiecesFound', {});
        
        function triggerHorseSound(element) {
            if (!element || !element.id) return;
            
            // Check if this piece was already found
            if (horsePiecesFound[element.id]) return;
            
            // Mark this piece as found
            horsePiecesFound[element.id] = true;
            safeStorage.setJSON('horsePiecesFound', horsePiecesFound);
            
            // Play mysterious sound
            playHorseSound();
            
            // Fade out and hide the horse
            element.style.opacity = '0';
            element.style.pointerEvents = 'none';
            setTimeout(() => element.remove(), 500);
            
            // Show TROJAN notification
            const notification = document.getElementById('horseFoundNotification');
            const text = document.getElementById('horseFoundText');
            
            text.textContent = 'TROJAN';
            text.classList.add('trojan');
            
            notification.classList.add('visible');
            
            // Hide notification after a delay
            setTimeout(() => {
                notification.classList.remove('visible');
            }, 3000);
        }
        
        // Check if piece was already found (for DJ horse created dynamically)
        function initHorsePieces() {
            // Nothing to do on page load - DJ horse is created dynamically after the drop
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', initHorsePieces);
        
        function playHorseSound() {
            if (!soundEnabled) return;
            
            try {
                const ctx = initSoundContext();
                if (!ctx) return;
                const now = ctx.currentTime;
                
                // Mysterious ethereal chord
                const freqs = [73.42, 110, 146.83]; // D2, A2, D3 - hollow fifth
                
                freqs.forEach((freq, i) => {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    const filter = ctx.createBiquadFilter();
                    
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(freq, now);
                    osc.detune.setValueAtTime(Math.random() * 8 - 4, now);
                    
                    filter.type = 'lowpass';
                    filter.frequency.setValueAtTime(300, now);
                    filter.frequency.exponentialRampToValueAtTime(80, now + 1.5);
                    filter.Q.value = 1;
                    
                    gain.gain.setValueAtTime(0, now);
                    gain.gain.linearRampToValueAtTime(MASTER_VOLUME * 0.1, now + 0.3);
                    gain.gain.exponentialRampToValueAtTime(0.001, now + 1.8);
                    
                    osc.connect(filter);
                    filter.connect(gain);
                    gain.connect(ctx.destination);
                    
                    osc.start(now + i * 0.05);
                    osc.stop(now + 2);
                });
                
            } catch(e) {
                console.log('Horse sound error:', e);
            }
        }
        

        // WebGL dream effect removed

        
        // ============ OWEN'S PAGE WISP EFFECT ============
        // Beautiful somber smoke/wisp particles with melodic notes
        
        let owenWispCanvas = null;
        let owenWispCtx = null;
        let owenWisps = [];
        let owenAmbientCircles = []; // New: ambient following circles
        let owenWispActive = false;
        let owenWispAnimationId = null;
        let owenNoteIndex = 0;
        let owenScrollPercent = 0;
        let owenLastScrollY = 0;
        let owenLastFrameTime = 0;
        let owenLastAmbientSpawn = 0;
        const owenFrameInterval = window.innerWidth < 768 ? 33 : 16; // 30fps on mobile, 60fps on desktop
        const owenMaxParticles = window.innerWidth < 768 ? 50 : 100;
        const owenParticleCount = window.innerWidth < 768 ? 3 : 5;
        const owenMaxAmbientCircles = window.innerWidth < 768 ? 8 : 15;
        
        // Pentatonic scale in E minor - somber and beautiful
        // Root note (E) has 25% chance, others distributed
        const owenScale = [
            { freq: 164.81, name: 'E3', isRoot: true },   // Root
            { freq: 196.00, name: 'G3', isRoot: false },
            { freq: 220.00, name: 'A3', isRoot: false },
            { freq: 246.94, name: 'B3', isRoot: false },
            { freq: 293.66, name: 'D4', isRoot: false },
            { freq: 329.63, name: 'E4', isRoot: true },   // Root octave
            { freq: 392.00, name: 'G4', isRoot: false },
            { freq: 440.00, name: 'A4', isRoot: false },
        ];
        
        // Pre-generated note sequence (root note appears ~25% of time)
        const owenNoteSequence = [
            0, 2, 4, 1, 5, 3, 0, 6, 2, 7, 0, 4, 1, 3, 5, 0, 
            7, 2, 6, 0, 4, 1, 5, 3, 0, 2, 7, 4, 0, 6, 1, 5,
            0, 3, 2, 7, 5, 0, 4, 6, 1, 0, 3, 5, 2, 7, 0, 4
        ];
        
        // Get circle color based on scroll position (adapts to background)
        function getOwenCircleColor(scrollPercent) {
            // Page goes from dark (0%) to white (100%)
            // Before 70%: dark background → use white circles
            // 70-100%: transitioning to white → circles need to be dark to stay visible
            // But with mix-blend-mode: difference, white always works!
            // However, let's add explicit control for better visibility
            
            if (scrollPercent < 0.65) {
                // Dark section - white circles
                return { r: 255, g: 255, b: 255 };
            } else if (scrollPercent < 0.85) {
                // Transition zone - gray circles that show on both
                const t = (scrollPercent - 0.65) / 0.2;
                const val = Math.floor(255 - t * 128); // 255 to 127
                return { r: val, g: val, b: val };
            } else {
                // White section - darker circles
                return { r: 80, g: 80, b: 80 };
            }
        }
        
        // Create ambient following circle (spawned during scroll)
        function createAmbientCircle() {
            if (!owenWispActive) return;
            
            const scrollY = window.scrollY;
            const pageHeight = document.documentElement.scrollHeight - window.innerHeight;
            owenScrollPercent = pageHeight > 0 ? scrollY / pageHeight : 0;
            
            // Random position across the viewport width, near current scroll position
            const x = Math.random() * window.innerWidth;
            const y = window.innerHeight * (0.3 + Math.random() * 0.5); // Middle 50% of viewport
            
            // Varied sizes - some small, some medium, some larger
            const sizeRoll = Math.random();
            let size;
            if (sizeRoll < 0.5) {
                size = 20 + Math.random() * 30; // Small: 20-50px
            } else if (sizeRoll < 0.85) {
                size = 50 + Math.random() * 50; // Medium: 50-100px
            } else {
                size = 100 + Math.random() * 80; // Large: 100-180px
            }
            
            // Get color based on scroll position
            const color = getOwenCircleColor(owenScrollPercent);
            
            owenAmbientCircles.push({
                x: x,
                y: y,
                targetX: x + (Math.random() - 0.5) * 100, // Gentle drift
                targetY: y - 50 - Math.random() * 100, // Float upward
                size: size,
                alpha: 0.08 + Math.random() * 0.12, // Subtle
                life: 1,
                decay: 0.003 + Math.random() * 0.004, // Slow fade
                color: color,
                driftSpeed: 0.3 + Math.random() * 0.5
            });
            
            // Limit count
            if (owenAmbientCircles.length > owenMaxAmbientCircles) {
                owenAmbientCircles = owenAmbientCircles.slice(-Math.floor(owenMaxAmbientCircles * 0.7));
            }
        }
        
        function initOwenWisp() {
            owenWispCanvas = document.getElementById('owenWispCanvas');
            if (!owenWispCanvas) return;
            
            owenWispCtx = owenWispCanvas.getContext('2d');
            if (!owenWispCtx) return;
            
            function resizeOwenCanvas() {
                owenWispCanvas.width = window.innerWidth;
                owenWispCanvas.height = window.innerHeight;
            }
            resizeOwenCanvas();
            window.addEventListener('resize', resizeOwenCanvas);
        }
        
        function createOwenWisp(x, y) {
            if (!owenWispActive) return;
            
            // Reduce intensity at top of screen
            const topFade = Math.min(1, y / (window.innerHeight * 0.3));
            
            // Create fewer particles on mobile
            const particleCount = owenParticleCount + Math.floor(Math.random() * owenParticleCount);
            
            for (let i = 0; i < particleCount; i++) {
                const angle = Math.random() * Math.PI * 2;
                const speed = 0.2 + Math.random() * 0.5;
                const size = 40 + Math.random() * 80;
                
                owenWisps.push({
                    x: x + (Math.random() - 0.5) * 50,
                    y: y + (Math.random() - 0.5) * 50,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed - 0.3,
                    size: size,
                    maxSize: size * 1.8,
                    alpha: (0.15 + Math.random() * 0.15) * topFade,
                    life: 1,
                    decay: 0.002 + Math.random() * 0.003,
                    rotation: Math.random() * Math.PI * 2,
                    rotationSpeed: (Math.random() - 0.5) * 0.01
                });
            }
            
            // Keep wisp count reasonable - reduced on mobile
            if (owenWisps.length > owenMaxParticles) {
                owenWisps = owenWisps.slice(-Math.floor(owenMaxParticles * 0.7));
            }
        }
        
        function playOwenNote() {
            if (!soundEnabled) return;
            
            try {
                const ctx = initSoundContext();
                if (!ctx) return;
                const now = ctx.currentTime;
                
                // Get next note from sequence
                const noteData = owenScale[owenNoteSequence[owenNoteIndex % owenNoteSequence.length]];
                owenNoteIndex++;
                
                const freq = noteData.freq;
                
                // Main tone
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                const filter = ctx.createBiquadFilter();
                
                osc.type = 'sine';
                osc.frequency.setValueAtTime(freq, now);
                
                // Gentle vibrato
                const vibrato = ctx.createOscillator();
                const vibratoGain = ctx.createGain();
                vibrato.frequency.value = 4;
                vibratoGain.gain.value = 2;
                vibrato.connect(vibratoGain);
                vibratoGain.connect(osc.frequency);
                vibrato.start(now);
                vibrato.stop(now + 4);
                
                // Warm lowpass filter
                filter.type = 'lowpass';
                filter.frequency.setValueAtTime(800, now);
                filter.frequency.exponentialRampToValueAtTime(300, now + 3);
                filter.Q.value = 1;
                
                // Soft envelope - piano-like with long release
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(MASTER_VOLUME * 0.2, now + 0.05);
                gain.gain.setValueAtTime(MASTER_VOLUME * 0.15, now + 0.1);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 3.5);
                
                osc.connect(filter);
                filter.connect(gain);
                gain.connect(ctx.destination);
                
                osc.start(now);
                osc.stop(now + 4);
                
                // Add subtle harmonic (octave below, very quiet)
                if (Math.random() > 0.5) {
                    const osc2 = ctx.createOscillator();
                    const gain2 = ctx.createGain();
                    
                    osc2.type = 'sine';
                    osc2.frequency.setValueAtTime(freq * 0.5, now);
                    
                    gain2.gain.setValueAtTime(0, now);
                    gain2.gain.linearRampToValueAtTime(MASTER_VOLUME * 0.05, now + 0.1);
                    gain2.gain.exponentialRampToValueAtTime(0.001, now + 2.5);
                    
                    osc2.connect(gain2);
                    gain2.connect(ctx.destination);
                    
                    osc2.start(now);
                    osc2.stop(now + 3);
                }
                
            } catch(e) {
                console.log('Owen note error:', e);
            }
        }
        
        function renderOwenWisps(timestamp) {
            if (!owenWispCtx || !owenWispActive) return;
            
            // Throttle frame rate on mobile
            if (timestamp - owenLastFrameTime < owenFrameInterval) {
                owenWispAnimationId = requestAnimationFrame(renderOwenWisps);
                return;
            }
            owenLastFrameTime = timestamp;
            
            // Clear canvas
            owenWispCtx.clearRect(0, 0, owenWispCanvas.width, owenWispCanvas.height);
            
            const isMobile = window.innerWidth < 768;
            
            // Update and draw each wisp
            owenWisps = owenWisps.filter(wisp => {
                // Update position
                wisp.x += wisp.vx;
                wisp.y += wisp.vy;
                wisp.vy -= 0.008;
                wisp.rotation += wisp.rotationSpeed;
                
                // Update life
                wisp.life -= wisp.decay;
                
                // Grow slightly then shrink
                if (wisp.life > 0.6) {
                    wisp.size = wisp.size + (wisp.maxSize - wisp.size) * 0.05;
                }
                
                if (wisp.life <= 0) return false;
                
                // Fade based on screen position
                const topFade = Math.min(1, wisp.y / (window.innerHeight * 0.25));
                const alpha = wisp.alpha * wisp.life * wisp.life * topFade;
                
                if (isMobile) {
                    // Simpler drawing on mobile - single circle, no gradient
                    owenWispCtx.save();
                    owenWispCtx.globalAlpha = alpha * 0.4;
                    owenWispCtx.fillStyle = 'white';
                    owenWispCtx.beginPath();
                    owenWispCtx.arc(wisp.x, wisp.y, wisp.size * 0.6, 0, Math.PI * 2);
                    owenWispCtx.fill();
                    owenWispCtx.restore();
                } else {
                    // Full gradient effect on desktop
                    const gradient = owenWispCtx.createRadialGradient(
                        wisp.x, wisp.y, 0,
                        wisp.x, wisp.y, wisp.size
                    );
                    
                    gradient.addColorStop(0, `rgba(255, 255, 255, ${alpha * 0.5})`);
                    gradient.addColorStop(0.3, `rgba(255, 255, 255, ${alpha * 0.3})`);
                    gradient.addColorStop(0.6, `rgba(255, 255, 255, ${alpha * 0.1})`);
                    gradient.addColorStop(1, `rgba(255, 255, 255, 0)`);
                    
                    owenWispCtx.save();
                    owenWispCtx.translate(wisp.x, wisp.y);
                    owenWispCtx.rotate(wisp.rotation);
                    owenWispCtx.translate(-wisp.x, -wisp.y);
                    
                    owenWispCtx.beginPath();
                    owenWispCtx.arc(wisp.x, wisp.y, wisp.size, 0, Math.PI * 2);
                    owenWispCtx.fillStyle = gradient;
                    owenWispCtx.fill();
                    
                    owenWispCtx.restore();
                }
                
                return true;
            });
            
            owenWispAnimationId = requestAnimationFrame(renderOwenWisps);
        }
        
        function startOwenWispEffect() {
            if (owenWispActive) return;
            owenWispActive = true;
            
            if (!owenWispCtx) {
                initOwenWisp();
            }
            
            const canvas = document.getElementById('owenWispCanvas');
            if (canvas) {
                canvas.classList.add('active');
            }
            
            owenWisps = [];
            renderOwenWisps();
            
            // Add event listeners
            document.addEventListener('touchstart', handleOwenTouch, { passive: true });
            document.addEventListener('mousedown', handleOwenClick);
            document.addEventListener('touchmove', handleOwenTouchMove, { passive: true });
        }
        
        function stopOwenWispEffect() {
            owenWispActive = false;
            
            const canvas = document.getElementById('owenWispCanvas');
            if (canvas) {
                canvas.classList.remove('active');
            }
            
            if (owenWispAnimationId) {
                cancelAnimationFrame(owenWispAnimationId);
                owenWispAnimationId = null;
            }
            
            document.removeEventListener('touchstart', handleOwenTouch);
            document.removeEventListener('mousedown', handleOwenClick);
            document.removeEventListener('touchmove', handleOwenTouchMove);
        }
        
        function handleOwenTouch(e) {
            if (!owenWispActive) return;
            const owenPage = document.getElementById('owenPage');
            if (!owenPage || !owenPage.classList.contains('active')) return;
            
            for (let touch of e.touches) {
                createOwenWisp(touch.clientX, touch.clientY);
            }
            playOwenNote();
        }
        
        function handleOwenClick(e) {
            if (!owenWispActive) return;
            const owenPage = document.getElementById('owenPage');
            if (!owenPage || !owenPage.classList.contains('active')) return;
            
            createOwenWisp(e.clientX, e.clientY);
            playOwenNote();
        }
        
        function handleOwenTouchMove(e) {
            if (!owenWispActive) return;
            const owenPage = document.getElementById('owenPage');
            if (!owenPage || !owenPage.classList.contains('active')) return;
            
            // Create wisps while scrolling (less frequently)
            if (Math.random() > 0.7) {
                for (let touch of e.touches) {
                    createOwenWisp(touch.clientX, touch.clientY);
                }
            }
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            initOwenWisp();
            initRedactReveal();
        });
        
        // ════════════════════════════════════
        // TAP-TO-REVEAL REDACTION SYSTEM
        // Multiple taps declassify hidden text
        // ════════════════════════════════════
        
        function initRedactReveal() {
            const redactions = document.querySelectorAll('#owenPage .owen-redact');
            const TAPS_REQUIRED = 3;
            
            redactions.forEach(redact => {
                let tapCount = 0;
                
                const handleTap = (e) => {
                    // Don't process if already revealed
                    if (redact.classList.contains('revealed')) return;
                    
                    e.stopPropagation();
                    tapCount++;
                    
                    // Visual feedback - glitch animation
                    redact.classList.remove('tapped');
                    void redact.offsetWidth; // Force reflow
                    redact.classList.add('tapped');
                    
                    // Play subtle sound if available
                    if (typeof playUISound === 'function') {
                        playUISound('tick');
                    }
                    
                    // Halfway there - show cracking
                    if (tapCount >= Math.ceil(TAPS_REQUIRED / 2)) {
                        redact.classList.add('cracking');
                    }
                    
                    // Fully revealed
                    if (tapCount >= TAPS_REQUIRED) {
                        redact.classList.remove('cracking');
                        redact.classList.add('revealed');
                        
                        // Optional: play reveal sound
                        if (typeof playUISound === 'function') {
                            playUISound('success');
                        }
                        
                        // Create a wisp at this location for extra effect
                        if (typeof createOwenWisp === 'function' && owenWispActive) {
                            const rect = redact.getBoundingClientRect();
                            createOwenWisp(rect.left + rect.width / 2, rect.top + rect.height / 2);
                        }
                    }
                };
                
                // Handle both click and touch
                redact.addEventListener('click', handleTap);
                redact.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    handleTap(e);
                }, { passive: false });
            });
        }
        
        // ════════════════════════════════════════════════════════════
        // SECTION 3: VOID ATMOSPHERE — PARTICLE & FILTER SYSTEM
        // Floating particles and animated SVG distortion
        // ════════════════════════════════════════════════════════════
        
        // Utility: debounce function
        function debounce(func, wait) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        }
        
        let voidParticles = [];
        let voidCanvas = null;
        let voidCtx = null;
        let voidAnimId = null;
        let voidActive = false;
        
        function initVoidAtmosphere() {
            const container = document.getElementById('section3Void');
            const canvas = document.getElementById('voidCanvas');
            
            if (!container || !canvas) return;
            
            voidCanvas = canvas;
            voidCtx = canvas.getContext('2d');
            
            // Size canvas
            resizeVoidCanvas();
            window.addEventListener('resize', debounce(resizeVoidCanvas, 200));
            
            // Create initial particles
            for (let i = 0; i < 50; i++) {
                createVoidParticle();
            }
        }
        
        function resizeVoidCanvas() {
            if (!voidCanvas) return;
            const container = document.getElementById('section3Void');
            if (!container) return;
            
            const rect = container.getBoundingClientRect();
            const dpr = Math.min(window.devicePixelRatio || 1, 2);
            
            voidCanvas.width = rect.width * dpr;
            voidCanvas.height = rect.height * dpr;
            voidCanvas.style.width = rect.width + 'px';
            voidCanvas.style.height = rect.height + 'px';
            
            if (voidCtx) {
                voidCtx.scale(dpr, dpr);
            }
        }
        
        function createVoidParticle() {
            if (!voidCanvas) return;
            
            const container = document.getElementById('section3Void');
            if (!container) return;
            
            const rect = container.getBoundingClientRect();
            
            voidParticles.push({
                x: Math.random() * rect.width,
                y: Math.random() * rect.height,
                size: Math.random() * 2 + 0.5,
                speedX: (Math.random() - 0.5) * 0.3,
                speedY: Math.random() * -0.5 - 0.1,
                opacity: Math.random() * 0.4 + 0.1,
                pulse: Math.random() * Math.PI * 2,
                pulseSpeed: Math.random() * 0.02 + 0.01
            });
        }
        
        function renderVoidAtmosphere() {
            if (!voidActive || !voidCtx || !voidCanvas) return;
            
            const container = document.getElementById('section3Void');
            if (!container) return;
            
            const rect = container.getBoundingClientRect();
            const dpr = Math.min(window.devicePixelRatio || 1, 2);
            
            // Clear with slight trail
            voidCtx.fillStyle = 'rgba(5, 5, 7, 0.15)';
            voidCtx.fillRect(0, 0, rect.width, rect.height);
            
            // Update and draw particles
            voidParticles.forEach((p, i) => {
                // Update position
                p.x += p.speedX;
                p.y += p.speedY;
                p.pulse += p.pulseSpeed;
                
                // Wrap around
                if (p.y < -10) {
                    p.y = rect.height + 10;
                    p.x = Math.random() * rect.width;
                }
                if (p.x < -10) p.x = rect.width + 10;
                if (p.x > rect.width + 10) p.x = -10;
                
                // Pulsing opacity
                const pulseOpacity = p.opacity * (0.7 + Math.sin(p.pulse) * 0.3);
                
                // Draw particle with glow
                const gradient = voidCtx.createRadialGradient(
                    p.x, p.y, 0,
                    p.x, p.y, p.size * 3
                );
                gradient.addColorStop(0, `rgba(180, 170, 200, ${pulseOpacity})`);
                gradient.addColorStop(0.5, `rgba(140, 130, 170, ${pulseOpacity * 0.5})`);
                gradient.addColorStop(1, 'rgba(100, 90, 130, 0)');
                
                voidCtx.beginPath();
                voidCtx.arc(p.x, p.y, p.size * 3, 0, Math.PI * 2);
                voidCtx.fillStyle = gradient;
                voidCtx.fill();
            });
            
            // Occasionally add new particles
            if (Math.random() < 0.02 && voidParticles.length < 80) {
                createVoidParticle();
            }
            
            // Remove excess particles
            if (voidParticles.length > 80) {
                voidParticles.shift();
            }
            
            voidAnimId = requestAnimationFrame(renderVoidAtmosphere);
        }
        
        function startVoidAtmosphere() {
            if (voidActive) return;
            voidActive = true;
            
            if (!voidCtx) {
                initVoidAtmosphere();
            }
            
            renderVoidAtmosphere();
            animateVoidFilter();
        }
        
        function stopVoidAtmosphere() {
            voidActive = false;
            if (voidAnimId) {
                cancelAnimationFrame(voidAnimId);
                voidAnimId = null;
            }
        }
        
        // Animate the SVG filter for organic distortion
        function animateVoidFilter() {
            if (!voidActive) return;
            
            const turbulence = document.getElementById('voidTurbulence');
            if (turbulence) {
                const time = performance.now() / 1000;
                const baseFreqX = 0.008 + Math.sin(time * 0.3) * 0.003;
                const baseFreqY = 0.006 + Math.cos(time * 0.4) * 0.002;
                turbulence.setAttribute('baseFrequency', `${baseFreqX} ${baseFreqY}`);
            }
            
            requestAnimationFrame(animateVoidFilter);
        }
        
        // Watch for Section 3 visibility
        function checkVoidVisibility() {
            const owenPage = document.getElementById('owenPage');
            const section3 = document.getElementById('section3Void');
            
            if (!owenPage || !owenPage.classList.contains('active') || !section3) {
                stopVoidAtmosphere();
                return;
            }
            
            const rect = section3.getBoundingClientRect();
            const inView = rect.top < window.innerHeight && rect.bottom > 0;
            
            if (inView && !voidActive) {
                startVoidAtmosphere();
            } else if (!inView && voidActive) {
                stopVoidAtmosphere();
            }
        }
        
        // Set up observers
        document.addEventListener('DOMContentLoaded', () => {
            const owenPage = document.getElementById('owenPage');
            if (owenPage) {
                // Watch for Owen page activation
                const observer = new MutationObserver(() => checkVoidVisibility());
                observer.observe(owenPage, { attributes: true });
                
                // Check on scroll
                window.addEventListener('scroll', debounce(checkVoidVisibility, 100), { passive: true });
            }
        });
        
        // ============ GESTURE PREVENTION ============
        // Prevent pinch zoom
        document.addEventListener('gesturestart', function(e) {
            e.preventDefault();
        }, { passive: false });
        
        document.addEventListener('gesturechange', function(e) {
            e.preventDefault();
        }, { passive: false });
        
        document.addEventListener('gestureend', function(e) {
            e.preventDefault();
        }, { passive: false });
        
        // Prevent double-tap zoom on iOS (but not on Owen's page to allow smooth scrolling)
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(e) {
            // Skip double-tap prevention on Owen's page for smoother scrolling
            const owenPage = document.getElementById('owenPage');
            if (owenPage && owenPage.classList.contains('active')) {
                return;
            }
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                e.preventDefault();
            }
            lastTouchEnd = now;
        }, { passive: false });
        
        // Prevent pinch zoom via touch (but allow on Owen's page)
        document.addEventListener('touchmove', function(e) {
            // Skip on Owen's page for smoother scrolling
            const owenPage = document.getElementById('owenPage');
            if (owenPage && owenPage.classList.contains('active')) {
                // Only prevent if more than 1 touch (pinch zoom)
                if (e.touches.length > 1) {
                    e.preventDefault();
                }
                return;
            }
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });
        
        // Prevent context menu on long press
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });
        
        // ═══════════════════════════════════════════
        // SECRET: M.A.R.A. ARCADE EASTER EGG
        // Type "MARA" in the login terminal to access the secret game
        // (Moved to normal command processing for consistent behavior)
        // ═══════════════════════════════════════════
    </script>
    
    <!-- Calibration Overlay -->
    <div id="calibrationOverlay" class="calibration-overlay">
        <div class="calibration-container">
            <div class="calibration-title">SYSTEM CALIBRATION</div>
            <div id="calibrationStatus" class="calibration-status">INITIALIZING...</div>
            <div id="calibrationContent"></div>
            <div class="calibration-progress-bar">
                <div id="calibrationProgress" class="calibration-progress-fill"></div>
            </div>
       